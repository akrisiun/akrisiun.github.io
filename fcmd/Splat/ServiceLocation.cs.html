<!DOCTYPE html>
<html><head><title>ServiceLocation.cs</title><link rel="stylesheet" href="../styles.css"><script src="../scripts.js"></script></head>
<body class="cB" onload="i(424);"><div class="dH">
<table style="width: 100%">
<tr><td>File: <a id="filePath" class="blueLink" href="/#Splat/ServiceLocation.cs" target="_top">ServiceLocation.cs</a><br/></td><td></td></tr>
<tr><td>Project: <a id="projectPath" class="blueLink" href="/#Splat" target="_top">reactive\spat\Splat.Net45.csproj</a> (Splat)</td><td></td></tr>
</table>
</div>
<div class="cz"><table class="tb" cellpadding="0" cellspacing="0"><tr><td valign="top" align="right"><pre id="ln"></pre></td><td valign="top" align="left"><pre id="code">
<b>using</b> <span class="i n">System</span>;
<b>using</b> <span class="i n">System</span>.<span class="i n">Collections</span>.<span class="i n">Generic</span>;
<b>using</b> <span class="i n">System</span>.<span class="i n">Linq</span>;
<b>using</b> <span class="i n">System</span>.<span class="i n">Threading</span>;

<b>namespace</b> <span class="i n">Splat</span>
{
    <b>public static class</b> <a id="f3fb6dab1f276930" href="R/f3fb6dab1f276930.html" target="n" data-glyph="0,0" class="t t">Locator</a>
    {
        [<a href="@0@mscorlib/A.html#b0c23fc7e6f66cf4" class="t constructor">ThreadStatic</a>] <b>static</b> <a href="#aa20bebbc5863f90" class="t t">IDependencyResolver</a> <a id="1f756e19e8b9d9c5" href="R/1f756e19e8b9d9c5.html" target="n" data-glyph="46,1" class="i field">unitTestDependencyResolver</a>;
        <b>static</b> <a href="#aa20bebbc5863f90" class="t t">IDependencyResolver</a> <a id="82f7ca5b97a516a0" href="R/82f7ca5b97a516a0.html" target="n" data-glyph="46,1" class="i field">dependencyResolver</a>;

        <b>static readonly</b> <a href="@0@mscorlib/A.html#cf7f4095e4de7646" class="t t">List</a>&lt;<a href="@0@mscorlib/A.html#9147ae6f76643aae" class="t t">Action</a>&gt; <a id="8e219e9c6bd76f6d" href="R/8e219e9c6bd76f6d.html" target="n" data-glyph="46,1" class="i field">resolverChanged</a> = <b>new</b> <a href="@0@mscorlib/A.html#9e5352b2b304ceba" class="t constructor">List</a>&lt;<a href="@0@mscorlib/A.html#9147ae6f76643aae" class="t t">Action</a>&gt;();

        <b>static</b> <a id="7dd9ab46d718225f" href="R/../../0000000000.html" target="n" data-glyph="76,1" class="i method">Locator</a>()
        {
            <a href="#cdf798a1f9410e09" class="k">var</a> <span id="r0 rd" class="r0 r">r</span> = <b>new</b> <a href="#9a1814bb7f747d22" class="t constructor">ModernDependencyResolver</a>();
            <a href="#82f7ca5b97a516a0" class="i field">dependencyResolver</a> = <span class="r0 r">r</span>;

            <a href="#5d62941ed9ec4b22" class="i method">RegisterResolverCallbackChanged</a>(() =&gt; {
                <b>if</b> (<a href="#f3fb6dab1f276930" class="t t">Locator</a>.<a href="#2c9f08a95aa133ae" class="i property">CurrentMutable</a> == <b>null</b>) <b>return</b>;
                <a href="#f3fb6dab1f276930" class="t t">Locator</a>.<a href="#2c9f08a95aa133ae" class="i property">CurrentMutable</a>.<a href="#3a23d2a697b521a3" class="i method">InitializeSplat</a>();
            });
        }

        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Gets or sets the dependency resolver. This class is used throughout</span>
        <span class="c">///</span><span class="c"> libraries for many internal operations as well as for general use</span>
        <span class="c">///</span><span class="c"> by applications. If this isn&#39;t assigned on startup, a default, highly</span>
        <span class="c">///</span><span class="c"> capable implementation will be used, and it is advised for most people</span>
        <span class="c">///</span><span class="c"> to simply use the default implementation.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">value</span><span class="c">&gt;</span><span class="c">The dependency resolver.</span><span class="c">&lt;/</span><span class="c">value</span><span class="c">&gt;</span>
        <b>public static</b> <a href="#aa20bebbc5863f90" class="t t">IDependencyResolver</a> <a id="ed187ab44399b0bd" href="R/ed187ab44399b0bd.html" target="n" data-glyph="102,1" class="i property">Current</a> {
            <b>get</b> {
                <b>return</b> <a href="#1f756e19e8b9d9c5" class="i field">unitTestDependencyResolver</a> ?? <a href="#82f7ca5b97a516a0" class="i field">dependencyResolver</a>;
            }
            <b>set</b> {
                <b>if</b> (<a href="ModeDetector.cs.html#a415ecd6285c89b5" class="t t">ModeDetector</a>.<a href="ModeDetector.cs.html#7ff87a023176c17c" class="i method">InUnitTestRunner</a>()) {
                    <a href="#1f756e19e8b9d9c5" class="i field">unitTestDependencyResolver</a> = <b>value</b>;
                    <a href="#82f7ca5b97a516a0" class="i field">dependencyResolver</a> = <a href="#82f7ca5b97a516a0" class="i field">dependencyResolver</a> ?? <b>value</b>;
                } <b>else</b> {
                    <a href="#82f7ca5b97a516a0" class="i field">dependencyResolver</a> = <b>value</b>;
                }

                <b>var</b> <span id="r1 rd" class="r1 r">currentCallbacks</span> = <b>default</b>(<a href="@0@mscorlib/A.html#9147ae6f76643aae" class="t t">Action</a>[]);
                <b>lock</b> (<a href="#8e219e9c6bd76f6d" class="i field">resolverChanged</a>) {
                    <span class="c">// NB: Prevent deadlocks should we reenter this setter from </span>
                    <span class="c">// the callbacks</span>
                    <span class="r1 r">currentCallbacks</span> = <a href="#8e219e9c6bd76f6d" class="i field">resolverChanged</a>.<a href="@0@mscorlib/A.html#d4409b7542728cec" class="i method">ToArray</a>();
                }

                <b>foreach</b> (<a href="@0@mscorlib/A.html#9147ae6f76643aae" class="k">var</a> <span id="r2 rd" class="r2 r">block</span> <b>in</b> <span class="r1 r">currentCallbacks</span>) <span class="r2 r">block</span>();
            }
        }

        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Convenience property to return the DependencyResolver cast to a</span>
        <span class="c">///</span><span class="c"> MutableDependencyResolver. The default resolver is also a mutable</span>
        <span class="c">///</span><span class="c"> resolver, so this will be non-null. Use this to register new types</span>
        <span class="c">///</span><span class="c"> on startup if you are using the default resolver</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <b>public static</b> <a href="#eea15e84fd57086b" class="t t">IMutableDependencyResolver</a> <a id="2c9f08a95aa133ae" href="R/2c9f08a95aa133ae.html" target="n" data-glyph="102,1" class="i property">CurrentMutable</a> {
            <b>get</b> { <b>return</b> <a href="#ed187ab44399b0bd" class="i property">Current</a> <b>as</b> <a href="#eea15e84fd57086b" class="t t">IMutableDependencyResolver</a>; }
            <b>set</b> { <a href="#ed187ab44399b0bd" class="i property">Current</a> = <b>value</b>; }
        }

        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> This method allows libraries to register themselves to be set up</span>
        <span class="c">///</span><span class="c"> whenever the dependency resolver changes. Applications should avoid</span>
        <span class="c">///</span><span class="c"> this method, it is usually used for libraries that depend on service</span>
        <span class="c">///</span><span class="c"> location.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span><span class="c"> </span><span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r3 r">callback</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">A callback that is invoked when the </span>
        <span class="c">///</span><span class="c"> resolver is changed. This callback is also invoked immediately,</span>
        <span class="c">///</span><span class="c"> to configure the current resolver.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">returns</span><span class="c">&gt;</span><span class="c">When disposed, removes the callback. You probably can </span>
        <span class="c">///</span><span class="c"> ignore this.</span><span class="c">&lt;/</span><span class="c">returns</span><span class="c">&gt;</span>
        <b>public static</b> <a href="@0@mscorlib/A.html#1f55292c3174123d" class="t t">IDisposable</a> <a id="5d62941ed9ec4b22" href="R/5d62941ed9ec4b22.html" target="n" data-glyph="72,1" class="i method">RegisterResolverCallbackChanged</a>(<a href="@0@mscorlib/A.html#9147ae6f76643aae" class="t t">Action</a> <span id="r3 rd" class="r3 r">callback</span>)
        {
            <b>lock</b> (<a href="#8e219e9c6bd76f6d" class="i field">resolverChanged</a>) {
                <a href="#8e219e9c6bd76f6d" class="i field">resolverChanged</a>.<a href="@0@mscorlib/A.html#9cc11588bffd57c1" class="i method">Add</a>(<span class="r3 r">callback</span>);
            }

            <span class="c">// NB: We always immediately invoke the callback to set up the </span>
            <span class="c">// current resolver with whatever we&#39;ve got</span>
            <span class="r3 r">callback</span>();

            <b>return</b> <b>new</b> <a href="#f2c8ace586861307" class="t constructor">ActionDisposable</a>(() =&gt; {
                <b>lock</b> (<a href="#8e219e9c6bd76f6d" class="i field">resolverChanged</a>) <a href="#8e219e9c6bd76f6d" class="i field">resolverChanged</a>.<a href="@0@mscorlib/A.html#db8cdd552a0bb10c" class="i method">Remove</a>(<span class="r3 r">callback</span>);
            });
        }
    }

    <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
    <span class="c">///</span><span class="c"> Represents a dependency resolver, a service to look up global class </span>
    <span class="c">///</span><span class="c"> instances or types.</span>
    <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
    <b>public interface</b> <a id="aa20bebbc5863f90" href="R/aa20bebbc5863f90.html" target="n" data-glyph="48,0" class="t t">IDependencyResolver</a> : <a href="@0@mscorlib/A.html#1f55292c3174123d" class="t t">IDisposable</a>
    {
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Gets an instance of the given </span><span class="c">&lt;</span><span class="c">paramref</span><span class="c"> </span><span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r4 r">serviceType</span><span class="c">&quot;</span><span class="c">/&gt;</span><span class="c">. Must return </span><span class="c">&lt;</span><span class="c">c</span><span class="c">&gt;</span><span class="c">null</span><span class="c">&lt;/</span><span class="c">c</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> if the service is not available (must not throw).</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span><span class="c"> </span><span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r4 r">serviceType</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">The object type.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">returns</span><span class="c">&gt;</span><span class="c">The requested object, if found; </span><span class="c">&lt;</span><span class="c">c</span><span class="c">&gt;</span><span class="c">null</span><span class="c">&lt;/</span><span class="c">c</span><span class="c">&gt;</span><span class="c"> otherwise.</span><span class="c">&lt;/</span><span class="c">returns</span><span class="c">&gt;</span>
        <b>object</b> <a id="9094a9e98adcc6f2" href="R/9094a9e98adcc6f2.html" target="n" data-glyph="72,1" class="i method">GetService</a>(<a href="@0@mscorlib/A.html#3d00eeab9feb80f3" class="t t">Type</a> <span id="r4 rd" class="r4 r">serviceType</span>, <b>string</b> <span id="r5 rd" class="r5 r">contract</span> = <b>null</b>);

        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Gets all instances of the given </span><span class="c">&lt;</span><span class="c">paramref</span><span class="c"> </span><span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r6 r">serviceType</span><span class="c">&quot;</span><span class="c">/&gt;</span><span class="c">. Must return an empty</span>
        <span class="c">///</span><span class="c"> collection if the service is not available (must not return </span><span class="c">&lt;</span><span class="c">c</span><span class="c">&gt;</span><span class="c">null</span><span class="c">&lt;/</span><span class="c">c</span><span class="c">&gt;</span><span class="c"> or throw).</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span><span class="c"> </span><span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r6 r">serviceType</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">The object type.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">returns</span><span class="c">&gt;</span><span class="c">A sequence of instances of the requested </span><span class="c">&lt;</span><span class="c">paramref</span><span class="c"> </span><span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r6 r">serviceType</span><span class="c">&quot;</span><span class="c">/&gt;</span><span class="c">. The sequence</span>
        <span class="c">///</span><span class="c"> should be empty (not </span><span class="c">&lt;</span><span class="c">c</span><span class="c">&gt;</span><span class="c">null</span><span class="c">&lt;/</span><span class="c">c</span><span class="c">&gt;</span><span class="c">) if no objects of the given type are available.</span><span class="c">&lt;/</span><span class="c">returns</span><span class="c">&gt;</span>
        <a href="@0@mscorlib/A.html#3acf01620172c7f0" class="t t">IEnumerable</a>&lt;<b>object</b>&gt; <a id="d74663104080ef49" href="R/d74663104080ef49.html" target="n" data-glyph="72,1" class="i method">GetServices</a>(<a href="@0@mscorlib/A.html#3d00eeab9feb80f3" class="t t">Type</a> <span id="r6 rd" class="r6 r">serviceType</span>, <b>string</b> <span id="r7 rd" class="r7 r">contract</span> = <b>null</b>);
    }

    <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
    <span class="c">///</span><span class="c"> Represents a dependency resolver where types can be registered after </span>
    <span class="c">///</span><span class="c"> setup.</span>
    <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
    <b>public interface</b> <a id="eea15e84fd57086b" href="R/eea15e84fd57086b.html" target="n" data-glyph="48,0" class="t t">IMutableDependencyResolver</a> : <a href="#aa20bebbc5863f90" class="t t">IDependencyResolver</a>
    {
        <b>void</b> <a id="fa61f39dc84e5de6" href="R/fa61f39dc84e5de6.html" target="n" data-glyph="72,1" class="i method">Register</a>(<a href="@0@mscorlib/A.html#87d60abb7092d5a4" class="t t">Func</a>&lt;<b>object</b>&gt; <span id="r8 rd" class="r8 r">factory</span>, <a href="@0@mscorlib/A.html#3d00eeab9feb80f3" class="t t">Type</a> <span id="r9 rd" class="r9 r">serviceType</span>, <b>string</b> <span id="r10 rd" class="r10 r">contract</span> = <b>null</b>);

        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Register a callback to be called when a new service matching the type </span>
        <span class="c">///</span><span class="c"> and contract is registered.</span>
        <span class="c">///</span><span class="c"> </span>
        <span class="c">///</span><span class="c"> When registered, the callback is also called for each currently matching </span>
        <span class="c">///</span><span class="c"> service.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">returns</span><span class="c">&gt;</span><span class="c">When disposed removes the callback</span><span class="c">&lt;/</span><span class="c">returns</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span><span class="c"> </span><span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r11 r">serviceType</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">Service type.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span><span class="c"> </span><span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r12 r">contract</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">Contract.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span><span class="c"> </span><span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r13 r">callback</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">Callback.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <a href="@0@mscorlib/A.html#1f55292c3174123d" class="t t">IDisposable</a> <a id="365d83a02eb8e1a0" href="R/365d83a02eb8e1a0.html" target="n" data-glyph="72,1" class="i method">ServiceRegistrationCallback</a>(<a href="@0@mscorlib/A.html#3d00eeab9feb80f3" class="t t">Type</a> <span id="r11 rd" class="r11 r">serviceType</span>, <b>string</b> <span id="r12 rd" class="r12 r">contract</span>, <a href="@0@mscorlib/A.html#486d58da4553e12d" class="t t">Action</a>&lt;<a href="@0@mscorlib/A.html#1f55292c3174123d" class="t t">IDisposable</a>&gt; <span id="r13 rd" class="r13 r">callback</span>);
    }

    <b>public static class</b> <a id="937861a16701613b" href="R/../../0000000000.html" target="n" data-glyph="0,0" class="t t">DependencyResolverMixins</a>
    {
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Gets an instance of the given </span><span class="c">&lt;</span><span class="c">paramref</span><span class="c"> </span><span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="i">serviceType</span><span class="c">&quot;</span><span class="c">/&gt;</span><span class="c">. Must return </span><span class="c">&lt;</span><span class="c">c</span><span class="c">&gt;</span><span class="c">null</span><span class="c">&lt;/</span><span class="c">c</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> if the service is not available (must not throw).</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span><span class="c"> </span><span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="i">serviceType</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">The object type.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">returns</span><span class="c">&gt;</span><span class="c">The requested object, if found; </span><span class="c">&lt;</span><span class="c">c</span><span class="c">&gt;</span><span class="c">null</span><span class="c">&lt;/</span><span class="c">c</span><span class="c">&gt;</span><span class="c"> otherwise.</span><span class="c">&lt;/</span><span class="c">returns</span><span class="c">&gt;</span>
        <b>public static</b> <span class="r14 r t">T</span> <a id="5de6a59eae056bea" href="R/5de6a59eae056bea.html" target="n" data-glyph="220,1" class="i method">GetService</a>&lt;<span id="r14 rd t" class="r14 r t">T</span>&gt;(<b>this</b> <a href="#aa20bebbc5863f90" class="t t">IDependencyResolver</a> <span id="r15 rd" class="r15 r">This</span>, <b>string</b> <span id="r16 rd" class="r16 r">contract</span> = <b>null</b>)
        {
            <b>return</b> (<span class="r14 r t">T</span>)<span class="r15 r">This</span>.<a href="#9094a9e98adcc6f2" class="i method">GetService</a>(<b>typeof</b>(<span class="r14 r t">T</span>), <span class="r16 r">contract</span>);
        }

        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Gets all instances of the given </span><span class="c">&lt;</span><span class="c">paramref</span><span class="c"> </span><span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="i">serviceType</span><span class="c">&quot;</span><span class="c">/&gt;</span><span class="c">. Must return an empty</span>
        <span class="c">///</span><span class="c"> collection if the service is not available (must not return </span><span class="c">&lt;</span><span class="c">c</span><span class="c">&gt;</span><span class="c">null</span><span class="c">&lt;/</span><span class="c">c</span><span class="c">&gt;</span><span class="c"> or throw).</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span><span class="c"> </span><span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="i">serviceType</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">The object type.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">returns</span><span class="c">&gt;</span><span class="c">A sequence of instances of the requested </span><span class="c">&lt;</span><span class="c">paramref</span><span class="c"> </span><span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="i">serviceType</span><span class="c">&quot;</span><span class="c">/&gt;</span><span class="c">. The sequence</span>
        <span class="c">///</span><span class="c"> should be empty (not </span><span class="c">&lt;</span><span class="c">c</span><span class="c">&gt;</span><span class="c">null</span><span class="c">&lt;/</span><span class="c">c</span><span class="c">&gt;</span><span class="c">) if no objects of the given type are available.</span><span class="c">&lt;/</span><span class="c">returns</span><span class="c">&gt;</span>
        <b>public static</b> <a href="@0@mscorlib/A.html#3acf01620172c7f0" class="t t">IEnumerable</a>&lt;<span class="r17 r t">T</span>&gt; <a id="bd40ac240176eba0" href="R/../../0000000000.html" target="n" data-glyph="220,1" class="i method">GetServices</a>&lt;<span id="r17 rd t" class="r17 r t">T</span>&gt;(<b>this</b> <a href="#aa20bebbc5863f90" class="t t">IDependencyResolver</a> <span id="r18 rd" class="r18 r">This</span>, <b>string</b> <span id="r19 rd" class="r19 r">contract</span> = <b>null</b>)
        {
            <b>return</b> <span class="r18 r">This</span>.<a href="#d74663104080ef49" class="i method">GetServices</a>(<b>typeof</b>(<span class="r17 r t">T</span>), <span class="r19 r">contract</span>).<a href="@0@System.Core/A.html#27bb217a6d5457ec" class="i method">Cast</a>&lt;<span class="r17 r t">T</span>&gt;();
        }

        <b>public static</b> <a href="@0@mscorlib/A.html#1f55292c3174123d" class="t t">IDisposable</a> <a id="031cca35a14d150d" href="R/../../0000000000.html" target="n" data-glyph="220,1" class="i method">ServiceRegistrationCallback</a>(<b>this</b> <a href="#eea15e84fd57086b" class="t t">IMutableDependencyResolver</a> <span id="r20 rd" class="r20 r">This</span>, <a href="@0@mscorlib/A.html#3d00eeab9feb80f3" class="t t">Type</a> <span id="r21 rd" class="r21 r">serviceType</span>, <a href="@0@mscorlib/A.html#486d58da4553e12d" class="t t">Action</a>&lt;<a href="@0@mscorlib/A.html#1f55292c3174123d" class="t t">IDisposable</a>&gt; <span id="r22 rd" class="r22 r">callback</span>)
        {
            <b>return</b> <span class="r20 r">This</span>.<a href="#365d83a02eb8e1a0" class="i method">ServiceRegistrationCallback</a>(<span class="r21 r">serviceType</span>, <b>null</b>, <span class="r22 r">callback</span>);
        }

        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Override the default Dependency Resolver until the object returned </span>
        <span class="c">///</span><span class="c"> is disposed.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span><span class="c"> </span><span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r23 r">resolver</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">The test resolver to use.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <b>public static</b> <a href="@0@mscorlib/A.html#1f55292c3174123d" class="t t">IDisposable</a> <a id="a65d457c7ef09c71" href="R/../../0000000000.html" target="n" data-glyph="220,1" class="i method">WithResolver</a>(<b>this</b> <a href="#aa20bebbc5863f90" class="t t">IDependencyResolver</a> <span id="r23 rd" class="r23 r">resolver</span>)
        {
            <a href="#aa20bebbc5863f90" class="k">var</a> <span id="r24 rd" class="r24 r">origResolver</span> = <a href="#f3fb6dab1f276930" class="t t">Locator</a>.<a href="#ed187ab44399b0bd" class="i property">Current</a>;
            <a href="#f3fb6dab1f276930" class="t t">Locator</a>.<a href="#ed187ab44399b0bd" class="i property">Current</a> = <span class="r23 r">resolver</span>;

            <b>return</b> <b>new</b> <a href="#f2c8ace586861307" class="t constructor">ActionDisposable</a>(() =&gt; <a href="#f3fb6dab1f276930" class="t t">Locator</a>.<a href="#ed187ab44399b0bd" class="i property">Current</a> = <span class="r24 r">origResolver</span>);
        }
                
        <b>public static void</b> <a id="1b2b161a1136edea" href="R/1b2b161a1136edea.html" target="n" data-glyph="220,1" class="i method">RegisterConstant</a>(<b>this</b> <a href="#eea15e84fd57086b" class="t t">IMutableDependencyResolver</a> <span id="r25 rd" class="r25 r">This</span>, <b>object</b> <span id="r26 rd" class="r26 r">value</span>, <a href="@0@mscorlib/A.html#3d00eeab9feb80f3" class="t t">Type</a> <span id="r27 rd" class="r27 r">serviceType</span>, <b>string</b> <span id="r28 rd" class="r28 r">contract</span> = <b>null</b>)
        {
            <span class="r25 r">This</span>.<a href="#fa61f39dc84e5de6" class="i method">Register</a>(() =&gt; <span class="r26 r">value</span>, <span class="r27 r">serviceType</span>, <span class="r28 r">contract</span>);
        }

        <b>public static void</b> <a id="f7c3d471eb250785" href="R/../../0000000000.html" target="n" data-glyph="220,1" class="i method">RegisterLazySingleton</a>(<b>this</b> <a href="#eea15e84fd57086b" class="t t">IMutableDependencyResolver</a> <span id="r29 rd" class="r29 r">This</span>, <a href="@0@mscorlib/A.html#87d60abb7092d5a4" class="t t">Func</a>&lt;<b>object</b>&gt; <span id="r30 rd" class="r30 r">valueFactory</span>, <a href="@0@mscorlib/A.html#3d00eeab9feb80f3" class="t t">Type</a> <span id="r31 rd" class="r31 r">serviceType</span>, <b>string</b> <span id="r32 rd" class="r32 r">contract</span> = <b>null</b>)
        {
            <a href="@0@mscorlib/A.html#8b99c1f377873554" class="k">var</a> <span id="r33 rd" class="r33 r">val</span> = <b>new</b> <a href="@0@mscorlib/A.html#00bfaf5130ba4f04" class="t constructor">Lazy</a>&lt;<b>object</b>&gt;(<span class="r30 r">valueFactory</span>, <a href="@0@mscorlib/A.html#9d99e1ca53509514" class="t t">LazyThreadSafetyMode</a>.<a href="@0@mscorlib/A.html#a0f06cbca5bbe6e6" class="i field">ExecutionAndPublication</a>);
            <span class="r29 r">This</span>.<a href="#fa61f39dc84e5de6" class="i method">Register</a>(() =&gt; <span class="r33 r">val</span>.<a href="@0@mscorlib/A.html#606a17645b0dc0ff" class="i property">Value</a>, <span class="r31 r">serviceType</span>, <span class="r32 r">contract</span>);
        }

        <b>public static void</b> <a id="3a23d2a697b521a3" href="R/3a23d2a697b521a3.html" target="n" data-glyph="220,1" class="i method">InitializeSplat</a>(<b>this</b> <a href="#eea15e84fd57086b" class="t t">IMutableDependencyResolver</a> <span id="r34 rd" class="r34 r">This</span>)
        {
            <span class="r34 r">This</span>.<a href="#fa61f39dc84e5de6" class="i method">Register</a>(() =&gt; <b>new</b> <a href="Logging.cs.html#cc5692f86ae609b5" class="t constructor">DefaultLogManager</a>(), <b>typeof</b>(<a href="Logging.cs.html#05a376ee40d98fc7" class="t t">ILogManager</a>));
            <span class="r34 r">This</span>.<a href="#1b2b161a1136edea" class="i method">RegisterConstant</a>(<b>new</b> <a href="Logging.cs.html#79b20693fc774b3b" class="t constructor">DebugLogger</a>(), <b>typeof</b>(<a href="Logging.cs.html#e0a22d3009c7e1d5" class="t t">ILogger</a>));
        }
    }

    <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
    <span class="c">///</span><span class="c"> This class is a dependency resolver written for modern C# 5.0 times. </span>
    <span class="c">///</span><span class="c"> It implements all registrations via a Factory method. With the power</span>
    <span class="c">///</span><span class="c"> of Closures, you can actually implement most lifetime styles (i.e.</span>
    <span class="c">///</span><span class="c"> construct per call, lazy construct, singleton) using this.</span>
    <span class="c">///</span>
    <span class="c">///</span><span class="c"> Unless you have a very compelling reason not to, this is the only class</span>
    <span class="c">///</span><span class="c"> you need in order to do dependency resolution, don&#39;t bother with using</span>
    <span class="c">///</span><span class="c"> a full IoC container.</span>
    <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
    <b>public class</b> <a id="cdf798a1f9410e09" href="R/cdf798a1f9410e09.html" target="n" data-glyph="0,0" class="t t">ModernDependencyResolver</a> : <a href="#eea15e84fd57086b" class="t t">IMutableDependencyResolver</a>
    {
        <a href="@0@mscorlib/A.html#d3599058f8d79be0" class="t t">Dictionary</a>&lt;<a href="@0@mscorlib/A.html#1806cf6634f5a371" class="t t">Tuple</a>&lt;<a href="@0@mscorlib/A.html#3d00eeab9feb80f3" class="t t">Type</a>, <b>string</b>&gt;, <a href="@0@mscorlib/A.html#cf7f4095e4de7646" class="t t">List</a>&lt;<a href="@0@mscorlib/A.html#87d60abb7092d5a4" class="t t">Func</a>&lt;<b>object</b>&gt;&gt;&gt; <a id="b682f562814cb222" href="R/b682f562814cb222.html" target="n" data-glyph="46,1" class="i field">_registry</a>;
        <a href="@0@mscorlib/A.html#d3599058f8d79be0" class="t t">Dictionary</a>&lt;<a href="@0@mscorlib/A.html#1806cf6634f5a371" class="t t">Tuple</a>&lt;<a href="@0@mscorlib/A.html#3d00eeab9feb80f3" class="t t">Type</a>, <b>string</b>&gt;, <a href="@0@mscorlib/A.html#cf7f4095e4de7646" class="t t">List</a>&lt;<a href="@0@mscorlib/A.html#486d58da4553e12d" class="t t">Action</a>&lt;<a href="@0@mscorlib/A.html#1f55292c3174123d" class="t t">IDisposable</a>&gt;&gt;&gt; <a id="fa715f910b652216" href="R/fa715f910b652216.html" target="n" data-glyph="46,1" class="i field">_callbackRegistry</a>;

        <b>public</b> <a id="9a1814bb7f747d22" href="R/9a1814bb7f747d22.html" target="n" data-glyph="72,1" class="i constructor">ModernDependencyResolver</a>() : <a href="#511840f71aaecfae" class="k">this</a>(<b>null</b>) { }

        <b>protected</b> <a id="511840f71aaecfae" href="R/511840f71aaecfae.html" target="n" data-glyph="75,1" class="i constructor">ModernDependencyResolver</a>(<a href="@0@mscorlib/A.html#d3599058f8d79be0" class="t t">Dictionary</a>&lt;<a href="@0@mscorlib/A.html#1806cf6634f5a371" class="t t">Tuple</a>&lt;<a href="@0@mscorlib/A.html#3d00eeab9feb80f3" class="t t">Type</a>, <b>string</b>&gt;, <a href="@0@mscorlib/A.html#cf7f4095e4de7646" class="t t">List</a>&lt;<a href="@0@mscorlib/A.html#87d60abb7092d5a4" class="t t">Func</a>&lt;<b>object</b>&gt;&gt;&gt; <span id="r35 rd" class="r35 r">registry</span>)
        {
            <a href="#b682f562814cb222" class="i field">_registry</a> = <span class="r35 r">registry</span> != <b>null</b> ? 
                <span class="r35 r">registry</span>.<a href="@0@System.Core/A.html#c7f3fa13329a79cd" class="i method">ToDictionary</a>(<span id="r36 rd" class="r36 r">k</span> =&gt; <span class="r36 r">k</span>.<a href="@0@mscorlib/A.html#f9d1c04feb1af032" class="i property">Key</a>, <span id="r37 rd" class="r37 r">v</span> =&gt; <span class="r37 r">v</span>.<a href="@0@mscorlib/A.html#38c0e86cc4b30170" class="i property">Value</a>.<a href="@0@System.Core/A.html#e276d6892241255b" class="i method">ToList</a>()) :
                <b>new</b> <a href="@0@mscorlib/A.html#bf6849e410b43c4c" class="t constructor">Dictionary</a>&lt;<a href="@0@mscorlib/A.html#1806cf6634f5a371" class="t t">Tuple</a>&lt;<a href="@0@mscorlib/A.html#3d00eeab9feb80f3" class="t t">Type</a>, <b>string</b>&gt;, <a href="@0@mscorlib/A.html#cf7f4095e4de7646" class="t t">List</a>&lt;<a href="@0@mscorlib/A.html#87d60abb7092d5a4" class="t t">Func</a>&lt;<b>object</b>&gt;&gt;&gt;();

            <a href="#fa715f910b652216" class="i field">_callbackRegistry</a> = <b>new</b> <a href="@0@mscorlib/A.html#bf6849e410b43c4c" class="t constructor">Dictionary</a>&lt;<a href="@0@mscorlib/A.html#1806cf6634f5a371" class="t t">Tuple</a>&lt;<a href="@0@mscorlib/A.html#3d00eeab9feb80f3" class="t t">Type</a>, <b>string</b>&gt;, <a href="@0@mscorlib/A.html#cf7f4095e4de7646" class="t t">List</a>&lt;<a href="@0@mscorlib/A.html#486d58da4553e12d" class="t t">Action</a>&lt;<a href="@0@mscorlib/A.html#1f55292c3174123d" class="t t">IDisposable</a>&gt;&gt;&gt;();
        }

        <b>public void</b> <a id="a6240b5fe4df7947" href="R/a6240b5fe4df7947.html" target="n" data-glyph="72,1" class="i method">Register</a>(<a href="@0@mscorlib/A.html#87d60abb7092d5a4" class="t t">Func</a>&lt;<b>object</b>&gt; <span id="r38 rd" class="r38 r">factory</span>, <a href="@0@mscorlib/A.html#3d00eeab9feb80f3" class="t t">Type</a> <span id="r39 rd" class="r39 r">serviceType</span>, <b>string</b> <span id="r40 rd" class="r40 r">contract</span> = <b>null</b>)
        {
            <a href="@0@mscorlib/A.html#1806cf6634f5a371" class="k">var</a> <span id="r41 rd" class="r41 r">pair</span> = <a href="@0@mscorlib/A.html#9124c4bea9ab0199" class="t t">Tuple</a>.<a href="@0@mscorlib/A.html#5cc616d5264cd769" class="i method">Create</a>(<span class="r39 r">serviceType</span>, <span class="r40 r">contract</span> ?? <b>string</b>.<a href="@0@mscorlib/A.html#c9f70a27facb27cf" class="i field">Empty</a>);
            <b>if</b> (!<a href="#b682f562814cb222" class="i field">_registry</a>.<a href="@0@mscorlib/A.html#22fd7cd7408aed6e" class="i method">ContainsKey</a>(<span class="r41 r">pair</span>)) {
                <a href="#b682f562814cb222" class="i field">_registry</a><a href="@0@mscorlib/A.html#49962975508e2d83">[</a><span class="r41 r">pair</span>] = <b>new</b> <a href="@0@mscorlib/A.html#9e5352b2b304ceba" class="t constructor">List</a>&lt;<a href="@0@mscorlib/A.html#87d60abb7092d5a4" class="t t">Func</a>&lt;<b>object</b>&gt;&gt;();
            }

            <a href="#b682f562814cb222" class="i field">_registry</a><a href="@0@mscorlib/A.html#49962975508e2d83">[</a><span class="r41 r">pair</span>].<a href="@0@mscorlib/A.html#9cc11588bffd57c1" class="i method">Add</a>(<span class="r38 r">factory</span>);

            <b>if</b> (<a href="#fa715f910b652216" class="i field">_callbackRegistry</a>.<a href="@0@mscorlib/A.html#22fd7cd7408aed6e" class="i method">ContainsKey</a>(<span class="r41 r">pair</span>)) {
                <a href="@0@mscorlib/A.html#cf7f4095e4de7646" class="t t">List</a>&lt;<a href="@0@mscorlib/A.html#486d58da4553e12d" class="t t">Action</a>&lt;<a href="@0@mscorlib/A.html#1f55292c3174123d" class="t t">IDisposable</a>&gt;&gt; <span id="r42 rd" class="r42 r">toRemove</span> = <b>null</b>;

                <b>foreach</b> (<a href="@0@mscorlib/A.html#486d58da4553e12d" class="k">var</a> <span id="r43 rd" class="r43 r">callback</span> <b>in</b> <a href="#fa715f910b652216" class="i field">_callbackRegistry</a><a href="@0@mscorlib/A.html#49962975508e2d83">[</a><span class="r41 r">pair</span>]) {
                    <a href="@0@mscorlib/A.html#f1b135ff6c380b37" class="k">var</a> <span id="r44 rd" class="r44 r">remove</span> = <b>false</b>;
                    <a href="#262687a4a218dd94" class="k">var</a> <span id="r45 rd" class="r45 r">disp</span> = <b>new</b> <a href="#f2c8ace586861307" class="t constructor">ActionDisposable</a>(() =&gt; {
                        <span class="r44 r">remove</span> = <b>true</b>;
                    });

                    <span class="r43 r">callback</span>(<span class="r45 r">disp</span>);

                    <b>if</b> (<span class="r44 r">remove</span>) {
                        <b>if</b> (<span class="r42 r">toRemove</span> == <b>null</b>) {
                            <span class="r42 r">toRemove</span> = <b>new</b> <a href="@0@mscorlib/A.html#9e5352b2b304ceba" class="t constructor">List</a>&lt;<a href="@0@mscorlib/A.html#486d58da4553e12d" class="t t">Action</a>&lt;<a href="@0@mscorlib/A.html#1f55292c3174123d" class="t t">IDisposable</a>&gt;&gt;();
                        }

                        <span class="r42 r">toRemove</span>.<a href="@0@mscorlib/A.html#9cc11588bffd57c1" class="i method">Add</a>(<span class="r43 r">callback</span>);
                    }
                }

                <b>if</b> (<span class="r42 r">toRemove</span> != <b>null</b>) {
                    <b>foreach</b> (<a href="@0@mscorlib/A.html#486d58da4553e12d" class="k">var</a> <span id="r46 rd" class="r46 r">c</span> <b>in</b> <span class="r42 r">toRemove</span>) {
                        <a href="#fa715f910b652216" class="i field">_callbackRegistry</a><a href="@0@mscorlib/A.html#49962975508e2d83">[</a><span class="r41 r">pair</span>].<a href="@0@mscorlib/A.html#db8cdd552a0bb10c" class="i method">Remove</a>(<span class="r46 r">c</span>);
                    }
                }
            }
        }

        <b>public object</b> <a id="96fa6fb415758ba4" href="R/96fa6fb415758ba4.html" target="n" data-glyph="72,1" class="i method">GetService</a>(<a href="@0@mscorlib/A.html#3d00eeab9feb80f3" class="t t">Type</a> <span id="r47 rd" class="r47 r">serviceType</span>, <b>string</b> <span id="r48 rd" class="r48 r">contract</span> = <b>null</b>)
        {
            <a href="@0@mscorlib/A.html#1806cf6634f5a371" class="k">var</a> <span id="r49 rd" class="r49 r">pair</span> = <a href="@0@mscorlib/A.html#9124c4bea9ab0199" class="t t">Tuple</a>.<a href="@0@mscorlib/A.html#5cc616d5264cd769" class="i method">Create</a>(<span class="r47 r">serviceType</span>, <span class="r48 r">contract</span> ?? <b>string</b>.<a href="@0@mscorlib/A.html#c9f70a27facb27cf" class="i field">Empty</a>);
            <b>if</b> (!<a href="#b682f562814cb222" class="i field">_registry</a>.<a href="@0@mscorlib/A.html#22fd7cd7408aed6e" class="i method">ContainsKey</a>(<span class="r49 r">pair</span>)) <b>return default</b>(<b>object</b>);

            <a href="@0@mscorlib/A.html#87d60abb7092d5a4" class="k">var</a> <span id="r50 rd" class="r50 r">ret</span> = <a href="#b682f562814cb222" class="i field">_registry</a><a href="@0@mscorlib/A.html#49962975508e2d83">[</a><span class="r49 r">pair</span>].<a href="@0@System.Core/A.html#75722fd194dc2e0e" class="i method">Last</a>();
            <b>return</b> <span class="r50 r">ret</span>();
        }

        <b>public</b> <a href="@0@mscorlib/A.html#3acf01620172c7f0" class="t t">IEnumerable</a>&lt;<b>object</b>&gt; <a id="715ea50ac4d069ea" href="R/715ea50ac4d069ea.html" target="n" data-glyph="72,1" class="i method">GetServices</a>(<a href="@0@mscorlib/A.html#3d00eeab9feb80f3" class="t t">Type</a> <span id="r51 rd" class="r51 r">serviceType</span>, <b>string</b> <span id="r52 rd" class="r52 r">contract</span> = <b>null</b>)
        {
            <a href="@0@mscorlib/A.html#1806cf6634f5a371" class="k">var</a> <span id="r53 rd" class="r53 r">pair</span> = <a href="@0@mscorlib/A.html#9124c4bea9ab0199" class="t t">Tuple</a>.<a href="@0@mscorlib/A.html#5cc616d5264cd769" class="i method">Create</a>(<span class="r51 r">serviceType</span>, <span class="r52 r">contract</span> ?? <b>string</b>.<a href="@0@mscorlib/A.html#c9f70a27facb27cf" class="i field">Empty</a>);
            <b>if</b> (!<a href="#b682f562814cb222" class="i field">_registry</a>.<a href="@0@mscorlib/A.html#22fd7cd7408aed6e" class="i method">ContainsKey</a>(<span class="r53 r">pair</span>)) <b>return</b> <a href="@0@System.Core/A.html#577032c8811e20d3" class="t t">Enumerable</a>.<a href="@0@System.Core/A.html#4d026772cf3399f5" class="i method">Empty</a>&lt;<b>object</b>&gt;();

            <b>return</b> <a href="#b682f562814cb222" class="i field">_registry</a><a href="@0@mscorlib/A.html#49962975508e2d83">[</a><span class="r53 r">pair</span>].<a href="@0@System.Core/A.html#5c652c53e80df013" class="i method">Select</a>(<span id="r54 rd" class="r54 r">x</span> =&gt; <span class="r54 r">x</span>()).<a href="@0@System.Core/A.html#e276d6892241255b" class="i method">ToList</a>();
        }

        <b>public</b> <a href="@0@mscorlib/A.html#1f55292c3174123d" class="t t">IDisposable</a> <a id="4b6bb13141f91b8f" href="R/4b6bb13141f91b8f.html" target="n" data-glyph="72,1" class="i method">ServiceRegistrationCallback</a>(<a href="@0@mscorlib/A.html#3d00eeab9feb80f3" class="t t">Type</a> <span id="r55 rd" class="r55 r">serviceType</span>, <b>string</b> <span id="r56 rd" class="r56 r">contract</span>, <a href="@0@mscorlib/A.html#486d58da4553e12d" class="t t">Action</a>&lt;<a href="@0@mscorlib/A.html#1f55292c3174123d" class="t t">IDisposable</a>&gt; <span id="r57 rd" class="r57 r">callback</span>)
        {
            <a href="@0@mscorlib/A.html#1806cf6634f5a371" class="k">var</a> <span id="r58 rd" class="r58 r">pair</span> = <a href="@0@mscorlib/A.html#9124c4bea9ab0199" class="t t">Tuple</a>.<a href="@0@mscorlib/A.html#5cc616d5264cd769" class="i method">Create</a>(<span class="r55 r">serviceType</span>, <span class="r56 r">contract</span> ?? <b>string</b>.<a href="@0@mscorlib/A.html#c9f70a27facb27cf" class="i field">Empty</a>);

            <b>if</b> (!<a href="#fa715f910b652216" class="i field">_callbackRegistry</a>.<a href="@0@mscorlib/A.html#22fd7cd7408aed6e" class="i method">ContainsKey</a>(<span class="r58 r">pair</span>)) {
                <a href="#fa715f910b652216" class="i field">_callbackRegistry</a><a href="@0@mscorlib/A.html#49962975508e2d83">[</a><span class="r58 r">pair</span>] = <b>new</b> <a href="@0@mscorlib/A.html#9e5352b2b304ceba" class="t constructor">List</a>&lt;<a href="@0@mscorlib/A.html#486d58da4553e12d" class="t t">Action</a>&lt;<a href="@0@mscorlib/A.html#1f55292c3174123d" class="t t">IDisposable</a>&gt;&gt;();
            }

            <a href="#fa715f910b652216" class="i field">_callbackRegistry</a><a href="@0@mscorlib/A.html#49962975508e2d83">[</a><span class="r58 r">pair</span>].<a href="@0@mscorlib/A.html#9cc11588bffd57c1" class="i method">Add</a>(<span class="r57 r">callback</span>);

            <a href="#262687a4a218dd94" class="k">var</a> <span id="r59 rd" class="r59 r">disp</span> = <b>new</b> <a href="#f2c8ace586861307" class="t constructor">ActionDisposable</a>(() =&gt; {
                <a href="#fa715f910b652216" class="i field">_callbackRegistry</a><a href="@0@mscorlib/A.html#49962975508e2d83">[</a><span class="r58 r">pair</span>].<a href="@0@mscorlib/A.html#db8cdd552a0bb10c" class="i method">Remove</a>(<span class="r57 r">callback</span>);
            });

            <b>if</b> (<a href="#b682f562814cb222" class="i field">_registry</a>.<a href="@0@mscorlib/A.html#22fd7cd7408aed6e" class="i method">ContainsKey</a>(<span class="r58 r">pair</span>)) {
                <b>foreach</b> (<a href="@0@mscorlib/A.html#87d60abb7092d5a4" class="k">var</a> <span id="r60 rd" class="r60 r">s</span> <b>in</b> <a href="#b682f562814cb222" class="i field">_registry</a><a href="@0@mscorlib/A.html#49962975508e2d83">[</a><span class="r58 r">pair</span>]) {
                    <span class="r57 r">callback</span>(<span class="r59 r">disp</span>);
                }
            }

            <b>return</b> <span class="r59 r">disp</span>;
        }

        <b>public</b> <a href="#cdf798a1f9410e09" class="t t">ModernDependencyResolver</a> <a id="c14b73e5e65e66ed" href="R/../../0000000000.html" target="n" data-glyph="72,1" class="i method">Duplicate</a>()
        {
            <b>return</b> <b>new</b> <a href="#511840f71aaecfae" class="t constructor">ModernDependencyResolver</a>(<a href="#b682f562814cb222" class="i field">_registry</a>);
        }

        <b>public void</b> <a id="9e9ed7face3f5924" href="R/9e9ed7face3f5924.html" target="n" data-glyph="72,1" class="i method">Dispose</a>()
        {
            <a href="#b682f562814cb222" class="i field">_registry</a> = <b>null</b>;
        }
    }

    <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
    <span class="c">///</span><span class="c"> A simple dependency resolver which takes Funcs for all its actions.</span>
    <span class="c">///</span><span class="c"> GetService is always implemented via GetServices().LastOrDefault()</span>
    <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
    <b>public class</b> <a id="b44df45c07d4ce24" href="R/../../0000000000.html" target="n" data-glyph="0,0" class="t t">FuncDependencyResolver</a> : <a href="#eea15e84fd57086b" class="t t">IMutableDependencyResolver</a>
    {
        <b>readonly</b> <a href="@0@mscorlib/A.html#8adbe0476ca899db" class="t t">Func</a>&lt;<a href="@0@mscorlib/A.html#3d00eeab9feb80f3" class="t t">Type</a>, <b>string</b>, <a href="@0@mscorlib/A.html#3acf01620172c7f0" class="t t">IEnumerable</a>&lt;<b>object</b>&gt;&gt; <a id="f6ef714714a3f66d" href="R/f6ef714714a3f66d.html" target="n" data-glyph="46,1" class="i field">innerGetServices</a>;
        <b>readonly</b> <a href="@0@mscorlib/A.html#28d0bef62ddfa8c8" class="t t">Action</a>&lt;<a href="@0@mscorlib/A.html#87d60abb7092d5a4" class="t t">Func</a>&lt;<b>object</b>&gt;, <a href="@0@mscorlib/A.html#3d00eeab9feb80f3" class="t t">Type</a>, <b>string</b>&gt; <a id="28daa90f31cb6567" href="R/28daa90f31cb6567.html" target="n" data-glyph="46,1" class="i field">innerRegister</a>;
        <b>readonly</b> <a href="@0@mscorlib/A.html#d3599058f8d79be0" class="t t">Dictionary</a>&lt;<a href="@0@mscorlib/A.html#1806cf6634f5a371" class="t t">Tuple</a>&lt;<a href="@0@mscorlib/A.html#3d00eeab9feb80f3" class="t t">Type</a>, <b>string</b>&gt;, <a href="@0@mscorlib/A.html#cf7f4095e4de7646" class="t t">List</a>&lt;<a href="@0@mscorlib/A.html#486d58da4553e12d" class="t t">Action</a>&lt;<a href="@0@mscorlib/A.html#1f55292c3174123d" class="t t">IDisposable</a>&gt;&gt;&gt; <a id="a91cda35843adcce" href="R/a91cda35843adcce.html" target="n" data-glyph="46,1" class="i field">_callbackRegistry</a> = 
            <b>new</b> <a href="@0@mscorlib/A.html#bf6849e410b43c4c" class="t constructor">Dictionary</a>&lt;<a href="@0@mscorlib/A.html#1806cf6634f5a371" class="t t">Tuple</a>&lt;<a href="@0@mscorlib/A.html#3d00eeab9feb80f3" class="t t">Type</a>, <b>string</b>&gt;, <a href="@0@mscorlib/A.html#cf7f4095e4de7646" class="t t">List</a>&lt;<a href="@0@mscorlib/A.html#486d58da4553e12d" class="t t">Action</a>&lt;<a href="@0@mscorlib/A.html#1f55292c3174123d" class="t t">IDisposable</a>&gt;&gt;&gt;();

        <a href="@0@mscorlib/A.html#1f55292c3174123d" class="t t">IDisposable</a> <a id="16fbf09e6191b741" href="R/16fbf09e6191b741.html" target="n" data-glyph="46,1" class="i field">inner</a>;

        <b>public</b> <a id="37c7af32276399ea" href="R/../../0000000000.html" target="n" data-glyph="72,1" class="i constructor">FuncDependencyResolver</a>(
            <a href="@0@mscorlib/A.html#8adbe0476ca899db" class="t t">Func</a>&lt;<a href="@0@mscorlib/A.html#3d00eeab9feb80f3" class="t t">Type</a>, <b>string</b>, <a href="@0@mscorlib/A.html#3acf01620172c7f0" class="t t">IEnumerable</a>&lt;<b>object</b>&gt;&gt; <span id="r61 rd" class="r61 r">getAllServices</span>, 
            <a href="@0@mscorlib/A.html#28d0bef62ddfa8c8" class="t t">Action</a>&lt;<a href="@0@mscorlib/A.html#87d60abb7092d5a4" class="t t">Func</a>&lt;<b>object</b>&gt;, <a href="@0@mscorlib/A.html#3d00eeab9feb80f3" class="t t">Type</a>, <b>string</b>&gt; <span id="r62 rd" class="r62 r">register</span> = <b>null</b>, 
            <a href="@0@mscorlib/A.html#1f55292c3174123d" class="t t">IDisposable</a> <span id="r63 rd" class="r63 r">toDispose</span> = <b>null</b>)
        {
            <a href="#f6ef714714a3f66d" class="i field">innerGetServices</a> = <span class="r61 r">getAllServices</span>;
            <a href="#28daa90f31cb6567" class="i field">innerRegister</a> = <span class="r62 r">register</span>;
            <a href="#16fbf09e6191b741" class="i field">inner</a> = <span class="r63 r">toDispose</span> ?? <a href="#262687a4a218dd94" class="t t">ActionDisposable</a>.<a href="#ca4c748c9c38f672" class="i property">Empty</a>;
        }

        <b>public object</b> <a id="40e093fbd7becff2" href="R/40e093fbd7becff2.html" target="n" data-glyph="72,1" class="i method">GetService</a>(<a href="@0@mscorlib/A.html#3d00eeab9feb80f3" class="t t">Type</a> <span id="r64 rd" class="r64 r">serviceType</span>, <b>string</b> <span id="r65 rd" class="r65 r">contract</span> = <b>null</b>)
        {
            <b>return</b> (<a href="#36d6841a612c3efc" class="i method">GetServices</a>(<span class="r64 r">serviceType</span>, <span class="r65 r">contract</span>) ?? <a href="@0@System.Core/A.html#577032c8811e20d3" class="t t">Enumerable</a>.<a href="@0@System.Core/A.html#4d026772cf3399f5" class="i method">Empty</a>&lt;<b>object</b>&gt;()).<a href="@0@System.Core/A.html#981cccb3b4b716eb" class="i method">LastOrDefault</a>();
        }

        <b>public</b> <a href="@0@mscorlib/A.html#3acf01620172c7f0" class="t t">IEnumerable</a>&lt;<b>object</b>&gt; <a id="36d6841a612c3efc" href="R/36d6841a612c3efc.html" target="n" data-glyph="72,1" class="i method">GetServices</a>(<a href="@0@mscorlib/A.html#3d00eeab9feb80f3" class="t t">Type</a> <span id="r66 rd" class="r66 r">serviceType</span>, <b>string</b> <span id="r67 rd" class="r67 r">contract</span> = <b>null</b>)
        {
            <b>return</b> <a href="#f6ef714714a3f66d" class="i field">innerGetServices</a>(<span class="r66 r">serviceType</span>, <span class="r67 r">contract</span>);
        }

        <b>public void</b> <a id="ceb69f4528bf8dc6" href="R/ceb69f4528bf8dc6.html" target="n" data-glyph="72,1" class="i method">Dispose</a>() 
        { 
            <a href="@0@mscorlib/A.html#8792520ddc6dadcb" class="t t">Interlocked</a>.<a href="@0@mscorlib/A.html#19d00939423c949f" class="i method">Exchange</a>(<b>ref</b> <a href="#16fbf09e6191b741" class="i field">inner</a>, <a href="#262687a4a218dd94" class="t t">ActionDisposable</a>.<a href="#ca4c748c9c38f672" class="i property">Empty</a>).<a href="@0@mscorlib/A.html#4e23fed29bd598fa" class="i method">Dispose</a>();
        }

        <b>public void</b> <a id="cb81f4f5c39888a3" href="R/cb81f4f5c39888a3.html" target="n" data-glyph="72,1" class="i method">Register</a>(<a href="@0@mscorlib/A.html#87d60abb7092d5a4" class="t t">Func</a>&lt;<b>object</b>&gt; <span id="r68 rd" class="r68 r">factory</span>, <a href="@0@mscorlib/A.html#3d00eeab9feb80f3" class="t t">Type</a> <span id="r69 rd" class="r69 r">serviceType</span>, <b>string</b> <span id="r70 rd" class="r70 r">contract</span> = <b>null</b>)
        {
            <b>if</b> (<a href="#28daa90f31cb6567" class="i field">innerRegister</a> == <b>null</b>) <b>throw</b> <b>new</b> <a href="@0@mscorlib/A.html#085d4139ffb78d13" class="t constructor">NotImplementedException</a>();
            <a href="#28daa90f31cb6567" class="i field">innerRegister</a>(<span class="r68 r">factory</span>, <span class="r69 r">serviceType</span>, <span class="r70 r">contract</span>);

            <a href="@0@mscorlib/A.html#1806cf6634f5a371" class="k">var</a> <span id="r71 rd" class="r71 r">pair</span> = <a href="@0@mscorlib/A.html#9124c4bea9ab0199" class="t t">Tuple</a>.<a href="@0@mscorlib/A.html#5cc616d5264cd769" class="i method">Create</a>(<span class="r69 r">serviceType</span>, <span class="r70 r">contract</span> ?? <b>string</b>.<a href="@0@mscorlib/A.html#c9f70a27facb27cf" class="i field">Empty</a>);

            <b>if</b> (<a href="#a91cda35843adcce" class="i field">_callbackRegistry</a>.<a href="@0@mscorlib/A.html#22fd7cd7408aed6e" class="i method">ContainsKey</a>(<span class="r71 r">pair</span>)) {
                <a href="@0@mscorlib/A.html#cf7f4095e4de7646" class="t t">List</a>&lt;<a href="@0@mscorlib/A.html#486d58da4553e12d" class="t t">Action</a>&lt;<a href="@0@mscorlib/A.html#1f55292c3174123d" class="t t">IDisposable</a>&gt;&gt; <span id="r72 rd" class="r72 r">toRemove</span> = <b>null</b>;

                <b>foreach</b> (<a href="@0@mscorlib/A.html#486d58da4553e12d" class="k">var</a> <span id="r73 rd" class="r73 r">callback</span> <b>in</b> <a href="#a91cda35843adcce" class="i field">_callbackRegistry</a><a href="@0@mscorlib/A.html#49962975508e2d83">[</a><span class="r71 r">pair</span>]) {
                    <a href="@0@mscorlib/A.html#f1b135ff6c380b37" class="k">var</a> <span id="r74 rd" class="r74 r">remove</span> = <b>false</b>;
                    <a href="#262687a4a218dd94" class="k">var</a> <span id="r75 rd" class="r75 r">disp</span> = <b>new</b> <a href="#f2c8ace586861307" class="t constructor">ActionDisposable</a>(() =&gt; {
                        <span class="r74 r">remove</span> = <b>true</b>;
                    });

                    <span class="r73 r">callback</span>(<span class="r75 r">disp</span>);

                    <b>if</b> (<span class="r74 r">remove</span>) {
                        <b>if</b> (<span class="r72 r">toRemove</span> == <b>null</b>) {
                            <span class="r72 r">toRemove</span> = <b>new</b> <a href="@0@mscorlib/A.html#9e5352b2b304ceba" class="t constructor">List</a>&lt;<a href="@0@mscorlib/A.html#486d58da4553e12d" class="t t">Action</a>&lt;<a href="@0@mscorlib/A.html#1f55292c3174123d" class="t t">IDisposable</a>&gt;&gt;();
                        }

                        <span class="r72 r">toRemove</span>.<a href="@0@mscorlib/A.html#9cc11588bffd57c1" class="i method">Add</a>(<span class="r73 r">callback</span>);
                    }
                }

                <b>if</b> (<span class="r72 r">toRemove</span> != <b>null</b>) {
                    <b>foreach</b> (<a href="@0@mscorlib/A.html#486d58da4553e12d" class="k">var</a> <span id="r76 rd" class="r76 r">c</span> <b>in</b> <span class="r72 r">toRemove</span>) {
                        <a href="#a91cda35843adcce" class="i field">_callbackRegistry</a><a href="@0@mscorlib/A.html#49962975508e2d83">[</a><span class="r71 r">pair</span>].<a href="@0@mscorlib/A.html#db8cdd552a0bb10c" class="i method">Remove</a>(<span class="r76 r">c</span>);
                    }
                }
            }
        }

        <b>public</b> <a href="@0@mscorlib/A.html#1f55292c3174123d" class="t t">IDisposable</a> <a id="8b7006c484f5fc6d" href="R/8b7006c484f5fc6d.html" target="n" data-glyph="72,1" class="i method">ServiceRegistrationCallback</a>(<a href="@0@mscorlib/A.html#3d00eeab9feb80f3" class="t t">Type</a> <span id="r77 rd" class="r77 r">serviceType</span>, <b>string</b> <span id="r78 rd" class="r78 r">contract</span>, <a href="@0@mscorlib/A.html#486d58da4553e12d" class="t t">Action</a>&lt;<a href="@0@mscorlib/A.html#1f55292c3174123d" class="t t">IDisposable</a>&gt; <span id="r79 rd" class="r79 r">callback</span>)
        {
            <a href="@0@mscorlib/A.html#1806cf6634f5a371" class="k">var</a> <span id="r80 rd" class="r80 r">pair</span> = <a href="@0@mscorlib/A.html#9124c4bea9ab0199" class="t t">Tuple</a>.<a href="@0@mscorlib/A.html#5cc616d5264cd769" class="i method">Create</a>(<span class="r77 r">serviceType</span>, <span class="r78 r">contract</span> ?? <b>string</b>.<a href="@0@mscorlib/A.html#c9f70a27facb27cf" class="i field">Empty</a>);

            <b>if</b> (!<a href="#a91cda35843adcce" class="i field">_callbackRegistry</a>.<a href="@0@mscorlib/A.html#22fd7cd7408aed6e" class="i method">ContainsKey</a>(<span class="r80 r">pair</span>)) {
                <a href="#a91cda35843adcce" class="i field">_callbackRegistry</a><a href="@0@mscorlib/A.html#49962975508e2d83">[</a><span class="r80 r">pair</span>] = <b>new</b> <a href="@0@mscorlib/A.html#9e5352b2b304ceba" class="t constructor">List</a>&lt;<a href="@0@mscorlib/A.html#486d58da4553e12d" class="t t">Action</a>&lt;<a href="@0@mscorlib/A.html#1f55292c3174123d" class="t t">IDisposable</a>&gt;&gt;();
            }

            <a href="#a91cda35843adcce" class="i field">_callbackRegistry</a><a href="@0@mscorlib/A.html#49962975508e2d83">[</a><span class="r80 r">pair</span>].<a href="@0@mscorlib/A.html#9cc11588bffd57c1" class="i method">Add</a>(<span class="r79 r">callback</span>);

            <b>return</b> <b>new</b> <a href="#f2c8ace586861307" class="t constructor">ActionDisposable</a>(() =&gt; {
                <a href="#a91cda35843adcce" class="i field">_callbackRegistry</a><a href="@0@mscorlib/A.html#49962975508e2d83">[</a><span class="r80 r">pair</span>].<a href="@0@mscorlib/A.html#db8cdd552a0bb10c" class="i method">Remove</a>(<span class="r79 r">callback</span>);
            });
        }
    }

    <b>sealed class</b> <a id="262687a4a218dd94" href="R/262687a4a218dd94.html" target="n" data-glyph="2,0" class="t t">ActionDisposable</a> : <a href="@0@mscorlib/A.html#1f55292c3174123d" class="t t">IDisposable</a>
    {
        <a href="@0@mscorlib/A.html#9147ae6f76643aae" class="t t">Action</a> <a id="c4fa45c330488551" href="R/c4fa45c330488551.html" target="n" data-glyph="46,1" class="i field">block</a>;

        <b>public static</b> <a href="@0@mscorlib/A.html#1f55292c3174123d" class="t t">IDisposable</a> <a id="ca4c748c9c38f672" href="R/ca4c748c9c38f672.html" target="n" data-glyph="102,1" class="i property">Empty</a> {
            <b>get</b> { <b>return</b> <b>new</b> <a href="#f2c8ace586861307" class="t constructor">ActionDisposable</a>(() =&gt; {}); }
        }

        <b>public</b> <a id="f2c8ace586861307" href="R/f2c8ace586861307.html" target="n" data-glyph="72,1" class="i constructor">ActionDisposable</a>(<a href="@0@mscorlib/A.html#9147ae6f76643aae" class="t t">Action</a> <span id="r81 rd" class="r81 r">block</span>)
        {
            <a href="#262687a4a218dd94" class="k">this</a>.<a href="#c4fa45c330488551" class="i field">block</a> = <span class="r81 r">block</span>;
        }

        <b>public void</b> <a id="4f9e860575a786ab" href="R/4f9e860575a786ab.html" target="n" data-glyph="72,1" class="i method">Dispose</a>()
        {
            <a href="@0@mscorlib/A.html#8792520ddc6dadcb" class="t t">Interlocked</a>.<a href="@0@mscorlib/A.html#19d00939423c949f" class="i method">Exchange</a>(<b>ref</b> <a href="#c4fa45c330488551" class="i field">block</a>, () =&gt; {})();
        }
    }
}
</pre></td></tr></table></div></body></html>
