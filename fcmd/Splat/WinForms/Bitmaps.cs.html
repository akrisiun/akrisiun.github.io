<!DOCTYPE html>
<html><head><title>Bitmaps.cs</title><link rel="stylesheet" href="../../styles.css"><script src="../../scripts.js"></script></head>
<body class="cB" onload="i(107);"><div class="dH">
<table style="width: 100%">
<tr><td>File: <a id="filePath" class="blueLink" href="/#Splat/WinForms/Bitmaps.cs" target="_top">WinForms\Bitmaps.cs</a><br/></td><td></td></tr>
<tr><td>Project: <a id="projectPath" class="blueLink" href="/#Splat" target="_top">reactive\spat\Splat.Net45.csproj</a> (Splat)</td><td></td></tr>
</table>
</div>
<div class="cz"><table class="tb" cellpadding="0" cellspacing="0"><tr><td valign="top" align="right"><pre id="ln"></pre></td><td valign="top" align="left"><pre id="code">
<b>using</b> <span class="i n">System</span>;
<b>using</b> <span class="i n">System</span>.<span class="i n">Collections</span>.<span class="i n">Generic</span>;
<b>using</b> <span class="i n">System</span>.<span class="i n">Drawing</span>;
<b>using</b> <span class="i n">System</span>.<span class="i n">Drawing</span>.<span class="i n">Imaging</span>;
<b>using</b> <span class="i n">System</span>.<span class="i n">IO</span>;
<b>using</b> <span class="i n">System</span>.<span class="i n">Linq</span>;
<b>using</b> <span class="i n">System</span>.<span class="i n">Text</span>;
<b>using</b> <span class="i n">System</span>.<span class="i n">Threading</span>.<span class="i n">Tasks</span>;

<b>namespace</b> <span class="i n">Splat</span>.<span class="i n">WinForms</span>
{
    <b>public class</b> <a id="d067d69c0858be72" href="../R/../../0000000000.html" target="n" data-glyph="0,0" class="t t"><span id="2a8cf23498cde12d">PlatformBitmapLoader</span></a> : <a href="../Bitmaps.cs.html#ad7cbc167b933b3f" class="t t">IBitmapLoader</a>
    {
        <b>public</b> <a href="@0@mscorlib/A.html#5ca7b77f3df89fc6" class="t t">Task</a>&lt;<a href="../Bitmaps.cs.html#2da0781da676dfa2" class="t t">IBitmap</a>&gt; <a id="a3030a1afe12588f" href="../R/a3030a1afe12588f.html" target="n" data-glyph="72,1" class="i method">Load</a>(<a href="@0@mscorlib/A.html#f956b0c07e86df64" class="t t">Stream</a> <span id="r0 rd" class="r0 r">sourceStream</span>, <b>float</b>? <span id="r1 rd" class="r1 r">desiredWidth</span>, <b>float</b>? <span id="r2 rd" class="r2 r">desiredHeight</span>)
        {
            <b>return</b> <a href="@0@mscorlib/A.html#045a746eb48cbaa9" class="t t">Task</a>.<a href="@0@mscorlib/A.html#c3e0ffe470f08b7b" class="i method">Run</a>(() =&gt; {
                <a href="@0@System.Drawing/A.html#e1ba6ce9c451889d" class="k">var</a> <span id="r3 rd" class="r3 r">ret</span> = <b>new</b> <a href="@0@System.Drawing/A.html#cbbb65af7f6fafdb" class="t constructor">Bitmap</a>(<span class="r0 r">sourceStream</span>);

                <b>if</b> (<span class="r1 r">desiredWidth</span> != <b>null</b>) {
                    <span class="r3 r">ret</span> = <b>new</b> <a href="@0@System.Drawing/A.html#687e85c43e9a2c42" class="t constructor">Bitmap</a>(<span class="r3 r">ret</span>, (<b>int</b>)<span class="r1 r">desiredWidth</span>, (<b>int</b>)<span class="r2 r">desiredHeight</span>);
                }

                <b>return</b> (<a href="../Bitmaps.cs.html#2da0781da676dfa2" class="t t">IBitmap</a>)<b>new</b> <a href="#1c8101678c960bba" class="t constructor">BitmapBitmap</a>(<span class="r3 r">ret</span>);
            });
        }

        <b>public</b> <a href="@0@mscorlib/A.html#5ca7b77f3df89fc6" class="t t">Task</a>&lt;<a href="../Bitmaps.cs.html#2da0781da676dfa2" class="t t">IBitmap</a>&gt; <a id="e3de46998af23295" href="../R/e3de46998af23295.html" target="n" data-glyph="72,1" class="i method">LoadFromResource</a>(<b>string</b> <span id="r4 rd" class="r4 r">source</span>, <b>float</b>? <span id="r5 rd" class="r5 r">desiredWidth</span>, <b>float</b>? <span id="r6 rd" class="r6 r">desiredHeight</span>)
        {
            <b>return</b> <a href="@0@mscorlib/A.html#045a746eb48cbaa9" class="t t">Task</a>.<a href="@0@mscorlib/A.html#c3e0ffe470f08b7b" class="i method">Run</a>(() =&gt; {
                <a href="@0@System.Drawing/A.html#e1ba6ce9c451889d" class="k">var</a> <span id="r7 rd" class="r7 r">ret</span> = <b>new</b> <a href="@0@System.Drawing/A.html#8f37ac8955882480" class="t constructor">Bitmap</a>(<span class="r4 r">source</span>);

                <b>if</b> (<span class="r5 r">desiredWidth</span> != <b>null</b>) {
                    <span class="r7 r">ret</span> = <b>new</b> <a href="@0@System.Drawing/A.html#687e85c43e9a2c42" class="t constructor">Bitmap</a>(<span class="r7 r">ret</span>, (<b>int</b>)<span class="r5 r">desiredWidth</span>, (<b>int</b>)<span class="r6 r">desiredHeight</span>);
                }

                <b>return</b> (<a href="../Bitmaps.cs.html#2da0781da676dfa2" class="t t">IBitmap</a>)<b>new</b> <a href="#1c8101678c960bba" class="t constructor">BitmapBitmap</a>(<span class="r7 r">ret</span>);
            });
        }

        <b>public</b> <a href="../Bitmaps.cs.html#2da0781da676dfa2" class="t t">IBitmap</a> <a id="309fd6b316b964b1" href="../R/309fd6b316b964b1.html" target="n" data-glyph="72,1" class="i method">Create</a>(<b>float</b> <span id="r8 rd" class="r8 r">width</span>, <b>float</b> <span id="r9 rd" class="r9 r">height</span>)
        {
            <b>return</b> (<a href="../Bitmaps.cs.html#2da0781da676dfa2" class="t t">IBitmap</a>)<b>new</b> <a href="#1c8101678c960bba" class="t constructor">BitmapBitmap</a>(<b>new</b> <a href="@0@System.Drawing/A.html#1ef674e04aee7a22" class="t constructor">Bitmap</a>((<b>int</b>)<span class="r8 r">width</span>, (<b>int</b>)<span class="r9 r">height</span>));
        }
    }

    <b>class</b> <a id="e28d43295e8a8667" href="../R/e28d43295e8a8667.html" target="n" data-glyph="2,0" class="t t">BitmapBitmap</a> : <a href="../Bitmaps.cs.html#2da0781da676dfa2" class="t t">IBitmap</a>
    {
        <b>internal</b> <a href="@0@System.Drawing/A.html#e1ba6ce9c451889d" class="t t">Bitmap</a> <a id="31d8a938b5ca583c" href="../R/31d8a938b5ca583c.html" target="n" data-glyph="44,1" class="i field">inner</a>;

        <b>public float</b> <a id="0b41529e313d996a" href="../R/0b41529e313d996a.html" target="n" data-glyph="102,1" class="i property">Width</a> { <b>get</b>; <b>protected set</b>; }
        <b>public float</b> <a id="4c9465e971e21631" href="../R/4c9465e971e21631.html" target="n" data-glyph="102,1" class="i property">Height</a> { <b>get</b>; <b>protected set</b>; }

        <b>public</b> <a id="1c8101678c960bba" href="../R/1c8101678c960bba.html" target="n" data-glyph="72,1" class="i constructor">BitmapBitmap</a>(<a href="@0@System.Drawing/A.html#e1ba6ce9c451889d" class="t t">Bitmap</a> <span id="r10 rd" class="r10 r">bitmap</span>)
        {
            <a href="#31d8a938b5ca583c" class="i field">inner</a> = <span class="r10 r">bitmap</span>;
            <a href="#0b41529e313d996a" class="i property">Width</a> = (<b>float</b>)<a href="#31d8a938b5ca583c" class="i field">inner</a>.<a href="@0@System.Drawing/A.html#9284bc31cef9a24b" class="i property">Width</a>;
            <a href="#4c9465e971e21631" class="i property">Height</a> = (<b>float</b>)<a href="#31d8a938b5ca583c" class="i field">inner</a>.<a href="@0@System.Drawing/A.html#e35c6ae51f9afab6" class="i property">Height</a>;
        }

        <b>public</b> <a href="@0@mscorlib/A.html#045a746eb48cbaa9" class="t t">Task</a> <a id="5a1d500b532ee4dd" href="../R/5a1d500b532ee4dd.html" target="n" data-glyph="72,1" class="i method">Save</a>(<a href="../Bitmaps.cs.html#d29b4bf00a5aebaf" class="t t">CompressedBitmapFormat</a> <span id="r11 rd" class="r11 r">format</span>, <b>float</b> <span id="r12 rd" class="r12 r">quality</span>, <a href="@0@mscorlib/A.html#f956b0c07e86df64" class="t t">Stream</a> <span id="r13 rd" class="r13 r">target</span>)
        {
            <b>return</b> <a href="@0@mscorlib/A.html#045a746eb48cbaa9" class="t t">Task</a>.<a href="@0@mscorlib/A.html#89fc01f3bb88eed9" class="i method">Run</a>(() =&gt; {
                <b>if</b> (<span class="r11 r">format</span> == <a href="../Bitmaps.cs.html#d29b4bf00a5aebaf" class="t t">CompressedBitmapFormat</a>.<a href="../Bitmaps.cs.html#d68c9a2155fe60a3" class="i field">Jpeg</a>) {
                    <a href="@0@System.Drawing/A.html#7abf6a8057209d6b" class="k">var</a> <span id="r14 rd" class="r14 r">jpgEncoder</span> = <a href="#1390964f20f04eb1" class="i method">GetEncoder</a>(<a href="@0@System.Drawing/A.html#96dae44da4d0a9a8" class="t t">ImageFormat</a>.<a href="@0@System.Drawing/A.html#87609c09c9fa6cc9" class="i property">Jpeg</a>);
                    <a href="@0@System.Drawing/A.html#5104da4e2d40c2eb" class="k">var</a> <span id="r15 rd" class="r15 r">encoderParams</span> = <b>new</b> <a href="@0@System.Drawing/A.html#3d068d11ee558898" class="t constructor">EncoderParameters</a>(1);
                    <a href="@0@System.Drawing/A.html#1b018cfebb1fb261" class="k">var</a> <span id="r16 rd" class="r16 r">encoderParam</span> = <b>new</b> <a href="@0@System.Drawing/A.html#19d1f87e1badb99b" class="t constructor">EncoderParameter</a>(<span class="i n">System</span>.<span class="i n">Drawing</span>.<span class="i n">Imaging</span>.<a href="@0@System.Drawing/A.html#82f9c50a667ac03a" class="t t">Encoder</a>.<a href="@0@System.Drawing/A.html#3b5aac9c19e763b4" class="i field">Quality</a>, (<b>int</b>)(<span class="r12 r">quality</span> * 100.0f));
                    <span class="r15 r">encoderParams</span>.<a href="@0@System.Drawing/A.html#0de9245644f377f0" class="i property">Param</a>[0] = <span class="r16 r">encoderParam</span>;
                    <a href="#31d8a938b5ca583c" class="i field">inner</a>.<a href="@0@System.Drawing/A.html#d92b744527b4f60d" class="i method">Save</a>(<span class="r13 r">target</span>, <span class="r14 r">jpgEncoder</span>, <span class="r15 r">encoderParams</span>);
                } <b>else</b> {
                    <a href="#31d8a938b5ca583c" class="i field">inner</a>.<a href="@0@System.Drawing/A.html#7c94190491dbb079" class="i method">Save</a>(<span class="r13 r">target</span>, <a href="@0@System.Drawing/A.html#96dae44da4d0a9a8" class="t t">ImageFormat</a>.<a href="@0@System.Drawing/A.html#f54bc0008d4aa133" class="i property">Png</a>);
                }
            });
        }

        <b>public void</b> <a id="f9e8072b5e5be263" href="../R/f9e8072b5e5be263.html" target="n" data-glyph="72,1" class="i method">Dispose</a>()
        {
            <a href="#31d8a938b5ca583c" class="i field">inner</a>.<a href="@0@System.Drawing/A.html#5f4dd2af374d1f3c" class="i method">Dispose</a>();
        }

        <a href="@0@System.Drawing/A.html#7abf6a8057209d6b" class="t t">ImageCodecInfo</a> <a id="1390964f20f04eb1" href="../R/1390964f20f04eb1.html" target="n" data-glyph="76,1" class="i method">GetEncoder</a>(<a href="@0@System.Drawing/A.html#96dae44da4d0a9a8" class="t t">ImageFormat</a> <span id="r17 rd" class="r17 r">format</span>)
        {
            <b>var</b> <span id="r18 rd" class="r18 r">codecs</span> = <a href="@0@System.Drawing/A.html#7abf6a8057209d6b" class="t t">ImageCodecInfo</a>.<a href="@0@System.Drawing/A.html#a04a242335af60c2" class="i method">GetImageEncoders</a>();

            <b>foreach</b> (<a href="@0@System.Drawing/A.html#7abf6a8057209d6b" class="k">var</a> <span id="r19 rd" class="r19 r">codec</span> <b>in</b> <span class="r18 r">codecs</span>) {
                <b>if</b> (<span class="r19 r">codec</span>.<a href="@0@System.Drawing/A.html#b6a825db8a11ab00" class="i property">FormatID</a> == <span class="r17 r">format</span>.<a href="@0@System.Drawing/A.html#8fd3d3780f26ae43" class="i property">Guid</a>) {
                    <b>return</b> <span class="r19 r">codec</span>;
                }
            }

            <b>return null</b>;
        }
    }

    <b>public static class</b> <a id="180882f58eff9a08" href="../R/../../0000000000.html" target="n" data-glyph="0,0" class="t t">BitmapMixins</a>
    {
        <b>public static</b> <a href="../Bitmaps.cs.html#2da0781da676dfa2" class="t t">IBitmap</a> <a id="e6b932ab98737886" href="../R/../../0000000000.html" target="n" data-glyph="220,1" class="i method">FromNative</a>(<b>this</b> <a href="@0@System.Drawing/A.html#e1ba6ce9c451889d" class="t t">Bitmap</a> <span id="r20 rd" class="r20 r">This</span>)
        {
            <b>return</b> <b>new</b> <a href="#1c8101678c960bba" class="t constructor">BitmapBitmap</a>(<span class="r20 r">This</span>);
        }

        <b>public static</b> <a href="@0@System.Drawing/A.html#e1ba6ce9c451889d" class="t t">Bitmap</a> <a id="c7af1717887bb02f" href="../R/../../0000000000.html" target="n" data-glyph="220,1" class="i method">ToNative</a>(<b>this</b> <a href="../Bitmaps.cs.html#2da0781da676dfa2" class="t t">IBitmap</a> <span id="r21 rd" class="r21 r">This</span>)
        {
            <b>return</b> ((<a href="#e28d43295e8a8667" class="t t">BitmapBitmap</a>)<span class="r21 r">This</span>).<a href="#31d8a938b5ca583c" class="i field">inner</a>;
        }
    }
}
</pre></td></tr></table></div></body></html>
