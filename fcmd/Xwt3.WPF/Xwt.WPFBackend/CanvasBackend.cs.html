<!DOCTYPE html>
<html><head><title>CanvasBackend.cs</title><link rel="stylesheet" href="../../styles.css"><script src="../../scripts.js"></script></head>
<body class="cB" onload="i(109);"><div class="dH">
<table style="width: 100%">
<tr><td>File: <a id="filePath" class="blueLink" href="/#Xwt3.WPF/Xwt.WPFBackend/CanvasBackend.cs" target="_top">Xwt.WPFBackend\CanvasBackend.cs</a><br/></td><td></td></tr>
<tr><td>Project: <a id="projectPath" class="blueLink" href="/#Xwt3.WPF" target="_top">xwt\Xwt.WPF\Xwt3.WPF.csproj</a> (Xwt3.WPF)</td><td></td></tr>
</table>
</div>
<div class="cz"><table class="tb" cellpadding="0" cellspacing="0"><tr><td valign="top" align="right"><pre id="ln"></pre></td><td valign="top" align="left"><pre id="code">

<b>using</b> <span class="i n">System</span>;
<b>using</b> <span class="i n">System</span>.<span class="i n">Collections</span>.<span class="i n">Generic</span>;
<b>using</b> <span class="i n">System</span>.<span class="i n">Linq</span>;
<b>using</b> <span class="i n">System</span>.<span class="i n">Text</span>;
<b>using</b> <span class="i n">Xwt</span>.<span class="i n">Backends</span>;
<b>using</b> <span class="i n">System</span>.<span class="i n">Windows</span>;
<b>using</b> <span class="i">SWC</span> = <span class="i n">System</span>.<span class="i n">Windows</span>.<span class="i n">Controls</span>;
<b>using</b> <span class="i n">System</span>.<span class="i n">Windows</span>.<span class="i n">Media</span>;

<b>namespace</b> <span class="i n">Xwt</span>.<span class="i n">WPFBackend</span>
{
	<b>class</b> <a id="891049961e874bea" href="../R/891049961e874bea.html" target="n" data-glyph="2,0" class="t t">CanvasBackend</a>
		: <a href="WidgetBackend.cs.html#551a9684f2eb2b53" class="t t">WidgetBackend</a>, <a href="/Xwt3/A.html#838d2c711493a761" class="t t">ICanvasBackend</a>
	{
		<span class="k preprocess">#</span><span class="k preprocess">region</span> ICanvasBackend Members

		<b>public</b> <a id="f54ade5f50d0897b" href="../R/../../0000000000.html" target="n" data-glyph="72,1" class="i constructor">CanvasBackend</a> ()
		{
			<a href="#712450b46561561a" class="i property">Canvas</a> = <b>new</b> <a href="BoxBackend.cs.html#43743e085d946f8b" class="t constructor">CustomPanel</a> ();
			<a href="#712450b46561561a" class="i property">Canvas</a>.<a href="BoxBackend.cs.html#4f536504eb99795a" class="i field">RenderAction</a> = <a href="#514b9149a51c1033" class="i method">Render</a>;
		}

		<b>private</b> <a href="BoxBackend.cs.html#e99a133c03c847e8" class="t t">CustomPanel</a> <a id="712450b46561561a" href="../R/712450b46561561a.html" target="n" data-glyph="106,1" class="i property">Canvas</a>
		{
			<b>get</b> { <b>return</b> (<a href="BoxBackend.cs.html#e99a133c03c847e8" class="t t">CustomPanel</a>)<a href="WidgetBackend.cs.html#bfe5b8d8f773f1ef" class="i property">Widget</a>; }
			<b>set</b> { <a href="WidgetBackend.cs.html#bfe5b8d8f773f1ef" class="i property">Widget</a> = <b>value</b>; }
		}

		<b>private</b> <a href="/Xwt3/A.html#d1e5998856738984" class="t t">ICanvasEventSink</a> <a id="2d79491e9bd12843" href="../R/2d79491e9bd12843.html" target="n" data-glyph="106,1" class="i property">CanvasEventSink</a>
		{
			<b>get</b> { <b>return</b> (<a href="/Xwt3/A.html#d1e5998856738984" class="t t">ICanvasEventSink</a>) <a href="WidgetBackend.cs.html#6eebdc0ff8c33e10" class="i property">EventSink</a>; }
		}

		<b>protected override void</b> <a id="ba574f947ba007fa" href="../R/ba574f947ba007fa.html" target="n" data-glyph="75,1" class="i method">SetWidgetColor</a> (<span class="i n">Drawing</span>.<a href="/Xwt3/A.html#773e78572598ea91" class="t t">Color</a> <span id="r0 rd" class="r0 r">value</span>)
		{
			<span class="c">// Do nothing</span>
		}

		<b>private void</b> <a id="514b9149a51c1033" href="../R/514b9149a51c1033.html" target="n" data-glyph="76,1" class="i method">Render</a> (<span class="i n">System</span>.<span class="i n">Windows</span>.<span class="i n">Media</span>.<a href="@0@PresentationCore/A.html#e8d3760dcaccd8d8" class="t t">DrawingContext</a> <span id="r1 rd" class="r1 r">dc</span>)
		{
			<b>if</b> (<a href="WidgetBackend.cs.html#68c84d4899d5d216" class="i property">BackgroundColorSet</a>) {
				<a href="@0@PresentationCore/A.html#2bdb4a721050df52" class="t t">SolidColorBrush</a> <span id="r2 rd" class="r2 r">mySolidColorBrush</span> = <b>new</b> <a href="@0@PresentationCore/A.html#3387a4fb06ed3ffd" class="t constructor">SolidColorBrush</a> ();
				<span class="r2 r">mySolidColorBrush</span>.<a href="@0@PresentationCore/A.html#eed7cf36d73cf29b" class="i property">Color</a> = <a href="WidgetBackend.cs.html#d2118170132e1aac" class="i property">BackgroundColor</a>.<a href="DataConverter.cs.html#fa6d926c9d2ffd8d" class="i method">ToWpfColor</a> ();
				<a href="@0@WindowsBase/A.html#fc387a6f7a1c2856" class="t t">Rect</a> <span id="r3 rd" class="r3 r">myRect</span> = <b>new</b> <a href="@0@WindowsBase/A.html#299a3fd614724168" class="t constructor">Rect</a> (0, 0, <a href="WidgetBackend.cs.html#bfe5b8d8f773f1ef" class="i property">Widget</a>.<a href="@0@PresentationFramework/A.html#7cc64ed9667c9f70" class="i property">ActualWidth</a>, <a href="WidgetBackend.cs.html#bfe5b8d8f773f1ef" class="i property">Widget</a>.<a href="@0@PresentationFramework/A.html#5554a4892ffe2cfc" class="i property">ActualHeight</a>);
				<span class="r1 r">dc</span>.<a href="@0@PresentationCore/A.html#deb95bbe17195482" class="i method">DrawRectangle</a> (<span class="r2 r">mySolidColorBrush</span>, <b>null</b>, <span class="r3 r">myRect</span>);
			}
			
			<a href="DrawingContext.cs.html#42d35a53a5184e2f" class="k">var</a> <span id="r4 rd" class="r4 r">ctx</span> = <b>new</b> <span class="i n">Xwt</span>.<span class="i n">WPFBackend</span>.<a href="DrawingContext.cs.html#f92f8df4a2206528" class="t constructor">DrawingContext</a> (<span class="r1 r">dc</span>, <a href="WidgetBackend.cs.html#bfe5b8d8f773f1ef" class="i property">Widget</a>.<a href="Util.cs.html#c511b9627034677b" class="i method">GetScaleFactor</a> ());
            <span class="r4 r">ctx</span>.<a href="DrawingContext.cs.html#36de1c650962f865" class="i property">Context</a>.<a href="@0@PresentationCore/A.html#b6e0bc0ec5f9f4e8" class="i method">PushClip</a>(<b>new</b> <a href="@0@PresentationCore/A.html#d1e640445af3aa8a" class="t constructor">RectangleGeometry</a>(<b>new</b> <a href="@0@WindowsBase/A.html#299a3fd614724168" class="t constructor">Rect</a>(0, 0, <a href="WidgetBackend.cs.html#bfe5b8d8f773f1ef" class="i property">Widget</a>.<a href="@0@PresentationFramework/A.html#7cc64ed9667c9f70" class="i property">ActualWidth</a>, <a href="WidgetBackend.cs.html#bfe5b8d8f773f1ef" class="i property">Widget</a>.<a href="@0@PresentationFramework/A.html#5554a4892ffe2cfc" class="i property">ActualHeight</a>)));
            <a href="#2d79491e9bd12843" class="i property">CanvasEventSink</a>.<a href="/Xwt3/A.html#03c1cec64b706cac" class="i method">OnDraw</a>(<span class="r4 r">ctx</span>, <b>new</b> <a href="/Xwt3/A.html#370723d8012de275" class="t constructor">Rectangle</a>(0, 0, <a href="WidgetBackend.cs.html#bfe5b8d8f773f1ef" class="i property">Widget</a>.<a href="@0@PresentationFramework/A.html#7cc64ed9667c9f70" class="i property">ActualWidth</a>, <a href="WidgetBackend.cs.html#bfe5b8d8f773f1ef" class="i property">Widget</a>.<a href="@0@PresentationFramework/A.html#5554a4892ffe2cfc" class="i property">ActualHeight</a>));
		}

		<b>public void</b> <a id="1f420e2f8ab7bc7d" href="../R/1f420e2f8ab7bc7d.html" target="n" data-glyph="72,1" class="i method">QueueDraw</a> ()
		{
			<a href="#712450b46561561a" class="i property">Canvas</a>.<a href="@0@PresentationCore/A.html#fdda546b8cd3480c" class="i method">InvalidateVisual</a> ();
		}

		<b>public void</b> <a id="cb653a86974ca501" href="../R/cb653a86974ca501.html" target="n" data-glyph="72,1" class="i method">QueueDraw</a> (<a href="/Xwt3/A.html#c6d9d3513c691785" class="t t">Rectangle</a> <span id="r5 rd" class="r5 r">rect</span>)
		{
			<a href="#712450b46561561a" class="i property">Canvas</a>.<a href="@0@PresentationCore/A.html#fdda546b8cd3480c" class="i method">InvalidateVisual</a> ();
		}

		<b>public void</b> <a id="ce15e42e0d8d5783" href="../R/ce15e42e0d8d5783.html" target="n" data-glyph="72,1" class="i method">AddChild</a> (<a href="/Xwt3/A.html#afaa20aa76724b41" class="t t">IWidgetBackend</a> <span id="r6 rd" class="r6 r">widget</span>, <a href="/Xwt3/A.html#c6d9d3513c691785" class="t t">Rectangle</a> <span id="r7 rd" class="r7 r">bounds</span>)
		{
			<a href="@0@PresentationCore/A.html#7911653ccb506216" class="t t">UIElement</a> <span id="r8 rd" class="r8 r">element</span> = <span class="r6 r">widget</span>.<a href="/Xwt3/A.html#b85c5c5d48346e23" class="i property">NativeWidget</a> <b>as</b> <a href="@0@PresentationCore/A.html#7911653ccb506216" class="t t">UIElement</a>;
			<b>if</b> (<span class="r8 r">element</span> == <b>null</b>)
				<b>throw</b> <b>new</b> <a href="@0@mscorlib/A.html#71d200dcf0047f8b" class="t constructor">ArgumentException</a> ();

			<b>if</b> (!<a href="#712450b46561561a" class="i property">Canvas</a>.<a href="@0@PresentationFramework/A.html#fb9060d71a3afc83" class="i property">Children</a>.<a href="@0@PresentationFramework/A.html#ae8feb579634df99" class="i method">Contains</a> (<span class="r8 r">element</span>))
				<a href="#712450b46561561a" class="i property">Canvas</a>.<a href="@0@PresentationFramework/A.html#fb9060d71a3afc83" class="i property">Children</a>.<a href="@0@PresentationFramework/A.html#8886057feae649bc" class="i method">Add</a> (<span class="r8 r">element</span>);

			<a href="#f74903892dae2d2b" class="i method">SetChildBounds</a> (<span class="r6 r">widget</span>, <span class="r7 r">bounds</span>);
		}

		<a href="@0@mscorlib/A.html#cf7f4095e4de7646" class="t t">List</a>&lt;<a href="/Xwt3/A.html#afaa20aa76724b41" class="t t">IWidgetBackend</a>&gt; <a id="862f053e1d8dcf73" href="../R/862f053e1d8dcf73.html" target="n" data-glyph="46,1" class="i field">children</a> = <b>new</b> <a href="@0@mscorlib/A.html#9e5352b2b304ceba" class="t constructor">List</a>&lt;<a href="/Xwt3/A.html#afaa20aa76724b41" class="t t">IWidgetBackend</a>&gt; ();
		<a href="@0@mscorlib/A.html#cf7f4095e4de7646" class="t t">List</a>&lt;<a href="/Xwt3/A.html#c6d9d3513c691785" class="t t">Rectangle</a>&gt; <a id="53bcd1b13d7bfdd3" href="../R/53bcd1b13d7bfdd3.html" target="n" data-glyph="46,1" class="i field">childrenBounds</a> = <b>new</b> <a href="@0@mscorlib/A.html#9e5352b2b304ceba" class="t constructor">List</a>&lt;<a href="/Xwt3/A.html#c6d9d3513c691785" class="t t">Rectangle</a>&gt; ();

		<b>public void</b> <a id="f74903892dae2d2b" href="../R/f74903892dae2d2b.html" target="n" data-glyph="72,1" class="i method">SetChildBounds</a> (<a href="/Xwt3/A.html#afaa20aa76724b41" class="t t">IWidgetBackend</a> <span id="r9 rd" class="r9 r">widget</span>, <a href="/Xwt3/A.html#c6d9d3513c691785" class="t t">Rectangle</a> <span id="r10 rd" class="r10 r">bounds</span>)
		{
			<b>int</b> <span id="r11 rd" class="r11 r">i</span> = <a href="#862f053e1d8dcf73" class="i field">children</a>.<a href="@0@mscorlib/A.html#242756beb6e8749e" class="i method">IndexOf</a> (<span class="r9 r">widget</span>);
			<b>if</b> (<span class="r11 r">i</span> == -1) {
				<a href="#862f053e1d8dcf73" class="i field">children</a>.<a href="@0@mscorlib/A.html#9cc11588bffd57c1" class="i method">Add</a> (<span class="r9 r">widget</span>);
				<a href="#53bcd1b13d7bfdd3" class="i field">childrenBounds</a>.<a href="@0@mscorlib/A.html#9cc11588bffd57c1" class="i method">Add</a> (<span class="r10 r">bounds</span>);
			}
			<b>else</b> {
				<a href="#53bcd1b13d7bfdd3" class="i field">childrenBounds</a><a href="@0@mscorlib/A.html#0c65bec4d3fac21e">[</a><span class="r11 r">i</span>] = <span class="r10 r">bounds</span>;
			}
			<a href="#712450b46561561a" class="i property">Canvas</a>.<a href="BoxBackend.cs.html#1e06c92ba712a5f2" class="i method">SetAllocation</a> (<a href="#862f053e1d8dcf73" class="i field">children</a>.<a href="@0@mscorlib/A.html#d4409b7542728cec" class="i method">ToArray</a> (), <a href="#53bcd1b13d7bfdd3" class="i field">childrenBounds</a>.<a href="@0@mscorlib/A.html#d4409b7542728cec" class="i method">ToArray</a> ());
		}

		<b>public void</b> <a id="4cfaa7873c772141" href="../R/4cfaa7873c772141.html" target="n" data-glyph="72,1" class="i method">RemoveChild</a> (<a href="/Xwt3/A.html#afaa20aa76724b41" class="t t">IWidgetBackend</a> <span id="r12 rd" class="r12 r">widget</span>)
		{
			<a href="@0@PresentationCore/A.html#7911653ccb506216" class="t t">UIElement</a> <span id="r13 rd" class="r13 r">element</span> = <span class="r12 r">widget</span>.<a href="/Xwt3/A.html#b85c5c5d48346e23" class="i property">NativeWidget</a> <b>as</b> <a href="@0@PresentationCore/A.html#7911653ccb506216" class="t t">UIElement</a>;
			<b>if</b> (<span class="r13 r">element</span> == <b>null</b>)
				<b>throw</b> <b>new</b> <a href="@0@mscorlib/A.html#71d200dcf0047f8b" class="t constructor">ArgumentException</a> ();

			<a href="#712450b46561561a" class="i property">Canvas</a>.<a href="@0@PresentationFramework/A.html#fb9060d71a3afc83" class="i property">Children</a>.<a href="@0@PresentationFramework/A.html#62e60fbcbfe44bc8" class="i method">Remove</a> (<span class="r13 r">element</span>);
			<b>int</b> <span id="r14 rd" class="r14 r">i</span> = <a href="#862f053e1d8dcf73" class="i field">children</a>.<a href="@0@mscorlib/A.html#242756beb6e8749e" class="i method">IndexOf</a> (<span class="r12 r">widget</span>);
			<b>if</b> (<span class="r14 r">i</span> != -1) {
				<a href="#862f053e1d8dcf73" class="i field">children</a>.<a href="@0@mscorlib/A.html#3d46113cc199059a" class="i method">RemoveAt</a> (<span class="r14 r">i</span>);
				<a href="#53bcd1b13d7bfdd3" class="i field">childrenBounds</a>.<a href="@0@mscorlib/A.html#3d46113cc199059a" class="i method">RemoveAt</a> (<span class="r14 r">i</span>);
			}
		}

		<span class="k preprocess">#</span><span class="k preprocess">endregion</span>
	}
}
</pre></td></tr></table></div></body></html>
