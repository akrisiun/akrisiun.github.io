<!DOCTYPE html>
<html><head><title>ExTreeView.cs</title><link rel="stylesheet" href="../../styles.css"><script src="../../scripts.js"></script></head>
<body class="cB" onload="i(464);"><div class="dH">
<table style="width: 100%">
<tr><td>File: <a id="filePath" class="blueLink" href="/#Xwt3.WPF/Xwt.WPFBackend/ExTreeView.cs" target="_top">Xwt.WPFBackend\ExTreeView.cs</a><br/></td><td></td></tr>
<tr><td>Project: <a id="projectPath" class="blueLink" href="/#Xwt3.WPF" target="_top">xwt\Xwt.WPF\Xwt3.WPF.csproj</a> (Xwt3.WPF)</td><td></td></tr>
</table>
</div>
<div class="cz"><table class="tb" cellpadding="0" cellspacing="0"><tr><td valign="top" align="right"><pre id="ln"></pre></td><td valign="top" align="left"><pre id="code">
<span class="c">//</span>
<span class="c">// ExTreeView.cs</span>
<span class="c">//</span>
<span class="c">// Author:</span>
<span class="c">//       Eric Maupin &lt;ermau@xamarin.com&gt;</span>
<span class="c">//       David Karlaš &lt;david.karlas@gmail.com&gt;</span>
<span class="c">//</span>
<span class="c">// Copyright (c) 2012 Xamarin, Inc.</span>
<span class="c">//</span>
<span class="c">// Permission is hereby granted, free of charge, to any person obtaining a copy</span>
<span class="c">// of this software and associated documentation files (the &quot;Software&quot;), to deal</span>
<span class="c">// in the Software without restriction, including without limitation the rights</span>
<span class="c">// to use, copy, modify, merge, publish, distribute, sublicense, and/or sell</span>
<span class="c">// copies of the Software, and to permit persons to whom the Software is</span>
<span class="c">// furnished to do so, subject to the following conditions:</span>
<span class="c">//</span>
<span class="c">// The above copyright notice and this permission notice shall be included in</span>
<span class="c">// all copies or substantial portions of the Software.</span>
<span class="c">//</span>
<span class="c">// THE SOFTWARE IS PROVIDED &quot;AS IS&quot;, WITHOUT WARRANTY OF ANY KIND, EXPRESS OR</span>
<span class="c">// IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,</span>
<span class="c">// FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE</span>
<span class="c">// AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER</span>
<span class="c">// LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,</span>
<span class="c">// OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN</span>
<span class="c">// THE SOFTWARE.</span>

<b>using</b> <span class="i n">System</span>;
<b>using</b> <span class="i n">System</span>.<span class="i n">Collections</span>;
<b>using</b> <span class="i n">System</span>.<span class="i n">Collections</span>.<span class="i n">ObjectModel</span>;
<b>using</b> <span class="i n">System</span>.<span class="i n">Collections</span>.<span class="i n">Specialized</span>;
<b>using</b> <span class="i n">System</span>.<span class="i n">Linq</span>;
<b>using</b> <span class="i n">System</span>.<span class="i n">Reflection</span>;
<b>using</b> <span class="i n">System</span>.<span class="i n">Windows</span>;
<b>using</b> <span class="i n">System</span>.<span class="i n">Windows</span>.<span class="i n">Controls</span>;
<b>using</b> <span class="i n">System</span>.<span class="i n">Collections</span>.<span class="i n">Generic</span>;
<b>using</b> <span class="i">SWC</span> = <span class="i n">System</span>.<span class="i n">Windows</span>.<span class="i n">Controls</span>;
<b>using</b> <span class="t">WKey</span> = <span class="i n">System</span>.<span class="i n">Windows</span>.<span class="i n">Input</span>.<a href="@0@WindowsBase/A.html#8e0d9266dee78287" class="t t">Key</a>;
<b>using</b> <span class="i n">System</span>.<span class="i n">Windows</span>.<span class="i n">Input</span>;
<b>using</b> <span class="i n">System</span>.<span class="i n">Windows</span>.<span class="i n">Controls</span>.<span class="i n">Primitives</span>;

<b>namespace</b> <span class="i n">Xwt</span>.<span class="i n">WPFBackend</span>
{
	<b>using</b> <span class="t">Keyboard</span> = <span class="i n">System</span>.<span class="i n">Windows</span>.<span class="i n">Input</span>.<a href="@0@PresentationCore/A.html#af9b7892ee354373" class="t t">Keyboard</a>;

	<b>public class</b> <a id="f162c84db9d2e04f" href="../R/f162c84db9d2e04f.html" target="n" data-glyph="0,0" class="t t">ExTreeView</a>
		: <span class="i n">SWC</span>.<a href="@0@PresentationFramework/A.html#5050528c9202ffc4" class="t t">TreeView</a>, <a href="WidgetBackend.cs.html#cc0e50a0d5748c2d" class="t t">IWpfWidget</a>
	{
		<b>public</b> <a id="46c8e88959e02c35" href="../R/46c8e88959e02c35.html" target="n" data-glyph="72,1" class="i constructor">ExTreeView</a>()
		{
			<a href="#0bab2449b8afe9e9" class="i property">SelectedItems</a> = <b>new</b> <a href="@0@System/A.html#a0b7a0640c9feb02" class="t constructor">ObservableCollection</a>&lt;<b>object</b>&gt; ();
			<a href="@0@PresentationFramework/A.html#a815b4f12f279dee" class="i">Loaded</a> += <b>new</b> <span class="t">RoutedEventHandler</span>(<a href="#6d9b7bccda9a9117" class="i method">ExTreeView_Loaded</a>);
		}

		<b>void</b> <a id="6d9b7bccda9a9117" href="../R/6d9b7bccda9a9117.html" target="n" data-glyph="76,1" class="i method">ExTreeView_Loaded</a>(<b>object</b> <span id="r0 rd" class="r0 r">sender</span>, <a href="@0@PresentationCore/A.html#3089ebf2139eba9d" class="t t">RoutedEventArgs</a> <span id="r1 rd" class="r1 r">e</span>)
		{
			<b>if</b> (<a href="#a00a6f8decc884bd" class="i property">SelectionMode</a> == <span class="i n">SWC</span>.<a href="@0@PresentationFramework/A.html#c049f467e619a257" class="t t">SelectionMode</a>.<a href="@0@PresentationFramework/A.html#7abb7043062e8485" class="i field">Single</a>)
			{
				<b>if</b> (<a href="#0bab2449b8afe9e9" class="i property">SelectedItems</a>.<a href="@0@mscorlib/A.html#e961aba0053db107" class="i property">Count</a> == 0)
				{
					<b>if</b> (<a href="@0@PresentationFramework/A.html#54366ee76d2f1106" class="i property">Items</a>.<a href="@0@PresentationFramework/A.html#4808b70b6149b33d" class="i property">Count</a> &gt; 0)
						<a href="#a80bdb1747903ec0" class="i method">SelectItem</a>(<a href="@0@PresentationFramework/A.html#54366ee76d2f1106" class="i property">Items</a>[0]);
				}
			}
		}

		<b>public event</b> <a href="@0@mscorlib/A.html#3b79d2b06c15f250" class="t t">EventHandler</a> <a id="e5334f89054024d1" href="../R/e5334f89054024d1.html" target="n" data-glyph="30,1" class="i">SelectedItemsChanged</a>;

		<b>public</b> <a href="WidgetBackend.cs.html#551a9684f2eb2b53" class="t t">WidgetBackend</a> <a id="d820ac1aa024f0cd" href="../R/d820ac1aa024f0cd.html" target="n" data-glyph="102,1" class="i property">Backend</a>
		{
			<b>get</b>;
			<b>set</b>;
		}

		<b>private readonly</b> <a href="@0@PresentationFramework/A.html#07b0f47c7e83d91b" class="t t">GridView</a> <a id="b221f677e1d24906" href="../R/b221f677e1d24906.html" target="n" data-glyph="46,1" class="i field">view</a> = <b>new</b> <a href="@0@PresentationFramework/A.html#bce36d87f1240024" class="t constructor">GridView</a>();
		<b>public</b> <a href="@0@PresentationFramework/A.html#07b0f47c7e83d91b" class="t t">GridView</a> <a id="b1fbc753ddb2cd94" href="../R/b1fbc753ddb2cd94.html" target="n" data-glyph="102,1" class="i property">View</a>
		{
			<b>get</b> { <b>return</b> <a href="#f162c84db9d2e04f" class="k">this</a>.<a href="#b221f677e1d24906" class="i field">view</a>; }
		}

		<b>public static readonly</b> <a href="@0@WindowsBase/A.html#4a20845df0b86ddd" class="t t">DependencyProperty</a> <a id="841686207f9b3a75" href="../R/841686207f9b3a75.html" target="n" data-glyph="42,1" class="i field">SelectionModeProperty</a> = <a href="@0@WindowsBase/A.html#4a20845df0b86ddd" class="t t">DependencyProperty</a>.<a href="@0@WindowsBase/A.html#3f509a22032d7071" class="i method">Register</a> (<span class="s">&quot;SelectionMode&quot;</span>,
			<b>typeof</b> (<span class="i n">System</span>.<span class="i n">Windows</span>.<span class="i n">Controls</span>.<a href="@0@PresentationFramework/A.html#c049f467e619a257" class="t t">SelectionMode</a>), <b>typeof</b> (<a href="#f162c84db9d2e04f" class="t t">ExTreeView</a>),
			<b>new</b> <a href="@0@PresentationCore/A.html#1708823089fadef6" class="t constructor">UIPropertyMetadata</a> (<span class="i n">System</span>.<span class="i n">Windows</span>.<span class="i n">Controls</span>.<a href="@0@PresentationFramework/A.html#c049f467e619a257" class="t t">SelectionMode</a>.<a href="@0@PresentationFramework/A.html#7abb7043062e8485" class="i field">Single</a>, <a href="#2ab623ebdf48faf6" class="i method">OnSelectionModePropertyChanged</a>));

		<b>public</b> <span class="i n">System</span>.<span class="i n">Windows</span>.<span class="i n">Controls</span>.<a href="@0@PresentationFramework/A.html#c049f467e619a257" class="t t">SelectionMode</a> <a id="a00a6f8decc884bd" href="../R/a00a6f8decc884bd.html" target="n" data-glyph="102,1" class="i property">SelectionMode</a>
		{
			<b>get</b> { <b>return</b> (<span class="i n">System</span>.<span class="i n">Windows</span>.<span class="i n">Controls</span>.<a href="@0@PresentationFramework/A.html#c049f467e619a257" class="t t">SelectionMode</a>) <a href="@0@WindowsBase/A.html#0e1012f338283c7a" class="i method">GetValue</a> (<a href="#841686207f9b3a75" class="i field">SelectionModeProperty</a>); }
			<b>set</b> { <a href="@0@WindowsBase/A.html#b1809fe135a72ec5" class="i method">SetValue</a> (<a href="#841686207f9b3a75" class="i field">SelectionModeProperty</a>, <b>value</b>); }
		}

		<b>public static readonly</b> <a href="@0@WindowsBase/A.html#4a20845df0b86ddd" class="t t">DependencyProperty</a> <a id="2e06a5495d382853" href="../R/2e06a5495d382853.html" target="n" data-glyph="42,1" class="i field">SelectedItemsProperty</a> = <a href="@0@WindowsBase/A.html#4a20845df0b86ddd" class="t t">DependencyProperty</a>.<a href="@0@WindowsBase/A.html#3f509a22032d7071" class="i method">Register</a> (<span class="s">&quot;SelectedItems&quot;</span>,
			<b>typeof</b> (<a href="@0@mscorlib/A.html#5d74f6adfeaf6c7d" class="t t">IList</a>), <b>typeof</b> (<a href="#f162c84db9d2e04f" class="t t">ExTreeView</a>),
			<b>new</b> <a href="@0@PresentationCore/A.html#de250674de661b24" class="t constructor">UIPropertyMetadata</a> (<a href="#b5a7a69a58fbdd39" class="i method">OnSelectedItemsPropertyChanged</a>));

		<b>public</b> <a href="@0@mscorlib/A.html#5d74f6adfeaf6c7d" class="t t">IList</a> <a id="0bab2449b8afe9e9" href="../R/0bab2449b8afe9e9.html" target="n" data-glyph="102,1" class="i property">SelectedItems</a>
		{
			<b>get</b> { <b>return</b> (<a href="@0@mscorlib/A.html#5d74f6adfeaf6c7d" class="t t">IList</a>) <a href="@0@WindowsBase/A.html#0e1012f338283c7a" class="i method">GetValue</a> (<a href="#2e06a5495d382853" class="i field">SelectedItemsProperty</a>); }
			<b>set</b> { <a href="@0@WindowsBase/A.html#b1809fe135a72ec5" class="i method">SetValue</a> (<a href="#2e06a5495d382853" class="i field">SelectedItemsProperty</a>, <b>value</b>); }
		}

		<b>public void</b> <a id="f7e5c6153eb26be0" href="../R/f7e5c6153eb26be0.html" target="n" data-glyph="72,1" class="i method">SelectAllExpanded</a>()
		{
			<b>if</b> (<a href="@0@PresentationFramework/A.html#54366ee76d2f1106" class="i property">Items</a> == <b>null</b> || <a href="@0@PresentationFramework/A.html#54366ee76d2f1106" class="i property">Items</a>.<a href="@0@PresentationFramework/A.html#4808b70b6149b33d" class="i property">Count</a> == 0)
				<b>return</b>;

			<b>foreach</b> (<b>object</b> <span id="r2 rd" class="r2 r">item</span> <b>in</b> <a href="@0@PresentationFramework/A.html#54366ee76d2f1106" class="i property">Items</a>) {
				<a href="ExTreeViewItem.cs.html#505370876d79da38" class="k">var</a> <span id="r3 rd" class="r3 r">treeItem</span> = ((<a href="ExTreeViewItem.cs.html#505370876d79da38" class="t t">ExTreeViewItem</a>) <a href="@0@PresentationFramework/A.html#c92e787729ebd178" class="i property">ItemContainerGenerator</a>.<a href="@0@PresentationFramework/A.html#6000667facb03be9" class="i method">ContainerFromItem</a> (<span class="r2 r">item</span>));
				<span class="r3 r">treeItem</span>.<a href="ExTreeViewItem.cs.html#aadb8bfc60aad190" class="i method">SelectChildren</a> ((<span id="r4 rd" class="r4 r">i</span>,<span id="r5 rd" class="r5 r">t</span>) =&gt; <span class="r5 r">t</span>.<a href="@0@PresentationFramework/A.html#b54aa385fc85e872" class="i property">IsExpanded</a>);
			}
		}

		<b>public void</b> <a id="d2bffb102609dc64" href="../R/d2bffb102609dc64.html" target="n" data-glyph="72,1" class="i method">UnselectAll</a>()
		{
			<b>if</b> (<a href="@0@PresentationFramework/A.html#54366ee76d2f1106" class="i property">Items</a> == <b>null</b> || <a href="@0@PresentationFramework/A.html#54366ee76d2f1106" class="i property">Items</a>.<a href="@0@PresentationFramework/A.html#4808b70b6149b33d" class="i property">Count</a> == 0)
				<b>return</b>;

			<a href="#0bab2449b8afe9e9" class="i property">SelectedItems</a>.<a href="@0@mscorlib/A.html#11fee9febe020c7c" class="i method">Clear</a>();
		}

		<b>public</b> <a href="ExTreeViewItem.cs.html#505370876d79da38" class="t t">ExTreeViewItem</a> <a id="d9ac0b59facecc3d" href="../R/d9ac0b59facecc3d.html" target="n" data-glyph="72,1" class="i method">ContainerFromObject</a> (<b>object</b> <span id="r6 rd" class="r6 r">item</span>)
		{
			<a href="ExTreeViewItem.cs.html#505370876d79da38" class="t t">ExTreeViewItem</a> <span id="r7 rd" class="r7 r">treeItem</span> = <b>null</b>;
			<a href="#76431e2a3129dca5" class="i method">TraverseTree</a> ((<span id="r8 rd" class="r8 r">o</span>,<span id="r9 rd" class="r9 r">i</span>) =&gt; {
				<b>if</b> (<span class="r8 r">o</span> == <span class="r6 r">item</span>) {
					<span class="r7 r">treeItem</span> = <span class="r9 r">i</span>;
					<b>return false</b>;
				}

				<b>return true</b>;
			});

			<b>return</b> <span class="r7 r">treeItem</span>;
		}

		<b>protected override bool</b> <a id="2fa8b0a19e9a5007" href="../R/2fa8b0a19e9a5007.html" target="n" data-glyph="75,1" class="i method">IsItemItsOwnContainerOverride</a> (<b>object</b> <span id="r10 rd" class="r10 r">item</span>)
		{
			<b>return</b> <span class="r10 r">item</span> <b>is</b> <a href="ExTreeViewItem.cs.html#505370876d79da38" class="t t">ExTreeViewItem</a>;
		}

		<b>protected override</b> <a href="@0@WindowsBase/A.html#3ce192f6633decc8" class="t t">DependencyObject</a> <a id="da2072d608160fab" href="../R/da2072d608160fab.html" target="n" data-glyph="75,1" class="i method">GetContainerForItemOverride</a>()
		{
			<b>return</b> <b>new</b> <a href="ExTreeViewItem.cs.html#66f2a65b08446d32" class="t constructor">ExTreeViewItem</a> (<a href="#f162c84db9d2e04f" class="k">this</a>);
		}

		<b>protected override</b> <span class="i n">System</span>.<span class="i n">Windows</span>.<a href="@0@WindowsBase/A.html#a844b9b525c2088c" class="t t">Size</a> <a id="54472cc4139d10b3" href="../R/54472cc4139d10b3.html" target="n" data-glyph="75,1" class="i method">MeasureOverride</a> (<span class="i n">System</span>.<span class="i n">Windows</span>.<a href="@0@WindowsBase/A.html#a844b9b525c2088c" class="t t">Size</a> <span id="r11 rd" class="r11 r">constraint</span>)
	    {
	        <a href="@0@WindowsBase/A.html#a844b9b525c2088c" class="k">var</a> <span id="r12 rd" class="r12 r">s</span> = <a href="@0@PresentationFramework/A.html#5050528c9202ffc4" class="k">base</a>.<a href="@0@PresentationFramework/A.html#df065fbb00809e59" class="i method">MeasureOverride</a> (<span class="r11 r">constraint</span>);
	        <b>if</b> (<a href="@0@PresentationFramework/A.html#488ab4a977a015eb" class="t t">ScrollViewer</a>.<a href="@0@PresentationFramework/A.html#99c7adca67579b1b" class="i method">GetHorizontalScrollBarVisibility</a> (<a href="#f162c84db9d2e04f" class="k">this</a>) != <a href="@0@PresentationFramework/A.html#cc606f9d55be03ae" class="t t">ScrollBarVisibility</a>.<a href="@0@PresentationFramework/A.html#d23a3b737b4893e3" class="i field">Hidden</a>)
	            <span class="r12 r">s</span>.<a href="@0@WindowsBase/A.html#6889b81bbde81637" class="i property">Width</a> = 0;
	        <b>if</b> (<a href="@0@PresentationFramework/A.html#488ab4a977a015eb" class="t t">ScrollViewer</a>.<a href="@0@PresentationFramework/A.html#0bb061fa751c5719" class="i method">GetVerticalScrollBarVisibility</a> (<a href="#f162c84db9d2e04f" class="k">this</a>) != <a href="@0@PresentationFramework/A.html#cc606f9d55be03ae" class="t t">ScrollBarVisibility</a>.<a href="@0@PresentationFramework/A.html#d23a3b737b4893e3" class="i field">Hidden</a>)
	            <span class="r12 r">s</span>.<a href="@0@WindowsBase/A.html#5c5d17caa72f2875" class="i property">Height</a> = <a href="@0@PresentationFramework/A.html#02007600b4eb5699" class="t t">SystemParameters</a>.<a href="@0@PresentationFramework/A.html#bed881a0a7de6556" class="i property">CaptionHeight</a>;

	        <b>return</b> <a href="#d820ac1aa024f0cd" class="i property">Backend</a>.<a href="WidgetBackend.cs.html#10b9740f443f1be6" class="i method">MeasureOverride</a> (<span class="r11 r">constraint</span>, <span class="r12 r">s</span>);
	    }

		<b>protected virtual void</b> <a id="309b4f5e0171b9e8" href="../R/309b4f5e0171b9e8.html" target="n" data-glyph="75,1" class="i method">OnSelectionModeChanged</a> (<a href="@0@WindowsBase/A.html#71a1a16823f70b8c" class="t t">DependencyPropertyChangedEventArgs</a> <span id="r13 rd" class="r13 r">e</span>)
		{
			<span class="i n">System</span>.<span class="i n">Windows</span>.<span class="i n">Controls</span>.<a href="@0@PresentationFramework/A.html#c049f467e619a257" class="t t">SelectionMode</a> <span id="r14 rd" class="r14 r">oldMode</span> = (<span class="i n">System</span>.<span class="i n">Windows</span>.<span class="i n">Controls</span>.<a href="@0@PresentationFramework/A.html#c049f467e619a257" class="t t">SelectionMode</a>) <span class="r13 r">e</span>.<a href="@0@WindowsBase/A.html#dfc6526fd2b658ce" class="i property">OldValue</a>;

			<b>object</b> <span id="r15 rd" class="r15 r">lastSelected</span> = <a href="@0@PresentationFramework/A.html#86321156e40bd51c" class="i property">SelectedItem</a>;

			<b>if</b> (<span class="r14 r">oldMode</span> == <span class="i n">System</span>.<span class="i n">Windows</span>.<span class="i n">Controls</span>.<a href="@0@PresentationFramework/A.html#c049f467e619a257" class="t t">SelectionMode</a>.<a href="@0@PresentationFramework/A.html#0987ae61e480b1a3" class="i field">Multiple</a>) {
				<a href="#d2bffb102609dc64" class="i method">UnselectAll</a> ();
				<b>if</b> (<span class="r15 r">lastSelected</span> != <b>null</b>)
					<a href="#0bab2449b8afe9e9" class="i property">SelectedItems</a>.<a href="@0@mscorlib/A.html#bded9f03433a53d4" class="i method">Add</a> (<span class="r15 r">lastSelected</span>);
			}
		}

		<b>protected virtual void</b> <a id="0250da0a10fe32ef" href="../R/0250da0a10fe32ef.html" target="n" data-glyph="75,1" class="i method">OnSelectedItemsChanged</a> (<a href="@0@mscorlib/A.html#9a1496aa60befd10" class="t t">EventArgs</a> <span id="r16 rd" class="r16 r">e</span>)
		{
			<a href="@0@mscorlib/A.html#3b79d2b06c15f250" class="k">var</a> <span id="r17 rd" class="r17 r">handler</span> = <a href="#e5334f89054024d1" class="i">SelectedItemsChanged</a>;
			<b>if</b> (<span class="r17 r">handler</span> != <b>null</b>)
				<span class="r17 r">handler</span> (<a href="#f162c84db9d2e04f" class="k">this</a>, <span class="r16 r">e</span>);
		}

		<b>protected virtual void</b> <a id="7e5e362d16031394" href="../R/7e5e362d16031394.html" target="n" data-glyph="75,1" class="i method">OnSelectedItemsPropertyChanged</a> (<a href="@0@WindowsBase/A.html#71a1a16823f70b8c" class="t t">DependencyPropertyChangedEventArgs</a> <span id="r18 rd" class="r18 r">e</span>)
		{
			<a href="@0@System/A.html#c0af625dba98c968" class="k">var</a> <span id="r19 rd" class="r19 r">oldNotifying</span> = <span class="r18 r">e</span>.<a href="@0@WindowsBase/A.html#dfc6526fd2b658ce" class="i property">OldValue</a> <b>as</b> <a href="@0@System/A.html#c0af625dba98c968" class="t t">INotifyCollectionChanged</a>;
			<b>if</b> (<span class="r19 r">oldNotifying</span> != <b>null</b>)
				<span class="r19 r">oldNotifying</span>.<a href="@0@System/A.html#26300c777385ef7c" class="i">CollectionChanged</a> -= <a href="#f6f65847117458ed" class="i method">SelectedItemsCollectionChanged</a>;

			<a href="@0@System/A.html#c0af625dba98c968" class="k">var</a> <span id="r20 rd" class="r20 r">newNotifying</span> = <span class="r18 r">e</span>.<a href="@0@WindowsBase/A.html#0acf297ea547e623" class="i property">NewValue</a> <b>as</b> <a href="@0@System/A.html#c0af625dba98c968" class="t t">INotifyCollectionChanged</a>;
			<b>if</b> (<span class="r20 r">newNotifying</span> != <b>null</b>)
				<span class="r20 r">newNotifying</span>.<a href="@0@System/A.html#26300c777385ef7c" class="i">CollectionChanged</a> += <a href="#f6f65847117458ed" class="i method">SelectedItemsCollectionChanged</a>;
		}

		<b>private bool</b> <a id="76431e2a3129dca5" href="../R/76431e2a3129dca5.html" target="n" data-glyph="76,1" class="i method">TraverseTree</a> (<a href="@0@mscorlib/A.html#8adbe0476ca899db" class="t t">Func</a>&lt;<b>object</b>, <a href="ExTreeViewItem.cs.html#505370876d79da38" class="t t">ExTreeViewItem</a>, <b>bool</b>&gt; <span id="r21 rd" class="r21 r">action</span>, <a href="ExTreeViewItem.cs.html#505370876d79da38" class="t t">ExTreeViewItem</a> <span id="r22 rd" class="r22 r">parent</span> = <b>null</b>)
		{
			<a href="@0@PresentationFramework/A.html#1b7909b08c58ddd0" class="t t">ItemContainerGenerator</a> <span id="r23 rd" class="r23 r">g</span> = <a href="@0@PresentationFramework/A.html#c92e787729ebd178" class="i property">ItemContainerGenerator</a>;
			<a href="@0@mscorlib/A.html#9be451ac13d86a97" class="t t">IEnumerable</a> <span id="r24 rd" class="r24 r">items</span> = <a href="@0@PresentationFramework/A.html#54366ee76d2f1106" class="i property">Items</a>;
			<b>if</b> (<span class="r22 r">parent</span> != <b>null</b>) {
				<span class="r24 r">items</span> = <span class="r22 r">parent</span>.<a href="@0@PresentationFramework/A.html#54366ee76d2f1106" class="i property">Items</a>;
				<span class="r23 r">g</span> = <span class="r22 r">parent</span>.<a href="@0@PresentationFramework/A.html#c92e787729ebd178" class="i property">ItemContainerGenerator</a>;
			}

			<b>foreach</b> (<b>object</b> <span id="r25 rd" class="r25 r">item</span> <b>in</b> <span class="r24 r">items</span>) {
				<a href="ExTreeViewItem.cs.html#505370876d79da38" class="k">var</a> <span id="r26 rd" class="r26 r">treeItem</span> = (<a href="ExTreeViewItem.cs.html#505370876d79da38" class="t t">ExTreeViewItem</a>)<span class="r23 r">g</span>.<a href="@0@PresentationFramework/A.html#6000667facb03be9" class="i method">ContainerFromItem</a> (<span class="r25 r">item</span>);
				<b>if</b> (<span class="r26 r">treeItem</span> == <b>null</b>) {
					<a href="@0@PresentationFramework/A.html#4014d1f10259f149" class="k">var</a> <span id="r27 rd" class="r27 r">ig</span> = (<a href="@0@PresentationFramework/A.html#4014d1f10259f149" class="t t">IItemContainerGenerator</a>)<span class="r23 r">g</span>;
					<b>using</b> (<span class="r27 r">ig</span>.<a href="@0@PresentationFramework/A.html#98815e8c5e9d9f67" class="i method">StartAt</a> (<b>new</b> <a href="@0@PresentationFramework/A.html#9e1bfb396ec5906c" class="t constructor">GeneratorPosition</a> (-1, 1), <a href="@0@PresentationFramework/A.html#055deb5c41665454" class="t t">GeneratorDirection</a>.<a href="@0@PresentationFramework/A.html#1e23a8d2de9308a5" class="i field">Forward</a>)) {
						<span class="r27 r">ig</span>.<a href="@0@PresentationFramework/A.html#ae8ceba7f045584a" class="i method">GenerateNext</a> ();
					}
					<span class="r26 r">treeItem</span> = (<a href="ExTreeViewItem.cs.html#505370876d79da38" class="t t">ExTreeViewItem</a>)<span class="r23 r">g</span>.<a href="@0@PresentationFramework/A.html#6000667facb03be9" class="i method">ContainerFromItem</a> (<span class="r25 r">item</span>);
					<b>if</b> (<span class="r26 r">treeItem</span> == <b>null</b>)
						<b>continue</b>;
				}

				<b>if</b> (!<span class="r21 r">action</span> (<span class="r25 r">item</span>, <span class="r26 r">treeItem</span>))
					<b>return false</b>;
				
				<b>if</b> (!<a href="#76431e2a3129dca5" class="i method">TraverseTree</a> (<span class="r21 r">action</span>, <span class="r26 r">treeItem</span>))
					<b>return false</b>;
			}

			<b>return true</b>;
		}

		<b>private</b> <a href="ExTreeViewItem.cs.html#505370876d79da38" class="t t">ExTreeViewItem</a> <a id="d3d8517060e130ec" href="../R/d3d8517060e130ec.html" target="n" data-glyph="76,1" class="i method">GetTreeItem</a> (<b>object</b> <span id="r28 rd" class="r28 r">item</span>)
		{
			<b>return</b> (<a href="ExTreeViewItem.cs.html#505370876d79da38" class="t t">ExTreeViewItem</a>) <a href="@0@PresentationFramework/A.html#c92e787729ebd178" class="i property">ItemContainerGenerator</a>.<a href="@0@PresentationFramework/A.html#6000667facb03be9" class="i method">ContainerFromItem</a> (<span class="r28 r">item</span>);
		}

		<b>private static readonly</b> <a href="@0@mscorlib/A.html#f3f0ea5f89a8f162" class="t t">PropertyInfo</a> <a id="7a40286c4b0690b2" href="../R/7a40286c4b0690b2.html" target="n" data-glyph="46,1" class="i field">IsSelectionChangeActiveProperty</a> =
			<b>typeof</b> (<span class="i n">System</span>.<span class="i n">Windows</span>.<span class="i n">Controls</span>.<a href="@0@PresentationFramework/A.html#5050528c9202ffc4" class="t t">TreeView</a>).<a href="@0@mscorlib/A.html#90cb501901e16fa4" class="i method">GetProperty</a> (<span class="s">&quot;IsSelectionChangeActive&quot;</span>, <a href="@0@mscorlib/A.html#4795caf3b483702d" class="t t">BindingFlags</a>.<a href="@0@mscorlib/A.html#5144189c11f6b668" class="i field">NonPublic</a> | <a href="@0@mscorlib/A.html#4795caf3b483702d" class="t t">BindingFlags</a>.<a href="@0@mscorlib/A.html#54a14f747b06c614" class="i field">Instance</a>);

		<b>private void</b> <a id="f6f65847117458ed" href="../R/f6f65847117458ed.html" target="n" data-glyph="76,1" class="i method">SelectedItemsCollectionChanged</a> (<b>object</b> <span id="r29 rd" class="r29 r">sender</span>, <a href="@0@System/A.html#f5d7031313cab4ab" class="t t">NotifyCollectionChangedEventArgs</a> <span id="r30 rd" class="r30 r">e</span>)
		{
			<b>bool</b> <span id="r31 rd" class="r31 r">changeActive</span> = (<b>bool</b>)<a href="#7a40286c4b0690b2" class="i field">IsSelectionChangeActiveProperty</a>.<a href="@0@mscorlib/A.html#0308429a99d58f37" class="i method">GetValue</a> (<a href="#f162c84db9d2e04f" class="k">this</a>, <b>null</b>);
			<b>if</b> (!<span class="r31 r">changeActive</span>)
				<a href="#7a40286c4b0690b2" class="i field">IsSelectionChangeActiveProperty</a>.<a href="@0@mscorlib/A.html#fac5bcae675d50eb" class="i method">SetValue</a> (<a href="#f162c84db9d2e04f" class="k">this</a>, <b>true</b>, <b>null</b>);

			<b>switch</b> (<span class="r30 r">e</span>.<a href="@0@System/A.html#15d9dc6d0ce211ef" class="i property">Action</a>) {
			<b>case</b> <a href="@0@System/A.html#5cce4343d1536ac7" class="t t">NotifyCollectionChangedAction</a>.<a href="@0@System/A.html#9f765bcaf89c2cbe" class="i field">Reset</a>:
				<a href="@0@System.Core/A.html#2d265edc718b158b" class="k">var</a> <span id="r32 rd" class="r32 r">selectedItems</span> = <b>new</b> <a href="@0@System.Core/A.html#e068afbcd77375f8" class="t constructor">HashSet</a>&lt;<b>object</b>&gt; (<a href="#0bab2449b8afe9e9" class="i property">SelectedItems</a>.<a href="@0@System.Core/A.html#27bb217a6d5457ec" class="i method">Cast</a>&lt;<b>object</b>&gt; ());
				<a href="#76431e2a3129dca5" class="i method">TraverseTree</a> ((<span id="r33 rd" class="r33 r">o</span>, <span id="r34 rd" class="r34 r">i</span>) =&gt; {
					<span class="r34 r">i</span>.<a href="@0@PresentationFramework/A.html#a7640b5ae036467a" class="i property">IsSelected</a> = <span class="r32 r">selectedItems</span>.<a href="@0@System.Core/A.html#4e77ae9204a00be6" class="i method">Remove</a> (<span class="r33 r">o</span>);
					<b>return true</b>;
				});

				<b>foreach</b> (<b>object</b> <span id="r35 rd" class="r35 r">item</span> <b>in</b> <a href="#0bab2449b8afe9e9" class="i property">SelectedItems</a>)
					<a href="#d3d8517060e130ec" class="i method">GetTreeItem</a> (<span class="r35 r">item</span>).<a href="@0@PresentationFramework/A.html#a7640b5ae036467a" class="i property">IsSelected</a> = <b>true</b>;
			<b>break</b>;

			<b>default</b>:
				<b>if</b> (!<span class="r31 r">changeActive</span> &amp;&amp; <a href="#a00a6f8decc884bd" class="i property">SelectionMode</a> == <span class="i n">System</span>.<span class="i n">Windows</span>.<span class="i n">Controls</span>.<a href="@0@PresentationFramework/A.html#c049f467e619a257" class="t t">SelectionMode</a>.<a href="@0@PresentationFramework/A.html#7abb7043062e8485" class="i field">Single</a>) {
					<b>if</b> (<a href="#0bab2449b8afe9e9" class="i property">SelectedItems</a>.<a href="@0@mscorlib/A.html#e961aba0053db107" class="i property">Count</a> &gt; 0)
						<a href="#0bab2449b8afe9e9" class="i property">SelectedItems</a>.<a href="@0@mscorlib/A.html#11fee9febe020c7c" class="i method">Clear</a>();
					<b>if</b> (<span class="r30 r">e</span>.<a href="@0@System/A.html#722a7e5cc5805066" class="i property">NewItems</a> != <b>null</b> &amp;&amp; <span class="r30 r">e</span>.<a href="@0@System/A.html#722a7e5cc5805066" class="i property">NewItems</a>.<a href="@0@mscorlib/A.html#e961aba0053db107" class="i property">Count</a> &gt; 0)
						<a href="#0bab2449b8afe9e9" class="i property">SelectedItems</a>.<a href="@0@mscorlib/A.html#bded9f03433a53d4" class="i method">Add</a> (<span class="r30 r">e</span>.<a href="@0@System/A.html#722a7e5cc5805066" class="i property">NewItems</a> [0]);
				}

				<b>if</b> (<span class="r30 r">e</span>.<a href="@0@System/A.html#722a7e5cc5805066" class="i property">NewItems</a> != <b>null</b> || <span class="r30 r">e</span>.<a href="@0@System/A.html#603468e507aeaa14" class="i property">OldItems</a> != <b>null</b>) {
					<a href="@0@System.Core/A.html#2d265edc718b158b" class="t t">HashSet</a>&lt;<b>object</b>&gt; <span id="r36 rd" class="r36 r">newItems</span> = (<span class="r30 r">e</span>.<a href="@0@System/A.html#722a7e5cc5805066" class="i property">NewItems</a> != <b>null</b>)
												? <b>new</b> <a href="@0@System.Core/A.html#e068afbcd77375f8" class="t constructor">HashSet</a>&lt;<b>object</b>&gt; (<span class="r30 r">e</span>.<a href="@0@System/A.html#722a7e5cc5805066" class="i property">NewItems</a>.<a href="@0@System.Core/A.html#27bb217a6d5457ec" class="i method">Cast</a>&lt;<b>object</b>&gt; ())
												: <b>new</b> <a href="@0@System.Core/A.html#eca9ea30fa3b2c28" class="t constructor">HashSet</a>&lt;<b>object</b>&gt; ();

					<a href="@0@System.Core/A.html#2d265edc718b158b" class="t t">HashSet</a>&lt;<b>object</b>&gt; <span id="r37 rd" class="r37 r">oldItems</span> = (<span class="r30 r">e</span>.<a href="@0@System/A.html#603468e507aeaa14" class="i property">OldItems</a> != <b>null</b>)
												? <b>new</b> <a href="@0@System.Core/A.html#e068afbcd77375f8" class="t constructor">HashSet</a>&lt;<b>object</b>&gt; (<span class="r30 r">e</span>.<a href="@0@System/A.html#603468e507aeaa14" class="i property">OldItems</a>.<a href="@0@System.Core/A.html#27bb217a6d5457ec" class="i method">Cast</a>&lt;<b>object</b>&gt; ())
												: <b>new</b> <a href="@0@System.Core/A.html#eca9ea30fa3b2c28" class="t constructor">HashSet</a>&lt;<b>object</b>&gt; ();
					
					<a href="#76431e2a3129dca5" class="i method">TraverseTree</a> ((<span id="r38 rd" class="r38 r">o</span>, <span id="r39 rd" class="r39 r">ti</span>) =&gt; {
						<b>if</b> (<span class="r36 r">newItems</span>.<a href="@0@System.Core/A.html#4e77ae9204a00be6" class="i method">Remove</a> (<span class="r38 r">o</span>))
							<span class="r39 r">ti</span>.<a href="@0@PresentationFramework/A.html#a7640b5ae036467a" class="i property">IsSelected</a> = <b>true</b>;
						<b>else if</b> (<a href="#a00a6f8decc884bd" class="i property">SelectionMode</a> == <span class="i n">SWC</span>.<a href="@0@PresentationFramework/A.html#c049f467e619a257" class="t t">SelectionMode</a>.<a href="@0@PresentationFramework/A.html#7abb7043062e8485" class="i field">Single</a> || <span class="r37 r">oldItems</span>.<a href="@0@System.Core/A.html#4e77ae9204a00be6" class="i method">Remove</a> (<span class="r38 r">o</span>))
							<span class="r39 r">ti</span>.<a href="@0@PresentationFramework/A.html#a7640b5ae036467a" class="i property">IsSelected</a> = <b>false</b>;

						<b>return</b> (<span class="r36 r">newItems</span>.<a href="@0@System.Core/A.html#905bec8c22644c82" class="i property">Count</a> + <span class="r37 r">oldItems</span>.<a href="@0@System.Core/A.html#905bec8c22644c82" class="i property">Count</a> &gt; 0);
					});
				}
				<b>break</b>;
			}

			<a href="#0250da0a10fe32ef" class="i method">OnSelectedItemsChanged</a> (<a href="@0@mscorlib/A.html#9a1496aa60befd10" class="t t">EventArgs</a>.<a href="@0@mscorlib/A.html#433622385e05af0d" class="i field">Empty</a>);

			<b>if</b> (!<span class="r31 r">changeActive</span>)
				<a href="#7a40286c4b0690b2" class="i field">IsSelectionChangeActiveProperty</a>.<a href="@0@mscorlib/A.html#fac5bcae675d50eb" class="i method">SetValue</a> (<a href="#f162c84db9d2e04f" class="k">this</a>, <span class="r31 r">changeActive</span>, <b>null</b>);
		}

		<b>private static void</b> <a id="b5a7a69a58fbdd39" href="../R/b5a7a69a58fbdd39.html" target="n" data-glyph="76,1" class="i method">OnSelectedItemsPropertyChanged</a> (<a href="@0@WindowsBase/A.html#3ce192f6633decc8" class="t t">DependencyObject</a> <span id="r40 rd" class="r40 r">dependencyObject</span>, <a href="@0@WindowsBase/A.html#71a1a16823f70b8c" class="t t">DependencyPropertyChangedEventArgs</a> <span id="r41 rd" class="r41 r">e</span>)
		{
			<a href="#f162c84db9d2e04f" class="k">var</a> <span id="r42 rd" class="r42 r">view</span> = (<a href="#f162c84db9d2e04f" class="t t">ExTreeView</a>) <span class="r40 r">dependencyObject</span>;
			<span class="r42 r">view</span>.<a href="#7e5e362d16031394" class="i method">OnSelectedItemsPropertyChanged</a> (<span class="r41 r">e</span>);
		}

		<b>private static void</b> <a id="2ab623ebdf48faf6" href="../R/2ab623ebdf48faf6.html" target="n" data-glyph="76,1" class="i method">OnSelectionModePropertyChanged</a> (<a href="@0@WindowsBase/A.html#3ce192f6633decc8" class="t t">DependencyObject</a> <span id="r43 rd" class="r43 r">dependencyObject</span>, <a href="@0@WindowsBase/A.html#71a1a16823f70b8c" class="t t">DependencyPropertyChangedEventArgs</a> <span id="r44 rd" class="r44 r">e</span>)
		{
			<a href="#f162c84db9d2e04f" class="k">var</a> <span id="r45 rd" class="r45 r">view</span> = (<a href="#f162c84db9d2e04f" class="t t">ExTreeView</a>) <span class="r43 r">dependencyObject</span>;
			<span class="r45 r">view</span>.<a href="#309b4f5e0171b9e8" class="i method">OnSelectionModeChanged</a> (<span class="r44 r">e</span>);
		}

		<b>public void</b> <a id="a80bdb1747903ec0" href="../R/a80bdb1747903ec0.html" target="n" data-glyph="72,1" class="i method">SelectItem</a>(<b>object</b> <span id="r46 rd" class="r46 r">item</span>)
		{
			<a href="#c9c2de9027253b12" class="i method">SelectItem</a>(<a href="#d9ac0b59facecc3d" class="i method">ContainerFromObject</a>(<span class="r46 r">item</span>));
		}

		<a href="ExTreeViewItem.cs.html#505370876d79da38" class="t t">ExTreeViewItem</a> <a id="e4bc9a510a0e0d7b" href="../R/e4bc9a510a0e0d7b.html" target="n" data-glyph="46,1" class="i field">shiftStart</a> = <b>null</b>;
		<a href="ExTreeViewItem.cs.html#505370876d79da38" class="t t">ExTreeViewItem</a> <a id="5eebedd344dc1c70" href="../R/5eebedd344dc1c70.html" target="n" data-glyph="46,1" class="i field">shiftEnd</a> = <b>null</b>;

		<b>private bool</b> <a id="c3ca43e46f077930" href="../R/c3ca43e46f077930.html" target="n" data-glyph="106,1" class="i property">ShiftPressed</a>
		{
			<b>get</b>
			{
				<b>return</b> <a href="@0@PresentationCore/A.html#af9b7892ee354373" class="t t">Keyboard</a>.<a href="@0@PresentationCore/A.html#4e532ab033c068e5" class="i method">IsKeyDown</a>(<a href="@0@WindowsBase/A.html#8e0d9266dee78287" class="t t">WKey</a>.<a href="@0@WindowsBase/A.html#b4e6e7b9707e42b0" class="i field">RightShift</a>) || <a href="@0@PresentationCore/A.html#af9b7892ee354373" class="t t">Keyboard</a>.<a href="@0@PresentationCore/A.html#4e532ab033c068e5" class="i method">IsKeyDown</a>(<a href="@0@WindowsBase/A.html#8e0d9266dee78287" class="t t">WKey</a>.<a href="@0@WindowsBase/A.html#d063f622025ee52a" class="i field">LeftShift</a>);
			}
		}

		<b>private bool</b> <a id="759f7f05fdbb6e0c" href="../R/759f7f05fdbb6e0c.html" target="n" data-glyph="106,1" class="i property">CtrlPressed</a>
		{
			<b>get</b>
			{
				<b>return</b> <a href="@0@PresentationCore/A.html#af9b7892ee354373" class="t t">Keyboard</a>.<a href="@0@PresentationCore/A.html#4e532ab033c068e5" class="i method">IsKeyDown</a>(<a href="@0@WindowsBase/A.html#8e0d9266dee78287" class="t t">WKey</a>.<a href="@0@WindowsBase/A.html#e89a228c9dc1bd2c" class="i field">RightCtrl</a>) || <a href="@0@PresentationCore/A.html#af9b7892ee354373" class="t t">Keyboard</a>.<a href="@0@PresentationCore/A.html#4e532ab033c068e5" class="i method">IsKeyDown</a>(<a href="@0@WindowsBase/A.html#8e0d9266dee78287" class="t t">WKey</a>.<a href="@0@WindowsBase/A.html#2b72caec22f1249d" class="i field">LeftCtrl</a>);
			}
		}

		<b>protected override void</b> <a id="9b77da1187c2764d" href="../R/9b77da1187c2764d.html" target="n" data-glyph="75,1" class="i method">OnGotFocus</a>(<a href="@0@PresentationCore/A.html#3089ebf2139eba9d" class="t t">RoutedEventArgs</a> <span id="r47 rd" class="r47 r">e</span>)
		{
			<a href="@0@PresentationFramework/A.html#5050528c9202ffc4" class="k">base</a>.<a href="@0@PresentationFramework/A.html#2f9d751655ae4c6d" class="i method">OnGotFocus</a>(<span class="r47 r">e</span>);
			<a href="#f7b0ddd0a5fbc243" class="i method">FocusItem</a>(<a href="#a1226acadb878c51" class="i field">focusedTreeViewItem</a>);
		}

		<b>public void</b> <a id="c9c2de9027253b12" href="../R/c9c2de9027253b12.html" target="n" data-glyph="72,1" class="i method">SelectItem</a>(<a href="ExTreeViewItem.cs.html#505370876d79da38" class="t t">ExTreeViewItem</a> <span id="r48 rd" class="r48 r">item</span>)
		{
			<a href="#f7b0ddd0a5fbc243" class="i method">FocusItem</a>(<span class="r48 r">item</span>);
			<b>if</b> (!<a href="#759f7f05fdbb6e0c" class="i property">CtrlPressed</a>)
				<a href="#0bab2449b8afe9e9" class="i property">SelectedItems</a>.<a href="@0@mscorlib/A.html#11fee9febe020c7c" class="i method">Clear</a>();
			<b>if</b> (<a href="#c3ca43e46f077930" class="i property">ShiftPressed</a>)
			{
				<b>if</b> (<a href="#5eebedd344dc1c70" class="i field">shiftEnd</a> != <b>null</b>)<span class="c">//Erase previous selection of shift</span>
					<b>foreach</b> (<a href="ExTreeViewItem.cs.html#505370876d79da38" class="k">var</a> <span id="r49 rd" class="r49 r">forEachItem</span> <b>in</b> <a href="#baaee102bcb34f9b" class="i method">GetItemsBetween</a>(<a href="#e4bc9a510a0e0d7b" class="i field">shiftStart</a>, <a href="#5eebedd344dc1c70" class="i field">shiftEnd</a>))
						<a href="#0bab2449b8afe9e9" class="i property">SelectedItems</a>.<a href="@0@mscorlib/A.html#36e262a0820371fd" class="i method">Remove</a>(<span class="r49 r">forEachItem</span>.<a href="@0@PresentationFramework/A.html#e4aaca7514916173" class="i property">DataContext</a>);
				<a href="#5eebedd344dc1c70" class="i field">shiftEnd</a> = <span class="r48 r">item</span>;
				<b>foreach</b> (<a href="ExTreeViewItem.cs.html#505370876d79da38" class="k">var</a> <span id="r50 rd" class="r50 r">forEachItem</span> <b>in</b> <a href="#baaee102bcb34f9b" class="i method">GetItemsBetween</a>(<a href="#e4bc9a510a0e0d7b" class="i field">shiftStart</a>, <a href="#5eebedd344dc1c70" class="i field">shiftEnd</a>))
					<a href="#0bab2449b8afe9e9" class="i property">SelectedItems</a>.<a href="@0@mscorlib/A.html#bded9f03433a53d4" class="i method">Add</a>(<span class="r50 r">forEachItem</span>.<a href="@0@PresentationFramework/A.html#e4aaca7514916173" class="i property">DataContext</a>);
			}
			<b>else</b>
			{
				<a href="#5eebedd344dc1c70" class="i field">shiftEnd</a> = <b>null</b>;
				<a href="#e4bc9a510a0e0d7b" class="i field">shiftStart</a> = <span class="r48 r">item</span>;
				<b>if</b> (<a href="#759f7f05fdbb6e0c" class="i property">CtrlPressed</a> &amp;&amp; <a href="#0bab2449b8afe9e9" class="i property">SelectedItems</a>.<a href="@0@mscorlib/A.html#ffcdcc091fb8c1ef" class="i method">Contains</a>(<span class="r48 r">item</span>.<a href="@0@PresentationFramework/A.html#e4aaca7514916173" class="i property">DataContext</a>))
					<a href="#0bab2449b8afe9e9" class="i property">SelectedItems</a>.<a href="@0@mscorlib/A.html#36e262a0820371fd" class="i method">Remove</a>(<span class="r48 r">item</span>.<a href="@0@PresentationFramework/A.html#e4aaca7514916173" class="i property">DataContext</a>);
				<b>else</b>
					<a href="#0bab2449b8afe9e9" class="i property">SelectedItems</a>.<a href="@0@mscorlib/A.html#bded9f03433a53d4" class="i method">Add</a>(<span class="r48 r">item</span>.<a href="@0@PresentationFramework/A.html#e4aaca7514916173" class="i property">DataContext</a>);
			}
		}

		<b>private</b> <a href="@0@mscorlib/A.html#3acf01620172c7f0" class="t t">IEnumerable</a>&lt;<a href="ExTreeViewItem.cs.html#505370876d79da38" class="t t">ExTreeViewItem</a>&gt; <a id="d1072934f8022d4b" href="../R/d1072934f8022d4b.html" target="n" data-glyph="76,1" class="i method">GetAllVisibleItems</a>(<a href="@0@PresentationFramework/A.html#dee33c98c4dcf3f2" class="t t">ItemsControl</a> <span id="r51 rd" class="r51 r">itemsControl</span>)
		{
			<b>foreach</b> (<a href="@0@mscorlib/A.html#d9262ceecc1719ab" class="k">var</a> <span id="r52 rd" class="r52 r">item</span> <b>in</b> <span class="r51 r">itemsControl</span>.<a href="@0@PresentationFramework/A.html#54366ee76d2f1106" class="i property">Items</a>)
			{
				<a href="ExTreeViewItem.cs.html#505370876d79da38" class="t t">ExTreeViewItem</a> <span id="r53 rd" class="r53 r">treeViewItem</span> = (<a href="ExTreeViewItem.cs.html#505370876d79da38" class="t t">ExTreeViewItem</a>)<span class="r51 r">itemsControl</span>.<a href="@0@PresentationFramework/A.html#c92e787729ebd178" class="i property">ItemContainerGenerator</a>.<a href="@0@PresentationFramework/A.html#6000667facb03be9" class="i method">ContainerFromItem</a>(<span class="r52 r">item</span>);
				<b>if</b> (<span class="r53 r">treeViewItem</span> == <b>null</b>)
					<b>continue</b>;
				<b>if</b> (<span class="r53 r">treeViewItem</span>.<a href="@0@PresentationCore/A.html#90bc97a020426061" class="i property">IsVisible</a> &amp;&amp; <span class="r53 r">treeViewItem</span>.<a href="@0@PresentationCore/A.html#69f262dd47fdf2be" class="i property">Visibility</a> == <a href="@0@PresentationCore/A.html#2668d640196eddd0" class="t t">Visibility</a>.<a href="@0@PresentationCore/A.html#02d18b751f37c2fd" class="i field">Visible</a>)
				{
					<b>yield return</b> <span class="r53 r">treeViewItem</span>;
					<b>if</b> (<span class="r53 r">treeViewItem</span>.<a href="@0@PresentationFramework/A.html#b54aa385fc85e872" class="i property">IsExpanded</a>)
						<b>foreach</b> (<a href="ExTreeViewItem.cs.html#505370876d79da38" class="k">var</a> <span id="r54 rd" class="r54 r">childItem</span> <b>in</b> <a href="#d1072934f8022d4b" class="i method">GetAllVisibleItems</a>(<span class="r53 r">treeViewItem</span>))
							<b>yield return</b> <span class="r54 r">childItem</span>;
				}
			}
		}

		<b>private</b> <a href="@0@mscorlib/A.html#3acf01620172c7f0" class="t t">IEnumerable</a>&lt;<a href="ExTreeViewItem.cs.html#505370876d79da38" class="t t">ExTreeViewItem</a>&gt; <a id="baaee102bcb34f9b" href="../R/baaee102bcb34f9b.html" target="n" data-glyph="76,1" class="i method">GetItemsBetween</a>(<a href="ExTreeViewItem.cs.html#505370876d79da38" class="t t">ExTreeViewItem</a> <span id="r55 rd" class="r55 r">startItem</span>, <a href="ExTreeViewItem.cs.html#505370876d79da38" class="t t">ExTreeViewItem</a> <span id="r56 rd" class="r56 r">endItem</span>)
		{
			<a href="@0@mscorlib/A.html#cf7f4095e4de7646" class="k">var</a> <span id="r57 rd" class="r57 r">allVisibleItems</span> = <a href="#d1072934f8022d4b" class="i method">GetAllVisibleItems</a>(<a href="#f162c84db9d2e04f" class="k">this</a>).<a href="@0@System.Core/A.html#e276d6892241255b" class="i method">ToList</a>();
			<a href="@0@mscorlib/A.html#225942ed7b7a3252" class="k">var</a> <span id="r58 rd" class="r58 r">startIndex</span> = <span class="r57 r">allVisibleItems</span>.<a href="@0@mscorlib/A.html#242756beb6e8749e" class="i method">IndexOf</a>(<span class="r55 r">startItem</span>);
			<a href="@0@mscorlib/A.html#225942ed7b7a3252" class="k">var</a> <span id="r59 rd" class="r59 r">endIndex</span> = <span class="r57 r">allVisibleItems</span>.<a href="@0@mscorlib/A.html#242756beb6e8749e" class="i method">IndexOf</a>(<span class="r56 r">endItem</span>);

			<b>if</b> (<span class="r59 r">endIndex</span> == <span class="r58 r">startIndex</span>)
				<b>return</b> <b>new</b> <a href="@0@mscorlib/A.html#9e5352b2b304ceba" class="t constructor">List</a>&lt;<a href="ExTreeViewItem.cs.html#505370876d79da38" class="t t">ExTreeViewItem</a>&gt; { <span class="r56 r">endItem</span> };
			<a href="@0@mscorlib/A.html#cf7f4095e4de7646" class="k">var</a> <span id="r60 rd" class="r60 r">filteredItems</span> = <b>new</b> <a href="@0@mscorlib/A.html#9e5352b2b304ceba" class="t constructor">List</a>&lt;<a href="ExTreeViewItem.cs.html#505370876d79da38" class="t t">ExTreeViewItem</a>&gt;();
			<b>if</b> (<span class="r59 r">endIndex</span> &gt; <span class="r58 r">startIndex</span>)
				<b>for</b> (<b>int</b> <span id="r61 rd" class="r61 r">i</span> = <span class="r58 r">startIndex</span>; <span class="r61 r">i</span> &lt;= <span class="r59 r">endIndex</span>; <span class="r61 r">i</span>++)
					<span class="r60 r">filteredItems</span>.<a href="@0@mscorlib/A.html#9cc11588bffd57c1" class="i method">Add</a>(<span class="r57 r">allVisibleItems</span><a href="@0@mscorlib/A.html#0c65bec4d3fac21e">[</a><span class="r61 r">i</span>]);
			<b>else
				for</b> (<b>int</b> <span id="r62 rd" class="r62 r">i</span> = <span class="r58 r">startIndex</span>; <span class="r62 r">i</span> &gt;= <span class="r59 r">endIndex</span>; <span class="r62 r">i</span>--)
					<span class="r60 r">filteredItems</span>.<a href="@0@mscorlib/A.html#9cc11588bffd57c1" class="i method">Add</a>(<span class="r57 r">allVisibleItems</span><a href="@0@mscorlib/A.html#0c65bec4d3fac21e">[</a><span class="r62 r">i</span>]);
			<b>return</b> <span class="r60 r">filteredItems</span>;
		}

		<b>private</b> <a href="ExTreeViewItem.cs.html#505370876d79da38" class="t t">ExTreeViewItem</a> <a id="a1226acadb878c51" href="../R/a1226acadb878c51.html" target="n" data-glyph="46,1" class="i field">focusedTreeViewItem</a> = <b>null</b>;
		<b>public</b> <a href="ExTreeViewItem.cs.html#505370876d79da38" class="t t">ExTreeViewItem</a> <a id="95f40a7a8dc0a8be" href="../R/95f40a7a8dc0a8be.html" target="n" data-glyph="102,1" class="i property">FocusedItem</a> {
			<b>get</b> {
				<b>return</b> <a href="#a1226acadb878c51" class="i field">focusedTreeViewItem</a>;
			}
			<b>set</b> {
				<a href="#f7b0ddd0a5fbc243" class="i method">FocusItem</a> (<b>value</b>);
			}
		}

		<b>protected override void</b> <a id="817130bb07c95a13" href="../R/817130bb07c95a13.html" target="n" data-glyph="75,1" class="i method">OnKeyDown</a>(<span class="i n">System</span>.<span class="i n">Windows</span>.<span class="i n">Input</span>.<a href="@0@PresentationCore/A.html#0d2ce926f5cfc74b" class="t t">KeyEventArgs</a> <span id="r63 rd" class="r63 r">e</span>)
		{
			<span class="r63 r">e</span>.<a href="@0@PresentationCore/A.html#f2bcc08494fea0e6" class="i property">Handled</a> = <b>true</b>;
			<b>if</b> (<span class="r63 r">e</span>.<a href="@0@PresentationCore/A.html#102560189e85fa41" class="i property">Key</a> == <a href="@0@WindowsBase/A.html#8e0d9266dee78287" class="t t">WKey</a>.<a href="@0@WindowsBase/A.html#dadbca967a7407ff" class="i field">Down</a>)
			{
				<b>if</b> (<a href="#759f7f05fdbb6e0c" class="i property">CtrlPressed</a> &amp;&amp; !<a href="#c3ca43e46f077930" class="i property">ShiftPressed</a>)
				{
					<a href="#f7b0ddd0a5fbc243" class="i method">FocusItem</a>(<a href="#326ed885ee45ae2a" class="i method">GetNextItem</a>(<a href="#a1226acadb878c51" class="i field">focusedTreeViewItem</a>));
				}
				<b>else</b>
				{
					<a href="#c9c2de9027253b12" class="i method">SelectItem</a>(<a href="#326ed885ee45ae2a" class="i method">GetNextItem</a>(<a href="#a1226acadb878c51" class="i field">focusedTreeViewItem</a>));
				}
			}
			<b>else if</b> (<span class="r63 r">e</span>.<a href="@0@PresentationCore/A.html#102560189e85fa41" class="i property">Key</a> == <a href="@0@WindowsBase/A.html#8e0d9266dee78287" class="t t">WKey</a>.<a href="@0@WindowsBase/A.html#3e53291dba010c69" class="i field">Up</a>)
			{
				<b>if</b> (<a href="#759f7f05fdbb6e0c" class="i property">CtrlPressed</a> &amp;&amp; !<a href="#c3ca43e46f077930" class="i property">ShiftPressed</a>)
				{
					<a href="#f7b0ddd0a5fbc243" class="i method">FocusItem</a>(<a href="#8008341748195274" class="i method">GetPrevItem</a>(<a href="#a1226acadb878c51" class="i field">focusedTreeViewItem</a>));
				}
				<b>else</b>
				{
					<a href="#c9c2de9027253b12" class="i method">SelectItem</a>(<a href="#8008341748195274" class="i method">GetPrevItem</a>(<a href="#a1226acadb878c51" class="i field">focusedTreeViewItem</a>));
				}
			}
			<b>else if</b> (<span class="r63 r">e</span>.<a href="@0@PresentationCore/A.html#102560189e85fa41" class="i property">Key</a> == <a href="@0@WindowsBase/A.html#8e0d9266dee78287" class="t t">WKey</a>.<a href="@0@WindowsBase/A.html#692aebff3e077477" class="i field">Space</a>)
			{
				<a href="#c9c2de9027253b12" class="i method">SelectItem</a>(<a href="#a1226acadb878c51" class="i field">focusedTreeViewItem</a>);
			}
			<b>else if</b> (<span class="r63 r">e</span>.<a href="@0@PresentationCore/A.html#102560189e85fa41" class="i property">Key</a> == <a href="@0@WindowsBase/A.html#8e0d9266dee78287" class="t t">WKey</a>.<a href="@0@WindowsBase/A.html#eb42cde70e9949cf" class="i field">Right</a> &amp;&amp; !<a href="#759f7f05fdbb6e0c" class="i property">CtrlPressed</a>)
			{
				<a href="#a1226acadb878c51" class="i field">focusedTreeViewItem</a>.<a href="@0@PresentationFramework/A.html#b54aa385fc85e872" class="i property">IsExpanded</a> = <b>true</b>;
			}
			<b>else if</b> (<span class="r63 r">e</span>.<a href="@0@PresentationCore/A.html#102560189e85fa41" class="i property">Key</a> == <a href="@0@WindowsBase/A.html#8e0d9266dee78287" class="t t">WKey</a>.<a href="@0@WindowsBase/A.html#eec36958cde02be2" class="i field">Left</a> &amp;&amp; !<a href="#759f7f05fdbb6e0c" class="i property">CtrlPressed</a>)
			{
				<a href="#a1226acadb878c51" class="i field">focusedTreeViewItem</a>.<a href="@0@PresentationFramework/A.html#b54aa385fc85e872" class="i property">IsExpanded</a> = <b>false</b>;
			}
			<b>else</b>
			{
				<span class="r63 r">e</span>.<a href="@0@PresentationCore/A.html#f2bcc08494fea0e6" class="i property">Handled</a> = <b>false</b>;
			}
			<a href="@0@PresentationFramework/A.html#5050528c9202ffc4" class="k">base</a>.<a href="@0@PresentationFramework/A.html#2463eaa9362e2660" class="i method">OnKeyDown</a>(<span class="r63 r">e</span>);
		}

		<b>private void</b> <a id="f7b0ddd0a5fbc243" href="../R/f7b0ddd0a5fbc243.html" target="n" data-glyph="76,1" class="i method">FocusItem</a>(<a href="ExTreeViewItem.cs.html#505370876d79da38" class="t t">ExTreeViewItem</a> <span id="r64 rd" class="r64 r">exTreeViewItem</span>)
		{
			<b>if</b> (<span class="r64 r">exTreeViewItem</span> != <b>null</b>)
			{
				<a href="#a1226acadb878c51" class="i field">focusedTreeViewItem</a> = <span class="r64 r">exTreeViewItem</span>;
				<span class="r64 r">exTreeViewItem</span>.<a href="@0@PresentationCore/A.html#0e11f7ae56f1c30f" class="i method">Focus</a>();
			}
		}

		<b>private</b> <a href="ExTreeViewItem.cs.html#505370876d79da38" class="t t">ExTreeViewItem</a> <a id="8008341748195274" href="../R/8008341748195274.html" target="n" data-glyph="76,1" class="i method">GetPrevItem</a>(<a href="ExTreeViewItem.cs.html#505370876d79da38" class="t t">ExTreeViewItem</a> <span id="r65 rd" class="r65 r">p</span>)
		{
			<a href="@0@mscorlib/A.html#cf7f4095e4de7646" class="k">var</a> <span id="r66 rd" class="r66 r">items</span> = <a href="#d1072934f8022d4b" class="i method">GetAllVisibleItems</a>(<a href="#f162c84db9d2e04f" class="k">this</a>).<a href="@0@System.Core/A.html#e276d6892241255b" class="i method">ToList</a>();
			<b>int</b> <span id="r67 rd" class="r67 r">indexOfP</span> = <span class="r66 r">items</span>.<a href="@0@mscorlib/A.html#242756beb6e8749e" class="i method">IndexOf</a>(<span class="r65 r">p</span>);
			<b>if</b> (<span class="r67 r">indexOfP</span> == 0)
				<b>return</b> <span class="r65 r">p</span>;
			<b>else
				return</b> <span class="r66 r">items</span><a href="@0@mscorlib/A.html#0c65bec4d3fac21e">[</a><span class="r67 r">indexOfP</span> - 1];
		}

		<b>private</b> <a href="ExTreeViewItem.cs.html#505370876d79da38" class="t t">ExTreeViewItem</a> <a id="326ed885ee45ae2a" href="../R/326ed885ee45ae2a.html" target="n" data-glyph="76,1" class="i method">GetNextItem</a>(<a href="ExTreeViewItem.cs.html#505370876d79da38" class="t t">ExTreeViewItem</a> <span id="r68 rd" class="r68 r">p</span>)
		{
			<a href="@0@mscorlib/A.html#cf7f4095e4de7646" class="k">var</a> <span id="r69 rd" class="r69 r">items</span> = <a href="#d1072934f8022d4b" class="i method">GetAllVisibleItems</a>(<a href="#f162c84db9d2e04f" class="k">this</a>).<a href="@0@System.Core/A.html#e276d6892241255b" class="i method">ToList</a>();
			<b>int</b> <span id="r70 rd" class="r70 r">indexOfP</span> = <span class="r69 r">items</span>.<a href="@0@mscorlib/A.html#242756beb6e8749e" class="i method">IndexOf</a>(<span class="r68 r">p</span>);
			<b>if</b> (<span class="r70 r">indexOfP</span> + 1 == <span class="r69 r">items</span>.<a href="@0@mscorlib/A.html#78a69d857716bc68" class="i property">Count</a>)
				<b>return</b> <span class="r68 r">p</span>;
			<b>else
				return</b> <span class="r69 r">items</span><a href="@0@mscorlib/A.html#0c65bec4d3fac21e">[</a><span class="r70 r">indexOfP</span> + 1];
		}
	}
}</pre></td></tr></table></div></body></html>
