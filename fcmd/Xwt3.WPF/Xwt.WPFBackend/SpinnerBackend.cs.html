<!DOCTYPE html>
<html><head><title>SpinnerBackend.cs</title><link rel="stylesheet" href="../../styles.css"><script src="../../scripts.js"></script></head>
<body class="cB" onload="i(127);"><div class="dH">
<table style="width: 100%">
<tr><td>File: <a id="filePath" class="blueLink" href="/#Xwt3.WPF/Xwt.WPFBackend/SpinnerBackend.cs" target="_top">Xwt.WPFBackend\SpinnerBackend.cs</a><br/></td><td></td></tr>
<tr><td>Project: <a id="projectPath" class="blueLink" href="/#Xwt3.WPF" target="_top">xwt\Xwt.WPF\Xwt3.WPF.csproj</a> (Xwt3.WPF)</td><td></td></tr>
</table>
</div>
<div class="cz"><table class="tb" cellpadding="0" cellspacing="0"><tr><td valign="top" align="right"><pre id="ln"></pre></td><td valign="top" align="left"><pre id="code">
<b>using</b> <span class="i n">System</span>;
<b>using</b> <span class="i n">System</span>.<span class="i n">Collections</span>.<span class="i n">Generic</span>;
<b>using</b> <span class="i n">System</span>.<span class="i n">Linq</span>;
<b>using</b> <span class="i n">System</span>.<span class="i n">Text</span>;
<b>using</b> <span class="i n">Xwt</span>.<span class="i n">Backends</span>;
<b>using</b> <span class="i n">System</span>.<span class="i n">Windows</span>.<span class="i n">Media</span>;
<b>using</b> <span class="i n">System</span>.<span class="i n">Windows</span>.<span class="i n">Media</span>.<span class="i n">Animation</span>;

<b>using</b> <span class="t">WpfRectangle</span> = <span class="i n">System</span>.<span class="i n">Windows</span>.<span class="i n">Shapes</span>.<a href="@0@PresentationFramework/A.html#11beea5bbde25b1a" class="t t">Rectangle</a>;
<b>using</b> <span class="t">WpfCanvas</span> = <span class="i n">System</span>.<span class="i n">Windows</span>.<span class="i n">Controls</span>.<a href="@0@PresentationFramework/A.html#a23db2d321823084" class="t t">Canvas</a>;
<b>using</b> <span class="i n">System</span>.<span class="i n">Windows</span>;

<b>namespace</b> <span class="i n">Xwt</span>.<span class="i n">WPFBackend</span>
{
	<b>public class</b> <a id="64cbe420d5070938" href="../R/64cbe420d5070938.html" target="n" data-glyph="0,0" class="t t">SpinnerBackend</a> : <a href="WidgetBackend.cs.html#551a9684f2eb2b53" class="t t">WidgetBackend</a>, <a href="/Xwt3/A.html#ba11431574058fa9" class="t t">ISpinnerBackend</a>
	{
		<b>new</b> <a href="#c3fe87b08f6537d1" class="t t">WpfSpinButton</a> <a id="4747175df8689bca" href="../R/4747175df8689bca.html" target="n" data-glyph="106,1" class="i property">Widget</a> {
			<b>get</b> { <b>return</b> (<a href="#c3fe87b08f6537d1" class="t t">WpfSpinButton</a>) <a href="WidgetBackend.cs.html#551a9684f2eb2b53" class="k">base</a>.<a href="WidgetBackend.cs.html#bfe5b8d8f773f1ef" class="i property">Widget</a>; }
			<b>set</b> { <a href="WidgetBackend.cs.html#551a9684f2eb2b53" class="k">base</a>.<a href="WidgetBackend.cs.html#bfe5b8d8f773f1ef" class="i property">Widget</a> = <b>value</b>; }
		}
		<b>public</b> <a id="ae2a5b742f1664b3" href="../R/../../0000000000.html" target="n" data-glyph="72,1" class="i constructor">SpinnerBackend</a> ()
		{
			<a href="#4747175df8689bca" class="i property">Widget</a> = <b>new</b> <a href="#96f543b18acce368" class="t constructor">WpfSpinButton</a> ();
		}

		<b>public bool</b> <a id="c82d29b6ecea1d6a" href="../R/c82d29b6ecea1d6a.html" target="n" data-glyph="102,1" class="i property">IsAnimating</a> {
			<b>get</b> { <b>return</b> <a href="#4747175df8689bca" class="i property">Widget</a>.<a href="#0f8d051a69a16874" class="i property">Storyboard</a>.<a href="@0@PresentationFramework/A.html#8765a70f3dee916e" class="i method">GetIsPaused</a> (); }
		}
		
		<b>public void</b> <a id="5e9b013e0f253a22" href="../R/5e9b013e0f253a22.html" target="n" data-glyph="72,1" class="i method">StartAnimation</a> ()
		{
			<a href="#4747175df8689bca" class="i property">Widget</a>.<a href="#0f8d051a69a16874" class="i property">Storyboard</a>.<a href="@0@PresentationFramework/A.html#934016b9f5ad8240" class="i method">Begin</a> ();
		}

		<b>public void</b> <a id="dde4e4a9d5d878dd" href="../R/dde4e4a9d5d878dd.html" target="n" data-glyph="72,1" class="i method">StopAnimation</a> ()
		{
			<a href="#4747175df8689bca" class="i property">Widget</a>.<a href="#0f8d051a69a16874" class="i property">Storyboard</a>.<a href="@0@PresentationFramework/A.html#1c801ddfae6a699a" class="i method">Stop</a> ();
		}
	}

	<b>public class</b> <a id="c3fe87b08f6537d1" href="../R/c3fe87b08f6537d1.html" target="n" data-glyph="0,0" class="t t">WpfSpinButton</a> : <span class="i n">System</span>.<span class="i n">Windows</span>.<span class="i n">Controls</span>.<a href="@0@PresentationFramework/A.html#a23db2d321823084" class="t t">Canvas</a>, <a href="WidgetBackend.cs.html#cc0e50a0d5748c2d" class="t t">IWpfWidget</a>
	{
		<b>const int</b> <a id="8029b930066aea85" href="../R/8029b930066aea85.html" target="n" data-glyph="10,1" class="i field">Duration</a> = 1000;
		<b>static int</b>[] <a id="09409c1aeac7a444" href="../R/09409c1aeac7a444.html" target="n" data-glyph="46,1" class="i field">StartTimes</a> = <b>new</b>[] {
			(<b>int</b>)(0.00 * <a href="#8029b930066aea85" class="i field">Duration</a>),
			(<b>int</b>)(0.70 * <a href="#8029b930066aea85" class="i field">Duration</a>),
			(<b>int</b>)(0.75 * <a href="#8029b930066aea85" class="i field">Duration</a>),
			(<b>int</b>)(0.99 * <a href="#8029b930066aea85" class="i field">Duration</a>)
		};

		<b>static double</b>[] <a id="44a7f5bda2b2da2d" href="../R/44a7f5bda2b2da2d.html" target="n" data-glyph="46,1" class="i field">Values</a> = <b>new</b>[] {
			0.25,
			0.25,
			1,
			0.25
		};

		<b>public</b> <a href="@0@PresentationFramework/A.html#ccdf3751fb4ab867" class="t t">Storyboard</a> <a id="0f8d051a69a16874" href="../R/0f8d051a69a16874.html" target="n" data-glyph="102,1" class="i property">Storyboard</a> {
			<b>get</b>; <b>private set</b>;
		}
		
		<b>public</b> <a href="WidgetBackend.cs.html#551a9684f2eb2b53" class="t t">WidgetBackend</a> <a id="0b1cc95dd14c0b8a" href="../R/0b1cc95dd14c0b8a.html" target="n" data-glyph="102,1" class="i property">Backend</a> {
			<b>get</b>; <b>set</b>;
		}

		<b>public</b> <a id="96f543b18acce368" href="../R/96f543b18acce368.html" target="n" data-glyph="72,1" class="i constructor">WpfSpinButton</a> ()
		{
			<a href="@0@PresentationFramework/A.html#d0e1f940abafebe8" class="i property">Width</a> = 25;
			<a href="@0@PresentationFramework/A.html#df2641c07f10d929" class="i property">Height</a> = 25;
			<a href="@0@PresentationFramework/A.html#03c5f431b20f4bce" class="i property">Background</a> = <b>new</b> <a href="@0@PresentationCore/A.html#28be7a261187a210" class="t constructor">SolidColorBrush</a> (<a href="@0@PresentationCore/A.html#0584e1e7d7fb612c" class="t t">Colors</a>.<a href="@0@PresentationCore/A.html#d6c4b30872bd611e" class="i property">Transparent</a>);
			<a href="#0f8d051a69a16874" class="i property">Storyboard</a> = <b>new</b> <a href="@0@PresentationFramework/A.html#a4987eaf37f92cec" class="t constructor">Storyboard</a> { <a href="@0@PresentationCore/A.html#b13f5ae6c1e524d4" class="i property">RepeatBehavior</a> = <a href="@0@PresentationCore/A.html#970bddcf6804bd56" class="t t">RepeatBehavior</a>.<a href="@0@PresentationCore/A.html#170c92af2207336b" class="i property">Forever</a>, <a href="@0@PresentationCore/A.html#aa3a36b776218bff" class="i property">Duration</a> = <a href="@0@mscorlib/A.html#865ef7b89f41b632" class="t t">TimeSpan</a>.<a href="@0@mscorlib/A.html#668d91d771bce54b" class="i method">FromMilliseconds</a> (<a href="#8029b930066aea85" class="i field">Duration</a>) };

			<b>for</b> (<b>int</b> <span id="r0 rd" class="r0 r">i</span> = 0; <span class="r0 r">i</span> &lt; 360; <span class="r0 r">i</span> += 30) {
				<span class="c">// Create the rectangle and centre it in our widget</span>
				<a href="@0@PresentationFramework/A.html#11beea5bbde25b1a" class="k">var</a> <span id="r1 rd" class="r1 r">rect</span> = <b>new</b> <a href="@0@PresentationFramework/A.html#2f367c6aaf93ace5" class="t constructor">WpfRectangle</a> { <a href="@0@PresentationFramework/A.html#d0e1f940abafebe8" class="i property">Width</a> = 2, <a href="@0@PresentationFramework/A.html#df2641c07f10d929" class="i property">Height</a> = 8, <a href="@0@PresentationFramework/A.html#9126b79b79de4c67" class="i property">Fill</a> = <b>new</b> <a href="@0@PresentationCore/A.html#28be7a261187a210" class="t constructor">SolidColorBrush</a> (<a href="@0@PresentationCore/A.html#0584e1e7d7fb612c" class="t t">Colors</a>.<a href="@0@PresentationCore/A.html#8f0ba43d1a961d20" class="i property">Black</a>), <a href="@0@PresentationFramework/A.html#c782b04cbc651c39" class="i property">RadiusX</a> = 1, <a href="@0@PresentationFramework/A.html#c217d8d7ccad090f" class="i property">RadiusY</a> = 1, <a href="@0@PresentationCore/A.html#7ca23bf037950fa0" class="i property">Opacity</a> = <a href="#44a7f5bda2b2da2d" class="i field">Values</a>[0] };
				<a href="@0@PresentationFramework/A.html#a23db2d321823084" class="t t">WpfCanvas</a>.<a href="@0@PresentationFramework/A.html#8d0e3c40eb8a4922" class="i method">SetTop</a> (<span class="r1 r">rect</span>, (<a href="@0@PresentationFramework/A.html#df2641c07f10d929" class="i property">Height</a> - <span class="r1 r">rect</span>.<a href="@0@PresentationFramework/A.html#df2641c07f10d929" class="i property">Height</a>) / 2);
				<a href="@0@PresentationFramework/A.html#a23db2d321823084" class="t t">WpfCanvas</a>.<a href="@0@PresentationFramework/A.html#f338cad381926fb5" class="i method">SetLeft</a> (<span class="r1 r">rect</span>, <a href="@0@PresentationFramework/A.html#d0e1f940abafebe8" class="i property">Width</a> / 2);

				<span class="c">// Rotate the element by &#39;i&#39; degrees, creating a circle out of all the elements</span>
				<a href="@0@PresentationCore/A.html#64916fc204c8676e" class="k">var</a> <span id="r2 rd" class="r2 r">group</span> = <b>new</b> <a href="@0@PresentationCore/A.html#837e2a94b92eab22" class="t constructor">TransformGroup</a> ();
				<span class="r2 r">group</span>.<a href="@0@PresentationCore/A.html#1458dc307e1ebfc9" class="i property">Children</a>.<a href="@0@PresentationCore/A.html#c51e16b5ee84ca4b" class="i method">Add</a> (<b>new</b> <a href="@0@PresentationCore/A.html#a4d4cd0260ded04a" class="t constructor">RotateTransform</a> (<span class="r0 r">i</span>, 0.5, -6));
				<span class="r2 r">group</span>.<a href="@0@PresentationCore/A.html#1458dc307e1ebfc9" class="i property">Children</a>.<a href="@0@PresentationCore/A.html#c51e16b5ee84ca4b" class="i method">Add</a> (<b>new</b> <a href="@0@PresentationCore/A.html#7166f7f8458598a4" class="t constructor">TranslateTransform</a> (0, 10));
				<span class="r1 r">rect</span>.<a href="@0@PresentationCore/A.html#291370cc1b2ddda6" class="i property">RenderTransform</a> = <span class="r2 r">group</span>;

				<span class="c">// Set the animation</span>
				<a href="@0@PresentationCore/A.html#b95f9603a7310974" class="k">var</a> <span id="r3 rd" class="r3 r">timeline</span> = <b>new</b> <a href="@0@PresentationCore/A.html#2612b7d87e1bfb1f" class="t constructor">DoubleAnimationUsingKeyFrames</a> ();
				<a href="@0@PresentationFramework/A.html#ccdf3751fb4ab867" class="t t">Storyboard</a>.<a href="@0@PresentationFramework/A.html#81222d8a2eaf2532" class="i method">SetTarget</a> (<span class="r3 r">timeline</span>, <span class="r1 r">rect</span>);
				<a href="@0@PresentationFramework/A.html#ccdf3751fb4ab867" class="t t">Storyboard</a>.<a href="@0@PresentationFramework/A.html#9bf65aa14f9b04b0" class="i method">SetTargetProperty</a> (<span class="r3 r">timeline</span>, <b>new</b> <a href="@0@PresentationFramework/A.html#37b31b7d74bf3f0d" class="t constructor">PropertyPath</a> (<span class="s">&quot;Opacity&quot;</span>));

				<a href="@0@mscorlib/A.html#1a65cbdb09544ba1" class="k">var</a> <span id="r4 rd" class="r4 r">offset</span> = <a href="#8029b930066aea85" class="i field">Duration</a> * (<span class="r0 r">i</span> / 360.0);
				<b>for</b> (<b>int</b> <span id="r5 rd" class="r5 r">j</span> = 0; <span class="r5 r">j</span> &lt; <a href="#09409c1aeac7a444" class="i field">StartTimes</a>.<a href="@0@mscorlib/A.html#42e9b7616956cf94" class="i property">Length</a>; <span class="r5 r">j</span>++) {
					<a href="@0@mscorlib/A.html#1a65cbdb09544ba1" class="k">var</a> <span id="r6 rd" class="r6 r">start</span> = (<a href="#09409c1aeac7a444" class="i field">StartTimes</a>[<span class="r5 r">j</span>] + <span class="r4 r">offset</span>) % <a href="#8029b930066aea85" class="i field">Duration</a>;
					<span class="r3 r">timeline</span>.<a href="@0@PresentationCore/A.html#a413876606f40f81" class="i property">KeyFrames</a>.<a href="@0@PresentationCore/A.html#5cdbb4d8703f46d4" class="i method">Add</a> (<b>new</b> <a href="@0@PresentationCore/A.html#949ba3a6b6af2b5d" class="t constructor">EasingDoubleKeyFrame</a> { <a href="@0@PresentationCore/A.html#5f6881b3f4a301bf" class="i property">KeyTime</a> = <a href="@0@PresentationCore/A.html#e4c6f46eac166b13" class="t t">KeyTime</a>.<a href="@0@PresentationCore/A.html#983c91d9e7ff1bbc" class="i method">FromTimeSpan</a> (<a href="@0@mscorlib/A.html#865ef7b89f41b632" class="t t">TimeSpan</a>.<a href="@0@mscorlib/A.html#668d91d771bce54b" class="i method">FromMilliseconds</a> (<span class="r6 r">start</span>)), <a href="@0@PresentationCore/A.html#6a4a9c5697cd2019" class="i property">Value</a> = <a href="#44a7f5bda2b2da2d" class="i field">Values</a>[<span class="r5 r">j</span>] });
				}
				<a href="#0f8d051a69a16874" class="i property">Storyboard</a>.<a href="@0@PresentationCore/A.html#a34849b73cc39556" class="i property">Children</a>.<a href="@0@PresentationCore/A.html#1a3ad140834286df" class="i method">Add</a> (<span class="r3 r">timeline</span>);
				<a href="@0@PresentationFramework/A.html#fb9060d71a3afc83" class="i property">Children</a>.<a href="@0@PresentationFramework/A.html#8886057feae649bc" class="i method">Add</a> (<span class="r1 r">rect</span>);
			}
		}

		<b>protected override</b> <span class="i n">System</span>.<span class="i n">Windows</span>.<a href="@0@WindowsBase/A.html#a844b9b525c2088c" class="t t">Size</a> <a id="9a5c1244044993e4" href="../R/9a5c1244044993e4.html" target="n" data-glyph="75,1" class="i method">ArrangeOverride</a> (<span class="i n">System</span>.<span class="i n">Windows</span>.<a href="@0@WindowsBase/A.html#a844b9b525c2088c" class="t t">Size</a> <span id="r7 rd" class="r7 r">arrangeSize</span>)
		{
			<b>double</b> <span id="r8 rd" class="r8 r">dx</span> = 0, <span id="r9 rd" class="r9 r">dy</span> = 0;
			<b>double</b> <span id="r10 rd" class="r10 r">width</span> = <span class="r7 r">arrangeSize</span>.<a href="@0@WindowsBase/A.html#6889b81bbde81637" class="i property">Width</a>, <span id="r11 rd" class="r11 r">height</span> = <span class="r7 r">arrangeSize</span>.<a href="@0@WindowsBase/A.html#5c5d17caa72f2875" class="i property">Height</a>;
			<b>if</b> (<span class="r10 r">width</span> &gt; <span class="r11 r">height</span>) {
				<span class="r8 r">dx</span> = (<span class="r10 r">width</span> - <span class="r11 r">height</span>) / 2;
				<span class="r10 r">width</span> = <span class="r11 r">height</span>;
			}
			<b>else if</b> (<span class="r11 r">height</span> &gt; <span class="r10 r">width</span>) {
				<span class="r9 r">dy</span> = (<span class="r11 r">height</span> - <span class="r10 r">width</span>) / 2;
				<span class="r11 r">height</span> = <span class="r10 r">width</span>;
			}
			<a href="@0@PresentationCore/A.html#64916fc204c8676e" class="t t">TransformGroup</a> <span id="r12 rd" class="r12 r">tg</span> = <b>new</b> <a href="@0@PresentationCore/A.html#837e2a94b92eab22" class="t constructor">TransformGroup</a> ();
			<span class="r12 r">tg</span>.<a href="@0@PresentationCore/A.html#1458dc307e1ebfc9" class="i property">Children</a>.<a href="@0@PresentationCore/A.html#c51e16b5ee84ca4b" class="i method">Add</a> (<b>new</b> <a href="@0@PresentationCore/A.html#4ca1f16164405c58" class="t constructor">ScaleTransform</a> (<span class="r10 r">width</span> / 25d, <span class="r11 r">height</span> / 25d));
			<span class="r12 r">tg</span>.<a href="@0@PresentationCore/A.html#1458dc307e1ebfc9" class="i property">Children</a>.<a href="@0@PresentationCore/A.html#c51e16b5ee84ca4b" class="i method">Add</a> (<b>new</b> <a href="@0@PresentationCore/A.html#7166f7f8458598a4" class="t constructor">TranslateTransform</a> (<span class="r8 r">dx</span>, <span class="r9 r">dy</span>));
			<a href="@0@PresentationCore/A.html#291370cc1b2ddda6" class="i property">RenderTransform</a> = <span class="r12 r">tg</span>;
			<b>return</b> <a href="@0@PresentationFramework/A.html#a23db2d321823084" class="k">base</a>.<a href="@0@PresentationFramework/A.html#682e12cca8b93a39" class="i method">ArrangeOverride</a> (<span class="r7 r">arrangeSize</span>);
		}

		<b>protected override</b> <span class="i n">System</span>.<span class="i n">Windows</span>.<a href="@0@WindowsBase/A.html#a844b9b525c2088c" class="t t">Size</a> <a id="f859ec921cf761ff" href="../R/f859ec921cf761ff.html" target="n" data-glyph="75,1" class="i method">MeasureOverride</a> (<span class="i n">System</span>.<span class="i n">Windows</span>.<a href="@0@WindowsBase/A.html#a844b9b525c2088c" class="t t">Size</a> <span id="r13 rd" class="r13 r">constraint</span>)
		{
			<a href="@0@PresentationFramework/A.html#a23db2d321823084" class="k">base</a>.<a href="@0@PresentationFramework/A.html#d090db496fc316ef" class="i method">MeasureOverride</a> (<span class="r13 r">constraint</span>);
			<a href="@0@WindowsBase/A.html#a844b9b525c2088c" class="k">var</a> <span id="r14 rd" class="r14 r">s</span> = <b>new</b> <span class="i n">System</span>.<span class="i n">Windows</span>.<a href="@0@WindowsBase/A.html#a9e92f9d82abccc2" class="t constructor">Size</a> (25, 25);
			<b>return</b> <a href="#0b1cc95dd14c0b8a" class="i property">Backend</a>.<a href="WidgetBackend.cs.html#10b9740f443f1be6" class="i method">MeasureOverride</a> (<span class="r13 r">constraint</span>, <span class="r14 r">s</span>);
		}
	}
}
</pre></td></tr></table></div></body></html>
