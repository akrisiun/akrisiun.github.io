<!DOCTYPE html>
<html><head><title>CustomScrollViewPort.cs</title><link rel="stylesheet" href="../../styles.css"><script src="../../scripts.js"></script></head>
<body class="cB" onload="i(360);"><div class="dH">
<table style="width: 100%">
<tr><td>File: <a id="filePath" class="blueLink" href="/#Xwt3.WPF/Xwt.WPFBackend/CustomScrollViewPort.cs" target="_top">Xwt.WPFBackend\CustomScrollViewPort.cs</a><br/></td><td></td></tr>
<tr><td>Project: <a id="projectPath" class="blueLink" href="/#Xwt3.WPF" target="_top">xwt\Xwt.WPF\Xwt3.WPF.csproj</a> (Xwt3.WPF)</td><td></td></tr>
</table>
</div>
<div class="cz"><table class="tb" cellpadding="0" cellspacing="0"><tr><td valign="top" align="right"><pre id="ln"></pre></td><td valign="top" align="left"><pre id="code">
<span class="c">//</span>
<span class="c">// CustomScrollViewPort.cs</span>
<span class="c">//</span>
<span class="c">// Author:</span>
<span class="c">//	   Eric Maupin &lt;ermau@xamarin.com&gt;</span>
<span class="c">//     Lluis Sanchez &lt;lluis@xamarin.com&gt;</span>
<span class="c">//</span>
<span class="c">// Copyright (c) 2012 Xamarin, Inc.</span>
<span class="c">//</span>
<span class="c">// Permission is hereby granted, free of charge, to any person obtaining a copy</span>
<span class="c">// of this software and associated documentation files (the &quot;Software&quot;), to deal</span>
<span class="c">// in the Software without restriction, including without limitation the rights</span>
<span class="c">// to use, copy, modify, merge, publish, distribute, sublicense, and/or sell</span>
<span class="c">// copies of the Software, and to permit persons to whom the Software is</span>
<span class="c">// furnished to do so, subject to the following conditions:</span>
<span class="c">//</span>
<span class="c">// The above copyright notice and this permission notice shall be included in</span>
<span class="c">// all copies or substantial portions of the Software.</span>
<span class="c">//</span>
<span class="c">// THE SOFTWARE IS PROVIDED &quot;AS IS&quot;, WITHOUT WARRANTY OF ANY KIND, EXPRESS OR</span>
<span class="c">// IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,</span>
<span class="c">// FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE</span>
<span class="c">// AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER</span>
<span class="c">// LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,</span>
<span class="c">// OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN</span>
<span class="c">// THE SOFTWARE.</span>

<b>using</b> <span class="i n">System</span>;
<b>using</b> <span class="i n">System</span>.<span class="i n">Windows</span>;
<b>using</b> <span class="i n">System</span>.<span class="i n">Windows</span>.<span class="i n">Controls</span>.<span class="i n">Primitives</span>;
<b>using</b> <span class="i n">System</span>.<span class="i n">Windows</span>.<span class="i n">Media</span>;
<b>using</b> <span class="i">SWC</span> = <span class="i n">System</span>.<span class="i n">Windows</span>.<span class="i n">Controls</span>;
<b>using</b> <span class="t">WSize</span> = <span class="i n">System</span>.<span class="i n">Windows</span>.<a href="@0@WindowsBase/A.html#a844b9b525c2088c" class="t t">Size</a>;

<b>namespace</b> <span class="i n">Xwt</span>.<span class="i n">WPFBackend</span>
{
	<b>internal class</b> <a id="0d36022744c86b38" href="../R/0d36022744c86b38.html" target="n" data-glyph="2,0" class="t t">CustomScrollViewPort</a>
		: <span class="i n">SWC</span>.<a href="@0@PresentationFramework/A.html#b65316d8b92f4b13" class="t t">Panel</a>, <a href="@0@PresentationFramework/A.html#86e6206da63f5261" class="t t">IScrollInfo</a>
	{
		<b>internal</b> <a id="0263eefbe3861454" href="../R/0263eefbe3861454.html" target="n" data-glyph="74,1" class="i constructor">CustomScrollViewPort</a> (<b>object</b> <span id="r0 rd" class="r0 r">widget</span>, <a href="ScrollAdjustmentBackend.cs.html#96e2073efffc6d72" class="t t">ScrollAdjustmentBackend</a> <span id="r1 rd" class="r1 r">verticalBackend</span>, <a href="ScrollAdjustmentBackend.cs.html#96e2073efffc6d72" class="t t">ScrollAdjustmentBackend</a> <span id="r2 rd" class="r2 r">horizontalBackend</span>)
		{
			<b>if</b> (<span class="r0 r">widget</span> == <b>null</b>)
				<b>throw</b> <b>new</b> <a href="@0@mscorlib/A.html#8314938388254d5a" class="t constructor">ArgumentNullException</a> (<span class="s">&quot;widget&quot;</span>);

			((<a href="@0@PresentationFramework/A.html#d2d98a3022fbac2f" class="t t">FrameworkElement</a>)<span class="r0 r">widget</span>).<a href="@0@PresentationCore/A.html#291370cc1b2ddda6" class="i property">RenderTransform</a> = <a href="#0d36022744c86b38" class="k">this</a>.<a href="#9803aa0490b93219" class="i field">transform</a>;

			<b>if</b> (<span class="r1 r">verticalBackend</span> != <b>null</b>) {
				<a href="#0d61d1ac5cbdea55" class="i field">usingCustomScrolling</a> = <b>true</b>;
				<span class="r1 r">verticalBackend</span>.<a href="ScrollAdjustmentBackend.cs.html#1261a555194da3a9" class="i property">TargetViewport</a> = <a href="#0d36022744c86b38" class="k">this</a>;
				<a href="#0d36022744c86b38" class="k">this</a>.<a href="#4c76716ee488a955" class="i field">verticalBackend</a> = <span class="r1 r">verticalBackend</span>;
				<span class="r2 r">horizontalBackend</span>.<a href="ScrollAdjustmentBackend.cs.html#1261a555194da3a9" class="i property">TargetViewport</a> = <a href="#0d36022744c86b38" class="k">this</a>;
				<a href="#0d36022744c86b38" class="k">this</a>.<a href="#6905c7de9ba6b53b" class="i field">horizontalBackend</a> = <span class="r2 r">horizontalBackend</span>;
				<a href="#1e127de665d3847a" class="i method">UpdateCustomExtent</a> ();
			}
			<a href="@0@PresentationFramework/A.html#fb9060d71a3afc83" class="i property">Children</a>.<a href="@0@PresentationFramework/A.html#8886057feae649bc" class="i method">Add</a> ((<a href="@0@PresentationCore/A.html#7911653ccb506216" class="t t">UIElement</a>) <span class="r0 r">widget</span>);
		}

		<b>public bool</b> <a id="f1883ea6b0572a87" href="../R/f1883ea6b0572a87.html" target="n" data-glyph="102,1" class="i property">CanHorizontallyScroll</a>
		{
			<b>get</b>;
			<b>set</b>;
		}

		<b>public bool</b> <a id="b2aa09c1c6c04e8c" href="../R/b2aa09c1c6c04e8c.html" target="n" data-glyph="102,1" class="i property">CanVerticallyScroll</a>
		{
			<b>get</b>;
			<b>set</b>;
		}

		<b>public double</b> <a id="7cd0d4fd55b48544" href="../R/7cd0d4fd55b48544.html" target="n" data-glyph="102,1" class="i property">ExtentHeight</a>
		{
			<b>get</b> { <b>return</b> <a href="#0d36022744c86b38" class="k">this</a>.<a href="#e09ddef32e2adb13" class="i field">extent</a>.<a href="@0@WindowsBase/A.html#5c5d17caa72f2875" class="i property">Height</a>; }
		}

		<b>public double</b> <a id="88b6eef4235b09c7" href="../R/88b6eef4235b09c7.html" target="n" data-glyph="102,1" class="i property">ExtentWidth</a>
		{
			<b>get</b> { <b>return</b> <a href="#0d36022744c86b38" class="k">this</a>.<a href="#e09ddef32e2adb13" class="i field">extent</a>.<a href="@0@WindowsBase/A.html#6889b81bbde81637" class="i property">Width</a>; }
		}

		<b>public double</b> <a id="dbe7ed18ac250698" href="../R/dbe7ed18ac250698.html" target="n" data-glyph="102,1" class="i property">ViewportHeight</a>
		{
			<b>get</b> { <b>return</b> <a href="#0d36022744c86b38" class="k">this</a>.<a href="#8f7e7e20c067ec2d" class="i field">viewport</a>.<a href="@0@WindowsBase/A.html#5c5d17caa72f2875" class="i property">Height</a>; }
		}

		<b>public double</b> <a id="bacd82961dd2d4a4" href="../R/bacd82961dd2d4a4.html" target="n" data-glyph="102,1" class="i property">ViewportWidth</a>
		{
			<b>get</b> { <b>return</b> <a href="#0d36022744c86b38" class="k">this</a>.<a href="#8f7e7e20c067ec2d" class="i field">viewport</a>.<a href="@0@WindowsBase/A.html#6889b81bbde81637" class="i property">Width</a>; }
		}

		<b>public double</b> <a id="2af5b0893db02f40" href="../R/2af5b0893db02f40.html" target="n" data-glyph="102,1" class="i property">VerticalOffset</a>
		{
			<b>get</b> { <b>return</b> <a href="#0d36022744c86b38" class="k">this</a>.<a href="#b6ae652abe4d823d" class="i field">contentOffset</a>.<a href="/Xwt3/A.html#270121b6118aba39" class="i property">Y</a>; }
		}

		<b>public double</b> <a id="800051cb632b961b" href="../R/800051cb632b961b.html" target="n" data-glyph="102,1" class="i property">HorizontalOffset</a>
		{
			<b>get</b> { <b>return</b> <a href="#0d36022744c86b38" class="k">this</a>.<a href="#b6ae652abe4d823d" class="i field">contentOffset</a>.<a href="/Xwt3/A.html#a925f0d89fafd1e3" class="i property">X</a>; }
		}

		<b>public void</b> <a id="0766373049d96acd" href="../R/0766373049d96acd.html" target="n" data-glyph="72,1" class="i method">LineDown</a>()
		{
			<a href="#0250648f5e834fdd" class="i method">SetVerticalOffset</a> (<a href="#2af5b0893db02f40" class="i property">VerticalOffset</a> + <a href="#4ce3720e55364a4c" class="i property">VerticalStepIncrement</a>);
		}

		<b>public void</b> <a id="e162db2b439ba7d7" href="../R/e162db2b439ba7d7.html" target="n" data-glyph="72,1" class="i method">LineLeft</a>()
		{
			<a href="#4827e8fbcec25164" class="i method">SetHorizontalOffset</a> (<a href="#800051cb632b961b" class="i property">HorizontalOffset</a> - <a href="#69efac7c8ae33798" class="i property">HorizontalStepIncrement</a>);
		}

		<b>public void</b> <a id="bc48161052282339" href="../R/bc48161052282339.html" target="n" data-glyph="72,1" class="i method">LineRight</a>()
		{
			<a href="#4827e8fbcec25164" class="i method">SetHorizontalOffset</a> (<a href="#800051cb632b961b" class="i property">HorizontalOffset</a> + <a href="#69efac7c8ae33798" class="i property">HorizontalStepIncrement</a>);
		}

		<b>public void</b> <a id="20c66d3fe6c8372c" href="../R/20c66d3fe6c8372c.html" target="n" data-glyph="72,1" class="i method">LineUp</a>()
		{
			<a href="#0250648f5e834fdd" class="i method">SetVerticalOffset</a> (<a href="#2af5b0893db02f40" class="i property">VerticalOffset</a> - <a href="#4ce3720e55364a4c" class="i property">VerticalStepIncrement</a>);
		}

		<b>public</b> <a href="@0@WindowsBase/A.html#fc387a6f7a1c2856" class="t t">Rect</a> <a id="7c7053079f17ca82" href="../R/7c7053079f17ca82.html" target="n" data-glyph="72,1" class="i method">MakeVisible</a> (<a href="@0@PresentationCore/A.html#5dae7b267e6db0d6" class="t t">Visual</a> <span id="r3 rd" class="r3 r">visual</span>, <a href="@0@WindowsBase/A.html#fc387a6f7a1c2856" class="t t">Rect</a> <span id="r4 rd" class="r4 r">rectangle</span>)
		{
			<span class="c">// This is the area which is currently visible</span>
			<a href="@0@WindowsBase/A.html#fc387a6f7a1c2856" class="k">var</a> <span id="r5 rd" class="r5 r">visibleRect</span> = <b>new</b> <a href="@0@WindowsBase/A.html#299a3fd614724168" class="t constructor">Rect</a> (<a href="#800051cb632b961b" class="i property">HorizontalOffset</a>, <a href="#2af5b0893db02f40" class="i property">VerticalOffset</a>, <a href="#bacd82961dd2d4a4" class="i property">ViewportWidth</a>, <a href="#dbe7ed18ac250698" class="i property">ViewportHeight</a>);

			<span class="c">// This is the area we wish to be visible</span>
			<span class="r4 r">rectangle</span> = <span class="r3 r">visual</span>.<a href="@0@PresentationCore/A.html#c8fcbc7ed8770a87" class="i method">TransformToAncestor</a> (<a href="#0d36022744c86b38" class="k">this</a>).<a href="@0@PresentationCore/A.html#b7441dc7ac2c6738" class="i method">TransformBounds</a> (<span class="r4 r">rectangle</span>);

			<b>if</b> (<span class="r5 r">visibleRect</span> == <span class="r4 r">rectangle</span>)
				<b>return</b> <span class="r4 r">rectangle</span>;

			<span class="c">// The co-ordinates are relative to the visible area, so we need to add the visible area offset</span>
			<span class="c">// to convert to values we can use in VerticalOffset/HorizontalOffset</span>
			<span class="r4 r">rectangle</span>.<a href="@0@WindowsBase/A.html#e41478f50084bb9f" class="i property">X</a> += <span class="r5 r">visibleRect</span>.<a href="@0@WindowsBase/A.html#e41478f50084bb9f" class="i property">X</a>;
			<span class="r4 r">rectangle</span>.<a href="@0@WindowsBase/A.html#7e3e32042d014946" class="i property">Y</a> += <span class="r5 r">visibleRect</span>.<a href="@0@WindowsBase/A.html#7e3e32042d014946" class="i property">Y</a>;

			<a href="#4827e8fbcec25164" class="i method">SetHorizontalOffset</a> (<a href="#4688f71a7dd75f2f" class="i method">ClampOffset</a> (<span class="r5 r">visibleRect</span>.<a href="@0@WindowsBase/A.html#5ca85ee8246d080e" class="i property">Left</a>, <span class="r5 r">visibleRect</span>.<a href="@0@WindowsBase/A.html#49bdda261fc8ff58" class="i property">Right</a>, <span class="r4 r">rectangle</span>.<a href="@0@WindowsBase/A.html#5ca85ee8246d080e" class="i property">Left</a>, <span class="r4 r">rectangle</span>.<a href="@0@WindowsBase/A.html#49bdda261fc8ff58" class="i property">Right</a>));
			<a href="#0250648f5e834fdd" class="i method">SetVerticalOffset</a> (<a href="#4688f71a7dd75f2f" class="i method">ClampOffset</a> (<span class="r5 r">visibleRect</span>.<a href="@0@WindowsBase/A.html#a3c8a162c3dfa208" class="i property">Top</a>, <span class="r5 r">visibleRect</span>.<a href="@0@WindowsBase/A.html#ff29c878cee62add" class="i property">Bottom</a>, <span class="r4 r">rectangle</span>.<a href="@0@WindowsBase/A.html#a3c8a162c3dfa208" class="i property">Top</a>, <span class="r4 r">rectangle</span>.<a href="@0@WindowsBase/A.html#ff29c878cee62add" class="i property">Bottom</a>));

			<b>return</b> <span class="r4 r">rectangle</span>;
		}

		<b>private double</b> <a id="4688f71a7dd75f2f" href="../R/4688f71a7dd75f2f.html" target="n" data-glyph="76,1" class="i method">ClampOffset</a> (<b>double</b> <span id="r6 rd" class="r6 r">lowerVisible</span>, <b>double</b> <span id="r7 rd" class="r7 r">upperVisible</span>, <b>double</b> <span id="r8 rd" class="r8 r">desiredLower</span>, <b>double</b> <span id="r9 rd" class="r9 r">desiredUpper</span>)
		{
			<span class="c">// This is not entirely correct. The &#39;else&#39; statement needs to be improved</span>
			<span class="c">// so we scroll the minimum required distance as opposed to just jumping</span>
			<span class="c">// to &#39;desiredLower&#39; if our element doesn&#39;t already fit perfectly</span>
			<b>if</b> (<span class="r8 r">desiredLower</span> &gt;= <span class="r6 r">lowerVisible</span> &amp;&amp; <span class="r9 r">desiredUpper</span> &lt; <span class="r7 r">upperVisible</span>)
				<b>return</b> <span class="r6 r">lowerVisible</span>;
			<b>else
				return</b> <span class="r8 r">desiredLower</span>; 
		}

		<b>public void</b> <a id="e1f5755f5d8af05b" href="../R/e1f5755f5d8af05b.html" target="n" data-glyph="72,1" class="i method">MouseWheelDown</a>()
		{
			<a href="#0250648f5e834fdd" class="i method">SetVerticalOffset</a> (<a href="#2af5b0893db02f40" class="i property">VerticalOffset</a> + 12);
		}

		<b>public void</b> <a id="d60eec39ae1f296d" href="../R/d60eec39ae1f296d.html" target="n" data-glyph="72,1" class="i method">MouseWheelLeft</a>()
		{
			<a href="#4827e8fbcec25164" class="i method">SetHorizontalOffset</a> (<a href="#800051cb632b961b" class="i property">HorizontalOffset</a> - 12);
		}

		<b>public void</b> <a id="944ede56dec0dbad" href="../R/944ede56dec0dbad.html" target="n" data-glyph="72,1" class="i method">MouseWheelRight</a>()
		{
			<a href="#4827e8fbcec25164" class="i method">SetHorizontalOffset</a> (<a href="#800051cb632b961b" class="i property">HorizontalOffset</a> + 12);
		}

		<b>public void</b> <a id="adbafa48a4beb6fb" href="../R/adbafa48a4beb6fb.html" target="n" data-glyph="72,1" class="i method">MouseWheelUp</a>()
		{
			<a href="#0250648f5e834fdd" class="i method">SetVerticalOffset</a> (<a href="#2af5b0893db02f40" class="i property">VerticalOffset</a> - 12);
		}

		<b>public void</b> <a id="e37be32a7f8c3710" href="../R/e37be32a7f8c3710.html" target="n" data-glyph="72,1" class="i method">PageDown</a>()
		{
			<a href="#0250648f5e834fdd" class="i method">SetVerticalOffset</a> (<a href="#2af5b0893db02f40" class="i property">VerticalOffset</a> + <a href="#5bea95eba0e7a688" class="i property">VerticalPageIncrement</a>);
		}

		<b>public void</b> <a id="1fb4c46fa4aa078e" href="../R/1fb4c46fa4aa078e.html" target="n" data-glyph="72,1" class="i method">PageLeft</a>()
		{
			<a href="#4827e8fbcec25164" class="i method">SetHorizontalOffset</a> (<a href="#800051cb632b961b" class="i property">HorizontalOffset</a> - <a href="#ffebfae1f47be066" class="i property">HorizontalPageIncrement</a>);
		}

		<b>public void</b> <a id="8d12ffc8914395da" href="../R/8d12ffc8914395da.html" target="n" data-glyph="72,1" class="i method">PageRight</a>()
		{
			<a href="#4827e8fbcec25164" class="i method">SetHorizontalOffset</a> (<a href="#800051cb632b961b" class="i property">HorizontalOffset</a> + <a href="#ffebfae1f47be066" class="i property">HorizontalPageIncrement</a>);
		}

		<b>public void</b> <a id="88a92ed9dcbc7d09" href="../R/88a92ed9dcbc7d09.html" target="n" data-glyph="72,1" class="i method">PageUp</a>()
		{
			<a href="#0250648f5e834fdd" class="i method">SetVerticalOffset</a> (<a href="#2af5b0893db02f40" class="i property">VerticalOffset</a> - <a href="#5bea95eba0e7a688" class="i property">VerticalPageIncrement</a>);
		}

		<b>public</b> <span class="i n">SWC</span>.<a href="@0@PresentationFramework/A.html#488ab4a977a015eb" class="t t">ScrollViewer</a> <a id="388371254f8b0c71" href="../R/388371254f8b0c71.html" target="n" data-glyph="102,1" class="i property">ScrollOwner</a>
		{
			<b>get</b>;
			<b>set</b>;
		}

		<b>public void</b> <a id="4827e8fbcec25164" href="../R/4827e8fbcec25164.html" target="n" data-glyph="72,1" class="i method">SetHorizontalOffset</a> (<b>double</b> <span id="r10 rd" class="r10 r">offset</span>)
		{
			<b>if</b> (<span class="r10 r">offset</span> &lt; 0 || <a href="#0d36022744c86b38" class="k">this</a>.<a href="#8f7e7e20c067ec2d" class="i field">viewport</a>.<a href="@0@WindowsBase/A.html#6889b81bbde81637" class="i property">Width</a> &gt;= <a href="#0d36022744c86b38" class="k">this</a>.<a href="#e09ddef32e2adb13" class="i field">extent</a>.<a href="@0@WindowsBase/A.html#6889b81bbde81637" class="i property">Width</a>)
				<span class="r10 r">offset</span> = 0;
			<b>else if</b> (<span class="r10 r">offset</span> + <a href="#0d36022744c86b38" class="k">this</a>.<a href="#8f7e7e20c067ec2d" class="i field">viewport</a>.<a href="@0@WindowsBase/A.html#6889b81bbde81637" class="i property">Width</a> &gt;= <a href="#0d36022744c86b38" class="k">this</a>.<a href="#e09ddef32e2adb13" class="i field">extent</a>.<a href="@0@WindowsBase/A.html#6889b81bbde81637" class="i property">Width</a>)
				<span class="r10 r">offset</span> = <a href="#0d36022744c86b38" class="k">this</a>.<a href="#e09ddef32e2adb13" class="i field">extent</a>.<a href="@0@WindowsBase/A.html#6889b81bbde81637" class="i property">Width</a> - <a href="#0d36022744c86b38" class="k">this</a>.<a href="#8f7e7e20c067ec2d" class="i field">viewport</a>.<a href="@0@WindowsBase/A.html#6889b81bbde81637" class="i property">Width</a>;

			<a href="#0d36022744c86b38" class="k">this</a>.<a href="#b6ae652abe4d823d" class="i field">contentOffset</a>.<a href="/Xwt3/A.html#a925f0d89fafd1e3" class="i property">X</a> = <span class="r10 r">offset</span>;
			<b>if</b> (<a href="#0d61d1ac5cbdea55" class="i field">usingCustomScrolling</a>)
				<a href="#0d36022744c86b38" class="k">this</a>.<a href="#6905c7de9ba6b53b" class="i field">horizontalBackend</a>.<a href="ScrollAdjustmentBackend.cs.html#c8f2152558ed8493" class="i method">SetOffset</a> (<span class="r10 r">offset</span>);
			<b>else</b>
				<a href="#0d36022744c86b38" class="k">this</a>.<a href="#9803aa0490b93219" class="i field">transform</a>.<a href="@0@PresentationCore/A.html#76821051a9a35f26" class="i property">X</a> = -<span class="r10 r">offset</span>;
			<b>if</b> (<a href="#388371254f8b0c71" class="i property">ScrollOwner</a> != <b>null</b>)
				<a href="#388371254f8b0c71" class="i property">ScrollOwner</a>.<a href="@0@PresentationFramework/A.html#b5da19f474e5e42b" class="i method">InvalidateScrollInfo</a> ();
		}

		<b>public void</b> <a id="0250648f5e834fdd" href="../R/0250648f5e834fdd.html" target="n" data-glyph="72,1" class="i method">SetVerticalOffset</a> (<b>double</b> <span id="r11 rd" class="r11 r">offset</span>)
		{
			<b>if</b> (<span class="r11 r">offset</span> &lt; 0 || <a href="#0d36022744c86b38" class="k">this</a>.<a href="#8f7e7e20c067ec2d" class="i field">viewport</a>.<a href="@0@WindowsBase/A.html#5c5d17caa72f2875" class="i property">Height</a> &gt;= <a href="#0d36022744c86b38" class="k">this</a>.<a href="#e09ddef32e2adb13" class="i field">extent</a>.<a href="@0@WindowsBase/A.html#5c5d17caa72f2875" class="i property">Height</a>)
				<span class="r11 r">offset</span> = 0;
			<b>else if</b> (<span class="r11 r">offset</span> + <a href="#0d36022744c86b38" class="k">this</a>.<a href="#8f7e7e20c067ec2d" class="i field">viewport</a>.<a href="@0@WindowsBase/A.html#5c5d17caa72f2875" class="i property">Height</a> &gt;= <a href="#0d36022744c86b38" class="k">this</a>.<a href="#e09ddef32e2adb13" class="i field">extent</a>.<a href="@0@WindowsBase/A.html#5c5d17caa72f2875" class="i property">Height</a>)
				<span class="r11 r">offset</span> = <a href="#0d36022744c86b38" class="k">this</a>.<a href="#e09ddef32e2adb13" class="i field">extent</a>.<a href="@0@WindowsBase/A.html#5c5d17caa72f2875" class="i property">Height</a> - <a href="#0d36022744c86b38" class="k">this</a>.<a href="#8f7e7e20c067ec2d" class="i field">viewport</a>.<a href="@0@WindowsBase/A.html#5c5d17caa72f2875" class="i property">Height</a>;

			<a href="#0d36022744c86b38" class="k">this</a>.<a href="#b6ae652abe4d823d" class="i field">contentOffset</a>.<a href="/Xwt3/A.html#270121b6118aba39" class="i property">Y</a> = <span class="r11 r">offset</span>;
			<b>if</b> (<a href="#0d61d1ac5cbdea55" class="i field">usingCustomScrolling</a>)
				<a href="#0d36022744c86b38" class="k">this</a>.<a href="#4c76716ee488a955" class="i field">verticalBackend</a>.<a href="ScrollAdjustmentBackend.cs.html#c8f2152558ed8493" class="i method">SetOffset</a> (<span class="r11 r">offset</span>);
			<b>else</b>
				<a href="#0d36022744c86b38" class="k">this</a>.<a href="#9803aa0490b93219" class="i field">transform</a>.<a href="@0@PresentationCore/A.html#45ae7acbb11bbb4c" class="i property">Y</a> = -<span class="r11 r">offset</span>;
			<b>if</b> (<a href="#388371254f8b0c71" class="i property">ScrollOwner</a> != <b>null</b>)
				<a href="#388371254f8b0c71" class="i property">ScrollOwner</a>.<a href="@0@PresentationFramework/A.html#b5da19f474e5e42b" class="i method">InvalidateScrollInfo</a> ();
		}

		<b>public void</b> <a id="c2f09ef9a0a7ad7d" href="../R/c2f09ef9a0a7ad7d.html" target="n" data-glyph="72,1" class="i method">SetOffset</a> (<a href="ScrollAdjustmentBackend.cs.html#96e2073efffc6d72" class="t t">ScrollAdjustmentBackend</a> <span id="r12 rd" class="r12 r">scroller</span>, <b>double</b> <span id="r13 rd" class="r13 r">offset</span>)
		{
			<b>if</b> (<span class="r12 r">scroller</span> == <a href="#4c76716ee488a955" class="i field">verticalBackend</a>)
				<a href="#0250648f5e834fdd" class="i method">SetVerticalOffset</a> (<span class="r13 r">offset</span>);
			<b>else</b>
				<a href="#4827e8fbcec25164" class="i method">SetHorizontalOffset</a> (<span class="r13 r">offset</span>);
		}

		<b>public void</b> <a id="1e127de665d3847a" href="../R/1e127de665d3847a.html" target="n" data-glyph="72,1" class="i method">UpdateCustomExtent</a> ()
		{
			<span class="c">// Updates the extent and the viewport, based on the scrollbar properties</span>

			<a href="@0@WindowsBase/A.html#a844b9b525c2088c" class="k">var</a> <span id="r14 rd" class="r14 r">newExtent</span> = <b>new</b> <a href="@0@WindowsBase/A.html#a9e92f9d82abccc2" class="t constructor">WSize</a> (<a href="#6905c7de9ba6b53b" class="i field">horizontalBackend</a>.<a href="ScrollAdjustmentBackend.cs.html#5e281a73a1bd9c00" class="i property">UpperValue</a> - <a href="#6905c7de9ba6b53b" class="i field">horizontalBackend</a>.<a href="ScrollAdjustmentBackend.cs.html#82451775f252cd56" class="i property">LowerValue</a>, <a href="#4c76716ee488a955" class="i field">verticalBackend</a>.<a href="ScrollAdjustmentBackend.cs.html#5e281a73a1bd9c00" class="i property">UpperValue</a> - <a href="#4c76716ee488a955" class="i field">verticalBackend</a>.<a href="ScrollAdjustmentBackend.cs.html#82451775f252cd56" class="i property">LowerValue</a>);
			<a href="@0@WindowsBase/A.html#a844b9b525c2088c" class="k">var</a> <span id="r15 rd" class="r15 r">newViewport</span> = <b>new</b> <a href="@0@WindowsBase/A.html#a9e92f9d82abccc2" class="t constructor">WSize</a> (<a href="#6905c7de9ba6b53b" class="i field">horizontalBackend</a>.<a href="ScrollAdjustmentBackend.cs.html#34a316088cda7361" class="i property">PageSize</a>, <a href="#4c76716ee488a955" class="i field">verticalBackend</a>.<a href="ScrollAdjustmentBackend.cs.html#34a316088cda7361" class="i property">PageSize</a>);
			<b>if</b> (<span class="r15 r">newViewport</span>.<a href="@0@WindowsBase/A.html#6889b81bbde81637" class="i property">Width</a> &gt; <span class="r14 r">newExtent</span>.<a href="@0@WindowsBase/A.html#6889b81bbde81637" class="i property">Width</a>)
				<span class="r15 r">newViewport</span>.<a href="@0@WindowsBase/A.html#6889b81bbde81637" class="i property">Width</a> = <span class="r14 r">newExtent</span>.<a href="@0@WindowsBase/A.html#6889b81bbde81637" class="i property">Width</a>;
			<b>if</b> (<span class="r15 r">newViewport</span>.<a href="@0@WindowsBase/A.html#5c5d17caa72f2875" class="i property">Height</a> &gt; <span class="r14 r">newExtent</span>.<a href="@0@WindowsBase/A.html#5c5d17caa72f2875" class="i property">Height</a>)
				<span class="r15 r">newViewport</span>.<a href="@0@WindowsBase/A.html#5c5d17caa72f2875" class="i property">Height</a> = <span class="r14 r">newExtent</span>.<a href="@0@WindowsBase/A.html#5c5d17caa72f2875" class="i property">Height</a>;

			<b>if</b> (<a href="#e09ddef32e2adb13" class="i field">extent</a> != <span class="r14 r">newExtent</span> || <a href="#8f7e7e20c067ec2d" class="i field">viewport</a> != <span class="r15 r">newViewport</span>) {
				<a href="#e09ddef32e2adb13" class="i field">extent</a> = <span class="r14 r">newExtent</span>;
				<a href="#8f7e7e20c067ec2d" class="i field">viewport</a> = <span class="r15 r">newViewport</span>;
				<b>if</b> (!<a href="#4813a50d049e2866" class="i field">viewportAdjustmentQueued</a>) {
					<a href="#4813a50d049e2866" class="i field">viewportAdjustmentQueued</a> = <b>true</b>;
					<a href="/Xwt3/A.html#687215caac5b1b53" class="t t">Application</a>.<a href="/Xwt3/A.html#90e66e6f971c8db5" class="i property">MainLoop</a>.<a href="/Xwt3/A.html#4355754e43c9ee9f" class="i method">QueueExitAction</a> (<b>delegate</b>
					{
						<span class="c">// Adjust the position, if it now falls outside the extents.</span>
						<span class="c">// Doing it in an exit action to make sure the adjustement</span>
						<span class="c">// is made only once for all changes in the scrollbar properties</span>
						<a href="#4813a50d049e2866" class="i field">viewportAdjustmentQueued</a> = <b>false</b>;
						<b>if</b> (<a href="#b6ae652abe4d823d" class="i field">contentOffset</a>.<a href="/Xwt3/A.html#a925f0d89fafd1e3" class="i property">X</a> + <a href="#8f7e7e20c067ec2d" class="i field">viewport</a>.<a href="@0@WindowsBase/A.html#6889b81bbde81637" class="i property">Width</a> &gt; <a href="#e09ddef32e2adb13" class="i field">extent</a>.<a href="@0@WindowsBase/A.html#6889b81bbde81637" class="i property">Width</a>)
							<a href="#4827e8fbcec25164" class="i method">SetHorizontalOffset</a> (<a href="#e09ddef32e2adb13" class="i field">extent</a>.<a href="@0@WindowsBase/A.html#6889b81bbde81637" class="i property">Width</a> - <a href="#8f7e7e20c067ec2d" class="i field">viewport</a>.<a href="@0@WindowsBase/A.html#6889b81bbde81637" class="i property">Width</a>);
						<b>if</b> (<a href="#b6ae652abe4d823d" class="i field">contentOffset</a>.<a href="/Xwt3/A.html#270121b6118aba39" class="i property">Y</a> + <a href="#8f7e7e20c067ec2d" class="i field">viewport</a>.<a href="@0@WindowsBase/A.html#5c5d17caa72f2875" class="i property">Height</a> &gt; <a href="#e09ddef32e2adb13" class="i field">extent</a>.<a href="@0@WindowsBase/A.html#5c5d17caa72f2875" class="i property">Height</a>)
							<a href="#0250648f5e834fdd" class="i method">SetVerticalOffset</a> (<a href="#e09ddef32e2adb13" class="i field">extent</a>.<a href="@0@WindowsBase/A.html#5c5d17caa72f2875" class="i property">Height</a> - <a href="#8f7e7e20c067ec2d" class="i field">viewport</a>.<a href="@0@WindowsBase/A.html#5c5d17caa72f2875" class="i property">Height</a>);
						<b>if</b> (<a href="#388371254f8b0c71" class="i property">ScrollOwner</a> != <b>null</b>)
							<a href="#388371254f8b0c71" class="i property">ScrollOwner</a>.<a href="@0@PresentationFramework/A.html#b5da19f474e5e42b" class="i method">InvalidateScrollInfo</a> ();
					});
				}
			}
		}

		<b>private readonly</b> <a href="@0@PresentationCore/A.html#d575b26d9ec0d77d" class="t t">TranslateTransform</a> <a id="9803aa0490b93219" href="../R/9803aa0490b93219.html" target="n" data-glyph="46,1" class="i field">transform</a> = <b>new</b> <a href="@0@PresentationCore/A.html#9a2f3f583479d7b6" class="t constructor">TranslateTransform</a>();
		<b>private readonly</b> <a href="ScrollAdjustmentBackend.cs.html#96e2073efffc6d72" class="t t">ScrollAdjustmentBackend</a> <a id="4c76716ee488a955" href="../R/4c76716ee488a955.html" target="n" data-glyph="46,1" class="i field">verticalBackend</a>;
		<b>private readonly</b> <a href="ScrollAdjustmentBackend.cs.html#96e2073efffc6d72" class="t t">ScrollAdjustmentBackend</a> <a id="6905c7de9ba6b53b" href="../R/6905c7de9ba6b53b.html" target="n" data-glyph="46,1" class="i field">horizontalBackend</a>;
		<b>private readonly bool</b> <a id="0d61d1ac5cbdea55" href="../R/0d61d1ac5cbdea55.html" target="n" data-glyph="46,1" class="i field">usingCustomScrolling</a>;

		<b>private bool</b> <a id="4813a50d049e2866" href="../R/4813a50d049e2866.html" target="n" data-glyph="46,1" class="i field">viewportAdjustmentQueued</a>;
		<b>private</b> <a href="/Xwt3/A.html#0e54e87b6e891b4f" class="t t">Point</a> <a id="b6ae652abe4d823d" href="../R/b6ae652abe4d823d.html" target="n" data-glyph="46,1" class="i field">contentOffset</a>;
		<b>private</b> <a href="@0@WindowsBase/A.html#a844b9b525c2088c" class="t t">WSize</a> <a id="e09ddef32e2adb13" href="../R/e09ddef32e2adb13.html" target="n" data-glyph="46,1" class="i field">extent</a> = <b>new</b> <a href="@0@WindowsBase/A.html#a9e92f9d82abccc2" class="t constructor">WSize</a> (0, 0);
		<b>private</b> <a href="@0@WindowsBase/A.html#a844b9b525c2088c" class="t t">WSize</a> <a id="8f7e7e20c067ec2d" href="../R/8f7e7e20c067ec2d.html" target="n" data-glyph="46,1" class="i field">viewport</a> = <b>new</b> <a href="@0@WindowsBase/A.html#a9e92f9d82abccc2" class="t constructor">WSize</a> (0, 0);

		<b>private static readonly</b> <a href="@0@WindowsBase/A.html#a844b9b525c2088c" class="t t">WSize</a> <a id="f0c45d06b9459be8" href="../R/f0c45d06b9459be8.html" target="n" data-glyph="46,1" class="i field">InfiniteSize</a>
			= <b>new</b> <span class="i n">System</span>.<span class="i n">Windows</span>.<a href="@0@WindowsBase/A.html#a9e92f9d82abccc2" class="t constructor">Size</a> (<a href="@0@mscorlib/A.html#1a65cbdb09544ba1" class="t t">Double</a>.<a href="@0@mscorlib/A.html#704210f8dd6afaed" class="i field">PositiveInfinity</a>, <a href="@0@mscorlib/A.html#1a65cbdb09544ba1" class="t t">Double</a>.<a href="@0@mscorlib/A.html#704210f8dd6afaed" class="i field">PositiveInfinity</a>);

		<b>protected double</b> <a id="5bea95eba0e7a688" href="../R/5bea95eba0e7a688.html" target="n" data-glyph="105,1" class="i property">VerticalPageIncrement</a>
		{
			<b>get</b> { <b>return</b> (<a href="#0d36022744c86b38" class="k">this</a>.<a href="#4c76716ee488a955" class="i field">verticalBackend</a> != <b>null</b>) ? <a href="#0d36022744c86b38" class="k">this</a>.<a href="#4c76716ee488a955" class="i field">verticalBackend</a>.<a href="ScrollAdjustmentBackend.cs.html#abe04ed746c302c5" class="i property">PageIncrement</a> : <a href="#dbe7ed18ac250698" class="i property">ViewportHeight</a>; }
		}

		<b>protected double</b> <a id="ffebfae1f47be066" href="../R/ffebfae1f47be066.html" target="n" data-glyph="105,1" class="i property">HorizontalPageIncrement</a>
		{
			<b>get</b> { <b>return</b> (<a href="#0d36022744c86b38" class="k">this</a>.<a href="#6905c7de9ba6b53b" class="i field">horizontalBackend</a> != <b>null</b>) ? <a href="#0d36022744c86b38" class="k">this</a>.<a href="#6905c7de9ba6b53b" class="i field">horizontalBackend</a>.<a href="ScrollAdjustmentBackend.cs.html#abe04ed746c302c5" class="i property">PageIncrement</a> : <a href="#bacd82961dd2d4a4" class="i property">ViewportWidth</a>; }
		}

		<b>protected double</b> <a id="4ce3720e55364a4c" href="../R/4ce3720e55364a4c.html" target="n" data-glyph="105,1" class="i property">VerticalStepIncrement</a>
		{
			<b>get</b> { <b>return</b> (<a href="#0d36022744c86b38" class="k">this</a>.<a href="#4c76716ee488a955" class="i field">verticalBackend</a> != <b>null</b>) ? <a href="#0d36022744c86b38" class="k">this</a>.<a href="#4c76716ee488a955" class="i field">verticalBackend</a>.<a href="ScrollAdjustmentBackend.cs.html#afea4edf7d8f85c6" class="i property">StepIncrement</a> : <a href="#5bea95eba0e7a688" class="i property">VerticalPageIncrement</a> / 10; }
		}

		<b>protected double</b> <a id="69efac7c8ae33798" href="../R/69efac7c8ae33798.html" target="n" data-glyph="105,1" class="i property">HorizontalStepIncrement</a>
		{
			<b>get</b> { <b>return</b> (<a href="#0d36022744c86b38" class="k">this</a>.<a href="#6905c7de9ba6b53b" class="i field">horizontalBackend</a> != <b>null</b>) ? <a href="#0d36022744c86b38" class="k">this</a>.<a href="#6905c7de9ba6b53b" class="i field">horizontalBackend</a>.<a href="ScrollAdjustmentBackend.cs.html#afea4edf7d8f85c6" class="i property">StepIncrement</a> : <a href="#ffebfae1f47be066" class="i property">HorizontalPageIncrement</a> / 10; }
		}

		<b>protected override</b> <a href="@0@WindowsBase/A.html#a844b9b525c2088c" class="t t">WSize</a> <a id="52d79e42ad90afb9" href="../R/52d79e42ad90afb9.html" target="n" data-glyph="75,1" class="i method">MeasureOverride</a> (<a href="@0@WindowsBase/A.html#a844b9b525c2088c" class="t t">WSize</a> <span id="r16 rd" class="r16 r">constraint</span>)
		{
			<a href="@0@PresentationFramework/A.html#d2d98a3022fbac2f" class="t t">FrameworkElement</a> <span id="r17 rd" class="r17 r">child</span> = (<a href="@0@PresentationFramework/A.html#d2d98a3022fbac2f" class="t t">FrameworkElement</a>) <a href="@0@PresentationFramework/A.html#2dfe8f6fd8301ab5" class="i property">InternalChildren</a> [0];

			<b>if</b> (<a href="#0d61d1ac5cbdea55" class="i field">usingCustomScrolling</a>) {
				<span class="c">// Measure the child using the constraint because when using custom scrolling,</span>
				<span class="c">// the child is not really scrolled (its contents are) and its size is whatever</span>
				<span class="c">// the scroll view decides to assign to the viewport, so the constraint</span>
				<span class="c">// must be satisfied</span>
				<span class="r17 r">child</span>.<a href="@0@PresentationCore/A.html#0e6c09a4266b5db0" class="i method">Measure</a> (<span class="r16 r">constraint</span>);
				<b>return</b> <span class="r17 r">child</span>.<a href="@0@PresentationCore/A.html#32042c7c3b8912f8" class="i property">DesiredSize</a>;
			}
			<b>else</b> {
				<span class="c">// We don&#39;t use the child size here, but WPF requires Measure to</span>
				<span class="c">// be called for all children of a widget in the container&#39;s MeasureOverride</span>
				<span class="r17 r">child</span>.<a href="@0@PresentationCore/A.html#0e6c09a4266b5db0" class="i method">Measure</a> (<a href="#f0c45d06b9459be8" class="i field">InfiniteSize</a>);
				<b>return</b> <b>new</b> <a href="@0@WindowsBase/A.html#a9e92f9d82abccc2" class="t constructor">WSize</a> (0, 0);
			}
		}

		<b>protected override</b> <span class="i n">System</span>.<span class="i n">Windows</span>.<a href="@0@WindowsBase/A.html#a844b9b525c2088c" class="t t">Size</a> <a id="c1cc7d321879ed64" href="../R/c1cc7d321879ed64.html" target="n" data-glyph="75,1" class="i method">ArrangeOverride</a> (<span class="i n">System</span>.<span class="i n">Windows</span>.<a href="@0@WindowsBase/A.html#a844b9b525c2088c" class="t t">Size</a> <span id="r18 rd" class="r18 r">finalSize</span>)
		{
			<a href="@0@PresentationFramework/A.html#d2d98a3022fbac2f" class="t t">FrameworkElement</a> <span id="r19 rd" class="r19 r">child</span> = (<a href="@0@PresentationFramework/A.html#d2d98a3022fbac2f" class="t t">FrameworkElement</a>)<a href="@0@PresentationFramework/A.html#2dfe8f6fd8301ab5" class="i property">InternalChildren</a> [0];

			<a href="@0@WindowsBase/A.html#a844b9b525c2088c" class="t t">WSize</a> <span id="r20 rd" class="r20 r">childSize</span> = <span class="r19 r">child</span>.<a href="@0@PresentationCore/A.html#32042c7c3b8912f8" class="i property">DesiredSize</a>;

			<span class="c">// The child has to fill all the available space in the ScrollView</span>
			<span class="c">// if the ScrollView happens to be bigger than the space required by the child</span>
			<b>if</b> (<span class="r20 r">childSize</span>.<a href="@0@WindowsBase/A.html#5c5d17caa72f2875" class="i property">Height</a> &lt; <span class="r18 r">finalSize</span>.<a href="@0@WindowsBase/A.html#5c5d17caa72f2875" class="i property">Height</a>)
				<span class="r20 r">childSize</span>.<a href="@0@WindowsBase/A.html#5c5d17caa72f2875" class="i property">Height</a> = <span class="r18 r">finalSize</span>.<a href="@0@WindowsBase/A.html#5c5d17caa72f2875" class="i property">Height</a>;
			<b>if</b> (<span class="r20 r">childSize</span>.<a href="@0@WindowsBase/A.html#6889b81bbde81637" class="i property">Width</a> &lt; <span class="r18 r">finalSize</span>.<a href="@0@WindowsBase/A.html#6889b81bbde81637" class="i property">Width</a>)
				<span class="r20 r">childSize</span>.<a href="@0@WindowsBase/A.html#6889b81bbde81637" class="i property">Width</a> = <span class="r18 r">finalSize</span>.<a href="@0@WindowsBase/A.html#6889b81bbde81637" class="i property">Width</a>;

			<b>if</b> (!<a href="#0d61d1ac5cbdea55" class="i field">usingCustomScrolling</a>) {
				<span class="c">// The viewport and extent doesn&#39;t have to be set when using custom scrolling, since they</span>
				<span class="c">// are fully controlled by the child widget through the scroll adjustments</span>
				<b>if</b> (<a href="#0d36022744c86b38" class="k">this</a>.<a href="#e09ddef32e2adb13" class="i field">extent</a> != <span class="r20 r">childSize</span>) {
					<a href="#0d36022744c86b38" class="k">this</a>.<a href="#e09ddef32e2adb13" class="i field">extent</a> = <span class="r20 r">childSize</span>;
					<a href="#388371254f8b0c71" class="i property">ScrollOwner</a>.<a href="@0@PresentationFramework/A.html#b5da19f474e5e42b" class="i method">InvalidateScrollInfo</a> ();
				}

				<b>if</b> (<a href="#0d36022744c86b38" class="k">this</a>.<a href="#8f7e7e20c067ec2d" class="i field">viewport</a> != <span class="r18 r">finalSize</span>) {
					<a href="#0d36022744c86b38" class="k">this</a>.<a href="#8f7e7e20c067ec2d" class="i field">viewport</a> = <span class="r18 r">finalSize</span>;
					<a href="#388371254f8b0c71" class="i property">ScrollOwner</a>.<a href="@0@PresentationFramework/A.html#b5da19f474e5e42b" class="i method">InvalidateScrollInfo</a> ();
				}
			}

			<span class="r19 r">child</span>.<a href="@0@PresentationCore/A.html#db317f34429aad8f" class="i method">Arrange</a> (<b>new</b> <a href="@0@WindowsBase/A.html#299a3fd614724168" class="t constructor">Rect</a> (0, 0, <span class="r20 r">childSize</span>.<a href="@0@WindowsBase/A.html#6889b81bbde81637" class="i property">Width</a>, <span class="r20 r">childSize</span>.<a href="@0@WindowsBase/A.html#5c5d17caa72f2875" class="i property">Height</a>));
			<span class="r19 r">child</span>.<a href="@0@PresentationCore/A.html#b985370236fdd604" class="i method">UpdateLayout</a> ();
			<b>if</b> (<span class="r19 r">child</span> <b>is</b> <a href="WidgetBackend.cs.html#cc0e50a0d5748c2d" class="t t">IWpfWidget</a>)
				((<a href="/Xwt3/A.html#f1551041ed661732" class="t t">IWidgetSurface</a>)(((<a href="WidgetBackend.cs.html#cc0e50a0d5748c2d" class="t t">IWpfWidget</a>)<span class="r19 r">child</span>).<a href="WidgetBackend.cs.html#993669e9ca4e75f4" class="i property">Backend</a>.<a href="WidgetBackend.cs.html#a0cac2053ea95bf6" class="i property">Frontend</a>)).<a href="/Xwt3/A.html#a4666bf972e0fba2" class="i method">Reallocate</a> ();

			<b>return</b> <span class="r18 r">finalSize</span>;
		}
	}
}</pre></td></tr></table></div></body></html>
