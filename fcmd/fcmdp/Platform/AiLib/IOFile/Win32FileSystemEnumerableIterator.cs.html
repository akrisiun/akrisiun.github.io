<!DOCTYPE html>
<html><head><title>Win32FileSystemEnumerableIterator.cs</title><link rel="stylesheet" href="../../../../styles.css"><script src="../../../../scripts.js"></script></head>
<body class="cB" onload="i(663);"><div class="dH">
<table style="width: 100%">
<tr><td>File: <a id="filePath" class="blueLink" href="/#fcmdp/Platform/AiLib/IOFile/Win32FileSystemEnumerableIterator.cs" target="_top">Platform\AiLib\IOFile\Win32FileSystemEnumerableIterator.cs</a><br/></td><td></td></tr>
<tr><td>Project: <a id="projectPath" class="blueLink" href="/#fcmdp" target="_top">fcmd\fcmdp.csproj</a> (fcmdp)</td><td></td></tr>
</table>
</div>
<div class="cz"><table class="tb" cellpadding="0" cellspacing="0"><tr><td valign="top" align="right"><pre id="ln"></pre></td><td valign="top" align="left"><pre id="code">
<b>using</b> <span class="i n">System</span>;
<b>using</b> <span class="i n">System</span>.<span class="i n">Collections</span>;
<b>using</b> <span class="i n">System</span>.<span class="i n">Collections</span>.<span class="i n">Generic</span>;
<b>using</b> <span class="i n">System</span>.<span class="i n">Diagnostics</span>.<span class="i n">Contracts</span>;
<b>using</b> <span class="i n">System</span>.<span class="i n">IO</span>;
<b>using</b> <span class="i n">System</span>.<span class="i n">Linq</span>;
<b>using</b> <span class="i n">System</span>.<span class="i n">Runtime</span>.<span class="i n">InteropServices</span>;
<b>using</b> <span class="i n">System</span>.<span class="i n">Text</span>;
<b>using</b> <span class="t">SafeFindHandle</span> = <span class="i n">System</span>.<a href="@0@mscorlib/A.html#d99bf6ad49979009" class="t t">IntPtr</a>;
 
<b>namespace</b> <span class="i n">AiLib</span>.<span class="i n">IOFile</span>
{
    <span class="k preprocess">#</span><span class="k preprocess">region</span> Search data
 
    <b>public sealed class</b> <a id="bf0edcbb12a7e5b5" href="../../../R/bf0edcbb12a7e5b5.html" target="n" data-glyph="0,0" class="t t">SearchResult</a>
    {
        <b>private</b> <a href="@0@mscorlib/A.html#8281103e6f23cb5c" class="t t">String</a> <a id="71474d85c52c2650" href="../../../R/71474d85c52c2650.html" target="n" data-glyph="46,1" class="i field">_fullPath</a>;     <span class="c">// fully-qualified path</span>
        <b>private</b> <a href="@0@mscorlib/A.html#8281103e6f23cb5c" class="t t">String</a> <a id="be02da5c3f227a28" href="../../../R/be02da5c3f227a28.html" target="n" data-glyph="46,1" class="i field">_userPath</a>;     <span class="c">// user-specified path</span>
        [<span class="i n">System</span>.<span class="i n">Security</span>.<a href="@0@mscorlib/A.html#29a3d687a50338b1" class="t constructor">SecurityCritical</a>]
        <b>private</b> <a href="Win32FindFile.cs.html#7631f748197d6b49" class="t t">Win32FindFile</a>.<a href="Win32FindFile.cs.html#2b1a59df44331d51" class="t t">WIN32_FIND_DATA</a> <a id="d9d87dc6fda25a44" href="../../../R/d9d87dc6fda25a44.html" target="n" data-glyph="46,1" class="i field">_findData</a>;
 
        [<span class="i n">System</span>.<span class="i n">Security</span>.<a href="@0@mscorlib/A.html#29a3d687a50338b1" class="t constructor">SecurityCritical</a>]
        <b>internal</b> <a id="4fbda159e441f752" href="../../../R/4fbda159e441f752.html" target="n" data-glyph="74,1" class="i constructor">SearchResult</a>(<a href="@0@mscorlib/A.html#8281103e6f23cb5c" class="t t">String</a> <span id="r0 rd" class="r0 r">fullPath</span>, <a href="@0@mscorlib/A.html#8281103e6f23cb5c" class="t t">String</a> <span id="r1 rd" class="r1 r">userPath</span>, <a href="Win32FindFile.cs.html#7631f748197d6b49" class="t t">Win32FindFile</a>.<a href="Win32FindFile.cs.html#2b1a59df44331d51" class="t t">WIN32_FIND_DATA</a> <span id="r2 rd" class="r2 r">findData</span>)
        {
            <a href="@0@mscorlib/A.html#c575dbe300e57438" class="t t">Contract</a>.<a href="@0@mscorlib/A.html#1f51ef07e80c9b68" class="i method">Requires</a>(<span class="r0 r">fullPath</span> != <b>null</b>);
            <span class="c">// Contract.Requires(userPath != null);</span>
 
            <a href="#bf0edcbb12a7e5b5" class="k">this</a>.<a href="#71474d85c52c2650" class="i field">_fullPath</a> = <span class="r0 r">fullPath</span>;
            <a href="#bf0edcbb12a7e5b5" class="k">this</a>.<a href="#be02da5c3f227a28" class="i field">_userPath</a> = <span class="r1 r">userPath</span>;
            <a href="#bf0edcbb12a7e5b5" class="k">this</a>.<a href="#d9d87dc6fda25a44" class="i field">_findData</a> = <span class="r2 r">findData</span>;
        }
 
        <b>internal</b> <a href="@0@mscorlib/A.html#8281103e6f23cb5c" class="t t">String</a> <a id="59bb18d3ab5ffd26" href="../../../R/59bb18d3ab5ffd26.html" target="n" data-glyph="104,1" class="i property">FullPath</a>
        {
            <b>get</b> { <b>return</b> <a href="#71474d85c52c2650" class="i field">_fullPath</a>; }
        }
 
        <b>internal</b> <a href="@0@mscorlib/A.html#8281103e6f23cb5c" class="t t">String</a> <a id="eb2182c258566418" href="../../../R/eb2182c258566418.html" target="n" data-glyph="104,1" class="i property">UserPath</a>
        {
            <b>get</b> { <b>return</b> <a href="#be02da5c3f227a28" class="i field">_userPath</a>; }
        }
 
        <b>internal</b> <a href="Win32FindFile.cs.html#7631f748197d6b49" class="t t">Win32FindFile</a>.<a href="Win32FindFile.cs.html#2b1a59df44331d51" class="t t">WIN32_FIND_DATA</a> <a id="52668478ed193cae" href="../../../R/52668478ed193cae.html" target="n" data-glyph="104,1" class="i property">FindData</a>
        {
            [<span class="i n">System</span>.<span class="i n">Security</span>.<a href="@0@mscorlib/A.html#29a3d687a50338b1" class="t constructor">SecurityCritical</a>]
            <b>get</b>
            { <b>return</b> <a href="#d9d87dc6fda25a44" class="i field">_findData</a>; }
        }
    }
 
    <b>internal sealed class</b> <a id="8eaba6458e1cc166" href="../../../R/8eaba6458e1cc166.html" target="n" data-glyph="2,0" class="t t">SearchData</a>
    {
        <b>public</b> <a id="dfa482c62ad2a753" href="../../../R/dfa482c62ad2a753.html" target="n" data-glyph="72,1" class="i constructor">SearchData</a>(<a href="@0@mscorlib/A.html#8281103e6f23cb5c" class="t t">String</a> <span id="r3 rd" class="r3 r">fullPath</span>, <a href="@0@mscorlib/A.html#8281103e6f23cb5c" class="t t">String</a> <span id="r4 rd" class="r4 r">userPath</span>, <a href="@0@mscorlib/A.html#2cb8f758d1188030" class="t t">SearchOption</a> <span id="r5 rd" class="r5 r">searchOption</span>)
        {
            <a href="@0@mscorlib/A.html#c575dbe300e57438" class="t t">Contract</a>.<a href="@0@mscorlib/A.html#1f51ef07e80c9b68" class="i method">Requires</a>(<span class="r3 r">fullPath</span> != <b>null</b> &amp;&amp; <span class="r3 r">fullPath</span>.<a href="@0@mscorlib/A.html#e13f5829ef28aa07" class="i property">Length</a> &gt; 0);
            <a href="@0@mscorlib/A.html#c575dbe300e57438" class="t t">Contract</a>.<a href="@0@mscorlib/A.html#1f51ef07e80c9b68" class="i method">Requires</a>(<span class="r4 r">userPath</span> != <b>null</b> &amp;&amp; <span class="r4 r">userPath</span>.<a href="@0@mscorlib/A.html#e13f5829ef28aa07" class="i property">Length</a> &gt; 0);
            <a href="@0@mscorlib/A.html#c575dbe300e57438" class="t t">Contract</a>.<a href="@0@mscorlib/A.html#1f51ef07e80c9b68" class="i method">Requires</a>(<span class="r5 r">searchOption</span> == <a href="@0@mscorlib/A.html#2cb8f758d1188030" class="t t">SearchOption</a>.<a href="@0@mscorlib/A.html#189c2c97fce85a03" class="i field">AllDirectories</a> || <span class="r5 r">searchOption</span> == <a href="@0@mscorlib/A.html#2cb8f758d1188030" class="t t">SearchOption</a>.<a href="@0@mscorlib/A.html#db04cd5083907c24" class="i field">TopDirectoryOnly</a>);
 
            <a href="#8eaba6458e1cc166" class="k">this</a>.<a href="#3602347d3f235859" class="i field">fullPath</a> = <span class="r3 r">fullPath</span>;
            <a href="#8eaba6458e1cc166" class="k">this</a>.<a href="#5a88cc05a056cb62" class="i field">userPath</a> = <span class="r4 r">userPath</span>;
            <a href="#8eaba6458e1cc166" class="k">this</a>.<a href="#bb6aed41672ac354" class="i field">searchOption</a> = <span class="r5 r">searchOption</span>;
        }
 
        <b>public readonly string</b> <a id="3602347d3f235859" href="../../../R/3602347d3f235859.html" target="n" data-glyph="42,1" class="i field">fullPath</a>;     <span class="c">// Fully qualified search path excluding the search criteria in the end (ex, c:\temp\bar\foo)</span>
        <b>public readonly string</b> <a id="5a88cc05a056cb62" href="../../../R/5a88cc05a056cb62.html" target="n" data-glyph="42,1" class="i field">userPath</a>;     <span class="c">// User specified path (ex, bar\foo)</span>
        <b>public readonly</b> <a href="@0@mscorlib/A.html#2cb8f758d1188030" class="t t">SearchOption</a> <a id="bb6aed41672ac354" href="../../../R/bb6aed41672ac354.html" target="n" data-glyph="42,1" class="i field">searchOption</a>;
    }
 
    <span class="k preprocess">#</span><span class="k preprocess">endregion</span>
 
    <b>internal class</b> <a id="b140df088e8c365d" href="../../../R/b140df088e8c365d.html" target="n" data-glyph="2,0" class="t t">Win32FileSystemEnumerableIterator</a>&lt;<span id="r6 rd t" class="r6 r t">TSource</span>&gt; : <a href="Iterator.cs.html#2ea95d0e58eae0c7" class="t t">Iterator</a>&lt;<span class="r6 r t">TSource</span>&gt;, <a href="@0@mscorlib/A.html#1f55292c3174123d" class="t t">IDisposable</a>
    {
        <span class="k preprocess">#</span><span class="k preprocess">region</span> Properties
 
        <b>private const int</b> <a id="9171b1571534d4f8" href="../../../R/9171b1571534d4f8.html" target="n" data-glyph="10,1" class="i field">STATE_INIT</a> = 1;
        <b>private const int</b> <a id="6d09629f1101e952" href="../../../R/6d09629f1101e952.html" target="n" data-glyph="10,1" class="i field">STATE_SEARCH_NEXT_DIR</a> = 2;
        <b>private const int</b> <a id="305864c2812370b1" href="../../../R/305864c2812370b1.html" target="n" data-glyph="10,1" class="i field">STATE_FIND_NEXT_FILE</a> = 3;
        <b>private const int</b> <a id="620f18ee0c50612f" href="../../../R/620f18ee0c50612f.html" target="n" data-glyph="10,1" class="i field">STATE_FINISH</a> = 4;
 
        <b>private</b> <a href="#77ab7cfb35834836" class="t t">SearchResultHandler</a>&lt;<span class="r6 r t">TSource</span>&gt; <a id="c90ff19552f2214b" href="../../../R/c90ff19552f2214b.html" target="n" data-glyph="46,1" class="i field">_resultHandler</a>;
        <b>private</b> <a href="@0@mscorlib/A.html#cf7f4095e4de7646" class="t t">List</a>&lt;<a href="#8eaba6458e1cc166" class="t t">SearchData</a>&gt; <a id="28bf98feab6b024b" href="../../../R/28bf98feab6b024b.html" target="n" data-glyph="46,1" class="i field">_searchStack</a>;
        <b>private</b> <a href="#8eaba6458e1cc166" class="t t">SearchData</a> <a id="b3c2ebc7ab102a44" href="../../../R/b3c2ebc7ab102a44.html" target="n" data-glyph="46,1" class="i field">_searchData</a>;
        <b>private</b> <a href="@0@mscorlib/A.html#8281103e6f23cb5c" class="t t">String</a> <a id="a3c693352072ef01" href="../../../R/a3c693352072ef01.html" target="n" data-glyph="46,1" class="i field">_searchCriteria</a>;
 
        [<span class="i n">System</span>.<span class="i n">Security</span>.<a href="@0@mscorlib/A.html#29a3d687a50338b1" class="t constructor">SecurityCritical</a>]
        <b>private</b> <a href="@0@mscorlib/A.html#d99bf6ad49979009" class="t t">IntPtr</a> <a id="e882bfe3415d175d" href="../../../R/e882bfe3415d175d.html" target="n" data-glyph="46,1" class="i field">_hnd</a> = <a href="@0@mscorlib/A.html#d99bf6ad49979009" class="t t">IntPtr</a>.<a href="@0@mscorlib/A.html#d46202ed9b6005b2" class="i field">Zero</a>; <span class="c">// null;</span>
 
        <span class="c">// empty means we know in advance that we won’t find any search results, which can happen if:</span>
        <span class="c">// 1. we don’t have a search pattern</span>
        <span class="c">// 2. we’re enumerating only the top directory and found no matches during the first call</span>
        <span class="c">// This flag allows us to return early for these cases. We can’t know this in advance for</span>
        <span class="c">// SearchOption.AllDirectories because we do a “*” search for subdirs and then use the</span>
        <span class="c">// searchPattern at each directory level.</span>
        <b>private bool</b> <a id="88365f12827903d4" href="../../../R/88365f12827903d4.html" target="n" data-glyph="46,1" class="i field">_empty</a>;
 
        <b>private</b> <a href="@0@mscorlib/A.html#8281103e6f23cb5c" class="t t">String</a> <a id="5d6de410add820b3" href="../../../R/5d6de410add820b3.html" target="n" data-glyph="46,1" class="i field">_userPath</a>;
        <b>private</b> <a href="@0@mscorlib/A.html#2cb8f758d1188030" class="t t">SearchOption</a> <a id="3baaa50fc77001f1" href="../../../R/3baaa50fc77001f1.html" target="n" data-glyph="46,1" class="i field">_searchOption</a>;
        <b>private</b> <a href="@0@mscorlib/A.html#8281103e6f23cb5c" class="t t">String</a> <a id="d9ccf1f123d21f9f" href="../../../R/d9ccf1f123d21f9f.html" target="n" data-glyph="46,1" class="i field">_fullPath</a>;
        <b>private</b> <a href="@0@mscorlib/A.html#8281103e6f23cb5c" class="t t">String</a> <a id="17939fc0b3db52c7" href="../../../R/17939fc0b3db52c7.html" target="n" data-glyph="46,1" class="i field">_normalizedSearchPath</a>;
        <span class="c">// private uint _oldMode;</span>
 
        <b>void</b> <a id="3a72c84648d2d782" href="../../../R/3a72c84648d2d782.html" target="n" data-glyph="76,1" class="i method">Dispose</a>(<a href="@0@mscorlib/A.html#d99bf6ad49979009" class="t t">IntPtr</a> <span id="r7 rd" class="r7 r">_hnd</span>) {
            <b>if</b> (<span class="r7 r">_hnd</span> != <a href="@0@mscorlib/A.html#d99bf6ad49979009" class="t t">IntPtr</a>.<a href="@0@mscorlib/A.html#d46202ed9b6005b2" class="i field">Zero</a>)
                <a href="Win32FindFile.cs.html#7631f748197d6b49" class="t t">Win32FindFile</a>.<a href="Win32FindFile.cs.html#8878180625031ff8" class="i method">FindClose</a>(<span class="r7 r">_hnd</span>);
        }
 
        <span class="k preprocess">#</span><span class="k preprocess">endregion</span>
 
        [<span class="i n">System</span>.<span class="i n">Security</span>.<a href="@0@mscorlib/A.html#13cf8064dae6f902" class="t constructor">SecuritySafeCritical</a>]
        <b>internal</b> <a id="6a4a03663059f4aa" href="../../../R/6a4a03663059f4aa.html" target="n" data-glyph="74,1" class="i constructor">Win32FileSystemEnumerableIterator</a>(<a href="@0@mscorlib/A.html#8281103e6f23cb5c" class="t t">String</a> <span id="r8 rd" class="r8 r">path</span>, <a href="@0@mscorlib/A.html#8281103e6f23cb5c" class="t t">String</a> <span id="r9 rd" class="r9 r">originalUserPath</span>,
            <a href="@0@mscorlib/A.html#8281103e6f23cb5c" class="t t">String</a> <span id="r10 rd" class="r10 r">searchPattern</span>, <a href="@0@mscorlib/A.html#2cb8f758d1188030" class="t t">SearchOption</a> <span id="r11 rd" class="r11 r">searchOption</span>, <a href="#77ab7cfb35834836" class="t t">SearchResultHandler</a>&lt;<span class="r6 r t">TSource</span>&gt; <span id="r12 rd" class="r12 r">resultHandler</span>)
        {
            <a href="@0@mscorlib/A.html#c575dbe300e57438" class="t t">Contract</a>.<a href="@0@mscorlib/A.html#1f51ef07e80c9b68" class="i method">Requires</a>(<span class="r8 r">path</span> != <b>null</b>);
            <a href="@0@mscorlib/A.html#c575dbe300e57438" class="t t">Contract</a>.<a href="@0@mscorlib/A.html#1f51ef07e80c9b68" class="i method">Requires</a>(<span class="r9 r">originalUserPath</span> != <b>null</b>);
            <a href="@0@mscorlib/A.html#c575dbe300e57438" class="t t">Contract</a>.<a href="@0@mscorlib/A.html#1f51ef07e80c9b68" class="i method">Requires</a>(<span class="r10 r">searchPattern</span> != <b>null</b>);
            <a href="@0@mscorlib/A.html#c575dbe300e57438" class="t t">Contract</a>.<a href="@0@mscorlib/A.html#1f51ef07e80c9b68" class="i method">Requires</a>(<span class="r11 r">searchOption</span> == <a href="@0@mscorlib/A.html#2cb8f758d1188030" class="t t">SearchOption</a>.<a href="@0@mscorlib/A.html#189c2c97fce85a03" class="i field">AllDirectories</a> || <span class="r11 r">searchOption</span> == <a href="@0@mscorlib/A.html#2cb8f758d1188030" class="t t">SearchOption</a>.<a href="@0@mscorlib/A.html#db04cd5083907c24" class="i field">TopDirectoryOnly</a>);
            <a href="@0@mscorlib/A.html#c575dbe300e57438" class="t t">Contract</a>.<a href="@0@mscorlib/A.html#1f51ef07e80c9b68" class="i method">Requires</a>(<span class="r12 r">resultHandler</span> != <b>null</b>);
 
            <span class="c">// _oldMode = Interop.SetErrorMode(Interop.SEM_FAILCRITICALERRORS);</span>
            <a href="#28bf98feab6b024b" class="i field">_searchStack</a> = <b>new</b> <a href="@0@mscorlib/A.html#9e5352b2b304ceba" class="t constructor">List</a>&lt;<a href="#8eaba6458e1cc166" class="t t">SearchData</a>&gt;();
 
            <a href="@0@mscorlib/A.html#8281103e6f23cb5c" class="t t">String</a> <span id="r13 rd" class="r13 r">normalizedSearchPattern</span> = <a href="#eeb3480e6240aded" class="i method">NormalizeSearchPattern</a>(<span class="r10 r">searchPattern</span>);
 
            <b>if</b> (<span class="r13 r">normalizedSearchPattern</span>.<a href="@0@mscorlib/A.html#e13f5829ef28aa07" class="i property">Length</a> == 0)
            {
                <a href="#88365f12827903d4" class="i field">_empty</a> = <b>true</b>;
            }
            <b>else</b>
            {
                <a href="#c90ff19552f2214b" class="i field">_resultHandler</a> = <span class="r12 r">resultHandler</span>;
                <a href="#b140df088e8c365d" class="k">this</a>.<a href="#3baaa50fc77001f1" class="i field">_searchOption</a> = <span class="r11 r">searchOption</span>;
 
                <a href="#d9ccf1f123d21f9f" class="i field">_fullPath</a> = <a href="@0@mscorlib/A.html#090eca8621a248ee" class="t t">Path</a>.<a href="@0@mscorlib/A.html#1274738792cce835" class="i method">GetFullPath</a>(<span class="r8 r">path</span>);
                <a href="@0@mscorlib/A.html#8281103e6f23cb5c" class="t t">String</a> <span id="r14 rd" class="r14 r">fullSearchString</span> = <a href="#63cc81a6f6d5c7b4" class="i method">GetFullSearchString</a>(<a href="#d9ccf1f123d21f9f" class="i field">_fullPath</a>, <span class="r13 r">normalizedSearchPattern</span>);
                <a href="#17939fc0b3db52c7" class="i field">_normalizedSearchPath</a> = <a href="@0@mscorlib/A.html#090eca8621a248ee" class="t t">Path</a>.<a href="@0@mscorlib/A.html#f9128b02ffd0d3ea" class="i method">GetDirectoryName</a>(<span class="r14 r">fullSearchString</span>);
 
                <span class="c">// normalize search criteria</span>
                <a href="#a3c693352072ef01" class="i field">_searchCriteria</a> = <a href="#f49ca4192de6e170" class="i method">GetNormalizedSearchCriteria</a>(<span class="r14 r">fullSearchString</span>, <a href="#17939fc0b3db52c7" class="i field">_normalizedSearchPath</a>);
 
                <span class="c">// fix up user path</span>
                <a href="@0@mscorlib/A.html#8281103e6f23cb5c" class="t t">String</a> <span id="r15 rd" class="r15 r">searchPatternDirName</span> = <a href="@0@mscorlib/A.html#090eca8621a248ee" class="t t">Path</a>.<a href="@0@mscorlib/A.html#f9128b02ffd0d3ea" class="i method">GetDirectoryName</a>(<span class="r13 r">normalizedSearchPattern</span>);
                <a href="@0@mscorlib/A.html#8281103e6f23cb5c" class="t t">String</a> <span id="r16 rd" class="r16 r">userPathTemp</span> = <span class="r9 r">originalUserPath</span>;
                <b>if</b> (<span class="r15 r">searchPatternDirName</span> != <b>null</b> &amp;&amp; <span class="r15 r">searchPatternDirName</span>.<a href="@0@mscorlib/A.html#e13f5829ef28aa07" class="i property">Length</a> != 0)
                {
                    <span class="r16 r">userPathTemp</span> = <a href="@0@mscorlib/A.html#090eca8621a248ee" class="t t">Path</a>.<a href="@0@mscorlib/A.html#2d7263f86a526264" class="i method">Combine</a>(<span class="r16 r">userPathTemp</span>, <span class="r15 r">searchPatternDirName</span>);
                }
                <a href="#b140df088e8c365d" class="k">this</a>.<a href="#5d6de410add820b3" class="i field">_userPath</a> = <span class="r16 r">userPathTemp</span>;
 
                <a href="#b3c2ebc7ab102a44" class="i field">_searchData</a> = <b>new</b> <a href="#dfa482c62ad2a753" class="t constructor">SearchData</a>(<a href="#17939fc0b3db52c7" class="i field">_normalizedSearchPath</a>, <a href="#b140df088e8c365d" class="k">this</a>.<a href="#5d6de410add820b3" class="i field">_userPath</a>, <span class="r11 r">searchOption</span>);
 
                <a href="#bc64c61206c78d93" class="i method">CommonInit</a>();
            }
        }
 
        [<span class="i n">System</span>.<span class="i n">Security</span>.<a href="@0@mscorlib/A.html#29a3d687a50338b1" class="t constructor">SecurityCritical</a>]
        <b>private void</b> <a id="bc64c61206c78d93" href="../../../R/bc64c61206c78d93.html" target="n" data-glyph="76,1" class="i method">CommonInit</a>()
        {
            <span class="c">// Contract.Assert(_searchCriteria != null &amp;&amp; _searchData != null, &quot;searchCriteria and searchData should be initialized&quot;);</span>
            <span class="c">// Execute searchCriteria against the current directory</span>
            <span class="c">// PathHelpers.ThrowIfEmptyOrRootedPath(_searchCriteria);</span>
            <a href="@0@mscorlib/A.html#8281103e6f23cb5c" class="t t">String</a> <span id="r17 rd" class="r17 r">searchPath</span> = <a href="@0@mscorlib/A.html#090eca8621a248ee" class="t t">Path</a>.<a href="@0@mscorlib/A.html#2d7263f86a526264" class="i method">Combine</a>(<a href="#b3c2ebc7ab102a44" class="i field">_searchData</a>.<a href="#3602347d3f235859" class="i field">fullPath</a>, <a href="#a3c693352072ef01" class="i field">_searchCriteria</a>);
 
            <a href="Win32FindFile.cs.html#7631f748197d6b49" class="t t">Win32FindFile</a>.<a href="Win32FindFile.cs.html#2b1a59df44331d51" class="t t">WIN32_FIND_DATA</a> <span id="r18 rd" class="r18 r">data</span> = <b>new</b> <a href="Win32FindFile.cs.html#7631f748197d6b49" class="t t">Win32FindFile</a>.<a href="Win32FindFile.cs.html#2b1a59df44331d51" class="t constructor">WIN32_FIND_DATA</a>();
 
            <span class="c">// Open a Find handle</span>
            <a href="#e882bfe3415d175d" class="i field">_hnd</a> = <a href="Win32FindFile.cs.html#7631f748197d6b49" class="t t">Win32FindFile</a>.<a href="Win32FindFile.cs.html#4d69c314ff08f57f" class="i method">FindFirstFile</a>(<span class="r17 r">searchPath</span>, <b>ref</b> <span class="r18 r">data</span>);
 
            <b>if</b> (<a href="#a29606254a10fd8f" class="i method">IsInvalid</a>(<a href="#e882bfe3415d175d" class="i field">_hnd</a>))
            {
                <b>int</b> <span id="r19 rd" class="r19 r">errorCode</span> = <a href="@0@mscorlib/A.html#489a61c84168b119" class="t t">Marshal</a>.<a href="@0@mscorlib/A.html#271dfd5a7c6bfad5" class="i method">GetLastWin32Error</a>();
                <b>if</b> (<span class="r19 r">errorCode</span> != <a href="Win32FindFile.cs.html#7631f748197d6b49" class="t t">Win32FindFile</a>.<a href="Win32FindFile.cs.html#66b2ec0cbc5f5158" class="t t">Errors</a>.<a href="Win32FindFile.cs.html#891480ddc23d986b" class="i field">ERROR_FILE_NOT_FOUND</a> 
                    &amp;&amp; <span class="r19 r">errorCode</span> != <a href="Win32FindFile.cs.html#7631f748197d6b49" class="t t">Win32FindFile</a>.<a href="Win32FindFile.cs.html#66b2ec0cbc5f5158" class="t t">Errors</a>.<a href="Win32FindFile.cs.html#4bf3da219ae2b1a2" class="i field">ERROR_NO_MORE_FILES</a>)
                {
                    <a href="#9163cfc904c11ecd" class="i method">HandleError</a>(<span class="r19 r">errorCode</span>, <a href="#b3c2ebc7ab102a44" class="i field">_searchData</a>.<a href="#3602347d3f235859" class="i field">fullPath</a>);
                }
                <b>else</b>
                {
                    <span class="c">// flag this as empty only if we&#39;re searching just top directory</span>
                    <span class="c">// Used in fast path for top directory only</span>
                    <a href="#88365f12827903d4" class="i field">_empty</a> = <a href="#b3c2ebc7ab102a44" class="i field">_searchData</a>.<a href="#bb6aed41672ac354" class="i field">searchOption</a> == <a href="@0@mscorlib/A.html#2cb8f758d1188030" class="t t">SearchOption</a>.<a href="@0@mscorlib/A.html#db04cd5083907c24" class="i field">TopDirectoryOnly</a>;
                }
            }
            <span class="c">// fast path for TopDirectoryOnly. If we have a result, go ahead and set it to </span>
            <span class="c">// current. If empty, dispose handle.</span>
            <b>if</b> (<a href="#b3c2ebc7ab102a44" class="i field">_searchData</a>.<a href="#bb6aed41672ac354" class="i field">searchOption</a> == <a href="@0@mscorlib/A.html#2cb8f758d1188030" class="t t">SearchOption</a>.<a href="@0@mscorlib/A.html#db04cd5083907c24" class="i field">TopDirectoryOnly</a>)
            {
                <b>if</b> (<a href="#88365f12827903d4" class="i field">_empty</a>)
                {
                    <a href="#3a72c84648d2d782" class="i method">Dispose</a>(<a href="#e882bfe3415d175d" class="i field">_hnd</a>);
                }
                <b>else</b>
                {
                    <a href="#bf0edcbb12a7e5b5" class="t t">SearchResult</a> <span id="r20 rd" class="r20 r">searchResult</span> = <a href="#60fb8358af843c6c" class="i method">CreateSearchResult</a>(<a href="#b3c2ebc7ab102a44" class="i field">_searchData</a>, <span class="r18 r">data</span>);
                    <b>if</b> (<a href="#c90ff19552f2214b" class="i field">_resultHandler</a>.<a href="#967f1a27e6b419d8" class="i method">IsResultIncluded</a>(<span class="r20 r">searchResult</span>))
                    {
                        <a href="Iterator.cs.html#b863016b68e1c9fc" class="i field">current</a> = <a href="#c90ff19552f2214b" class="i field">_resultHandler</a>.<a href="#237fee9d495f14a6" class="i method">CreateObject</a>(<span class="r20 r">searchResult</span>);
                    }
                }
            }
            <span class="c">// for AllDirectories, we first recurse into dirs, so cleanup and add searchData </span>
            <span class="c">// to the stack</span>
            <b>else</b>
            {
                <a href="#3a72c84648d2d782" class="i method">Dispose</a>(<a href="#e882bfe3415d175d" class="i field">_hnd</a>);
                <a href="#28bf98feab6b024b" class="i field">_searchStack</a>.<a href="@0@mscorlib/A.html#9cc11588bffd57c1" class="i method">Add</a>(<a href="#b3c2ebc7ab102a44" class="i field">_searchData</a>);
            }
        }
 
        [<span class="i n">System</span>.<span class="i n">Security</span>.<a href="@0@mscorlib/A.html#13cf8064dae6f902" class="t constructor">SecuritySafeCritical</a>]
        <b>private</b> <a id="06445d95efaf1a23" href="../../../R/06445d95efaf1a23.html" target="n" data-glyph="76,1" class="i constructor">Win32FileSystemEnumerableIterator</a>(<a href="@0@mscorlib/A.html#8281103e6f23cb5c" class="t t">String</a> <span id="r21 rd" class="r21 r">fullPath</span>, <a href="@0@mscorlib/A.html#8281103e6f23cb5c" class="t t">String</a> <span id="r22 rd" class="r22 r">normalizedSearchPath</span>, 
            <a href="@0@mscorlib/A.html#8281103e6f23cb5c" class="t t">String</a> <span id="r23 rd" class="r23 r">searchCriteria</span>, <a href="@0@mscorlib/A.html#8281103e6f23cb5c" class="t t">String</a> <span id="r24 rd" class="r24 r">userPath</span>, <a href="@0@mscorlib/A.html#2cb8f758d1188030" class="t t">SearchOption</a> <span id="r25 rd" class="r25 r">searchOption</span>, <a href="#77ab7cfb35834836" class="t t">SearchResultHandler</a>&lt;<span class="r6 r t">TSource</span>&gt; <span id="r26 rd" class="r26 r">resultHandler</span>)
        {
            <a href="#b140df088e8c365d" class="k">this</a>.<a href="#d9ccf1f123d21f9f" class="i field">_fullPath</a> = <span class="r21 r">fullPath</span>;
            <a href="#b140df088e8c365d" class="k">this</a>.<a href="#17939fc0b3db52c7" class="i field">_normalizedSearchPath</a> = <span class="r22 r">normalizedSearchPath</span>;
            <a href="#b140df088e8c365d" class="k">this</a>.<a href="#a3c693352072ef01" class="i field">_searchCriteria</a> = <span class="r23 r">searchCriteria</span>;
            <a href="#b140df088e8c365d" class="k">this</a>.<a href="#c90ff19552f2214b" class="i field">_resultHandler</a> = <span class="r26 r">resultHandler</span>;
            <a href="#b140df088e8c365d" class="k">this</a>.<a href="#5d6de410add820b3" class="i field">_userPath</a> = <span class="r24 r">userPath</span>;
            <a href="#b140df088e8c365d" class="k">this</a>.<a href="#3baaa50fc77001f1" class="i field">_searchOption</a> = <span class="r25 r">searchOption</span>;
 
            <a href="#28bf98feab6b024b" class="i field">_searchStack</a> = <b>new</b> <a href="@0@mscorlib/A.html#9e5352b2b304ceba" class="t constructor">List</a>&lt;<a href="#8eaba6458e1cc166" class="t t">SearchData</a>&gt;();
 
            <b>if</b> (<span class="r23 r">searchCriteria</span> != <b>null</b>)
            {
                <span class="c">// PathHelpers.CheckInvalidPathChars(fullPath, true);</span>
                <a href="#b3c2ebc7ab102a44" class="i field">_searchData</a> = <b>new</b> <a href="#dfa482c62ad2a753" class="t constructor">SearchData</a>(<span class="r22 r">normalizedSearchPath</span>, <span class="r24 r">userPath</span>, <span class="r25 r">searchOption</span>);
                <a href="#bc64c61206c78d93" class="i method">CommonInit</a>();
            }
            <b>else</b>
            {
                <a href="#88365f12827903d4" class="i field">_empty</a> = <b>true</b>;
            }
        }
 
        <b>protected override</b> <a href="Iterator.cs.html#2ea95d0e58eae0c7" class="t t">Iterator</a>&lt;<span class="r6 r t">TSource</span>&gt; <a id="78ae2c7ed94910e3" href="../../../R/78ae2c7ed94910e3.html" target="n" data-glyph="75,1" class="i method">Clone</a>()
        {
            <b>return</b> <b>new</b> <a href="#06445d95efaf1a23" class="t constructor">Win32FileSystemEnumerableIterator</a>&lt;<span class="r6 r t">TSource</span>&gt;(<a href="#d9ccf1f123d21f9f" class="i field">_fullPath</a>, <a href="#17939fc0b3db52c7" class="i field">_normalizedSearchPath</a>, 
                <a href="#a3c693352072ef01" class="i field">_searchCriteria</a>, <a href="#5d6de410add820b3" class="i field">_userPath</a>, <a href="#3baaa50fc77001f1" class="i field">_searchOption</a>, <a href="#c90ff19552f2214b" class="i field">_resultHandler</a>);
        }
 
        [<span class="i n">System</span>.<span class="i n">Security</span>.<a href="@0@mscorlib/A.html#13cf8064dae6f902" class="t constructor">SecuritySafeCritical</a>]
        <b>protected override void</b> <a id="17d7e9a20f58df6a" href="../../../R/17d7e9a20f58df6a.html" target="n" data-glyph="75,1" class="i method">Dispose</a>(<b>bool</b> <span id="r27 rd" class="r27 r">disposing</span>)
        {
            <b>try</b>
            {
				<b>if</b> (<a href="#e882bfe3415d175d" class="i field">_hnd</a> != <a href="@0@mscorlib/A.html#d99bf6ad49979009" class="t t">IntPtr</a>.<a href="@0@mscorlib/A.html#d46202ed9b6005b2" class="i field">Zero</a>)
                {
                    <a href="#3a72c84648d2d782" class="i method">Dispose</a>(<a href="#e882bfe3415d175d" class="i field">_hnd</a>);
                }
            }
            <b>finally</b>
            {
                <span class="c">// Interop.SetErrorMode(_oldMode);</span>
                <a href="Iterator.cs.html#2ea95d0e58eae0c7" class="k">base</a>.<a href="Iterator.cs.html#39fd4ea59f24b49b" class="i method">Dispose</a>(<span class="r27 r">disposing</span>);
            }
        }
 
        [<span class="i n">System</span>.<span class="i n">Security</span>.<a href="@0@mscorlib/A.html#13cf8064dae6f902" class="t constructor">SecuritySafeCritical</a>]
        <b>public override bool</b> <a id="389ee0cd18be492f" href="../../../R/389ee0cd18be492f.html" target="n" data-glyph="72,1" class="i method">MoveNext</a>()
        {
            <a href="Win32FindFile.cs.html#7631f748197d6b49" class="t t">Win32FindFile</a>.<a href="Win32FindFile.cs.html#2b1a59df44331d51" class="t t">WIN32_FIND_DATA</a> <span id="r28 rd" class="r28 r">data</span> = <b>new</b> <a href="Win32FindFile.cs.html#7631f748197d6b49" class="t t">Win32FindFile</a>.<a href="Win32FindFile.cs.html#2b1a59df44331d51" class="t constructor">WIN32_FIND_DATA</a>();
            <b>switch</b> (<a href="Iterator.cs.html#60f09a7cb3ed9f14" class="i field">state</a>)
            {
                <b>case</b> <a href="#9171b1571534d4f8" class="i field">STATE_INIT</a>:
                    {
                        <b>if</b> (<a href="#88365f12827903d4" class="i field">_empty</a>)
                        {
                            <a href="Iterator.cs.html#60f09a7cb3ed9f14" class="i field">state</a> = <a href="#620f18ee0c50612f" class="i field">STATE_FINISH</a>;
                            <b>goto case</b> <a href="#620f18ee0c50612f" class="i field">STATE_FINISH</a>;
                        }
                        <b>if</b> (<a href="#b3c2ebc7ab102a44" class="i field">_searchData</a>.<a href="#bb6aed41672ac354" class="i field">searchOption</a> == <a href="@0@mscorlib/A.html#2cb8f758d1188030" class="t t">SearchOption</a>.<a href="@0@mscorlib/A.html#db04cd5083907c24" class="i field">TopDirectoryOnly</a>)
                        {
                            <a href="Iterator.cs.html#60f09a7cb3ed9f14" class="i field">state</a> = <a href="#305864c2812370b1" class="i field">STATE_FIND_NEXT_FILE</a>;
                            <b>if</b> (<a href="Iterator.cs.html#b863016b68e1c9fc" class="i field">current</a> != <b>null</b>)
                            {
                                <b>return true</b>;
                            }
                            <b>else</b>
                            {
                                <b>goto case</b> <a href="#305864c2812370b1" class="i field">STATE_FIND_NEXT_FILE</a>;
                            }
                        }
                        <b>else</b>
                        {
                            <a href="Iterator.cs.html#60f09a7cb3ed9f14" class="i field">state</a> = <a href="#6d09629f1101e952" class="i field">STATE_SEARCH_NEXT_DIR</a>;
                            <b>goto case</b> <a href="#6d09629f1101e952" class="i field">STATE_SEARCH_NEXT_DIR</a>;
                        }
                    }
                <b>case</b> <a href="#6d09629f1101e952" class="i field">STATE_SEARCH_NEXT_DIR</a>:
                    {
                        <a href="@0@mscorlib/A.html#c575dbe300e57438" class="t t">Contract</a>.<a href="@0@mscorlib/A.html#e1f5696175c73b50" class="i method">Assert</a>(<a href="#b3c2ebc7ab102a44" class="i field">_searchData</a>.<a href="#bb6aed41672ac354" class="i field">searchOption</a> != <a href="@0@mscorlib/A.html#2cb8f758d1188030" class="t t">SearchOption</a>.<a href="@0@mscorlib/A.html#db04cd5083907c24" class="i field">TopDirectoryOnly</a>, <span class="s">&quot;should not reach this code path if searchOption == TopDirectoryOnly&quot;</span>);
 
                        <span class="c">// Traverse directory structure. We need to get &#39;*&#39;</span>
                        <b>while</b> (<a href="#28bf98feab6b024b" class="i field">_searchStack</a>.<a href="@0@mscorlib/A.html#78a69d857716bc68" class="i property">Count</a> &gt; 0)
                        {
                            <a href="#b3c2ebc7ab102a44" class="i field">_searchData</a> = <a href="#28bf98feab6b024b" class="i field">_searchStack</a>[0];
                            <a href="@0@mscorlib/A.html#c575dbe300e57438" class="t t">Contract</a>.<a href="@0@mscorlib/A.html#e1f5696175c73b50" class="i method">Assert</a>((<a href="#b3c2ebc7ab102a44" class="i field">_searchData</a>.<a href="#3602347d3f235859" class="i field">fullPath</a> != <b>null</b>), <span class="s">&quot;fullpath can&#39;t be null!&quot;</span>);
                            <a href="#28bf98feab6b024b" class="i field">_searchStack</a>.<a href="@0@mscorlib/A.html#3d46113cc199059a" class="i method">RemoveAt</a>(0);
 
                            <span class="c">// Traverse the subdirs</span>
                            <a href="#6880bfa42100822b" class="i method">AddSearchableDirsToStack</a>(<a href="#b3c2ebc7ab102a44" class="i field">_searchData</a>);
 
                            <span class="c">// Execute searchCriteria against the current directory</span>
                            <a href="@0@mscorlib/A.html#8281103e6f23cb5c" class="t t">String</a> <span id="r29 rd" class="r29 r">searchPath</span> = <a href="@0@mscorlib/A.html#090eca8621a248ee" class="t t">Path</a>.<a href="@0@mscorlib/A.html#2d7263f86a526264" class="i method">Combine</a>(<a href="#b3c2ebc7ab102a44" class="i field">_searchData</a>.<a href="#3602347d3f235859" class="i field">fullPath</a>, <a href="#a3c693352072ef01" class="i field">_searchCriteria</a>);
 
                            <span class="c">// Open a Find handle</span>
                            <a href="#e882bfe3415d175d" class="i field">_hnd</a> = <a href="Win32FindFile.cs.html#7631f748197d6b49" class="t t">Win32FindFile</a>.<a href="Win32FindFile.cs.html#4d69c314ff08f57f" class="i method">FindFirstFile</a>(<span class="r29 r">searchPath</span>, <b>ref</b> <span class="r28 r">data</span>);
                            <b>if</b> (<a href="#a29606254a10fd8f" class="i method">IsInvalid</a>(<a href="#e882bfe3415d175d" class="i field">_hnd</a>))
                            {
                                <b>int</b> <span id="r30 rd" class="r30 r">errorCode</span> = <a href="@0@mscorlib/A.html#489a61c84168b119" class="t t">Marshal</a>.<a href="@0@mscorlib/A.html#271dfd5a7c6bfad5" class="i method">GetLastWin32Error</a>();
                                <b>if</b> (<span class="r30 r">errorCode</span> == <a href="Win32FindFile.cs.html#7631f748197d6b49" class="t t">Win32FindFile</a>.<a href="Win32FindFile.cs.html#66b2ec0cbc5f5158" class="t t">Errors</a>.<a href="Win32FindFile.cs.html#891480ddc23d986b" class="i field">ERROR_FILE_NOT_FOUND</a> || <span class="r30 r">errorCode</span> == <a href="Win32FindFile.cs.html#7631f748197d6b49" class="t t">Win32FindFile</a>.<a href="Win32FindFile.cs.html#66b2ec0cbc5f5158" class="t t">Errors</a>.<a href="Win32FindFile.cs.html#4bf3da219ae2b1a2" class="i field">ERROR_NO_MORE_FILES</a> || <span class="r30 r">errorCode</span> == <a href="Win32FindFile.cs.html#7631f748197d6b49" class="t t">Win32FindFile</a>.<a href="Win32FindFile.cs.html#66b2ec0cbc5f5158" class="t t">Errors</a>.<a href="Win32FindFile.cs.html#bedb9f4d837ebb86" class="i field">ERROR_PATH_NOT_FOUND</a>)
                                    <b>continue</b>;
 
                                <a href="#3a72c84648d2d782" class="i method">Dispose</a>(<a href="#e882bfe3415d175d" class="i field">_hnd</a>);
                                <a href="#9163cfc904c11ecd" class="i method">HandleError</a>(<span class="r30 r">errorCode</span>, <a href="#b3c2ebc7ab102a44" class="i field">_searchData</a>.<a href="#3602347d3f235859" class="i field">fullPath</a>);
                            }
 
                            <a href="Iterator.cs.html#60f09a7cb3ed9f14" class="i field">state</a> = <a href="#305864c2812370b1" class="i field">STATE_FIND_NEXT_FILE</a>;
 
                            <a href="#bf0edcbb12a7e5b5" class="t t">SearchResult</a> <span id="r31 rd" class="r31 r">searchResult</span> = <a href="#60fb8358af843c6c" class="i method">CreateSearchResult</a>(<a href="#b3c2ebc7ab102a44" class="i field">_searchData</a>, <span class="r28 r">data</span>);
                            <b>if</b> (<a href="#c90ff19552f2214b" class="i field">_resultHandler</a>.<a href="#967f1a27e6b419d8" class="i method">IsResultIncluded</a>(<span class="r31 r">searchResult</span>))
                            {
                                <a href="Iterator.cs.html#b863016b68e1c9fc" class="i field">current</a> = <a href="#c90ff19552f2214b" class="i field">_resultHandler</a>.<a href="#237fee9d495f14a6" class="i method">CreateObject</a>(<span class="r31 r">searchResult</span>);
                                <b>return true</b>;
                            }
                            <b>else</b>
                            {
                                <b>goto case</b> <a href="#305864c2812370b1" class="i field">STATE_FIND_NEXT_FILE</a>;
                            }
                        }
                        <a href="Iterator.cs.html#60f09a7cb3ed9f14" class="i field">state</a> = <a href="#620f18ee0c50612f" class="i field">STATE_FINISH</a>;
                        <b>goto case</b> <a href="#620f18ee0c50612f" class="i field">STATE_FINISH</a>;
                    }
                <b>case</b> <a href="#305864c2812370b1" class="i field">STATE_FIND_NEXT_FILE</a>:
                    {
					<b>if</b> (<a href="#b3c2ebc7ab102a44" class="i field">_searchData</a> != <b>null</b> &amp;&amp; <a href="#e882bfe3415d175d" class="i field">_hnd</a> != <a href="@0@mscorlib/A.html#d99bf6ad49979009" class="t t">IntPtr</a>.<a href="@0@mscorlib/A.html#d46202ed9b6005b2" class="i field">Zero</a>)
                        {
                            <span class="c">// Keep asking for more matching files/dirs, add it to the list </span>
                            <b>while</b> (<a href="Win32FindFile.cs.html#7631f748197d6b49" class="t t">Win32FindFile</a>.<a href="Win32FindFile.cs.html#3a3264cc622d7e05" class="i method">FindNextFile</a>(<a href="#e882bfe3415d175d" class="i field">_hnd</a>, <b>ref</b> <span class="r28 r">data</span>))
                            {
                                <a href="#bf0edcbb12a7e5b5" class="t t">SearchResult</a> <span id="r32 rd" class="r32 r">searchResult</span> = <a href="#60fb8358af843c6c" class="i method">CreateSearchResult</a>(<a href="#b3c2ebc7ab102a44" class="i field">_searchData</a>, <span class="r28 r">data</span>);
                                <b>if</b> (<a href="#c90ff19552f2214b" class="i field">_resultHandler</a>.<a href="#967f1a27e6b419d8" class="i method">IsResultIncluded</a>(<span class="r32 r">searchResult</span>))
                                {
                                    <a href="Iterator.cs.html#b863016b68e1c9fc" class="i field">current</a> = <a href="#c90ff19552f2214b" class="i field">_resultHandler</a>.<a href="#237fee9d495f14a6" class="i method">CreateObject</a>(<span class="r32 r">searchResult</span>);
                                    <b>return true</b>;
                                }
                            }
 
                            <span class="c">// Make sure we quit with a sensible error.</span>
                            <b>int</b> <span id="r33 rd" class="r33 r">errorCode</span> = <a href="@0@mscorlib/A.html#489a61c84168b119" class="t t">Marshal</a>.<a href="@0@mscorlib/A.html#271dfd5a7c6bfad5" class="i method">GetLastWin32Error</a>();
 
							<b>if</b> (<a href="#e882bfe3415d175d" class="i field">_hnd</a> != <a href="@0@mscorlib/A.html#d99bf6ad49979009" class="t t">IntPtr</a>.<a href="@0@mscorlib/A.html#d46202ed9b6005b2" class="i field">Zero</a>)
                                <a href="#3a72c84648d2d782" class="i method">Dispose</a>(<a href="#e882bfe3415d175d" class="i field">_hnd</a>);
 
                            <span class="c">// ERROR_FILE_NOT_FOUND is valid here because if the top level</span>
                            <span class="c">// dir doesn&#39;t contain any subdirs and matching files then </span>
                            <span class="c">// we will get here with this errorcode from the searchStack walk</span>
                            <b>if</b> ((<span class="r33 r">errorCode</span> != 0) &amp;&amp; (<span class="r33 r">errorCode</span> != <a href="Win32FindFile.cs.html#7631f748197d6b49" class="t t">Win32FindFile</a>.<a href="Win32FindFile.cs.html#66b2ec0cbc5f5158" class="t t">Errors</a>.<a href="Win32FindFile.cs.html#4bf3da219ae2b1a2" class="i field">ERROR_NO_MORE_FILES</a>)
                                &amp;&amp; (<span class="r33 r">errorCode</span> != <a href="Win32FindFile.cs.html#7631f748197d6b49" class="t t">Win32FindFile</a>.<a href="Win32FindFile.cs.html#66b2ec0cbc5f5158" class="t t">Errors</a>.<a href="Win32FindFile.cs.html#891480ddc23d986b" class="i field">ERROR_FILE_NOT_FOUND</a>))
                            {
                                <a href="#9163cfc904c11ecd" class="i method">HandleError</a>(<span class="r33 r">errorCode</span>, <a href="#b3c2ebc7ab102a44" class="i field">_searchData</a>.<a href="#3602347d3f235859" class="i field">fullPath</a>);
                            }
                        }
                        <b>if</b> (<a href="#b3c2ebc7ab102a44" class="i field">_searchData</a>.<a href="#bb6aed41672ac354" class="i field">searchOption</a> == <a href="@0@mscorlib/A.html#2cb8f758d1188030" class="t t">SearchOption</a>.<a href="@0@mscorlib/A.html#db04cd5083907c24" class="i field">TopDirectoryOnly</a>)
                        {
                            <a href="Iterator.cs.html#60f09a7cb3ed9f14" class="i field">state</a> = <a href="#620f18ee0c50612f" class="i field">STATE_FINISH</a>;
                            <b>goto case</b> <a href="#620f18ee0c50612f" class="i field">STATE_FINISH</a>;
                        }
                        <b>else</b>
                        {
                            <a href="Iterator.cs.html#60f09a7cb3ed9f14" class="i field">state</a> = <a href="#6d09629f1101e952" class="i field">STATE_SEARCH_NEXT_DIR</a>;
                            <b>goto case</b> <a href="#6d09629f1101e952" class="i field">STATE_SEARCH_NEXT_DIR</a>;
                        }
                    }
                <b>case</b> <a href="#620f18ee0c50612f" class="i field">STATE_FINISH</a>:
                    {
                        <a href="Iterator.cs.html#ab89fedf2082ee78" class="i method">Dispose</a>();
                        <b>break</b>;
                    }
            }
            <b>return false</b>;
        }
 
        [<span class="i n">System</span>.<span class="i n">Security</span>.<a href="@0@mscorlib/A.html#29a3d687a50338b1" class="t constructor">SecurityCritical</a>]
        <b>private</b> <a href="#bf0edcbb12a7e5b5" class="t t">SearchResult</a> <a id="60fb8358af843c6c" href="../../../R/60fb8358af843c6c.html" target="n" data-glyph="76,1" class="i method">CreateSearchResult</a>(<a href="#8eaba6458e1cc166" class="t t">SearchData</a> <span id="r34 rd" class="r34 r">localSearchData</span>, <a href="Win32FindFile.cs.html#7631f748197d6b49" class="t t">Win32FindFile</a>.<a href="Win32FindFile.cs.html#2b1a59df44331d51" class="t t">WIN32_FIND_DATA</a> <span id="r35 rd" class="r35 r">findData</span>)
        {
            <b>string</b> <span id="r36 rd" class="r36 r">findData_fileName</span> = <span class="r35 r">findData</span>.<a href="Win32FindFile.cs.html#dc8550e08c5b3e16" class="i field">cFileName</a>;
            <a href="@0@mscorlib/A.html#c575dbe300e57438" class="t t">Contract</a>.<a href="@0@mscorlib/A.html#ed8c78e4783a0eaf" class="i method">Requires</a>(<span class="r36 r">findData_fileName</span>.<a href="@0@mscorlib/A.html#e13f5829ef28aa07" class="i property">Length</a> != 0 &amp;&amp; !<a href="@0@mscorlib/A.html#090eca8621a248ee" class="t t">Path</a>.<a href="@0@mscorlib/A.html#807960f08fca497d" class="i method">IsPathRooted</a>(<span class="r36 r">findData_fileName</span>),
                <span class="s">&quot;Expected file system enumeration to not have empty file/directory name and not have rooted name&quot;</span>);
 
            <a href="@0@mscorlib/A.html#8281103e6f23cb5c" class="t t">String</a> <span id="r37 rd" class="r37 r">userPathFinal</span> = <a href="@0@mscorlib/A.html#090eca8621a248ee" class="t t">Path</a>.<a href="@0@mscorlib/A.html#2d7263f86a526264" class="i method">Combine</a>(<span class="r34 r">localSearchData</span>.<a href="#5a88cc05a056cb62" class="i field">userPath</a> ?? <span class="s">&quot;&quot;</span>, <span class="r36 r">findData_fileName</span>);
            <a href="@0@mscorlib/A.html#8281103e6f23cb5c" class="t t">String</a> <span id="r38 rd" class="r38 r">fullPathFinal</span> = <a href="@0@mscorlib/A.html#090eca8621a248ee" class="t t">Path</a>.<a href="@0@mscorlib/A.html#2d7263f86a526264" class="i method">Combine</a>(<span class="r34 r">localSearchData</span>.<a href="#3602347d3f235859" class="i field">fullPath</a>, <span class="r36 r">findData_fileName</span>);
            <b>return</b> <b>new</b> <a href="#4fbda159e441f752" class="t constructor">SearchResult</a>(<span class="r38 r">fullPathFinal</span>, <span class="r37 r">userPathFinal</span>, <span class="r35 r">findData</span>);
        }
 
        <span class="k preprocess">#</span><span class="k preprocess">region</span> Handle errors
 
        [<span class="i n">System</span>.<span class="i n">Security</span>.<a href="@0@mscorlib/A.html#29a3d687a50338b1" class="t constructor">SecurityCritical</a>]
        <b>private void</b> <a id="9163cfc904c11ecd" href="../../../R/9163cfc904c11ecd.html" target="n" data-glyph="76,1" class="i method">HandleError</a>(<b>int</b> <span id="r39 rd" class="r39 r">errorCode</span>, <a href="@0@mscorlib/A.html#8281103e6f23cb5c" class="t t">String</a> <span id="r40 rd" class="r40 r">path</span>)
        {
            <a href="Iterator.cs.html#ab89fedf2082ee78" class="i method">Dispose</a>();
            <b>throw</b> <a href="#0220ed82904bad2e" class="i method">GetExceptionForWin32Error</a>(<span class="r39 r">errorCode</span>, <span class="r40 r">path</span>);
        }
 
        <b>public bool</b> <a id="a29606254a10fd8f" href="../../../R/a29606254a10fd8f.html" target="n" data-glyph="72,1" class="i method">IsInvalid</a>(<a href="@0@mscorlib/A.html#d99bf6ad49979009" class="t t">SafeFindHandle</a> <span id="r41 rd" class="r41 r">handle</span>)
        {
            <b>return</b> <span class="r41 r">handle</span> == <a href="@0@mscorlib/A.html#d99bf6ad49979009" class="t t">IntPtr</a>.<a href="@0@mscorlib/A.html#d46202ed9b6005b2" class="i field">Zero</a>;
        }
 
        [<span class="i n">System</span>.<span class="i n">Security</span>.<a href="@0@mscorlib/A.html#29a3d687a50338b1" class="t constructor">SecurityCritical</a>]  <span class="c">// auto-generated</span>
        <b>private void</b> <a id="6880bfa42100822b" href="../../../R/6880bfa42100822b.html" target="n" data-glyph="76,1" class="i method">AddSearchableDirsToStack</a>(<a href="#8eaba6458e1cc166" class="t t">SearchData</a> <span id="r42 rd" class="r42 r">localSearchData</span>)
        {
            <a href="@0@mscorlib/A.html#c575dbe300e57438" class="t t">Contract</a>.<a href="@0@mscorlib/A.html#1f51ef07e80c9b68" class="i method">Requires</a>(<span class="r42 r">localSearchData</span> != <b>null</b>);
 
            <a href="@0@mscorlib/A.html#8281103e6f23cb5c" class="t t">String</a> <span id="r43 rd" class="r43 r">searchPath</span> = <a href="@0@mscorlib/A.html#090eca8621a248ee" class="t t">Path</a>.<a href="@0@mscorlib/A.html#2d7263f86a526264" class="i method">Combine</a>(<span class="r42 r">localSearchData</span>.<a href="#3602347d3f235859" class="i field">fullPath</a>, <span class="s">&quot;*&quot;</span>);
            <a href="@0@mscorlib/A.html#d99bf6ad49979009" class="t t">SafeFindHandle</a> <span id="r44 rd" class="r44 r">hnd</span> = <a href="@0@mscorlib/A.html#d99bf6ad49979009" class="t t">SafeFindHandle</a>.<a href="@0@mscorlib/A.html#d46202ed9b6005b2" class="i field">Zero</a>; <span class="c">// null;</span>
            <a href="Win32FindFile.cs.html#7631f748197d6b49" class="t t">Win32FindFile</a>.<a href="Win32FindFile.cs.html#2b1a59df44331d51" class="t t">WIN32_FIND_DATA</a> <span id="r45 rd" class="r45 r">data</span> = <b>new</b> <a href="Win32FindFile.cs.html#7631f748197d6b49" class="t t">Win32FindFile</a>.<a href="Win32FindFile.cs.html#2b1a59df44331d51" class="t constructor">WIN32_FIND_DATA</a>();
            <b>try</b>
            {
                <span class="c">// Get all files and dirs</span>
                <span class="r44 r">hnd</span> = <a href="Win32FindFile.cs.html#7631f748197d6b49" class="t t">Win32FindFile</a>.<a href="Win32FindFile.cs.html#4d69c314ff08f57f" class="i method">FindFirstFile</a>(<span class="r43 r">searchPath</span>, <b>ref</b> <span class="r45 r">data</span>);
 
                <b>if</b> (<a href="#a29606254a10fd8f" class="i method">IsInvalid</a>(<span class="r44 r">hnd</span>))
                {
                    <b>int</b> <span id="r46 rd" class="r46 r">errorCode</span> = <a href="@0@mscorlib/A.html#489a61c84168b119" class="t t">Marshal</a>.<a href="@0@mscorlib/A.html#271dfd5a7c6bfad5" class="i method">GetLastWin32Error</a>();
 
                    <span class="c">// This could happen if the dir doesn&#39;t contain any files.</span>
                    <span class="c">// Continue with the recursive search though, eventually</span>
                    <span class="c">// searchStack will become empty</span>
                    <b>if</b> (<span class="r46 r">errorCode</span> == <a href="Win32FindFile.cs.html#7631f748197d6b49" class="t t">Win32FindFile</a>.<a href="Win32FindFile.cs.html#66b2ec0cbc5f5158" class="t t">Errors</a>.<a href="Win32FindFile.cs.html#891480ddc23d986b" class="i field">ERROR_FILE_NOT_FOUND</a> || <span class="r46 r">errorCode</span> == <a href="Win32FindFile.cs.html#7631f748197d6b49" class="t t">Win32FindFile</a>.<a href="Win32FindFile.cs.html#66b2ec0cbc5f5158" class="t t">Errors</a>.<a href="Win32FindFile.cs.html#4bf3da219ae2b1a2" class="i field">ERROR_NO_MORE_FILES</a> || <span class="r46 r">errorCode</span> == <a href="Win32FindFile.cs.html#7631f748197d6b49" class="t t">Win32FindFile</a>.<a href="Win32FindFile.cs.html#66b2ec0cbc5f5158" class="t t">Errors</a>.<a href="Win32FindFile.cs.html#bedb9f4d837ebb86" class="i field">ERROR_PATH_NOT_FOUND</a>)
                        <b>return</b>;
 
                    <a href="#9163cfc904c11ecd" class="i method">HandleError</a>(<span class="r46 r">errorCode</span>, <span class="r42 r">localSearchData</span>.<a href="#3602347d3f235859" class="i field">fullPath</a>);
                }
 
                <span class="c">// Add subdirs to searchStack. Exempt ReparsePoints as appropriate</span>
                <b>int</b> <span id="r47 rd" class="r47 r">incr</span> = 0;
                <b>do</b>
                {
                    <b>if</b> (<a href="#50d44777a3acfe41" class="t t">Win32FileSystemEnumerableHelpers</a>.<a href="#b275fed349c9c9dd" class="i method">IsDir</a>(<span class="r45 r">data</span>))
                    {
                        <a href="@0@mscorlib/A.html#c575dbe300e57438" class="t t">Contract</a>.<a href="@0@mscorlib/A.html#e1f5696175c73b50" class="i method">Assert</a>(<span class="r45 r">data</span>.<a href="Win32FindFile.cs.html#dc8550e08c5b3e16" class="i field">cFileName</a>.<a href="@0@mscorlib/A.html#e13f5829ef28aa07" class="i property">Length</a> != 0 &amp;&amp; !<a href="@0@mscorlib/A.html#090eca8621a248ee" class="t t">Path</a>.<a href="@0@mscorlib/A.html#807960f08fca497d" class="i method">IsPathRooted</a>(<span class="r45 r">data</span>.<a href="Win32FindFile.cs.html#dc8550e08c5b3e16" class="i field">cFileName</a>),
                            <span class="s">&quot;Expected file system enumeration to not have empty file/directory name and not have rooted name&quot;</span>);
 
                        <a href="@0@mscorlib/A.html#8281103e6f23cb5c" class="t t">String</a> <span id="r48 rd" class="r48 r">tempFullPath</span> = <a href="@0@mscorlib/A.html#090eca8621a248ee" class="t t">Path</a>.<a href="@0@mscorlib/A.html#2d7263f86a526264" class="i method">Combine</a>(<span class="r42 r">localSearchData</span>.<a href="#3602347d3f235859" class="i field">fullPath</a>, <span class="r45 r">data</span>.<a href="Win32FindFile.cs.html#dc8550e08c5b3e16" class="i field">cFileName</a>);
                        <a href="@0@mscorlib/A.html#8281103e6f23cb5c" class="t t">String</a> <span id="r49 rd" class="r49 r">tempUserPath</span> = <a href="@0@mscorlib/A.html#090eca8621a248ee" class="t t">Path</a>.<a href="@0@mscorlib/A.html#2d7263f86a526264" class="i method">Combine</a>(<span class="r42 r">localSearchData</span>.<a href="#5a88cc05a056cb62" class="i field">userPath</a>, <span class="r45 r">data</span>.<a href="Win32FindFile.cs.html#dc8550e08c5b3e16" class="i field">cFileName</a>);
 
                        <a href="@0@mscorlib/A.html#2cb8f758d1188030" class="t t">SearchOption</a> <span id="r50 rd" class="r50 r">option</span> = <span class="r42 r">localSearchData</span>.<a href="#bb6aed41672ac354" class="i field">searchOption</a>;
 
                        <span class="c">// Setup search data for the sub directory and push it into the stack</span>
                        <a href="#8eaba6458e1cc166" class="t t">SearchData</a> <span id="r51 rd" class="r51 r">searchDataSubDir</span> = <b>new</b> <a href="#dfa482c62ad2a753" class="t constructor">SearchData</a>(<span class="r48 r">tempFullPath</span>, <span class="r49 r">tempUserPath</span>, <span class="r50 r">option</span>);
 
                        <a href="#28bf98feab6b024b" class="i field">_searchStack</a>.<a href="@0@mscorlib/A.html#49c519bce0cdbd82" class="i method">Insert</a>(<span class="r47 r">incr</span>++, <span class="r51 r">searchDataSubDir</span>);
                    }
                } <b>while</b> (<a href="Win32FindFile.cs.html#7631f748197d6b49" class="t t">Win32FindFile</a>.<a href="Win32FindFile.cs.html#3a3264cc622d7e05" class="i method">FindNextFile</a>(<span class="r44 r">hnd</span>, <b>ref</b> <span class="r45 r">data</span>));
                <span class="c">// We don&#39;t care about errors here</span>
            }
            <b>finally</b>
            {
				<b>if</b> (<span class="r44 r">hnd</span> != <a href="@0@mscorlib/A.html#d99bf6ad49979009" class="t t">IntPtr</a>.<a href="@0@mscorlib/A.html#d46202ed9b6005b2" class="i field">Zero</a>)
                    <a href="#3a72c84648d2d782" class="i method">Dispose</a>(<span class="r44 r">hnd</span>);
            }
        }
 
        <b>private static</b> <a href="@0@mscorlib/A.html#8281103e6f23cb5c" class="t t">String</a> <a id="eeb3480e6240aded" href="../../../R/eeb3480e6240aded.html" target="n" data-glyph="76,1" class="i method">NormalizeSearchPattern</a>(<a href="@0@mscorlib/A.html#8281103e6f23cb5c" class="t t">String</a> <span id="r52 rd" class="r52 r">searchPattern</span>)
        {
            <a href="@0@mscorlib/A.html#c575dbe300e57438" class="t t">Contract</a>.<a href="@0@mscorlib/A.html#1f51ef07e80c9b68" class="i method">Requires</a>(<span class="r52 r">searchPattern</span> != <b>null</b>);
 
            <span class="c">// Win32 normalization trims only U+0020. </span>
            <a href="@0@mscorlib/A.html#8281103e6f23cb5c" class="t t">String</a> <span id="r53 rd" class="r53 r">tempSearchPattern</span> = <span class="r52 r">searchPattern</span>.<a href="@0@mscorlib/A.html#fc988fb267590f98" class="i method">TrimEnd</a>(<a href="PathHelpers.cs.html#6be975bde3644b50" class="t t">PathHelpers</a>.<a href="PathHelpers.cs.html#0035eac6138381b4" class="i field">TrimEndChars</a>);
 
            <span class="c">// Make this corner case more useful, like dir</span>
            <b>if</b> (<span class="r53 r">tempSearchPattern</span>.<a href="@0@mscorlib/A.html#31b307b02a3bd6b9" class="i method">Equals</a>(<span class="s">&quot;.&quot;</span>))
            {
                <span class="r53 r">tempSearchPattern</span> = <span class="s">&quot;*&quot;</span>;
            }
 
            <span class="c">// PathHelpers.CheckSearchPattern(tempSearchPattern);</span>
            <b>return</b> <span class="r53 r">tempSearchPattern</span>;
        }
 
        <b>private static</b> <a href="@0@mscorlib/A.html#8281103e6f23cb5c" class="t t">String</a> <a id="f49ca4192de6e170" href="../../../R/f49ca4192de6e170.html" target="n" data-glyph="76,1" class="i method">GetNormalizedSearchCriteria</a>(<a href="@0@mscorlib/A.html#8281103e6f23cb5c" class="t t">String</a> <span id="r54 rd" class="r54 r">fullSearchString</span>, <a href="@0@mscorlib/A.html#8281103e6f23cb5c" class="t t">String</a> <span id="r55 rd" class="r55 r">fullPathMod</span>)
        {
            <a href="@0@mscorlib/A.html#c575dbe300e57438" class="t t">Contract</a>.<a href="@0@mscorlib/A.html#1f51ef07e80c9b68" class="i method">Requires</a>(<span class="r54 r">fullSearchString</span> != <b>null</b>);
            <a href="@0@mscorlib/A.html#c575dbe300e57438" class="t t">Contract</a>.<a href="@0@mscorlib/A.html#1f51ef07e80c9b68" class="i method">Requires</a>(<span class="r55 r">fullPathMod</span> != <b>null</b>);
            <a href="@0@mscorlib/A.html#c575dbe300e57438" class="t t">Contract</a>.<a href="@0@mscorlib/A.html#1f51ef07e80c9b68" class="i method">Requires</a>(<span class="r54 r">fullSearchString</span>.<a href="@0@mscorlib/A.html#e13f5829ef28aa07" class="i property">Length</a> &gt;= <span class="r55 r">fullPathMod</span>.<a href="@0@mscorlib/A.html#e13f5829ef28aa07" class="i property">Length</a>);
 
            <a href="@0@mscorlib/A.html#8281103e6f23cb5c" class="t t">String</a> <span id="r56 rd" class="r56 r">searchCriteria</span> = <b>null</b>;
            <b>char</b> <span id="r57 rd" class="r57 r">lastChar</span> = <span class="r55 r">fullPathMod</span><a href="@0@mscorlib/A.html#8307d03426b56fe1">[</a><span class="r55 r">fullPathMod</span>.<a href="@0@mscorlib/A.html#e13f5829ef28aa07" class="i property">Length</a> - 1];
            <b>if</b> (<a href="PathHelpers.cs.html#6be975bde3644b50" class="t t">PathHelpers</a>.<a href="PathHelpers.cs.html#f598b6f378b21ea8" class="i method">IsDirectorySeparator</a>(<span class="r57 r">lastChar</span>))
            {
                <span class="c">// Can happen if the path is C:\temp, in which case GetDirectoryName would return C:\</span>
                <span class="r56 r">searchCriteria</span> = <span class="r54 r">fullSearchString</span>.<a href="@0@mscorlib/A.html#882fa7998d6ca35a" class="i method">Substring</a>(<span class="r55 r">fullPathMod</span>.<a href="@0@mscorlib/A.html#e13f5829ef28aa07" class="i property">Length</a>);
            }
            <b>else</b>
            {
                <a href="@0@mscorlib/A.html#c575dbe300e57438" class="t t">Contract</a>.<a href="@0@mscorlib/A.html#e87e73b73368f052" class="i method">Assert</a>(<span class="r54 r">fullSearchString</span>.<a href="@0@mscorlib/A.html#e13f5829ef28aa07" class="i property">Length</a> &gt; <span class="r55 r">fullPathMod</span>.<a href="@0@mscorlib/A.html#e13f5829ef28aa07" class="i property">Length</a>);
                <span class="r56 r">searchCriteria</span> = <span class="r54 r">fullSearchString</span>.<a href="@0@mscorlib/A.html#882fa7998d6ca35a" class="i method">Substring</a>(<span class="r55 r">fullPathMod</span>.<a href="@0@mscorlib/A.html#e13f5829ef28aa07" class="i property">Length</a> + 1);
            }
            <b>return</b> <span class="r56 r">searchCriteria</span>;
        }
 
        <b>private static</b> <a href="@0@mscorlib/A.html#8281103e6f23cb5c" class="t t">String</a> <a id="63cc81a6f6d5c7b4" href="../../../R/63cc81a6f6d5c7b4.html" target="n" data-glyph="76,1" class="i method">GetFullSearchString</a>(<a href="@0@mscorlib/A.html#8281103e6f23cb5c" class="t t">String</a> <span id="r58 rd" class="r58 r">fullPath</span>, <a href="@0@mscorlib/A.html#8281103e6f23cb5c" class="t t">String</a> <span id="r59 rd" class="r59 r">searchPattern</span>)
        {
            <a href="@0@mscorlib/A.html#c575dbe300e57438" class="t t">Contract</a>.<a href="@0@mscorlib/A.html#1f51ef07e80c9b68" class="i method">Requires</a>(<span class="r58 r">fullPath</span> != <b>null</b>);
            <a href="@0@mscorlib/A.html#c575dbe300e57438" class="t t">Contract</a>.<a href="@0@mscorlib/A.html#1f51ef07e80c9b68" class="i method">Requires</a>(<span class="r59 r">searchPattern</span> != <b>null</b>);
 
            <a href="PathHelpers.cs.html#6be975bde3644b50" class="t t">PathHelpers</a>.<a href="PathHelpers.cs.html#cc74a1ca62f30dd7" class="i method">ThrowIfEmptyOrRootedPath</a>(<span class="r59 r">searchPattern</span>);
            <a href="@0@mscorlib/A.html#8281103e6f23cb5c" class="t t">String</a> <span id="r60 rd" class="r60 r">tempStr</span> = <a href="@0@mscorlib/A.html#090eca8621a248ee" class="t t">Path</a>.<a href="@0@mscorlib/A.html#2d7263f86a526264" class="i method">Combine</a>(<span class="r58 r">fullPath</span>, <span class="r59 r">searchPattern</span>);
 
            <span class="c">// If path ends in a trailing slash (\), append a * or we&#39;ll get a &quot;Cannot find the file specified&quot; exception</span>
            <b>char</b> <span id="r61 rd" class="r61 r">lastChar</span> = <span class="r60 r">tempStr</span><a href="@0@mscorlib/A.html#8307d03426b56fe1">[</a><span class="r60 r">tempStr</span>.<a href="@0@mscorlib/A.html#e13f5829ef28aa07" class="i property">Length</a> - 1];
            <b>if</b> (<a href="PathHelpers.cs.html#6be975bde3644b50" class="t t">PathHelpers</a>.<a href="PathHelpers.cs.html#f598b6f378b21ea8" class="i method">IsDirectorySeparator</a>(<span class="r61 r">lastChar</span>) || <span class="r61 r">lastChar</span> == <a href="@0@mscorlib/A.html#090eca8621a248ee" class="t t">Path</a>.<a href="@0@mscorlib/A.html#09d4ae1717c5b2cc" class="i field">VolumeSeparatorChar</a>)
            {
                <span class="r60 r">tempStr</span> = <span class="r60 r">tempStr</span> + <span class="s">&quot;*&quot;</span>;
            }
 
            <b>return</b> <span class="r60 r">tempStr</span>;
        }
 
        <b>internal static</b> <a href="@0@mscorlib/A.html#f092fb2b893a0162" class="t t">Exception</a> <a id="0220ed82904bad2e" href="../../../R/0220ed82904bad2e.html" target="n" data-glyph="74,1" class="i method">GetExceptionForWin32Error</a>(<b>int</b> <span id="r62 rd" class="r62 r">errorCode</span>, <b>string</b> <span id="r63 rd" class="r63 r">path</span>)
        {
            <b>switch</b> (<span class="r62 r">errorCode</span>)
            {
                <b>case</b> <a href="Win32FindFile.cs.html#7631f748197d6b49" class="t t">Win32FindFile</a>.<a href="Win32FindFile.cs.html#66b2ec0cbc5f5158" class="t t">Errors</a>.<a href="Win32FindFile.cs.html#891480ddc23d986b" class="i field">ERROR_FILE_NOT_FOUND</a>:
                    <b>if</b> (<span class="r63 r">path</span>.<a href="@0@mscorlib/A.html#e13f5829ef28aa07" class="i property">Length</a> == 0)
                        <b>return</b> <b>new</b> <a href="@0@mscorlib/A.html#15a723847ffcc0c8" class="t constructor">FileNotFoundException</a>(<span class="s">&quot;FileNotFound&quot;</span>);
                    <b>else
                        return</b> <b>new</b> <a href="@0@mscorlib/A.html#e49034af96bf20b2" class="t constructor">FileNotFoundException</a>(<a href="@0@mscorlib/A.html#8281103e6f23cb5c" class="t t">String</a>.<a href="@0@mscorlib/A.html#9d5604d4425b216f" class="i method">Format</a>(<span class="s">&quot;FileNotFound %1&quot;</span>, <span class="r63 r">path</span>), <span class="r63 r">path</span>);
 
                <b>case</b> <a href="Win32FindFile.cs.html#7631f748197d6b49" class="t t">Win32FindFile</a>.<a href="Win32FindFile.cs.html#66b2ec0cbc5f5158" class="t t">Errors</a>.<a href="Win32FindFile.cs.html#bedb9f4d837ebb86" class="i field">ERROR_PATH_NOT_FOUND</a>:
                    <b>if</b> (<span class="r63 r">path</span>.<a href="@0@mscorlib/A.html#e13f5829ef28aa07" class="i property">Length</a> == 0)
                        <b>return</b> <b>new</b> <a href="@0@mscorlib/A.html#8593c71a1cc2ada9" class="t constructor">DirectoryNotFoundException</a>(<span class="s">&quot;PathNotFound_NoPathName&quot;</span>);
                    <b>else
                        return</b> <b>new</b> <a href="@0@mscorlib/A.html#8593c71a1cc2ada9" class="t constructor">DirectoryNotFoundException</a>(<a href="@0@mscorlib/A.html#8281103e6f23cb5c" class="t t">String</a>.<a href="@0@mscorlib/A.html#9d5604d4425b216f" class="i method">Format</a>(<span class="s">&quot;PathNotFound %1&quot;</span>, <span class="r63 r">path</span>));
 
                <b>case</b> <a href="Win32FindFile.cs.html#7631f748197d6b49" class="t t">Win32FindFile</a>.<a href="Win32FindFile.cs.html#66b2ec0cbc5f5158" class="t t">Errors</a>.<a href="Win32FindFile.cs.html#0c70f9101cb6457b" class="i field">ERROR_ACCESS_DENIED</a>:
                    <b>if</b> (<span class="r63 r">path</span>.<a href="@0@mscorlib/A.html#e13f5829ef28aa07" class="i property">Length</a> == 0)
                        <b>return</b> <b>new</b> <a href="@0@mscorlib/A.html#dd67e4fce0a46265" class="t constructor">UnauthorizedAccessException</a>(<span class="s">&quot;UnauthorizedAccess_IODenied_NoPathName&quot;</span>);
                    <b>else
                        return</b> <b>new</b> <a href="@0@mscorlib/A.html#dd67e4fce0a46265" class="t constructor">UnauthorizedAccessException</a>(<a href="@0@mscorlib/A.html#8281103e6f23cb5c" class="t t">String</a>.<a href="@0@mscorlib/A.html#9d5604d4425b216f" class="i method">Format</a>(<span class="s">&quot;UnauthorizedAccess_IODenied %1&quot;</span>, <span class="r63 r">path</span>));
 
                <b>case</b> <a href="Win32FindFile.cs.html#7631f748197d6b49" class="t t">Win32FindFile</a>.<a href="Win32FindFile.cs.html#66b2ec0cbc5f5158" class="t t">Errors</a>.<a href="Win32FindFile.cs.html#5fc5cdffbfb0301d" class="i field">ERROR_ALREADY_EXISTS</a>:
                    <b>if</b> (<span class="r63 r">path</span>.<a href="@0@mscorlib/A.html#e13f5829ef28aa07" class="i property">Length</a> == 0)
                        <b>goto default</b>;
 
                    <b>return</b> <b>new</b> <a href="@0@mscorlib/A.html#7269b8856f594752" class="t constructor">IOException</a>(<a href="@0@mscorlib/A.html#8281103e6f23cb5c" class="t t">String</a>.<a href="@0@mscorlib/A.html#9d5604d4425b216f" class="i method">Format</a>(<span class="s">&quot;AlreadyExists %1&quot;</span>, <span class="r63 r">path</span>), <a href="#156aa9d26f008dbb" class="i method">MakeHRFromErrorCode</a>(<span class="r62 r">errorCode</span>));
 
                <b>case</b> <a href="Win32FindFile.cs.html#7631f748197d6b49" class="t t">Win32FindFile</a>.<a href="Win32FindFile.cs.html#66b2ec0cbc5f5158" class="t t">Errors</a>.<a href="Win32FindFile.cs.html#d951380aa24f8cc8" class="i field">ERROR_FILENAME_EXCED_RANGE</a>:
                    <b>return</b> <b>new</b> <a href="@0@mscorlib/A.html#ab28a4423d25eed2" class="t constructor">PathTooLongException</a>(<span class="s">&quot;PathTooLong&quot;</span>);
 
                <b>case</b> <a href="Win32FindFile.cs.html#7631f748197d6b49" class="t t">Win32FindFile</a>.<a href="Win32FindFile.cs.html#66b2ec0cbc5f5158" class="t t">Errors</a>.<a href="Win32FindFile.cs.html#e8f435a0bd53087b" class="i field">ERROR_INVALID_PARAMETER</a>:
                    <b>return</b> <b>new</b> <a href="@0@mscorlib/A.html#7269b8856f594752" class="t constructor">IOException</a>(<a href="#44f53489264ff048" class="i method">GetMessage</a>(<span class="r62 r">errorCode</span>), <a href="#156aa9d26f008dbb" class="i method">MakeHRFromErrorCode</a>(<span class="r62 r">errorCode</span>));
 
                <b>case</b> <a href="Win32FindFile.cs.html#7631f748197d6b49" class="t t">Win32FindFile</a>.<a href="Win32FindFile.cs.html#66b2ec0cbc5f5158" class="t t">Errors</a>.<a href="Win32FindFile.cs.html#f08a00df65a78dd2" class="i field">ERROR_SHARING_VIOLATION</a>:
                    <b>if</b> (<span class="r63 r">path</span>.<a href="@0@mscorlib/A.html#e13f5829ef28aa07" class="i property">Length</a> == 0)
                        <b>return</b> <b>new</b> <a href="@0@mscorlib/A.html#7269b8856f594752" class="t constructor">IOException</a>(<span class="s">&quot;SharingViolation_NoFileName&quot;</span>, <a href="#156aa9d26f008dbb" class="i method">MakeHRFromErrorCode</a>(<span class="r62 r">errorCode</span>));
                    <b>else
                        return</b> <b>new</b> <a href="@0@mscorlib/A.html#7269b8856f594752" class="t constructor">IOException</a>(<a href="@0@mscorlib/A.html#8281103e6f23cb5c" class="t t">String</a>.<a href="@0@mscorlib/A.html#9d5604d4425b216f" class="i method">Format</a>(<span class="s">&quot;SharingViolation %1&quot;</span>, <span class="r63 r">path</span>), <a href="#156aa9d26f008dbb" class="i method">MakeHRFromErrorCode</a>(<span class="r62 r">errorCode</span>));
 
                <b>case</b> <a href="Win32FindFile.cs.html#7631f748197d6b49" class="t t">Win32FindFile</a>.<a href="Win32FindFile.cs.html#66b2ec0cbc5f5158" class="t t">Errors</a>.<a href="Win32FindFile.cs.html#86e8da6135d4fe9d" class="i field">ERROR_FILE_EXISTS</a>:
                    <b>if</b> (<span class="r63 r">path</span>.<a href="@0@mscorlib/A.html#e13f5829ef28aa07" class="i property">Length</a> == 0)
                        <b>goto default</b>;
 
                    <b>return</b> <b>new</b> <a href="@0@mscorlib/A.html#7269b8856f594752" class="t constructor">IOException</a>(<a href="@0@mscorlib/A.html#8281103e6f23cb5c" class="t t">String</a>.<a href="@0@mscorlib/A.html#9d5604d4425b216f" class="i method">Format</a>(<span class="s">&quot;FileExists %1&quot;</span>, <span class="r63 r">path</span>), <a href="#156aa9d26f008dbb" class="i method">MakeHRFromErrorCode</a>(<span class="r62 r">errorCode</span>));
 
                <b>case</b> <a href="Win32FindFile.cs.html#7631f748197d6b49" class="t t">Win32FindFile</a>.<a href="Win32FindFile.cs.html#66b2ec0cbc5f5158" class="t t">Errors</a>.<a href="Win32FindFile.cs.html#cc8fb5b71dfb8bd0" class="i field">ERROR_OPERATION_ABORTED</a>:
                    <b>return</b> <b>new</b> <a href="@0@mscorlib/A.html#1697b6f5143e8f94" class="t constructor">OperationCanceledException</a>();
 
                <b>default</b>:
                    <b>return</b> <b>new</b> <a href="@0@mscorlib/A.html#7269b8856f594752" class="t constructor">IOException</a>(<a href="#44f53489264ff048" class="i method">GetMessage</a>(<span class="r62 r">errorCode</span>), <a href="#156aa9d26f008dbb" class="i method">MakeHRFromErrorCode</a>(<span class="r62 r">errorCode</span>));
            }
        }
 
        <b>internal static string</b> <a id="44f53489264ff048" href="../../../R/44f53489264ff048.html" target="n" data-glyph="74,1" class="i method">GetMessage</a>(<b>int</b> <span id="r64 rd" class="r64 r">errorCode</span>)
        {
            <span class="c">//  return Interop.mincore.GetMessage(errorCode);</span>
            <b>return</b> <span class="s">&quot;Erorr code &quot;</span> + <span class="r64 r">errorCode</span>.<a href="@0@mscorlib/A.html#8d6f2d8bc0589463" class="i method">ToString</a>();
        }
 
        <b>internal static int</b> <a id="156aa9d26f008dbb" href="../../../R/156aa9d26f008dbb.html" target="n" data-glyph="74,1" class="i method">MakeHRFromErrorCode</a>(<b>int</b> <span id="r65 rd" class="r65 r">errorCode</span>)
        {
            <a href="@0@mscorlib/A.html#c575dbe300e57438" class="t t">Contract</a>.<a href="@0@mscorlib/A.html#e1f5696175c73b50" class="i method">Assert</a>((0xFFFF0000 &amp; <span class="r65 r">errorCode</span>) == 0, <span class="s">&quot;This is an HRESULT, not an error code!&quot;</span>);
            <b>return unchecked</b>(((<b>int</b>)0x80070000) | <span class="r65 r">errorCode</span>);
        }
 
        <span class="k preprocess">#</span><span class="k preprocess">endregion</span>
    }
 
    <span class="k preprocess">#</span><span class="k preprocess">region</span> Handler classes
 
    <b>internal abstract class</b> <a id="77ab7cfb35834836" href="../../../R/77ab7cfb35834836.html" target="n" data-glyph="2,0" class="t t"><span id="d5643d7201cefc79">SearchResultHandler</span></a>&lt;<span id="r66 rd t" class="r66 r t">TSource</span>&gt;
    {
        [<span class="i n">System</span>.<span class="i n">Security</span>.<a href="@0@mscorlib/A.html#29a3d687a50338b1" class="t constructor">SecurityCritical</a>]
        <b>internal abstract bool</b> <a id="967f1a27e6b419d8" href="../../../R/967f1a27e6b419d8.html" target="n" data-glyph="74,1" class="i method">IsResultIncluded</a>(<a href="#bf0edcbb12a7e5b5" class="t t">SearchResult</a> <span id="r67 rd" class="r67 r">result</span>);
 
        [<span class="i n">System</span>.<span class="i n">Security</span>.<a href="@0@mscorlib/A.html#29a3d687a50338b1" class="t constructor">SecurityCritical</a>]
        <b>internal abstract</b> <span class="r66 r t">TSource</span> <a id="237fee9d495f14a6" href="../../../R/237fee9d495f14a6.html" target="n" data-glyph="74,1" class="i method">CreateObject</a>(<a href="#bf0edcbb12a7e5b5" class="t t">SearchResult</a> <span id="r68 rd" class="r68 r">result</span>);
    }
 
    <b>internal class</b> <a id="283845889c33537e" href="../../../R/../../0000000000.html" target="n" data-glyph="2,0" class="t t">StringResultHandler</a> : <a href="#77ab7cfb35834836" class="t t">SearchResultHandler</a>&lt;<a href="@0@mscorlib/A.html#8281103e6f23cb5c" class="t t">String</a>&gt;
    {
        <b>private bool</b> <a id="d4c08ad1588b094f" href="../../../R/d4c08ad1588b094f.html" target="n" data-glyph="46,1" class="i field">_includeFiles</a>;
        <b>private bool</b> <a id="3774198e353c90ce" href="../../../R/3774198e353c90ce.html" target="n" data-glyph="46,1" class="i field">_includeDirs</a>;
 
        <b>internal</b> <a id="cbda53339cc87547" href="../../../R/../../0000000000.html" target="n" data-glyph="74,1" class="i constructor">StringResultHandler</a>(<b>bool</b> <span id="r69 rd" class="r69 r">includeFiles</span>, <b>bool</b> <span id="r70 rd" class="r70 r">includeDirs</span>)
        {
            <a href="#d4c08ad1588b094f" class="i field">_includeFiles</a> = <span class="r69 r">includeFiles</span>;
            <a href="#3774198e353c90ce" class="i field">_includeDirs</a> = <span class="r70 r">includeDirs</span>;
        }
 
        [<span class="i n">System</span>.<span class="i n">Security</span>.<a href="@0@mscorlib/A.html#29a3d687a50338b1" class="t constructor">SecurityCritical</a>]
        <b>internal override bool</b> <a id="33f56157b2db5907" href="../../../R/33f56157b2db5907.html" target="n" data-glyph="74,1" class="i method">IsResultIncluded</a>(<a href="#bf0edcbb12a7e5b5" class="t t">SearchResult</a> <span id="r71 rd" class="r71 r">result</span>)
        {
            <b>bool</b> <span id="r72 rd" class="r72 r">includeFile</span> = <a href="#d4c08ad1588b094f" class="i field">_includeFiles</a> &amp;&amp; <a href="#50d44777a3acfe41" class="t t">Win32FileSystemEnumerableHelpers</a>.<a href="#2de7a678cbb48c02" class="i method">IsFile</a>(<span class="r71 r">result</span>.<a href="#52668478ed193cae" class="i property">FindData</a>);
            <b>bool</b> <span id="r73 rd" class="r73 r">includeDir</span> = <a href="#3774198e353c90ce" class="i field">_includeDirs</a> &amp;&amp; <a href="#50d44777a3acfe41" class="t t">Win32FileSystemEnumerableHelpers</a>.<a href="#b275fed349c9c9dd" class="i method">IsDir</a>(<span class="r71 r">result</span>.<a href="#52668478ed193cae" class="i property">FindData</a>);
            <a href="@0@mscorlib/A.html#c575dbe300e57438" class="t t">Contract</a>.<a href="@0@mscorlib/A.html#e1f5696175c73b50" class="i method">Assert</a>(!(<span class="r72 r">includeFile</span> &amp;&amp; <span class="r73 r">includeDir</span>), <span class="r71 r">result</span>.<a href="#52668478ed193cae" class="i property">FindData</a>.<a href="Win32FindFile.cs.html#dc8550e08c5b3e16" class="i field">cFileName</a> + <span class="s">&quot;: current item can&#39;t be both file and dir!&quot;</span>);
            <b>return</b> (<span class="r72 r">includeFile</span> || <span class="r73 r">includeDir</span>);
        }
 
        [<span class="i n">System</span>.<span class="i n">Security</span>.<a href="@0@mscorlib/A.html#29a3d687a50338b1" class="t constructor">SecurityCritical</a>]
        <b>internal override</b> <a href="@0@mscorlib/A.html#8281103e6f23cb5c" class="t t">String</a> <a id="ece0d0178eb3940c" href="../../../R/ece0d0178eb3940c.html" target="n" data-glyph="74,1" class="i method">CreateObject</a>(<a href="#bf0edcbb12a7e5b5" class="t t">SearchResult</a> <span id="r74 rd" class="r74 r">result</span>)
        {
            <b>return</b> <span class="r74 r">result</span>.<a href="#eb2182c258566418" class="i property">UserPath</a>;
        }
    }
 
    <b>internal class</b> <a id="d36e18747d2cc630" href="../../../R/../../0000000000.html" target="n" data-glyph="2,0" class="t t"><span id="214b84d320780b5c">FileInfoResultHandler</span></a> : <a href="#77ab7cfb35834836" class="t t">SearchResultHandler</a>&lt;<a href="@0@mscorlib/A.html#4ee673c1a4ecad41" class="t t">FileInfo</a>&gt;
    {
        [<span class="i n">System</span>.<span class="i n">Security</span>.<a href="@0@mscorlib/A.html#29a3d687a50338b1" class="t constructor">SecurityCritical</a>]
        <b>internal override bool</b> <a id="7e46bf546af46f60" href="../../../R/7e46bf546af46f60.html" target="n" data-glyph="74,1" class="i method">IsResultIncluded</a>(<a href="#bf0edcbb12a7e5b5" class="t t">SearchResult</a> <span id="r75 rd" class="r75 r">result</span>)
        {
            <b>return</b> <a href="#50d44777a3acfe41" class="t t">Win32FileSystemEnumerableHelpers</a>.<a href="#2de7a678cbb48c02" class="i method">IsFile</a>(<span class="r75 r">result</span>.<a href="#52668478ed193cae" class="i property">FindData</a>);
        }
 
        [<span class="i n">System</span>.<span class="i n">Security</span>.<a href="@0@mscorlib/A.html#29a3d687a50338b1" class="t constructor">SecurityCritical</a>]
        <b>internal override</b> <a href="@0@mscorlib/A.html#4ee673c1a4ecad41" class="t t">FileInfo</a> <a id="13ec3d665f15005a" href="../../../R/13ec3d665f15005a.html" target="n" data-glyph="74,1" class="i method">CreateObject</a>(<a href="#bf0edcbb12a7e5b5" class="t t">SearchResult</a> <span id="r76 rd" class="r76 r">result</span>)
        {
            <a href="@0@mscorlib/A.html#8281103e6f23cb5c" class="t t">String</a> <span id="r77 rd" class="r77 r">name</span> = <span class="r76 r">result</span>.<a href="#59bb18d3ab5ffd26" class="i property">FullPath</a>;
            <a href="@0@mscorlib/A.html#4ee673c1a4ecad41" class="t t">FileInfo</a> <span id="r78 rd" class="r78 r">fi</span> = <b>new</b> <a href="@0@mscorlib/A.html#1fe2c3953ba2a577" class="t constructor">FileInfo</a>(<span class="r77 r">name</span>); <span class="c">//, fileSystemObject);</span>
            <b>return</b> <span class="r78 r">fi</span>;
        }
    }
 
    <b>internal static class</b> <a id="50d44777a3acfe41" href="../../../R/50d44777a3acfe41.html" target="n" data-glyph="2,0" class="t t">Win32FileSystemEnumerableHelpers</a>
    {
        [<span class="i n">System</span>.<span class="i n">Security</span>.<a href="@0@mscorlib/A.html#29a3d687a50338b1" class="t constructor">SecurityCritical</a>]  <span class="c">// auto-generated</span>
        <b>internal static bool</b> <a id="b275fed349c9c9dd" href="../../../R/b275fed349c9c9dd.html" target="n" data-glyph="74,1" class="i method">IsDir</a>(<a href="Win32FindFile.cs.html#7631f748197d6b49" class="t t">Win32FindFile</a>.<a href="Win32FindFile.cs.html#2b1a59df44331d51" class="t t">WIN32_FIND_DATA</a> <span id="r79 rd" class="r79 r">data</span>)
        {
            <span class="c">// Don&#39;t add &quot;.&quot; nor &quot;..&quot;</span>
            <b>return</b> (0 != (<span class="r79 r">data</span>.<a href="Win32FindFile.cs.html#431dea9d19cf8a87" class="i field">dwFileAttributes</a> &amp; <a href="Win32FindFile.cs.html#7631f748197d6b49" class="t t">Win32FindFile</a>.<a href="Win32FindFile.cs.html#038f6a446f1013c6" class="t t">FileAttributes</a>.<a href="Win32FindFile.cs.html#c2289e996687fb6c" class="i field">FILE_ATTRIBUTE_DIRECTORY</a>))
                                                &amp;&amp; !<span class="r79 r">data</span>.<a href="Win32FindFile.cs.html#dc8550e08c5b3e16" class="i field">cFileName</a>.<a href="@0@mscorlib/A.html#31b307b02a3bd6b9" class="i method">Equals</a>(<span class="s">&quot;.&quot;</span>) &amp;&amp; !<span class="r79 r">data</span>.<a href="Win32FindFile.cs.html#dc8550e08c5b3e16" class="i field">cFileName</a>.<a href="@0@mscorlib/A.html#31b307b02a3bd6b9" class="i method">Equals</a>(<span class="s">&quot;..&quot;</span>);
        }
 
        [<span class="i n">System</span>.<span class="i n">Security</span>.<a href="@0@mscorlib/A.html#29a3d687a50338b1" class="t constructor">SecurityCritical</a>]  <span class="c">// auto-generated</span>
        <b>internal static bool</b> <a id="2de7a678cbb48c02" href="../../../R/2de7a678cbb48c02.html" target="n" data-glyph="74,1" class="i method">IsFile</a>(<a href="Win32FindFile.cs.html#7631f748197d6b49" class="t t">Win32FindFile</a>.<a href="Win32FindFile.cs.html#2b1a59df44331d51" class="t t">WIN32_FIND_DATA</a> <span id="r80 rd" class="r80 r">data</span>)
        {
            <b>return</b> 0 == (<span class="r80 r">data</span>.<a href="Win32FindFile.cs.html#431dea9d19cf8a87" class="i field">dwFileAttributes</a> &amp; <a href="Win32FindFile.cs.html#7631f748197d6b49" class="t t">Win32FindFile</a>.<a href="Win32FindFile.cs.html#038f6a446f1013c6" class="t t">FileAttributes</a>.<a href="Win32FindFile.cs.html#c2289e996687fb6c" class="i field">FILE_ATTRIBUTE_DIRECTORY</a>);
        }
    }
 
    <span class="k preprocess">#</span><span class="k preprocess">endregion</span>
}
</pre></td></tr></table></div></body></html>
