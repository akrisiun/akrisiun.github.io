<!DOCTYPE html>
<html><head><title>MainWindow-Actions.cs</title><link rel="stylesheet" href="../../../styles.css"><script src="../../../scripts.js"></script></head>
<body class="cB" onload="i(362);"><div class="dH">
<table style="width: 100%">
<tr><td>File: <a id="filePath" class="blueLink" href="/#fcmdp/FileList/Actions/MainWindow-Actions.cs" target="_top">FileList\Actions\MainWindow-Actions.cs</a><br/></td><td></td></tr>
<tr><td>Project: <a id="projectPath" class="blueLink" href="/#fcmdp" target="_top">fcmd\fcmdp.csproj</a> (fcmdp)</td><td></td></tr>
</table>
</div>
<div class="cz"><table class="tb" cellpadding="0" cellspacing="0"><tr><td valign="top" align="right"><pre id="ln"></pre></td><td valign="top" align="left"><pre id="code">
<span class="c">/* The File Commander main window
 * The main file manager window
 * (C) The File Commander Team - https://github.com/atauenis/fcmd
 * (C) 2013-14, Alexander Tauenis (atauenis@yandex.ru)
 * (C) 2014, Evgeny Akhtimirov (wilbit@me.com)
 * Contributors should place own signs here.
 * (C) 2015, Andrius Krisiunas (akrisiun@gmail.com)
 */</span>

<b>using</b> <span class="i n">System</span>;
<b>using</b> <span class="i n">System</span>.<span class="i n">Linq</span>;
<b>using</b> <span class="i n">System</span>.<span class="i n">Text</span>;
<b>using</b> <span class="i n">System</span>.<span class="i n">Threading</span>;
<b>using</b> <span class="i n">pluginner</span>.<span class="i n">Widgets</span>;
<b>using</b> <span class="i n">Xwt</span>;
<b>using</b> <span class="i n">fcmd</span>.<span class="i n">FileList</span>;

<span class="k preprocess">#</span><span class="k preprocess">if</span> <span class="i">WPF</span>
<b>using</b> <span class="t">ListView2Canvas</span> = <span class="i n">fcmd</span>.<span class="i n">View</span>.<span class="i n">Xaml</span>.<a href="../../View.Xaml/ListPanel/ListItemXaml.cs.html#f370823f101f56f2" class="t t">ListItemXaml</a>;
<span class="k preprocess">#</span><span class="k preprocess">else</span> 
<span class="e">using ListView2Canvas = fcmd.View.GTK.ListView2Canvas;
</span><span class="k preprocess">#</span><span class="k preprocess">endif</span>

<b>namespace</b> <span class="i n">fcmd</span>
{
    <b>public</b> <a href="../../P/6628552ccd0b005b.html" target="s" class="k">partial</a> <b>class</b> <a id="6628552ccd0b005b" href="../../R/6628552ccd0b005b.html" target="n" data-glyph="0,0" class="t t">MainWindow</a>
    {
        <span class="c">/* ЗАМЕТКА РАЗРАБОТЧИКУ
		 * 
		 * В данном файле размещаются подпрограммы для управления файлами, которые
		 * вызываются из MainWindow.cs. Также планируется использование этих подпрограмм
		 * после реализации текстовой коммандной строки FC (которая внизу окна).
		 * Все комманды работают с активной и пассивой панелью - Active/PassivePanel.
		 * FC всегда их определяет сам. Пассивая панель - всегда получатель файлов.
		 * Названия комманд - UNIX в верблюжьем регистре (Ls, Rm, MkDir, Touch и т.п.).
		 * Всем коммандам параметры передаются строкой, но допускаются исключения, напр.,
		 * если базовая функция &quot;перегружена&quot; функцией для нужд графического интерфейса.
		 * Sorry for my bad english.
		 */</span>
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Reads the file </span><span class="c">&lt;</span><span class="c">paramref</span><span class="c"> </span><span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r0 r">url</span><span class="c">&quot;</span><span class="c">/&gt;</span><span class="c"> and shows in FC Viewer</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span><span class="c"> </span><span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r0 r">url</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <b>public void</b> <a id="c8d145bda21c8384" href="../../R/../../0000000000.html" target="n" data-glyph="72,1" class="i method">FCView</a>(<b>string</b> <span id="r0 rd" class="r0 r">url</span>)
        {
            <a href="../VEd.cs.html#c6e9e9066499e793" class="t t">VEd</a> <span id="r1 rd" class="r1 r">fcv</span> = <b>new</b> <a href="../VEd.cs.html#40ba556c8098f8ae" class="t constructor">VEd</a>();
            <span class="c">//pluginner.IFSPlugin fs = ActivePanel.FS;</span>
            <span class="c">//if (!fs.FileExists(url))</span>
            <span class="c">//{</span>
            <span class="c">//    //MessageBox.Show(string.Format(locale.GetString(&quot;FileNotFound&quot;), ActivePanel.list.SelectedItems[0].Text), &quot;&quot;, MessageBoxButtons.OK, MessageBoxIcon.Exclamation);</span>
            <span class="c">//    Xwt.MessageDialog.ShowError(string.Format(Localizator.GetString(&quot;FileNotFound&quot;)</span>
            <span class="c">//        , ActivePanel.GetValue(ActivePanel.df.DisplayName)));</span>
            <span class="c">//    return;</span>
            <span class="c">//}</span>
 
            <span class="c">//// string FileContent = Encoding.ASCII.GetString(fs.GetFileContent(url));</span>
            <span class="c">//fcv.LoadFile(url, ActivePanel.FS, false);</span>
            <span class="c">//fcv.Show();</span>
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Reads the file </span><span class="c">&lt;</span><span class="c">paramref</span><span class="c"> </span><span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r2 r">url</span><span class="c">&quot;</span><span class="c">/&gt;</span><span class="c"> and returns it as string </span>
        <span class="c">///</span><span class="c"> (for File Commander&#39;s CLI panel)</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span><span class="c"> </span><span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r2 r">url</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">returns</span><span class="c">&gt;</span><span class="c">&lt;/</span><span class="c">returns</span><span class="c">&gt;</span>
        <b>public string</b> <a id="5d0b19dd62afc966" href="../../R/../../0000000000.html" target="n" data-glyph="72,1" class="i method">Cat</a>(<b>string</b> <span id="r2 rd" class="r2 r">url</span>)
        {
            <span class="i n">pluginner</span>.<a href="/pluginner/A.html#a05a46d8951816c2" class="t t">IFSPlugin</a> <span id="r3 rd" class="r3 r">fs</span> = <a href="../../Model/MainDataContext.cs.html#9b15721940548510" class="i property">ActivePanel</a>.<a href="/pluginner/A.html#1202d9ced8768431" class="i property">FS</a>;
            <b>if</b> (!<span class="r3 r">fs</span>.<a href="/pluginner/A.html#49855afefc0d3fe4" class="i method">FileExists</a>(<span class="r2 r">url</span>)) <b>return</b> <span class="s">&quot;Файл не найден\n&quot;</span>;
 
            <b>return</b> <a href="@0@mscorlib/A.html#3b6090c501893c25" class="t t">Encoding</a>.<a href="@0@mscorlib/A.html#65768102b7ace585" class="i property">ASCII</a>.<a href="@0@mscorlib/A.html#7310c9cccfaecd17" class="i method">GetString</a>(<span class="r3 r">fs</span>.<a href="/pluginner/A.html#005bd742afc776d5" class="i method">GetFileContent</a>(<span class="r2 r">url</span>));
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Makes a new directory at the specifed </span><span class="c">&lt;</span><span class="c">paramref</span><span class="c"> </span><span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r4 r">url</span><span class="c">&quot;</span><span class="c">/&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span><span class="c"> </span><span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r4 r">url</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <b>public void</b> <a id="69beeb575a2171c9" href="../../R/69beeb575a2171c9.html" target="n" data-glyph="72,1" class="i method">MkDir</a>(<b>string</b> <span id="r4 rd" class="r4 r">url</span>)
        {
            <a href="FileProcessDialog.cs.html#f06aec4beb537c6e" class="t t">FileProcessDialog</a> <span id="r5 rd" class="r5 r">fpd</span> = <b>new</b> <a href="FileProcessDialog.cs.html#577789350c1b1ca0" class="t constructor">FileProcessDialog</a>();
            <span class="r5 r">fpd</span>.<a href="FileProcessDialog.cs.html#cfb7deed496b39ab" class="i field">lblStatus</a>.<a href="/Xwt3/A.html#e1385dbb967268cb" class="i property">Text</a> = <b>string</b>.<a href="@0@mscorlib/A.html#7432dab173fae5fc" class="i method">Format</a>(<a href="../Localizator.cs.html#0b0c6268a53237f4" class="t t">Localizator</a>.<a href="../Localizator.cs.html#546af5a79d2e88a9" class="i method">GetString</a>(<span class="s">&quot;DoingMkdir&quot;</span>), <span class="s">&quot;\n&quot;</span> + <span class="r4 r">url</span>, <b>null</b>);
            <span class="r5 r">fpd</span>.<a href="/Xwt3/A.html#14cc650ccd55476a" class="i method">Show</a>();
 
            <span class="c">//Thread MkDirThread = new Thread(delegate () { ActivePanel.FS.CreateDirectory(url); });</span>
            <span class="c">//MkDirThread.Start();</span>
 
            <span class="c">//do { /*Application.DoEvents();*/ Xwt.Application.MainLoop.DispatchPendingEvents(); }</span>
            <span class="c">//while (MkDirThread.ThreadState == ThreadState.Running);</span>
 
            <span class="c">//fpd.pbrProgress.Fraction = 1;</span>
            <span class="c">//ActivePanel.LoadDir(ActivePanel.FS.CurrentDirectory);</span>
            <span class="r5 r">fpd</span>.<a href="/Xwt3/A.html#90a8fb1a602385e7" class="i method">Hide</a>();
        }

        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span><span class="c">Removes the current selected files</span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <b>public void</b> <a id="eb989c95d5bf7ca0" href="../../R/eb989c95d5bf7ca0.html" target="n" data-glyph="72,1" class="i method">Rm</a>()
        {
            <span class="c">//if (ActivePanel.GetValue(ActivePanel.df.DisplayName) == &quot;..&quot;) { return; }</span>
 
            <a href="../../View.Xaml/ListPanel/ListItemXaml.cs.html#f370823f101f56f2" class="t t">ListView2Canvas</a>[] <span id="r6 rd" class="r6 r">chdrws</span> = (<a href="../../Model/MainDataContext.cs.html#9b15721940548510" class="i property">ActivePanel</a>.<a href="/pluginner/A.html#8f8dcc1691a90fb7" class="i property">ListingView</a> <b>as</b> <a href="/pluginner/A.html#54cdf62f3ae1a20e" class="t t">IListingView</a>&lt;<a href="../../View.Xaml/ListPanel/ListItemXaml.cs.html#f370823f101f56f2" class="t t">ListView2Canvas</a>&gt;)
                .<a href="/pluginner/A.html#897a4ac1e818c198" class="i property">ChoosedRows</a>.<a href="@0@System.Core/A.html#783a052330e7d48d" class="i method">ToArray</a>();

            <span class="c">////because the List may change due the process, we getting the copy of the list (as array, but how else?)</span>

            <span class="c">//foreach (ListView2ItemWpf selitem in chdrws)</span>
            <span class="c">//{</span>
            <span class="c">//    string URL = selitem.Data[ActivePanel.df.URL].ToString();</span>
            <span class="c">//    Rm(URL);</span>
            <span class="c">//}</span>
            <span class="c">//ActivePanel.LoadDir();</span>
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Removes the specifed file</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <b>public string</b> <a id="eb4bd0af2b935d6c" href="../../R/../../0000000000.html" target="n" data-glyph="72,1" class="i method">Rm</a>(<b>string</b> <span id="r7 rd" class="r7 r">url</span>)
        {
            <b>if</b> (<a href="../../Model/MainDataContext.cs.html#9b15721940548510" class="i property">ActivePanel</a>.<a href="/pluginner/A.html#3a138ea15450062b" class="i method">GetValue</a>&lt;<b>string</b>&gt;(<a href="../../Model/MainDataContext.cs.html#9b15721940548510" class="i property">ActivePanel</a>.<a href="/pluginner/A.html#90e7608e193237dc" class="i property">df</a>.<a href="/pluginner/A.html#f43d0c53b3230ed3" class="i field">DisplayName</a>) == <span class="s">&quot;..&quot;</span>)
            {
                <b>return</b> <span class="s">&quot;Cannot remove ..&quot;</span>;
            }
 
            <b>if</b> (!<span class="i n">Xwt</span>.<a href="/Xwt3/A.html#1e0854feacd0db6d" class="t t">MessageDialog</a>.<a href="/Xwt3/A.html#177aef548f5305dd" class="i method">Confirm</a>(
                <a href="@0@mscorlib/A.html#8281103e6f23cb5c" class="t t">String</a>.<a href="@0@mscorlib/A.html#7432dab173fae5fc" class="i method">Format</a>(<a href="../Localizator.cs.html#0b0c6268a53237f4" class="t t">Localizator</a>.<a href="../Localizator.cs.html#546af5a79d2e88a9" class="i method">GetString</a>(<span class="s">&quot;FCDelAsk&quot;</span>), <span class="r7 r">url</span>, <b>null</b>),
                <span class="i n">Xwt</span>.<a href="/Xwt3/A.html#e25dede4b0e9efac" class="t t">Command</a>.<a href="/Xwt3/A.html#4fa4689b5a2abfa1" class="i field">Remove</a>,
                <b>true</b>))
            { <b>return</b> <a href="../Localizator.cs.html#0b0c6268a53237f4" class="t t">Localizator</a>.<a href="../Localizator.cs.html#546af5a79d2e88a9" class="i method">GetString</a>(<span class="s">&quot;Canceled&quot;</span>); };
 
            <a href="FileProcessDialog.cs.html#f06aec4beb537c6e" class="t t">FileProcessDialog</a> <span id="r8 rd" class="r8 r">fpd</span> = <b>new</b> <a href="FileProcessDialog.cs.html#577789350c1b1ca0" class="t constructor">FileProcessDialog</a>();
            <span class="r8 r">fpd</span>.<a href="FileProcessDialog.cs.html#cfb7deed496b39ab" class="i field">lblStatus</a>.<a href="/Xwt3/A.html#e1385dbb967268cb" class="i property">Text</a> = <a href="@0@mscorlib/A.html#8281103e6f23cb5c" class="t t">String</a>.<a href="@0@mscorlib/A.html#7432dab173fae5fc" class="i method">Format</a>(<a href="../Localizator.cs.html#0b0c6268a53237f4" class="t t">Localizator</a>.<a href="../Localizator.cs.html#546af5a79d2e88a9" class="i method">GetString</a>(<span class="s">&quot;DoingRemove&quot;</span>), <span class="s">&quot;\n&quot;</span> + <span class="r7 r">url</span>, <b>null</b>);
            <span class="r8 r">fpd</span>.<a href="FileProcessDialog.cs.html#17467063a26b2575" class="i field">cmdCancel</a>.<a href="/Xwt3/A.html#627d0a91b5201755" class="i property">Sensitive</a> = <b>false</b>;
            <span class="r8 r">fpd</span>.<a href="/Xwt3/A.html#14cc650ccd55476a" class="i method">Show</a>();
 
            <b>string</b> <span id="r9 rd" class="r9 r">curItemDel</span> = <a href="../../Model/MainDataContext.cs.html#9b15721940548510" class="i property">ActivePanel</a>.<a href="/pluginner/A.html#3a138ea15450062b" class="i method">GetValue</a>&lt;<b>string</b>&gt;(<a href="../../Model/MainDataContext.cs.html#9b15721940548510" class="i property">ActivePanel</a>.<a href="/pluginner/A.html#90e7608e193237dc" class="i property">df</a>.<a href="/pluginner/A.html#66d073a4f05ed86b" class="i field">URL</a>);
            <span class="i n">pluginner</span>.<a href="/pluginner/A.html#a05a46d8951816c2" class="t t">IFSPlugin</a> <span id="r10 rd" class="r10 r">fsdel</span> = <a href="../../Model/MainDataContext.cs.html#9b15721940548510" class="i property">ActivePanel</a>.<a href="/pluginner/A.html#1202d9ced8768431" class="i property">FS</a>;
            <b>if</b> (<span class="r10 r">fsdel</span>.<a href="/pluginner/A.html#49855afefc0d3fe4" class="i method">FileExists</a>(<span class="r9 r">curItemDel</span>))
            {
                <span class="r8 r">fpd</span>.<a href="FileProcessDialog.cs.html#f18d67846a89e7cb" class="i field">pbrProgress</a>.<a href="/Xwt3/A.html#0d960e41da7beded" class="i property">Fraction</a> = 0.5;
                <a href="@0@mscorlib/A.html#3980e012bae82e96" class="t t">Thread</a> <span id="r11 rd" class="r11 r">RmFileThread</span> = <b>new</b> <a href="@0@mscorlib/A.html#76f340c84df6da8d" class="t constructor">Thread</a>(<b>delegate</b> () { <a href="../MainWindow-Workers.cs.html#e97b89db1533ed7c" class="i method">DoRmFile</a>(<span class="r9 r">curItemDel</span>, <span class="r10 r">fsdel</span>); });
                <span class="r11 r">RmFileThread</span>.<a href="@0@mscorlib/A.html#cd2144b8dd6f4373" class="i method">Start</a>();
 
                <b>do</b> { <span class="i n">Xwt</span>.<a href="/Xwt3/A.html#687215caac5b1b53" class="t t">Application</a>.<a href="/Xwt3/A.html#90e66e6f971c8db5" class="i property">MainLoop</a>.<a href="/Xwt3/A.html#590eaa3d920e5f18" class="i method">DispatchPendingEvents</a>(); }
                <b>while</b> (<span class="r11 r">RmFileThread</span>.<a href="@0@mscorlib/A.html#66a63a6ab576317d" class="i property">ThreadState</a> == <a href="@0@mscorlib/A.html#8ea2224d83e90f0d" class="t t">ThreadState</a>.<a href="@0@mscorlib/A.html#13c6499815acc109" class="i field">Running</a>);
 
                <span class="r8 r">fpd</span>.<a href="FileProcessDialog.cs.html#f18d67846a89e7cb" class="i field">pbrProgress</a>.<a href="/Xwt3/A.html#0d960e41da7beded" class="i property">Fraction</a> = 1;
                <span class="r8 r">fpd</span>.<a href="/Xwt3/A.html#90a8fb1a602385e7" class="i method">Hide</a>();
                <b>return</b> <span class="s">&quot;Файл удалён.\n&quot;</span>;
            }
            <b>if</b> (<span class="r10 r">fsdel</span>.<a href="/pluginner/A.html#c86d050760277042" class="i method">DirectoryExists</a>(<span class="r9 r">curItemDel</span>))
            {
                <span class="r8 r">fpd</span>.<a href="FileProcessDialog.cs.html#cfb7deed496b39ab" class="i field">lblStatus</a>.<a href="/Xwt3/A.html#e1385dbb967268cb" class="i property">Text</a> = <a href="@0@mscorlib/A.html#8281103e6f23cb5c" class="t t">String</a>.<a href="@0@mscorlib/A.html#7432dab173fae5fc" class="i method">Format</a>(<a href="../Localizator.cs.html#0b0c6268a53237f4" class="t t">Localizator</a>.<a href="../Localizator.cs.html#546af5a79d2e88a9" class="i method">GetString</a>(<span class="s">&quot;DoingRemove&quot;</span>), <span class="s">&quot;\n&quot;</span> + <span class="r7 r">url</span>, <span class="s">&quot;\n[&quot;</span> + <a href="../Localizator.cs.html#0b0c6268a53237f4" class="t t">Localizator</a>.<a href="../Localizator.cs.html#546af5a79d2e88a9" class="i method">GetString</a>(<span class="s">&quot;Directory&quot;</span>).<a href="@0@mscorlib/A.html#d536cbe70a300b01" class="i method">ToUpper</a>() + <span class="s">&quot;]&quot;</span>);
                <span class="r8 r">fpd</span>.<a href="FileProcessDialog.cs.html#f18d67846a89e7cb" class="i field">pbrProgress</a>.<a href="/Xwt3/A.html#0d960e41da7beded" class="i property">Fraction</a> = 0.5;
                <a href="@0@mscorlib/A.html#3980e012bae82e96" class="t t">Thread</a> <span id="r12 rd" class="r12 r">RmDirThread</span> = <b>new</b> <a href="@0@mscorlib/A.html#76f340c84df6da8d" class="t constructor">Thread</a>(<b>delegate</b> () { <a href="../MainWindow-Workers.cs.html#c0d2e398f571ccfc" class="i method">DoRmDir</a>(<span class="r9 r">curItemDel</span>, <span class="r10 r">fsdel</span>); });
                <span class="r12 r">RmDirThread</span>.<a href="@0@mscorlib/A.html#cd2144b8dd6f4373" class="i method">Start</a>();
 
                <b>do</b> { <span class="i n">Xwt</span>.<a href="/Xwt3/A.html#687215caac5b1b53" class="t t">Application</a>.<a href="/Xwt3/A.html#90e66e6f971c8db5" class="i property">MainLoop</a>.<a href="/Xwt3/A.html#590eaa3d920e5f18" class="i method">DispatchPendingEvents</a>(); }
                <b>while</b> (<span class="r12 r">RmDirThread</span>.<a href="@0@mscorlib/A.html#66a63a6ab576317d" class="i property">ThreadState</a> == <a href="@0@mscorlib/A.html#8ea2224d83e90f0d" class="t t">ThreadState</a>.<a href="@0@mscorlib/A.html#13c6499815acc109" class="i field">Running</a>);
 
                <span class="r8 r">fpd</span>.<a href="FileProcessDialog.cs.html#f18d67846a89e7cb" class="i field">pbrProgress</a>.<a href="/Xwt3/A.html#0d960e41da7beded" class="i property">Fraction</a> = 1;
 
                <span class="r8 r">fpd</span>.<a href="/Xwt3/A.html#90a8fb1a602385e7" class="i method">Hide</a>();
                <b>return</b> <span class="s">&quot;Каталог удалён.\n&quot;</span>;
            }
            <b>return</b> <span class="s">&quot;Файл не найден&quot;</span>;
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Copy the highlighted file to the passive panel. To be used in FC UI. </span>
        <span class="c">///</span><span class="c"> Includes asking of the destination path.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        [<a href="@0@mscorlib/A.html#0e5e65836a59d8c5" class="t constructor">STAThread</a>]
        <b>public void</b> <a id="9d60d1f65f98ce91" href="../../R/9d60d1f65f98ce91.html" target="n" data-glyph="72,1" class="i method">Cp</a>()
        {
            <b>if</b> (<a href="../../Model/MainDataContext.cs.html#9b15721940548510" class="i property">ActivePanel</a>.<a href="/pluginner/A.html#3a138ea15450062b" class="i method">GetValue</a>&lt;<b>string</b>&gt;(<a href="../../Model/MainDataContext.cs.html#9b15721940548510" class="i property">ActivePanel</a>.<a href="/pluginner/A.html#90e7608e193237dc" class="i property">df</a>.<a href="/pluginner/A.html#f43d0c53b3230ed3" class="i field">DisplayName</a>) == <span class="s">&quot;..&quot;</span>) { <b>return</b>; }

            <span class="c">// var PassivePanel = PassivePanel;</span>

            <b>foreach</b> (<a href="../../View.Xaml/ListPanel/ListItemXaml.cs.html#f370823f101f56f2" class="t t">ListView2Canvas</a> <span id="r13 rd" class="r13 r">selitem</span>
                        <b>in</b> (<a href="../../Model/MainDataContext.cs.html#9b15721940548510" class="i property">ActivePanel</a>.<a href="/pluginner/A.html#8f8dcc1691a90fb7" class="i property">ListingView</a> <b>as</b> <a href="/pluginner/A.html#54cdf62f3ae1a20e" class="t t">IListingView</a>&lt;<a href="../../View.Xaml/ListPanel/ListItemXaml.cs.html#f370823f101f56f2" class="t t">ListView2Canvas</a>&gt;)
                            .<a href="/pluginner/A.html#897a4ac1e818c198" class="i property">ChoosedRows</a>)
            {
                <b>string</b> <span id="r14 rd" class="r14 r">SourceURL</span> = <span class="r13 r">selitem</span>.<a href="../../View.Xaml/ListPanel/ListItemXaml.cs.html#853c5a1e547eff35" class="i property">Data</a>[<a href="../../Model/MainDataContext.cs.html#9b15721940548510" class="i property">ActivePanel</a>.<a href="/pluginner/A.html#90e7608e193237dc" class="i property">df</a>.<a href="/pluginner/A.html#66d073a4f05ed86b" class="i field">URL</a>].<a href="@0@mscorlib/A.html#ff31a6bf27c58f89" class="i method">ToString</a>();
                <span class="i n">pluginner</span>.<a href="/pluginner/A.html#a05a46d8951816c2" class="t t">IFSPlugin</a> <span id="r15 rd" class="r15 r">SourceFS</span> = <a href="../../Model/MainDataContext.cs.html#9b15721940548510" class="i property">ActivePanel</a>.<a href="/pluginner/A.html#1202d9ced8768431" class="i property">FS</a>;

                <span class="c">//check for file existing</span>
                <b>if</b> (<span class="r15 r">SourceFS</span>.<a href="/pluginner/A.html#49855afefc0d3fe4" class="i method">FileExists</a>(<span class="r14 r">SourceURL</span>))
                {
                    <b>string</b> <span id="r16 rd" class="r16 r">SourceName</span> = <span class="r15 r">SourceFS</span>.<a href="/pluginner/A.html#147a0dc4280adc32" class="i method">GetMetadata</a>(<span class="r14 r">SourceURL</span>).<a href="/pluginner/A.html#52470894417ea42a" class="i field">Name</a>;

                    <a href="../InputBox.cs.html#c200c0ad381ede4e" class="t t">InputBox</a> <span id="r17 rd" class="r17 r">ibx</span> = <b>new</b> <a href="../InputBox.cs.html#4a6d9cec35f2990b" class="t constructor">InputBox</a>(
                        <a href="@0@mscorlib/A.html#8281103e6f23cb5c" class="t t">String</a>.<a href="@0@mscorlib/A.html#9d5604d4425b216f" class="i method">Format</a>(<a href="../Localizator.cs.html#0b0c6268a53237f4" class="t t">Localizator</a>.<a href="../Localizator.cs.html#546af5a79d2e88a9" class="i method">GetString</a>(<span class="s">&quot;CopyTo&quot;</span>), <span class="r16 r">SourceName</span>),
                        <a href="../../Model/MainDataContext.cs.html#6d9fac18aaec85aa" class="i property">PassivePanel</a>.<a href="/pluginner/A.html#1202d9ced8768431" class="i property">FS</a>.<a href="/pluginner/A.html#53050e9ff0b5dd2d" class="i property">CurrentDirectory</a> + <a href="../../Model/MainDataContext.cs.html#6d9fac18aaec85aa" class="i property">PassivePanel</a>.<a href="/pluginner/A.html#1202d9ced8768431" class="i property">FS</a>.<a href="/pluginner/A.html#e10c6e92e153d997" class="i property">DirSeparator</a> + <span class="r16 r">SourceName</span>);

                    <b>bool</b> <span id="r18 rd" class="r18 r">show</span> = <b>false</b>;
                    <span class="r18 r">show</span> = <span class="r17 r">ibx</span>.<a href="../InputBox.cs.html#7641cf72e8aa3e00" class="i method">ShowDialog</a>(<a href="../../P/6628552ccd0b005b.html#6628552ccd0b005b" class="k">this</a>);
                    <b>if</b> (<span class="r18 r">show</span>)
                    {
                        <a href="@0@mscorlib/A.html#8281103e6f23cb5c" class="t t">String</a> <span id="r19 rd" class="r19 r">DestinationFilePath</span> = <span class="r17 r">ibx</span>.<a href="../InputBox.cs.html#8ff9c06778e84a30" class="i property">Result</a>;
                        <b>string</b> <span id="r20 rd" class="r20 r">StatusMask</span> = <a href="../Localizator.cs.html#0b0c6268a53237f4" class="t t">Localizator</a>.<a href="../Localizator.cs.html#546af5a79d2e88a9" class="i method">GetString</a>(<span class="s">&quot;DoingCopy&quot;</span>);

                        <a href="ReplaceQuestionDialog.cs.html#f9e379f97ba4081d" class="t t">ReplaceQuestionDialog</a>.<a href="ReplaceQuestionDialog.cs.html#fd9cf1d74b7d71d2" class="t t">ClickedButton</a> <span id="r21 rd" class="r21 r">dummy</span> = <a href="ReplaceQuestionDialog.cs.html#f9e379f97ba4081d" class="t t">ReplaceQuestionDialog</a>.<a href="ReplaceQuestionDialog.cs.html#fd9cf1d74b7d71d2" class="t t">ClickedButton</a>.<a href="ReplaceQuestionDialog.cs.html#f349c182bb630bc9" class="i field">Cancel</a>;
                        <a href="AsyncCopy.cs.html#c078a9625c561f8c" class="t t">AsyncCopy</a> <span id="r22 rd" class="r22 r">AC</span> = <b>new</b> <a href="AsyncCopy.cs.html#c078a9625c561f8c" class="t constructor">AsyncCopy</a>();

                        <a href="@0@mscorlib/A.html#3980e012bae82e96" class="t t">Thread</a> <span id="r23 rd" class="r23 r">CpThread</span> = <b>new</b> <a href="@0@mscorlib/A.html#76f340c84df6da8d" class="t constructor">Thread</a>(<b>delegate</b> () { <a href="../MainWindow-Workers.cs.html#57d90feff7fa1ed5" class="i method">DoCp</a>(<a href="../../Model/MainDataContext.cs.html#9b15721940548510" class="i property">ActivePanel</a>.<a href="/pluginner/A.html#1202d9ced8768431" class="i property">FS</a>, <a href="../../Model/MainDataContext.cs.html#6d9fac18aaec85aa" class="i property">PassivePanel</a>.<a href="/pluginner/A.html#1202d9ced8768431" class="i property">FS</a>, <span class="r14 r">SourceURL</span>, <span class="r19 r">DestinationFilePath</span>, <b>ref</b> <span class="r21 r">dummy</span>, <span class="r22 r">AC</span>); });

                        <span class="r23 r">CpThread</span>.<a href="@0@mscorlib/A.html#b4341217f97b123a" class="i method">TrySetApartmentState</a>(<a href="@0@mscorlib/A.html#0ef6964041ada0a3" class="t t">ApartmentState</a>.<a href="@0@mscorlib/A.html#3b2f34c02518c1c7" class="i field">STA</a>);
                        <a href="FileProcessDialog.cs.html#f06aec4beb537c6e" class="t t">FileProcessDialog</a> <span id="r24 rd" class="r24 r">fpd</span> = <b>new</b> <a href="FileProcessDialog.cs.html#577789350c1b1ca0" class="t constructor">FileProcessDialog</a>();
                        <span class="r24 r">fpd</span>.<a href="/Xwt3/A.html#86317c3e31708d71" class="i property">InitialLocation</a> = <span class="i n">Xwt</span>.<a href="/Xwt3/A.html#c5ac8bbdd62f440d" class="t t">WindowLocation</a>.<a href="/Xwt3/A.html#35c12236ed64b96a" class="i field">CenterParent</a>;
                        <span class="r24 r">fpd</span>.<a href="FileProcessDialog.cs.html#cfb7deed496b39ab" class="i field">lblStatus</a>.<a href="/Xwt3/A.html#e1385dbb967268cb" class="i property">Text</a> = <a href="@0@mscorlib/A.html#8281103e6f23cb5c" class="t t">String</a>.<a href="@0@mscorlib/A.html#6e5f254563fed78e" class="i method">Format</a>(<span class="r20 r">StatusMask</span>, <a href="../../Model/MainDataContext.cs.html#9b15721940548510" class="i property">ActivePanel</a>.<a href="/pluginner/A.html#3a138ea15450062b" class="i method">GetValue</a>&lt;<b>string</b>&gt;(<a href="../../Model/MainDataContext.cs.html#9b15721940548510" class="i property">ActivePanel</a>.<a href="/pluginner/A.html#90e7608e193237dc" class="i property">df</a>.<a href="/pluginner/A.html#66d073a4f05ed86b" class="i field">URL</a>), <span class="r17 r">ibx</span>.<a href="../InputBox.cs.html#8ff9c06778e84a30" class="i property">Result</a>, <b>null</b>);
                        <span class="r24 r">fpd</span>.<a href="FileProcessDialog.cs.html#17467063a26b2575" class="i field">cmdCancel</a>.<a href="/Xwt3/A.html#5683a347395de938" class="i">Clicked</a> += (<b>object</b> <span id="r25 rd" class="r25 r">s</span>, <a href="@0@mscorlib/A.html#9a1496aa60befd10" class="t t">EventArgs</a> <span id="r26 rd" class="r26 r">e</span>)
                            =&gt;
                            {
                                <span class="r23 r">CpThread</span>.<a href="@0@mscorlib/A.html#fbdd377484783e1b" class="i method">Abort</a>();
                                <a href="/Xwt3/A.html#1e0854feacd0db6d" class="t t">MessageDialog</a>.<a href="/Xwt3/A.html#345b746b6874b51e" class="i method">ShowWarning</a>(<a href="../Localizator.cs.html#0b0c6268a53237f4" class="t t">Localizator</a>.<a href="../Localizator.cs.html#546af5a79d2e88a9" class="i method">GetString</a>(<span class="s">&quot;Canceled&quot;</span>), <a href="../../Model/MainDataContext.cs.html#9b15721940548510" class="i property">ActivePanel</a>.<a href="/pluginner/A.html#3a138ea15450062b" class="i method">GetValue</a>&lt;<b>string</b>&gt;(<a href="../../Model/MainDataContext.cs.html#9b15721940548510" class="i property">ActivePanel</a>.<a href="/pluginner/A.html#90e7608e193237dc" class="i property">df</a>.<a href="/pluginner/A.html#66d073a4f05ed86b" class="i field">URL</a>));
                            };

                        <span class="r22 r">AC</span>.<a href="AsyncCopy.cs.html#ee55d7ae8d3ca2bf" class="i property">ReportMessage</a> = <a href="../Localizator.cs.html#0b0c6268a53237f4" class="t t">Localizator</a>.<a href="../Localizator.cs.html#546af5a79d2e88a9" class="i method">GetString</a>(<span class="s">&quot;CopyStatus&quot;</span>);
                        <span class="r22 r">AC</span>.<a href="AsyncCopy.cs.html#457c6a6c592c66d5" class="i">OnProgress</a> += (<span id="r27 rd" class="r27 r">message</span>, <span id="r28 rd" class="r28 r">percent</span>) =&gt;
                        {
                            <span class="i n">Xwt</span>.<a href="/Xwt3/A.html#687215caac5b1b53" class="t t">Application</a>.<a href="/Xwt3/A.html#19c640ba41a65ffb" class="i method">Invoke</a>(() =&gt;
                                {
                                    <b>try</b>
                                    {
                                        <span class="r24 r">fpd</span>.<a href="FileProcessDialog.cs.html#f18d67846a89e7cb" class="i field">pbrProgress</a>.<a href="/Xwt3/A.html#0d960e41da7beded" class="i property">Fraction</a> = (<b>double</b>)((<b>double</b>)<span class="r28 r">percent</span> / (<b>double</b>)100);
                                        <span class="r24 r">fpd</span>.<a href="FileProcessDialog.cs.html#cfb7deed496b39ab" class="i field">lblStatus</a>.<a href="/Xwt3/A.html#e1385dbb967268cb" class="i property">Text</a> = <a href="@0@mscorlib/A.html#8281103e6f23cb5c" class="t t">String</a>.<a href="@0@mscorlib/A.html#6e5f254563fed78e" class="i method">Format</a>(<span class="r20 r">StatusMask</span>, <a href="../../Model/MainDataContext.cs.html#9b15721940548510" class="i property">ActivePanel</a>.<a href="/pluginner/A.html#3a138ea15450062b" class="i method">GetValue</a>&lt;<b>string</b>&gt;(<a href="../../Model/MainDataContext.cs.html#9b15721940548510" class="i property">ActivePanel</a>.<a href="/pluginner/A.html#90e7608e193237dc" class="i property">df</a>.<a href="/pluginner/A.html#66d073a4f05ed86b" class="i field">URL</a>), <span class="r17 r">ibx</span>.<a href="../InputBox.cs.html#8ff9c06778e84a30" class="i property">Result</a>, <span class="r27 r">message</span>);
                                    }
                                    <b>catch</b> { }
                                }
                            );
                        };

                        <span class="r24 r">fpd</span>.<a href="/Xwt3/A.html#14cc650ccd55476a" class="i method">Show</a>();

                        <span class="r23 r">CpThread</span>.<a href="@0@mscorlib/A.html#cd2144b8dd6f4373" class="i method">Start</a>();

                        <b>do</b>
                        {
                            <span class="i n">Xwt</span>.<a href="/Xwt3/A.html#687215caac5b1b53" class="t t">Application</a>.<a href="/Xwt3/A.html#90e66e6f971c8db5" class="i property">MainLoop</a>.<a href="/Xwt3/A.html#590eaa3d920e5f18" class="i method">DispatchPendingEvents</a>();
                        }
                        <b>while</b> (<span class="r23 r">CpThread</span>.<a href="@0@mscorlib/A.html#66a63a6ab576317d" class="i property">ThreadState</a> == <a href="@0@mscorlib/A.html#8ea2224d83e90f0d" class="t t">ThreadState</a>.<a href="@0@mscorlib/A.html#13c6499815acc109" class="i field">Running</a>);
                        <span class="c">// todo: замер и показ скорости, пауза, запрос отмены, вывод в фоновый поток (кнопка &quot;в фоне&quot;).</span>
                        <span class="c">// TODO: show bytes rate, pause, cancel button, move to queue</span>

                        <span class="r24 r">fpd</span>.<a href="/Xwt3/A.html#90a8fb1a602385e7" class="i method">Hide</a>();
                    }
                    <b>continue</b>;
                }
                <span class="c">//not a file...maybe directory?</span>
                <b>if</b> (<span class="r15 r">SourceFS</span>.<a href="/pluginner/A.html#c86d050760277042" class="i method">DirectoryExists</a>(<span class="r14 r">SourceURL</span>))<span class="c">//а вдруг есть такой каталог?</span>
                {
                    <a href="../InputBox.cs.html#c200c0ad381ede4e" class="t t">InputBox</a> <span id="r29 rd" class="r29 r">ibxd</span> = <b>new</b> <a href="../InputBox.cs.html#4a6d9cec35f2990b" class="t constructor">InputBox</a>(<a href="@0@mscorlib/A.html#8281103e6f23cb5c" class="t t">String</a>.<a href="@0@mscorlib/A.html#9d5604d4425b216f" class="i method">Format</a>(<a href="../Localizator.cs.html#0b0c6268a53237f4" class="t t">Localizator</a>.<a href="../Localizator.cs.html#546af5a79d2e88a9" class="i method">GetString</a>(<span class="s">&quot;CopyTo&quot;</span>), <span class="r15 r">SourceFS</span>.<a href="/pluginner/A.html#147a0dc4280adc32" class="i method">GetMetadata</a>(<span class="r14 r">SourceURL</span>).<a href="/pluginner/A.html#52470894417ea42a" class="i field">Name</a>), <a href="../../Model/MainDataContext.cs.html#6d9fac18aaec85aa" class="i property">PassivePanel</a>.<a href="/pluginner/A.html#1202d9ced8768431" class="i property">FS</a>.<a href="/pluginner/A.html#53050e9ff0b5dd2d" class="i property">CurrentDirectory</a> + <span class="s">&quot;/&quot;</span> + <span class="r15 r">SourceFS</span>.<a href="/pluginner/A.html#147a0dc4280adc32" class="i method">GetMetadata</a>(<span class="r14 r">SourceURL</span>).<a href="/pluginner/A.html#52470894417ea42a" class="i field">Name</a>);

                    <b>if</b> (<span class="r29 r">ibxd</span>.<a href="../InputBox.cs.html#7641cf72e8aa3e00" class="i method">ShowDialog</a>())
                    {
                        <a href="@0@mscorlib/A.html#8281103e6f23cb5c" class="t t">String</a> <span id="r30 rd" class="r30 r">DestinationDirPath</span> = <span class="r29 r">ibxd</span>.<a href="../InputBox.cs.html#8ff9c06778e84a30" class="i property">Result</a>;
                        <span class="c">//копирование каталога</span>
                        <a href="@0@mscorlib/A.html#3980e012bae82e96" class="t t">Thread</a> <span id="r31 rd" class="r31 r">CpDirThread</span> = <b>new</b> <a href="@0@mscorlib/A.html#76f340c84df6da8d" class="t constructor">Thread</a>(<b>delegate</b> () { <a href="../MainWindow-Workers.cs.html#e112d6be00ce2030" class="i method">DoCpDir</a>(<span class="r14 r">SourceURL</span>, <span class="r30 r">DestinationDirPath</span>, <a href="../../Model/MainDataContext.cs.html#9b15721940548510" class="i property">ActivePanel</a>.<a href="/pluginner/A.html#1202d9ced8768431" class="i property">FS</a>, <a href="../../Model/MainDataContext.cs.html#6d9fac18aaec85aa" class="i property">PassivePanel</a>.<a href="/pluginner/A.html#1202d9ced8768431" class="i property">FS</a>); });
                        <span class="r31 r">CpDirThread</span>.<a href="@0@mscorlib/A.html#b4341217f97b123a" class="i method">TrySetApartmentState</a>(<a href="@0@mscorlib/A.html#0ef6964041ada0a3" class="t t">ApartmentState</a>.<a href="@0@mscorlib/A.html#3b2f34c02518c1c7" class="i field">STA</a>);
 
                        <a href="FileProcessDialog.cs.html#f06aec4beb537c6e" class="t t">FileProcessDialog</a> <span id="r32 rd" class="r32 r">CpDirProgressDialog</span> = <b>new</b> <a href="FileProcessDialog.cs.html#577789350c1b1ca0" class="t constructor">FileProcessDialog</a>();
                        <span class="r32 r">CpDirProgressDialog</span>.<a href="/Xwt3/A.html#86317c3e31708d71" class="i property">InitialLocation</a> = <span class="i n">Xwt</span>.<a href="/Xwt3/A.html#c5ac8bbdd62f440d" class="t t">WindowLocation</a>.<a href="/Xwt3/A.html#35c12236ed64b96a" class="i field">CenterParent</a>;
                        <span class="r32 r">CpDirProgressDialog</span>.<a href="FileProcessDialog.cs.html#cfb7deed496b39ab" class="i field">lblStatus</a>.<a href="/Xwt3/A.html#e1385dbb967268cb" class="i property">Text</a> = <a href="@0@mscorlib/A.html#8281103e6f23cb5c" class="t t">String</a>.<a href="@0@mscorlib/A.html#6e5f254563fed78e" class="i method">Format</a>(<a href="../Localizator.cs.html#0b0c6268a53237f4" class="t t">Localizator</a>.<a href="../Localizator.cs.html#546af5a79d2e88a9" class="i method">GetString</a>(<span class="s">&quot;DoingCopy&quot;</span>), <span class="s">&quot;\n&quot;</span> + <a href="../../Model/MainDataContext.cs.html#9b15721940548510" class="i property">ActivePanel</a>.<a href="/pluginner/A.html#3a138ea15450062b" class="i method">GetValue</a>&lt;<b>string</b>&gt;(<a href="../../Model/MainDataContext.cs.html#9b15721940548510" class="i property">ActivePanel</a>.<a href="/pluginner/A.html#90e7608e193237dc" class="i property">df</a>.<a href="/pluginner/A.html#66d073a4f05ed86b" class="i field">URL</a>) + <span class="s">&quot; [&quot;</span> + <a href="../Localizator.cs.html#0b0c6268a53237f4" class="t t">Localizator</a>.<a href="../Localizator.cs.html#546af5a79d2e88a9" class="i method">GetString</a>(<span class="s">&quot;Directory&quot;</span>) + <span class="s">&quot;]\n&quot;</span>, <span class="r29 r">ibxd</span>.<a href="../InputBox.cs.html#8ff9c06778e84a30" class="i property">Result</a>, <b>null</b>);
                        <span class="r32 r">CpDirProgressDialog</span>.<a href="FileProcessDialog.cs.html#17467063a26b2575" class="i field">cmdCancel</a>.<a href="/Xwt3/A.html#5683a347395de938" class="i">Clicked</a> += (<b>object</b> <span id="r33 rd" class="r33 r">s</span>, <a href="@0@mscorlib/A.html#9a1496aa60befd10" class="t t">EventArgs</a> <span id="r34 rd" class="r34 r">e</span>) =&gt; { <span class="r31 r">CpDirThread</span>.<a href="@0@mscorlib/A.html#fbdd377484783e1b" class="i method">Abort</a>(); <a href="/Xwt3/A.html#1e0854feacd0db6d" class="t t">MessageDialog</a>.<a href="/Xwt3/A.html#345b746b6874b51e" class="i method">ShowWarning</a>(<a href="../Localizator.cs.html#0b0c6268a53237f4" class="t t">Localizator</a>.<a href="../Localizator.cs.html#546af5a79d2e88a9" class="i method">GetString</a>(<span class="s">&quot;Canceled&quot;</span>), <a href="../../Model/MainDataContext.cs.html#9b15721940548510" class="i property">ActivePanel</a>.<a href="/pluginner/A.html#3a138ea15450062b" class="i method">GetValue</a>&lt;<b>string</b>&gt;(<a href="../../Model/MainDataContext.cs.html#9b15721940548510" class="i property">ActivePanel</a>.<a href="/pluginner/A.html#90e7608e193237dc" class="i property">df</a>.<a href="/pluginner/A.html#66d073a4f05ed86b" class="i field">URL</a>)); };

                        <span class="r32 r">CpDirProgressDialog</span>.<a href="/Xwt3/A.html#14cc650ccd55476a" class="i method">Show</a>();
                        <span class="r31 r">CpDirThread</span>.<a href="@0@mscorlib/A.html#cd2144b8dd6f4373" class="i method">Start</a>();

                        <b>do</b> { <span class="i n">Xwt</span>.<a href="/Xwt3/A.html#687215caac5b1b53" class="t t">Application</a>.<a href="/Xwt3/A.html#90e66e6f971c8db5" class="i property">MainLoop</a>.<a href="/Xwt3/A.html#590eaa3d920e5f18" class="i method">DispatchPendingEvents</a>(); }
                        <b>while</b> (<span class="r31 r">CpDirThread</span>.<a href="@0@mscorlib/A.html#66a63a6ab576317d" class="i property">ThreadState</a> == <a href="@0@mscorlib/A.html#8ea2224d83e90f0d" class="t t">ThreadState</a>.<a href="@0@mscorlib/A.html#13c6499815acc109" class="i field">Running</a>);

                        <span class="c">//LoadDir(PassivePanel.FSProvider.CurrentDirectory, PassivePanel); //обновление пассивной панели</span>
                        <a href="../../Model/MainDataContext.cs.html#6d9fac18aaec85aa" class="i property">PassivePanel</a>.<a href="/pluginner/A.html#8f2a6b4616ae80bb" class="i method">LoadDir</a>();
                        <span class="r32 r">CpDirProgressDialog</span>.<a href="/Xwt3/A.html#90a8fb1a602385e7" class="i method">Hide</a>();
                    }
                    <b>continue</b>;
                }
                <span class="c">//and, if none of those IF blocks has been entered, say that this isn&#39;t a real file nor a directory</span>
                <span class="i n">Xwt</span>.<a href="/Xwt3/A.html#1e0854feacd0db6d" class="t t">MessageDialog</a>.<a href="/Xwt3/A.html#345b746b6874b51e" class="i method">ShowWarning</a>(
                    <a href="../Localizator.cs.html#0b0c6268a53237f4" class="t t">Localizator</a>.<a href="../Localizator.cs.html#546af5a79d2e88a9" class="i method">GetString</a>(<span class="s">&quot;FileNotFound&quot;</span>),
                    <a href="../../Model/MainDataContext.cs.html#9b15721940548510" class="i property">ActivePanel</a>.<a href="/pluginner/A.html#3a138ea15450062b" class="i method">GetValue</a>&lt;<b>string</b>&gt;(
                        <a href="../../Model/MainDataContext.cs.html#9b15721940548510" class="i property">ActivePanel</a>.<a href="/pluginner/A.html#90e7608e193237dc" class="i property">df</a>.<a href="/pluginner/A.html#66d073a4f05ed86b" class="i field">URL</a>
                    )
                );
 
                <b>continue</b>;
 
            }
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Move the selected file or directory</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <b>public void</b> <a id="f34902de589ca99e" href="../../R/f34902de589ca99e.html" target="n" data-glyph="72,1" class="i method">Mv</a>()
        {
            <b>if</b> (<a href="../../Model/MainDataContext.cs.html#9b15721940548510" class="i property">ActivePanel</a>.<a href="/pluginner/A.html#3a138ea15450062b" class="i method">GetValue</a>&lt;<b>string</b>&gt;(<a href="../../Model/MainDataContext.cs.html#9b15721940548510" class="i property">ActivePanel</a>.<a href="/pluginner/A.html#90e7608e193237dc" class="i property">df</a>.<a href="/pluginner/A.html#f43d0c53b3230ed3" class="i field">DisplayName</a>) == <span class="s">&quot;..&quot;</span>) { <b>return</b>; }
 
            <span class="i n">pluginner</span>.<a href="/pluginner/A.html#a05a46d8951816c2" class="t t">IFSPlugin</a> <span id="r35 rd" class="r35 r">SourceFS</span> = <a href="../../Model/MainDataContext.cs.html#9b15721940548510" class="i property">ActivePanel</a>.<a href="/pluginner/A.html#1202d9ced8768431" class="i property">FS</a>;
            <span class="i n">pluginner</span>.<a href="/pluginner/A.html#a05a46d8951816c2" class="t t">IFSPlugin</a> <span id="r36 rd" class="r36 r">DestinationFS</span> = <a href="../../Model/MainDataContext.cs.html#6d9fac18aaec85aa" class="i property">PassivePanel</a>.<a href="/pluginner/A.html#1202d9ced8768431" class="i property">FS</a>;

            <b>foreach</b> (<a href="../../View.Xaml/ListPanel/ListItemXaml.cs.html#f370823f101f56f2" class="t t">ListView2Canvas</a> <span id="r37 rd" class="r37 r">selitem</span> <b>in</b>
                        (<a href="../../Model/MainDataContext.cs.html#9b15721940548510" class="i property">ActivePanel</a>.<a href="/pluginner/A.html#8f8dcc1691a90fb7" class="i property">ListingView</a> <b>as</b> <a href="/pluginner/A.html#54cdf62f3ae1a20e" class="t t">IListingView</a>&lt;<a href="../../View.Xaml/ListPanel/ListItemXaml.cs.html#f370823f101f56f2" class="t t">ListView2Canvas</a>&gt;)
                            .<a href="/pluginner/A.html#897a4ac1e818c198" class="i property">ChoosedRows</a>)
            {
                <span class="c">//Getting useful URL parts</span>
                <b>string</b> <span id="r38 rd" class="r38 r">SourceName</span> = <span class="r37 r">selitem</span>.<a href="../../View.Xaml/ListPanel/ListItemXaml.cs.html#853c5a1e547eff35" class="i property">Data</a>[<a href="../../Model/MainDataContext.cs.html#9b15721940548510" class="i property">ActivePanel</a>.<a href="/pluginner/A.html#90e7608e193237dc" class="i property">df</a>.<a href="/pluginner/A.html#f43d0c53b3230ed3" class="i field">DisplayName</a>].<a href="@0@mscorlib/A.html#ff31a6bf27c58f89" class="i method">ToString</a>(); <span class="c">//ActivePanel.GetValue&lt;string&gt;(ActivePanel.df.DisplayName);</span>
                <b>string</b> <span id="r39 rd" class="r39 r">SourcePath</span> = <span class="r37 r">selitem</span>.<a href="../../View.Xaml/ListPanel/ListItemXaml.cs.html#853c5a1e547eff35" class="i property">Data</a>[<a href="../../Model/MainDataContext.cs.html#9b15721940548510" class="i property">ActivePanel</a>.<a href="/pluginner/A.html#90e7608e193237dc" class="i property">df</a>.<a href="/pluginner/A.html#66d073a4f05ed86b" class="i field">URL</a>].<a href="@0@mscorlib/A.html#ff31a6bf27c58f89" class="i method">ToString</a>(); <span class="c">//ActivePanel.GetValue&lt;string&gt;(ActivePanel.df.URL);</span>
                <b>string</b> <span id="r40 rd" class="r40 r">DestinationPath</span> = <span class="r36 r">DestinationFS</span>.<a href="/pluginner/A.html#53050e9ff0b5dd2d" class="i property">CurrentDirectory</a> + <span class="r36 r">DestinationFS</span>.<a href="/pluginner/A.html#e10c6e92e153d997" class="i property">DirSeparator</a> + <span class="r38 r">SourceName</span>;

<span class="k preprocess">#</span><span class="k preprocess">if</span> <span class="i">XWT</span>
<span class="e">                InputBox ibx = new InputBox
                    (
                    string.Format(Localizator.GetString(&quot;MoveTo&quot;), SourceName),
                    DestinationPath
                    );
                if (ibx.ShowDialog())
                    DestinationPath = ibx.Result;
                else return;

                // Comparing the filesystems; if they is diffrent, use copy&amp;delete
                // instead of direct move (if anyone knows, how a file can be moved
                // from an FTP to an ext2fs on Windows or MacOS please tell me :-) )
                if (SourceFS.GetType() != DestinationFS.GetType())
                {
                    Xwt.MessageDialog
                        .ShowError(&quot;Cannot move between diffrent filesystems!\nНе сделана поддержка перемещения между разными ФС.&quot;);
                    Cp();
                    return;
                    //todo
                }

                //Now, assuming that the src &amp; dest fs is same and supports
                //cross-disk file moving

                if (SourcePath == DestinationPath)
                {
                    string itself = Localizator.GetString(&quot;CantCopySelf&quot;);
                    string toshow = string.Format(Localizator.GetString(&quot;CantMove&quot;), SourcePath, itself);

                    Xwt.Application.Invoke(delegate { Xwt.MessageDialog.ShowWarning(toshow); });
                    //calling the msgbox in non-main threads causes some UI bugs, thus pushing this call into main thread
                    return;
                }

                if (SourceFS.DirectoryExists(SourcePath))
                {//this is a directory
                    SourceFS.MoveDirectory(SourcePath, DestinationPath);
                }
                if (SourceFS.FileExists(SourcePath))
                {//this is a file
                    SourceFS.MoveFile(SourcePath, DestinationPath);
                }
</span><span class="k preprocess">#</span><span class="k preprocess">endif</span>

                <span class="c">//ActivePanel.LoadDir();</span>
                <span class="c">//PassivePanel.LoadDir();</span>
            }
        }
    }
}
</pre></td></tr></table></div></body></html>
