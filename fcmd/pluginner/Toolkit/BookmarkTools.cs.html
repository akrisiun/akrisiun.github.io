<!DOCTYPE html>
<html><head><title>BookmarkTools.cs</title><link rel="stylesheet" href="../../styles.css"><script src="../../scripts.js"></script></head>
<body class="cB" onload="i(311);"><div class="dH">
<table style="width: 100%">
<tr><td>File: <a id="filePath" class="blueLink" href="/#pluginner/Toolkit/BookmarkTools.cs" target="_top">Toolkit\BookmarkTools.cs</a><br/></td><td></td></tr>
<tr><td>Project: <a id="projectPath" class="blueLink" href="/#pluginner" target="_top">fcmd\pluginner\pluginner.csproj</a> (pluginner)</td><td></td></tr>
</table>
</div>
<div class="cz"><table class="tb" cellpadding="0" cellspacing="0"><tr><td valign="top" align="right"><pre id="ln"></pre></td><td valign="top" align="left"><pre id="code">
<span class="c">/* The File Commander - plugin API
 * Bookmark parser
 * (C) The File Commander Team - https://github.com/atauenis/fcmd
 * (C) 2014, Alexander Tauenis (atauenis@yandex.ru)
 * Contributors should place own signs here.
 */</span>

<b>using</b> <span class="i n">System</span>;
<b>using</b> <span class="i n">System</span>.<span class="i n">Collections</span>.<span class="i n">Generic</span>;
<b>using</b> <span class="i n">System</span>.<span class="i n">IO</span>;
<b>using</b> <span class="i n">System</span>.<span class="i n">Xml</span>;
<b>using</b> <span class="i n">Xwt</span>;
<b>using</b> <span class="t">Image</span> = <span class="i n">Xwt</span>.<span class="i n">Drawing</span>.<a href="/Xwt3/A.html#0e6b2faf07047267" class="t t">Image</a>;

<b>namespace</b> <span class="i n">pluginner</span>.<span class="i n">Toolkit</span>
{
    <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span><span class="c">Bookmark menu tools</span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
    <b>public class</b> <a id="d95d0e40871c6746" href="../R/../../0000000000.html" target="n" data-glyph="0,0" class="t t">BookmarkTools</a>
    {
        <a href="@0@mscorlib/A.html#cf7f4095e4de7646" class="t t">List</a>&lt;<a href="#504a9776da968dd9" class="t t">Bookmark</a>&gt; <a id="287cfe01daa1630f" href="../R/287cfe01daa1630f.html" target="n" data-glyph="46,1" class="i field">bookmarks</a> = <b>new</b> <a href="@0@mscorlib/A.html#9e5352b2b304ceba" class="t constructor">List</a>&lt;<a href="#504a9776da968dd9" class="t t">Bookmark</a>&gt;();
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span><span class="c">Initialize bookmark menu toolkit</span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span><span class="c"> </span><span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r0 r">BookmarkXML</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">The bookmark database (in XML format)</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span><span class="c"> </span><span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r1 r">Category</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">&quot;QuickAccessBar&quot;, &quot;BookmarksMenu&quot; or &quot;UserMenu&quot;</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <b>public</b> <a id="f7268b8f5ee0b070" href="../R/../../0000000000.html" target="n" data-glyph="72,1" class="i constructor">BookmarkTools</a>(<b>string</b> <span id="r0 rd" class="r0 r">BookmarkXML</span> = <b>null</b>, <b>string</b> <span id="r1 rd" class="r1 r">Category</span> = <span class="s">&quot;BookmarksMenu&quot;</span>)
        {
            <b>if</b> (<span class="r0 r">BookmarkXML</span> == <b>null</b>)
            {
                <span class="r0 r">BookmarkXML</span> = <a href="Utilities.cs.html#5fd4a8de29bac7e7" class="t t">Utilities</a>.<a href="Utilities.cs.html#ec3167c4e5ad00d7" class="i method">GetEmbeddedResource</a>(<span class="s">&quot;DefaultBookmarks.xml&quot;</span>);
                <b>if</b> (<span class="r0 r">BookmarkXML</span> == <b>null</b>) <b>throw</b> <b>new</b> <a href="@0@mscorlib/A.html#df2d82d91ca29e40" class="t constructor">Exception</a>(<span class="s">&quot;Cannot load pluginner.dll::DefaultBookmarks.xml&quot;</span>);
            }
 
            <a href="@0@System.Xml/A.html#f82a4c1bd1f0ee12" class="t t">XmlDocument</a> <span id="r2 rd" class="r2 r">bmDoc</span> = <b>new</b> <a href="@0@System.Xml/A.html#2d559a81f89e826f" class="t constructor">XmlDocument</a>();
            <span class="r2 r">bmDoc</span>.<a href="@0@System.Xml/A.html#774e340cfa235dc6" class="i method">LoadXml</a>(<span class="r0 r">BookmarkXML</span>);
            <a href="@0@System.Xml/A.html#c86ee4610278a863" class="t t">XmlNodeList</a> <span id="r3 rd" class="r3 r">items</span> = <span class="r2 r">bmDoc</span>.<a href="@0@System.Xml/A.html#452b842aece0f532" class="i method">GetElementsByTagName</a>(<span class="s">&quot;SpeedDial&quot;</span>);
            <b>foreach</b> (<a href="@0@System.Xml/A.html#735249b64d244851" class="t t">XmlNode</a> <span id="r4 rd" class="r4 r">x</span> <b>in</b> <span class="r3 r">items</span>)
            {<span class="c">//parsing speed dials</span>
                <b>if</b> (
                    <span class="r4 r">x</span>.<a href="@0@System.Xml/A.html#86643abd2a4fe7a2" class="i property">Attributes</a> != <b>null</b>
                    &amp;&amp;
                    <span class="r4 r">x</span>.<a href="@0@System.Xml/A.html#86643abd2a4fe7a2" class="i property">Attributes</a>.<a href="@0@System.Xml/A.html#e659ff77846b06eb" class="i method">GetNamedItem</a>(<span class="s">&quot;type&quot;</span>) != <b>null</b>
                    &amp;&amp;
                    <span class="r4 r">x</span>.<a href="@0@System.Xml/A.html#86643abd2a4fe7a2" class="i property">Attributes</a>.<a href="@0@System.Xml/A.html#e659ff77846b06eb" class="i method">GetNamedItem</a>(<span class="s">&quot;type&quot;</span>).<a href="@0@System.Xml/A.html#419e50e206d75bb5" class="i property">Value</a> == <span class="r1 r">Category</span>
                )
                {
                    <b>foreach</b> (<a href="@0@System.Xml/A.html#735249b64d244851" class="t t">XmlNode</a> <span id="r5 rd" class="r5 r">xc</span> <b>in</b> <span class="r4 r">x</span>.<a href="@0@System.Xml/A.html#ce940d5c84a21523" class="i property">ChildNodes</a>)
                    {<span class="c">//parsing bookmark list</span>
                        <b>if</b> (<span class="r5 r">xc</span>.<a href="@0@System.Xml/A.html#86643abd2a4fe7a2" class="i property">Attributes</a> != <b>null</b>)
                        {
                            <b>if</b> (<span class="r5 r">xc</span>.<a href="@0@System.Xml/A.html#9bd9c33f732c247e" class="i property">Name</a> == <span class="s">&quot;AutoBookmarks&quot;</span>) <span class="c">//автозакладка</span>
                            {
                                <b>switch</b> (<span class="r5 r">xc</span>.<a href="@0@System.Xml/A.html#86643abd2a4fe7a2" class="i property">Attributes</a>.<a href="@0@System.Xml/A.html#e659ff77846b06eb" class="i method">GetNamedItem</a>(<span class="s">&quot;type&quot;</span>).<a href="@0@System.Xml/A.html#419e50e206d75bb5" class="i property">Value</a>)
                                {
                                    <b>case</b> <span class="s">&quot;System.IO.DriveInfo.GetDrives&quot;</span>:
                                        <a href="#287cfe01daa1630f" class="i field">bookmarks</a>.<a href="@0@mscorlib/A.html#e569d850a66a1771" class="i method">AddRange</a>(<a href="#55e5670807322f17" class="i method">AddSysDrives</a>());
                                        <b>break</b>;
                                    <b>case</b> <span class="s">&quot;LinuxMounts&quot;</span>:
                                        <a href="#287cfe01daa1630f" class="i field">bookmarks</a>.<a href="@0@mscorlib/A.html#e569d850a66a1771" class="i method">AddRange</a>(<a href="#fe6a6bcf25a53517" class="i method">AddLinuxMounts</a>());
                                        <b>break</b>;
                                        <span class="c">//todo: LinuxSystemDirs (/), LinuxUserMounts, MacMounts</span>
                                }
                            }
                            <b>else if</b> (<span class="r5 r">xc</span>.<a href="@0@System.Xml/A.html#9bd9c33f732c247e" class="i property">Name</a> == <span class="s">&quot;Bookmark&quot;</span>) <span class="c">//простая закладка</span>
                            {
                                <a href="#238542e5bbfccd88" class="i method">ParseBookmarkNode</a>(<span class="r5 r">xc</span>);
                            }
                        }
                    }
                }
            }
        }
 
        <b>private void</b> <a id="238542e5bbfccd88" href="../R/238542e5bbfccd88.html" target="n" data-glyph="76,1" class="i method">ParseBookmarkNode</a>(<a href="@0@System.Xml/A.html#735249b64d244851" class="t t">XmlNode</a> <span id="r6 rd" class="r6 r">XN</span>, <a href="#504a9776da968dd9" class="t t">Bookmark</a> <span id="r7 rd" class="r7 r">UpperBookmark</span> = <b>null</b>)
        {
            <b>try</b>
            {
                <span class="c">//overall</span>
                <a href="#504a9776da968dd9" class="t t">Bookmark</a> <span id="r8 rd" class="r8 r">bm</span> = <b>new</b> <a href="#504a9776da968dd9" class="t constructor">Bookmark</a>();
                <span class="r8 r">bm</span>.<a href="#721577d41d698985" class="i property">title</a> = <span class="r6 r">XN</span>.<a href="@0@System.Xml/A.html#86643abd2a4fe7a2" class="i property">Attributes</a>.<a href="@0@System.Xml/A.html#e659ff77846b06eb" class="i method">GetNamedItem</a>(<span class="s">&quot;title&quot;</span>).<a href="@0@System.Xml/A.html#419e50e206d75bb5" class="i property">Value</a>;
                <b>if</b> (<span class="r6 r">XN</span>.<a href="@0@System.Xml/A.html#83aaee867e1523fb" class="i property">OuterXml</a>.<a href="@0@mscorlib/A.html#7d6aed52d875ec59" class="i method">IndexOf</a>(<span class="s">&quot;icon=&quot;</span>, <a href="@0@mscorlib/A.html#702797def97ecb7c" class="t t">StringComparison</a>.<a href="@0@mscorlib/A.html#87891a6d28c64c9b" class="i field">Ordinal</a>) &gt; 0)
                    <span class="r8 r">bm</span>.<a href="#c8cf56878dc65c24" class="i property">Icon</a> = <span class="r6 r">XN</span>.<a href="@0@System.Xml/A.html#86643abd2a4fe7a2" class="i property">Attributes</a>.<a href="@0@System.Xml/A.html#e659ff77846b06eb" class="i method">GetNamedItem</a>(<span class="s">&quot;icon&quot;</span>).<a href="@0@System.Xml/A.html#419e50e206d75bb5" class="i property">Value</a>;
 
                <span class="c">//if the bookmark is container</span>
                <b>if</b> (<span class="r6 r">XN</span>.<a href="@0@System.Xml/A.html#e24a222c531aba25" class="i property">HasChildNodes</a>)
                {
                    <span class="r8 r">bm</span>.<a href="#bfd3dd9b6ffaa93c" class="i field">SubMenu</a> = <b>new</b> <a href="@0@mscorlib/A.html#9e5352b2b304ceba" class="t constructor">List</a>&lt;<a href="#504a9776da968dd9" class="t t">Bookmark</a>&gt;();
                    <b>foreach</b> (<a href="@0@System.Xml/A.html#735249b64d244851" class="t t">XmlNode</a> <span id="r9 rd" class="r9 r">SubXN</span> <b>in</b> <span class="r6 r">XN</span>.<a href="@0@System.Xml/A.html#ce940d5c84a21523" class="i property">ChildNodes</a>)
                    {
                        <a href="#238542e5bbfccd88" class="i method">ParseBookmarkNode</a>(<span class="r9 r">SubXN</span>, <span class="r8 r">bm</span>);
                    }
                }
                <span class="c">//if it is not a container</span>
                <b>else</b>
                {
                    <span class="r8 r">bm</span>.<a href="#26f7114fc75d7fd7" class="i property">url</a> = <span class="r6 r">XN</span>.<a href="@0@System.Xml/A.html#86643abd2a4fe7a2" class="i property">Attributes</a>.<a href="@0@System.Xml/A.html#e659ff77846b06eb" class="i method">GetNamedItem</a>(<span class="s">&quot;url&quot;</span>).<a href="@0@System.Xml/A.html#419e50e206d75bb5" class="i property">Value</a>;
                }
 
                <b>if</b> (<span class="r7 r">UpperBookmark</span> == <b>null</b>)
                    <a href="#287cfe01daa1630f" class="i field">bookmarks</a>.<a href="@0@mscorlib/A.html#9cc11588bffd57c1" class="i method">Add</a>(<span class="r8 r">bm</span>);
                <b>else</b>
                    <span class="r7 r">UpperBookmark</span>.<a href="#bfd3dd9b6ffaa93c" class="i field">SubMenu</a>.<a href="@0@mscorlib/A.html#9cc11588bffd57c1" class="i method">Add</a>(<span class="r8 r">bm</span>);
            }
            <b>catch</b>
            {
                <a href="@0@mscorlib/A.html#f907d79481da6ba4" class="t t">Console</a>.<a href="@0@mscorlib/A.html#5ac7c4fda643413b" class="i method">WriteLine</a>(<span class="s">&quot;WARNING: Invalid bookmark declaration: &quot;</span> + <span class="r6 r">XN</span>.<a href="@0@System.Xml/A.html#83aaee867e1523fb" class="i property">OuterXml</a>);
            }
        }
 
<span class="k preprocess">#</span><span class="k preprocess">if</span> <span class="i">XWT</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span><span class="c">Display bookmark list to the XWT Box as an array of Buttons</span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span><span class="c"> </span><span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r10 r">box</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">The XWT box</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span><span class="c"> </span><span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r11 r">OnClick</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">What should happen if user clicks the bookmark</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span><span class="c"> </span><span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="i">s</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">The Stylist that should apply usertheme to the button (or null)</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <b>public void</b> <a id="8772ba6bb31e19d2" href="../R/../../0000000000.html" target="n" data-glyph="72,1" class="i method">DisplayBookmarks</a>(<a href="/Xwt3/A.html#5e31d6eea8411715" class="t t">Box</a> <span id="r10 rd" class="r10 r">box</span>, <a href="@0@mscorlib/A.html#486d58da4553e12d" class="t t">Action</a>&lt;<b>string</b>&gt; <span id="r11 rd" class="r11 r">OnClick</span>) <span class="c">//, Stylist s = null)</span>
        {
            <span class="c">//if (s == null) s = new Stylist();</span>
            <span class="r10 r">box</span>.<a href="/Xwt3/A.html#ec377d58e3798666" class="i method">Clear</a>();
            <b>foreach</b> (<a href="#504a9776da968dd9" class="t t">Bookmark</a> <span id="r12 rd" class="r12 r">b</span> <b>in</b> <a href="#287cfe01daa1630f" class="i field">bookmarks</a>)
            {
                <b>string</b> <span id="r13 rd" class="r13 r">url</span> = <span class="r12 r">b</span>.<a href="#26f7114fc75d7fd7" class="i property">url</a>;
                <a href="/Xwt3/A.html#59d3b598bac6fbbe" class="t t">MenuButton</a> <span id="r14 rd" class="r14 r">NewBtn</span> = <b>new</b> <a href="/Xwt3/A.html#51af4c3562c0fc73" class="t constructor">MenuButton</a>(<b>null</b>, <span class="r12 r">b</span>.<a href="#721577d41d698985" class="i property">title</a>);
                <b>if</b> (<span class="r12 r">b</span>.<a href="#bfd3dd9b6ffaa93c" class="i field">SubMenu</a> != <b>null</b>)
                {
                    <span class="r14 r">NewBtn</span>.<a href="/Xwt3/A.html#77d1fb02483f1fbe" class="i property">Type</a> = <a href="/Xwt3/A.html#843063b213c3c68e" class="t t">ButtonType</a>.<a href="/Xwt3/A.html#eb7a29eb41b917c8" class="i field">DropDown</a>;
                    <span class="r14 r">NewBtn</span>.<a href="/Xwt3/A.html#d2b4adbcff713ad7" class="i property">Menu</a> = <a href="#5cdc4e77fb7ea539" class="i method">GetBookmarkSubmenu</a>(<span class="r12 r">b</span>, <span class="r11 r">OnClick</span>);
                }
                <b>else</b>
                { <span class="r14 r">NewBtn</span>.<a href="/Xwt3/A.html#5683a347395de938" class="i">Clicked</a> += (<span id="r15 rd" class="r15 r">o</span>, <span id="r16 rd" class="r16 r">ea</span>) =&gt; <span class="r11 r">OnClick</span>(<span class="r13 r">url</span>); }
                <span class="r14 r">NewBtn</span>.<a href="/Xwt3/A.html#e9c9d0704b1f1d4e" class="i property">CanGetFocus</a> = <b>false</b>;
                <span class="r14 r">NewBtn</span>.<a href="/Xwt3/A.html#e38b702435052566" class="i property">Style</a> = <a href="/Xwt3/A.html#4959d1862d581536" class="t t">ButtonStyle</a>.<a href="/Xwt3/A.html#dc23fc2b55c3dd18" class="i field">Flat</a>;
                <span class="r14 r">NewBtn</span>.<a href="/Xwt3/A.html#496a2d688d2fa410" class="i property">Margin</a> = -3;
                <span class="r14 r">NewBtn</span>.<a href="/Xwt3/A.html#47d298ced7ae2fad" class="i property">Cursor</a> = <a href="/Xwt3/A.html#22050d35620c4cdb" class="t t">CursorType</a>.<a href="/Xwt3/A.html#c6dfe5f7ec128c92" class="i field">Hand</a>;
                <span class="r14 r">NewBtn</span>.<a href="/Xwt3/A.html#b476bad491cddc4b" class="i property">Image</a> = <span class="r12 r">b</span>.<a href="#20ff95e05ea1ac48" class="i method">GetIcon</a>();
                <span class="c">// s.Stylize(NewBtn);</span>
                <span class="r10 r">box</span>.<a href="/Xwt3/A.html#f76c11cd7b75d2d8" class="i method">PackStart</a>(<span class="r14 r">NewBtn</span>);
            }
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span><span class="c">Display bookmark list to the specifed XWT Menu</span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span><span class="c"> </span><span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r17 r">mnu</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">The XWT menu</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span><span class="c"> </span><span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r18 r">OnClick</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">What should happen if user clicks the bookmark</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <b>public void</b> <a id="fd17f92bb316b3ba" href="../R/../../0000000000.html" target="n" data-glyph="72,1" class="i method">DisplayBookmarks</a>(<a href="/Xwt3/A.html#19a610eb0dfd2273" class="t t">Menu</a> <span id="r17 rd" class="r17 r">mnu</span>, <a href="@0@mscorlib/A.html#486d58da4553e12d" class="t t">Action</a>&lt;<b>string</b>&gt; <span id="r18 rd" class="r18 r">OnClick</span>)
        {
            <b>if</b> (<span class="r17 r">mnu</span> == <b>null</b>) <span class="r17 r">mnu</span> = <b>new</b> <a href="/Xwt3/A.html#73e9b13e2912e1d9" class="t constructor">Menu</a>();
            <span class="r17 r">mnu</span>.<a href="/Xwt3/A.html#f515510160c31aae" class="i property">Items</a>.<a href="@0@mscorlib/A.html#1c7184c9f3526d9d" class="i method">Clear</a>();
            <b>foreach</b> (<a href="#504a9776da968dd9" class="t t">Bookmark</a> <span id="r19 rd" class="r19 r">b</span> <b>in</b> <a href="#287cfe01daa1630f" class="i field">bookmarks</a>)
            {
                <b>string</b> <span id="r20 rd" class="r20 r">url</span> = <span class="r19 r">b</span>.<a href="#26f7114fc75d7fd7" class="i property">url</a>;
                <a href="/Xwt3/A.html#60cd30035f288f32" class="t t">MenuItem</a> <span id="r21 rd" class="r21 r">mi</span> = <b>new</b> <a href="/Xwt3/A.html#a484a40fe2133cd7" class="t constructor">MenuItem</a>();
                <span class="r21 r">mi</span>.<a href="/Xwt3/A.html#bea30fddfe6bb1c3" class="i">Clicked</a> += (<span id="r22 rd" class="r22 r">o</span>, <span id="r23 rd" class="r23 r">ea</span>) =&gt; <span class="r18 r">OnClick</span>(<span class="r20 r">url</span>);
                <span class="r21 r">mi</span>.<a href="/Xwt3/A.html#93c18e62f924fbe1" class="i property">Label</a> = <span class="r19 r">b</span>.<a href="#721577d41d698985" class="i property">title</a>;
                <span class="r21 r">mi</span>.<a href="/Xwt3/A.html#dda273163b29212a" class="i property">Image</a> = <span class="r19 r">b</span>.<a href="#20ff95e05ea1ac48" class="i method">GetIcon</a>();
                <b>if</b> (<span class="r19 r">b</span>.<a href="#bfd3dd9b6ffaa93c" class="i field">SubMenu</a> != <b>null</b>) <span class="r21 r">mi</span>.<a href="/Xwt3/A.html#6b1abeaa367fd6b3" class="i property">SubMenu</a> = <a href="#5cdc4e77fb7ea539" class="i method">GetBookmarkSubmenu</a>(<span class="r19 r">b</span>, <span class="r18 r">OnClick</span>);
                <span class="r17 r">mnu</span>.<a href="/Xwt3/A.html#f515510160c31aae" class="i property">Items</a>.<a href="@0@mscorlib/A.html#5c61cc24de82f7e7" class="i method">Add</a>(<span class="r21 r">mi</span>);
            }
        }
<span class="k preprocess">#</span><span class="k preprocess">endif</span>
        <b>private</b> <a href="/Xwt3/A.html#19a610eb0dfd2273" class="t t">Menu</a> <a id="5cdc4e77fb7ea539" href="../R/5cdc4e77fb7ea539.html" target="n" data-glyph="76,1" class="i method">GetBookmarkSubmenu</a>(<a href="#504a9776da968dd9" class="t t">Bookmark</a> <span id="r24 rd" class="r24 r">bookmark</span>, <a href="@0@mscorlib/A.html#486d58da4553e12d" class="t t">Action</a>&lt;<b>string</b>&gt; <span id="r25 rd" class="r25 r">OnClick</span>)
        {
            <a href="/Xwt3/A.html#19a610eb0dfd2273" class="t t">Menu</a> <span id="r26 rd" class="r26 r">mnu</span> = <b>new</b> <a href="/Xwt3/A.html#73e9b13e2912e1d9" class="t constructor">Menu</a>();
            <b>if</b> (<span class="r24 r">bookmark</span>.<a href="#bfd3dd9b6ffaa93c" class="i field">SubMenu</a> == <b>null</b>) <b>throw</b> <b>new</b> <a href="@0@mscorlib/A.html#4b20cd3790b6426a" class="t constructor">ArgumentException</a>(<span class="s">&quot;The bookmark should have a submenu&quot;</span>, <span class="s">&quot;bookmark&quot;</span>);
 
            <a href="@0@mscorlib/A.html#cf7f4095e4de7646" class="t t">List</a>&lt;<a href="#504a9776da968dd9" class="t t">Bookmark</a>&gt; <span id="r27 rd" class="r27 r">lbm</span> = <span class="r24 r">bookmark</span>.<a href="#bfd3dd9b6ffaa93c" class="i field">SubMenu</a>;
            <b>foreach</b> (<a href="#504a9776da968dd9" class="t t">Bookmark</a> <span id="r28 rd" class="r28 r">b</span> <b>in</b> <span class="r27 r">lbm</span>)
            {
                <a href="/Xwt3/A.html#60cd30035f288f32" class="t t">MenuItem</a> <span id="r29 rd" class="r29 r">mi</span> = <b>new</b> <a href="/Xwt3/A.html#a484a40fe2133cd7" class="t constructor">MenuItem</a>();
                <span class="r29 r">mi</span>.<a href="/Xwt3/A.html#93c18e62f924fbe1" class="i property">Label</a> = <span class="r28 r">b</span>.<a href="#721577d41d698985" class="i property">title</a>;
                <span class="r29 r">mi</span>.<a href="/Xwt3/A.html#dda273163b29212a" class="i property">Image</a> = <span class="r28 r">b</span>.<a href="#20ff95e05ea1ac48" class="i method">GetIcon</a>();
 
                <b>if</b> (<span class="r28 r">b</span>.<a href="#bfd3dd9b6ffaa93c" class="i field">SubMenu</a> == <b>null</b>)
                {
                    <b>string</b> <span id="r30 rd" class="r30 r">url</span> = <span class="r28 r">b</span>.<a href="#26f7114fc75d7fd7" class="i property">url</a>;
                    <span class="r29 r">mi</span>.<a href="/Xwt3/A.html#bea30fddfe6bb1c3" class="i">Clicked</a> += (<span id="r31 rd" class="r31 r">o</span>, <span id="r32 rd" class="r32 r">ea</span>) =&gt; <span class="r25 r">OnClick</span>(<span class="r30 r">url</span>);
 
                }
                <b>else</b>
                {
                    <span class="r29 r">mi</span>.<a href="/Xwt3/A.html#6b1abeaa367fd6b3" class="i property">SubMenu</a> = <a href="#5cdc4e77fb7ea539" class="i method">GetBookmarkSubmenu</a>(<span class="r28 r">b</span>, <span class="r25 r">OnClick</span>);
                }
                <span class="r26 r">mnu</span>.<a href="/Xwt3/A.html#f515510160c31aae" class="i property">Items</a>.<a href="@0@mscorlib/A.html#5c61cc24de82f7e7" class="i method">Add</a>(<span class="r29 r">mi</span>);
            }
 
            <b>return</b> <span class="r26 r">mnu</span>;
        }
 
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span><span class="c">Add bookmarks of mounted medias (*nix)</span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <b>private</b> <a href="@0@mscorlib/A.html#cf7f4095e4de7646" class="t t">List</a>&lt;<a href="#504a9776da968dd9" class="t t">Bookmark</a>&gt; <a id="fe6a6bcf25a53517" href="../R/fe6a6bcf25a53517.html" target="n" data-glyph="76,1" class="i method">AddLinuxMounts</a>()
        {
            <a href="@0@mscorlib/A.html#cf7f4095e4de7646" class="t t">List</a>&lt;<a href="#504a9776da968dd9" class="t t">Bookmark</a>&gt; <span id="r33 rd" class="r33 r">bms</span> = <b>new</b> <a href="@0@mscorlib/A.html#9e5352b2b304ceba" class="t constructor">List</a>&lt;<a href="#504a9776da968dd9" class="t t">Bookmark</a>&gt;();
 
            <b>if</b> (<a href="@0@mscorlib/A.html#b3ad5f0ba800bb28" class="t t">Directory</a>.<a href="@0@mscorlib/A.html#6a2a3bee6b62826f" class="i method">Exists</a>(<span class="s">@&quot;/mnt&quot;</span>))
            {
                <b>foreach</b> (<b>string</b> <span id="r34 rd" class="r34 r">dir</span> <b>in</b> <a href="@0@mscorlib/A.html#b3ad5f0ba800bb28" class="t t">Directory</a>.<a href="@0@mscorlib/A.html#44b0fd73d2306777" class="i method">GetDirectories</a>(<span class="s">@&quot;/mnt/&quot;</span>))
                {
                    <a href="#504a9776da968dd9" class="t t">Bookmark</a> <span id="r35 rd" class="r35 r">bm</span> = <b>new</b> <a href="#504a9776da968dd9" class="t constructor">Bookmark</a>();
                    <span class="r35 r">bm</span>.<a href="#26f7114fc75d7fd7" class="i property">url</a> = <span class="s">&quot;file://&quot;</span> + <span class="r34 r">dir</span>;
                    <span class="r35 r">bm</span>.<a href="#721577d41d698985" class="i property">title</a> = <span class="r34 r">dir</span>.<a href="@0@mscorlib/A.html#69fc1d0aa6df8a90" class="i method">Replace</a>(<span class="s">@&quot;/mnt/&quot;</span>, <span class="s">&quot;&quot;</span>);
                    <span class="r35 r">bm</span>.<a href="#c8cf56878dc65c24" class="i property">Icon</a> = <span class="s">&quot;(internal)drive-removable-media.png&quot;</span>;
                    <span class="r33 r">bms</span>.<a href="@0@mscorlib/A.html#9cc11588bffd57c1" class="i method">Add</a>(<span class="r35 r">bm</span>);
                }
            }
            <b>else return</b> <a href="#55e5670807322f17" class="i method">AddSysDrives</a>(); <span class="c">//fallback for Windows</span>
 
            <b>return</b> <span class="r33 r">bms</span>;
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span><span class="c">Add bookmarks of mounted medias (Windows)</span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <b>private</b> <a href="@0@mscorlib/A.html#cf7f4095e4de7646" class="t t">List</a>&lt;<a href="#504a9776da968dd9" class="t t">Bookmark</a>&gt; <a id="55e5670807322f17" href="../R/55e5670807322f17.html" target="n" data-glyph="76,1" class="i method">AddSysDrives</a>()
        {
            <a href="@0@mscorlib/A.html#cf7f4095e4de7646" class="t t">List</a>&lt;<a href="#504a9776da968dd9" class="t t">Bookmark</a>&gt; <span id="r36 rd" class="r36 r">bms</span> = <b>new</b> <a href="@0@mscorlib/A.html#9e5352b2b304ceba" class="t constructor">List</a>&lt;<a href="#504a9776da968dd9" class="t t">Bookmark</a>&gt;();
            <b>foreach</b> (<a href="@0@mscorlib/A.html#5e187a6c915470e6" class="t t">DriveInfo</a> <span id="r37 rd" class="r37 r">di</span> <b>in</b> <a href="@0@mscorlib/A.html#5e187a6c915470e6" class="t t">DriveInfo</a>.<a href="@0@mscorlib/A.html#8daa70509a84df48" class="i method">GetDrives</a>())
            {
                <a href="#504a9776da968dd9" class="t t">Bookmark</a> <span id="r38 rd" class="r38 r">bm</span> = <b>new</b> <a href="#504a9776da968dd9" class="t constructor">Bookmark</a>();
                <span class="r38 r">bm</span>.<a href="#721577d41d698985" class="i property">title</a> = <span class="r37 r">di</span>.<a href="@0@mscorlib/A.html#b5ab0d04bb24de60" class="i property">Name</a>;
                <span class="r38 r">bm</span>.<a href="#26f7114fc75d7fd7" class="i property">url</a> = <span class="s">&quot;file://&quot;</span> + <span class="r37 r">di</span>.<a href="@0@mscorlib/A.html#b5ab0d04bb24de60" class="i property">Name</a>;
                <span class="c">/*if (di.IsReady)
				{
					NewBtn.TooltipText = di.VolumeLabel + &quot; (&quot; + di.DriveFormat + &quot;)&quot;;
				}*/</span>
 
                <b>switch</b> (<span class="r37 r">di</span>.<a href="@0@mscorlib/A.html#1e17037191cfedb7" class="i property">DriveType</a>)
                {
                    <b>case</b> <a href="@0@mscorlib/A.html#74d2c6a418f08beb" class="t t">DriveType</a>.<a href="@0@mscorlib/A.html#8289c235cb460559" class="i field">Fixed</a>:
                        <span class="r38 r">bm</span>.<a href="#c8cf56878dc65c24" class="i property">Icon</a> = <span class="s">&quot;(internal)drive-harddisk.png&quot;</span>;
                        <b>break</b>;
                    <b>case</b> <a href="@0@mscorlib/A.html#74d2c6a418f08beb" class="t t">DriveType</a>.<a href="@0@mscorlib/A.html#5768f47a7e424550" class="i field">CDRom</a>:
                        <span class="r38 r">bm</span>.<a href="#c8cf56878dc65c24" class="i property">Icon</a> = <span class="s">&quot;(internal)drive-optical.png&quot;</span>;
                        <b>break</b>;
                    <b>case</b> <a href="@0@mscorlib/A.html#74d2c6a418f08beb" class="t t">DriveType</a>.<a href="@0@mscorlib/A.html#a62754006493d1e6" class="i field">Removable</a>:
                        <span class="r38 r">bm</span>.<a href="#c8cf56878dc65c24" class="i property">Icon</a> = <span class="s">&quot;(internal)drive-removable-media.png&quot;</span>;
                        <b>break</b>;
                    <b>case</b> <a href="@0@mscorlib/A.html#74d2c6a418f08beb" class="t t">DriveType</a>.<a href="@0@mscorlib/A.html#af47a924ec610e04" class="i field">Network</a>:
                        <span class="r38 r">bm</span>.<a href="#c8cf56878dc65c24" class="i property">Icon</a> = <span class="s">&quot;(internal)network-server.png&quot;</span>;
                        <b>break</b>;
                    <b>case</b> <a href="@0@mscorlib/A.html#74d2c6a418f08beb" class="t t">DriveType</a>.<a href="@0@mscorlib/A.html#48761dace4f391f6" class="i field">Ram</a>:
                        <span class="r38 r">bm</span>.<a href="#c8cf56878dc65c24" class="i property">Icon</a> = <span class="s">&quot;(internal)emblem-system.png&quot;</span>;
                        <b>break</b>;
                    <b>case</b> <a href="@0@mscorlib/A.html#74d2c6a418f08beb" class="t t">DriveType</a>.<a href="@0@mscorlib/A.html#aa632552363287b5" class="i field">Unknown</a>:
                        <span class="r38 r">bm</span>.<a href="#c8cf56878dc65c24" class="i property">Icon</a> = <span class="s">&quot;(internal)image-missing.png&quot;</span>;
                        <b>break</b>;
                }
 
                <b>string</b> <span id="r39 rd" class="r39 r">d</span> = <span class="r37 r">di</span>.<a href="@0@mscorlib/A.html#b5ab0d04bb24de60" class="i property">Name</a>;
                <span class="c">//OS-specific icons</span>
                <b>if</b> (<span class="r39 r">d</span>.<a href="@0@mscorlib/A.html#23804789ea4c9c0e" class="i method">StartsWith</a>(<span class="s">&quot;A:&quot;</span>)) <span class="r38 r">bm</span>.<a href="#c8cf56878dc65c24" class="i property">Icon</a> = <span class="s">&quot;(internal)media-floppy.png&quot;</span>;
                <b>if</b> (<span class="r39 r">d</span>.<a href="@0@mscorlib/A.html#23804789ea4c9c0e" class="i method">StartsWith</a>(<span class="s">&quot;B:&quot;</span>)) <span class="r38 r">bm</span>.<a href="#c8cf56878dc65c24" class="i property">Icon</a> = <span class="s">&quot;(internal)media-floppy.png&quot;</span>;
                <b>if</b> (<span class="r39 r">d</span>.<a href="@0@mscorlib/A.html#23804789ea4c9c0e" class="i method">StartsWith</a>(<span class="s">&quot;/dev&quot;</span>)) <span class="r38 r">bm</span>.<a href="#c8cf56878dc65c24" class="i property">Icon</a> = <span class="s">&quot;(internal)preferences-desktop-peripherals.png&quot;</span>;
                <b>if</b> (<span class="r39 r">d</span>.<a href="@0@mscorlib/A.html#23804789ea4c9c0e" class="i method">StartsWith</a>(<span class="s">&quot;/proc&quot;</span>)) <span class="r38 r">bm</span>.<a href="#c8cf56878dc65c24" class="i property">Icon</a> = <span class="s">&quot;(internal)emblem-system.png&quot;</span>;
                <b>if</b> (<span class="r39 r">d</span> == <span class="s">&quot;/&quot;</span>) <span class="r38 r">bm</span>.<a href="#c8cf56878dc65c24" class="i property">Icon</a> = <span class="s">&quot;(internal)root-folder.png&quot;</span>;
                <span class="r36 r">bms</span>.<a href="@0@mscorlib/A.html#9cc11588bffd57c1" class="i method">Add</a>(<span class="r38 r">bm</span>);
            }
            <b>return</b> <span class="r36 r">bms</span>;
        }
    }
 
    <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span><span class="c">Represents a item in the bookmark DB</span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
    <b>public class</b> <a id="504a9776da968dd9" href="../R/504a9776da968dd9.html" target="n" data-glyph="0,0" class="t t"><span id="416a9a4b10f5b9c6">Bookmark</span></a>
    {
        <b>private</b> <a href="/Xwt3/A.html#0e6b2faf07047267" class="t t">Image</a> <a id="d07e73bb40d565c7" href="../R/d07e73bb40d565c7.html" target="n" data-glyph="46,1" class="i field">i</a> = <a href="/Xwt3/A.html#0e6b2faf07047267" class="t t">Image</a>.<a href="/Xwt3/A.html#c120d96e5b046a5f" class="i method">FromResource</a>(<span class="s">&quot;pluginner.Resources.folder.png&quot;</span>);
        <b>private bool</b> <a id="5a91d23ffbf9e0db" href="../R/5a91d23ffbf9e0db.html" target="n" data-glyph="46,1" class="i field">imageIsSet</a>;
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span><span class="c">The URL of the bookmark</span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <b>public string</b> <a id="26f7114fc75d7fd7" href="../R/26f7114fc75d7fd7.html" target="n" data-glyph="102,1" class="i property">url</a> { <b>get</b>; <b>set</b>; }
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span><span class="c">The label (caption, title, mark) of the bookmark</span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <b>public string</b> <a id="721577d41d698985" href="../R/721577d41d698985.html" target="n" data-glyph="102,1" class="i property">title</a> { <b>get</b>; <b>set</b>; }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span><span class="c">Get the icon of the bookmark (or default icon if the bookmark hasn&#39;t an icon)</span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <b>public</b> <a href="/Xwt3/A.html#0e6b2faf07047267" class="t t">Image</a> <a id="20ff95e05ea1ac48" href="../R/20ff95e05ea1ac48.html" target="n" data-glyph="72,1" class="i method">GetIcon</a>()
        {
            <b>if</b> (!<a href="#5a91d23ffbf9e0db" class="i field">imageIsSet</a>)
            {
                <b>try</b>
                {
                    <b>return</b> <a href="#bfd3dd9b6ffaa93c" class="i field">SubMenu</a> == <b>null</b> ?
                        <a href="#d07e73bb40d565c7" class="i field">i</a> : <a href="/Xwt3/A.html#0e6b2faf07047267" class="t t">Image</a>.<a href="/Xwt3/A.html#c120d96e5b046a5f" class="i method">FromResource</a>(<span class="s">&quot;pluginner.Resources.bookmarkMenu.png&quot;</span>); <span class="c">//todo: replace the Firefox icon with a free!</span>
                }
                <b>catch</b> (<a href="@0@mscorlib/A.html#f092fb2b893a0162" class="t t">Exception</a>) { <b>return null</b>; }
            }
            <b>return</b> <a href="#d07e73bb40d565c7" class="i field">i</a>;
        }
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span><span class="c">Set the icon of the bookmark</span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <b>public string</b> <a id="c8cf56878dc65c24" href="../R/c8cf56878dc65c24.html" target="n" data-glyph="102,1" class="i property">Icon</a>
        {
            <b>set</b>
            {
                <b>try</b>
                {
                    <b>if</b> (<b>value</b> == <b>null</b> || <b>value</b> == <span class="s">&quot;&quot;</span>)
                        <b>throw</b> <b>new</b> <a href="@0@mscorlib/A.html#df2d82d91ca29e40" class="t constructor">Exception</a>(<span class="s">&quot;Please catch me! Catch me! Catch me!&quot;</span>); <span class="c">//to leave &#39;try&#39; and go to &#39;catch&#39; block.</span>
 
                    <b>if</b> (<b>value</b>.<a href="@0@mscorlib/A.html#23804789ea4c9c0e" class="i method">StartsWith</a>(<span class="s">&quot;(internal)&quot;</span>))
                        <a href="#d07e73bb40d565c7" class="i field">i</a> = <a href="/Xwt3/A.html#0e6b2faf07047267" class="t t">Image</a>.<a href="/Xwt3/A.html#c120d96e5b046a5f" class="i method">FromResource</a>(<b>value</b>.<a href="@0@mscorlib/A.html#69fc1d0aa6df8a90" class="i method">Replace</a>(<span class="s">&quot;(internal)&quot;</span>, <span class="s">&quot;pluginner.Resources.&quot;</span>));
                    <b>else</b>
                        <a href="#d07e73bb40d565c7" class="i field">i</a> = <a href="/Xwt3/A.html#0e6b2faf07047267" class="t t">Image</a>.<a href="/Xwt3/A.html#730191fe10fe4e25" class="i method">FromFile</a>(<b>value</b>);
 
                    <a href="#5a91d23ffbf9e0db" class="i field">imageIsSet</a> = <b>true</b>;
                }
                <b>catch</b> (<a href="@0@mscorlib/A.html#f092fb2b893a0162" class="t t">Exception</a> <span id="r40 rd" class="r40 r">ex</span>)
                {
                    <a href="@0@mscorlib/A.html#f907d79481da6ba4" class="t t">Console</a>.<a href="@0@mscorlib/A.html#5ac7c4fda643413b" class="i method">WriteLine</a>(<span class="s">&quot;ERROR: Can&#39;t load bookmark image &quot;</span> + <b>value</b> + <span class="s">&quot; because of &quot;</span> + <span class="r40 r">ex</span>.<a href="@0@mscorlib/A.html#5fba0e16215b42a3" class="i property">Message</a>);
                    <span class="c">// i = Image.FromResource(&quot;pluginner.Resources.image-missing.png&quot;);</span>
                }
            }
        }
 
        <b>public</b> <a href="@0@mscorlib/A.html#cf7f4095e4de7646" class="t t">List</a>&lt;<a href="#504a9776da968dd9" class="t t">Bookmark</a>&gt; <a id="bfd3dd9b6ffaa93c" href="../R/bfd3dd9b6ffaa93c.html" target="n" data-glyph="42,1" class="i field">SubMenu</a>;
 
        <span class="c">//todo: public string Description;</span>
    }
}
</pre></td></tr></table></div></body></html>
