<!DOCTYPE html>
<html><head><title>SqlObjTable.cs</title><link rel="stylesheet" href="../../styles.css"><script src="../../scripts.js"></script></head>
<body class="cB" onload="i(445);"><div class="dH">
<table style="width: 100%">
<tr><td>File: <a id="filePath" class="blueLink" href="/#Ai.WebLib/Entity/SqlObjTable.cs" target="_top">Entity\SqlObjTable.cs</a><br/></td><td></td></tr>
<tr><td>Project: <a id="projectPath" class="blueLink" href="/#Ai.WebLib" target="_top">WebLib\src\Ai.WebLib.csproj</a> (Ai.WebLib)</td><td></td></tr>
</table>
</div>
<div class="cz"><table class="tb" cellpadding="0" cellspacing="0"><tr><td valign="top" align="right"><pre id="ln"></pre></td><td valign="top" align="left"><pre id="code">
<b>using</b> <span class="i n">System</span>;
<b>using</b> <span class="i n">System</span>.<span class="i n">Collections</span>.<span class="i n">Generic</span>;
<b>using</b> <span class="i n">System</span>.<span class="i n">ComponentModel</span>;
<b>using</b> <span class="i n">System</span>.<span class="i n">Data</span>;
<b>using</b> <span class="i n">System</span>.<span class="i n">Data</span>.<span class="i n">Common</span>;
<b>using</b> <span class="i n">System</span>.<span class="i n">Data</span>.<span class="i n">SqlClient</span>;
<b>using</b> <span class="i n">System</span>.<span class="i n">Linq</span>;
<b>using</b> <span class="i n">System</span>.<span class="i n">Linq</span>.<span class="i n">Expressions</span>;
<b>using</b> <span class="i n">System</span>.<span class="i n">Web</span>;
 
<b>namespace</b> <span class="i n">Ai</span>.<span class="i n">Entity</span>
{
    <b>public class</b> <a id="f23d3735ed74a980" href="../R/f23d3735ed74a980.html" target="n" data-glyph="0,0" class="t t">SqlObjTable</a> : <a href="@0@mscorlib/A.html#3acf01620172c7f0" class="t t">IEnumerable</a>&lt;<b>object</b>[]&gt;
    {
        <span class="k preprocess">#</span><span class="k preprocess">region</span> ctor
        <b>public</b> <a href="SqlField.cs.html#2de0c9a9df3ed4e5" class="t t">SqlField</a>[] <a id="e5c7e58c370ac665" href="../R/e5c7e58c370ac665.html" target="n" data-glyph="102,1" class="i property">Fields</a> { <b>get</b>; <b>set</b>; }
 
        <b>private</b> <a href="@0@System.Core/A.html#965b3e30b9ed851f" class="t t">IQueryable</a>&lt;<b>object</b>[]&gt; <a id="3d179875f676b590" href="../R/3d179875f676b590.html" target="n" data-glyph="46,1" class="i field">querySource</a>;
        <b>private</b> <a href="#d80aea28850bd3df" class="t t">SqlObjQueryParameters</a> <a id="0933ab281cc2d5eb" href="../R/0933ab281cc2d5eb.html" target="n" data-glyph="46,1" class="i field">queryParam</a>;
        <span class="c">// public abstract DbContext Reconnect { get; }</span>
 
        <b>public bool</b> <a id="44ff38185f6ff841" href="../R/../../0000000000.html" target="n" data-glyph="102,1" class="i property">RowsAny</a>
        {
            <b>get</b>
            {
                <b>if</b> (<a href="#0933ab281cc2d5eb" class="i field">queryParam</a>.<a href="#b6a238a4ab76cb05" class="i method">IsEmpty</a>()
                    || <a href="#0933ab281cc2d5eb" class="i field">queryParam</a>.<a href="#4cf7113134df9cf1" class="i property">DataReader</a> == <b>null</b>)
                    <b>return false</b>;
                <b>if</b> (!<a href="#0933ab281cc2d5eb" class="i field">queryParam</a>.<a href="#4cf7113134df9cf1" class="i property">DataReader</a>.<a href="@0@System.Data/A.html#bb3e859aa1c493a4" class="i property">HasRows</a>)
                    <b>return false</b>;
 
                <b>return true</b>;
            }
        }
 
        <b>public</b> <a href="@0@mscorlib/A.html#3acf01620172c7f0" class="t t">IEnumerable</a>&lt;<b>object</b>[]&gt; <a id="a668f745064e885c" href="../R/a668f745064e885c.html" target="n" data-glyph="102,1" class="i property">Rows</a>
        {
            <b>get</b>
            {
                <b>if</b> (!<a href="#ea11ca4c025523da" class="i method">Reset</a>())
                    <b>return</b> <a href="@0@System.Core/A.html#577032c8811e20d3" class="t t">Enumerable</a>.<a href="@0@System.Core/A.html#4d026772cf3399f5" class="i method">Empty</a>&lt;<b>object</b>[]&gt;();        <span class="c">// error</span>
                <b>return</b> <a href="#f23d3735ed74a980" class="k">this</a> <b>as</b> <a href="@0@mscorlib/A.html#3acf01620172c7f0" class="t t">IEnumerable</a>&lt;<b>object</b>[]&gt;;
            }
        }
 
        <span class="c">// todo: IList&lt;object[]&gt; Rows</span>
 
        <b>public</b> <a id="1d86f5fd77449322" href="../R/../../0000000000.html" target="n" data-glyph="72,1" class="i constructor">SqlObjTable</a>()
        {
            <a href="#e5c7e58c370ac665" class="i property">Fields</a> = <b>new</b> <a href="SqlField.cs.html#2de0c9a9df3ed4e5" class="t t">SqlField</a>[] { };
 
            <a href="#0933ab281cc2d5eb" class="i field">queryParam</a> = <a href="#d80aea28850bd3df" class="t t">SqlObjQueryParameters</a>.<a href="#b8386661f5f6094d" class="i method">WithParser</a>(
                <b>new</b> <a href="SqlProc.cs.html#420674bdead92c9e" class="t constructor">SqlProc</a>() { <a href="SqlProc.cs.html#6bcd485d0b8dace0" class="i property">CmdText</a> = <a href="@0@mscorlib/A.html#8281103e6f23cb5c" class="t t">String</a>.<a href="@0@mscorlib/A.html#c9f70a27facb27cf" class="i field">Empty</a>, <a href="SqlProc.cs.html#0e2cd862b6088b84" class="i property">Context</a> = <b>null</b> }, <b>null</b>);
 
            <a href="#3d179875f676b590" class="i field">querySource</a> = <a href="@0@System.Core/A.html#577032c8811e20d3" class="t t">Enumerable</a>.<a href="@0@System.Core/A.html#4d026772cf3399f5" class="i method">Empty</a>&lt;<b>object</b>[]&gt;().<a href="@0@System.Core/A.html#080010ec4b6beced" class="i method">AsQueryable</a>();
 
            <span class="c">// Queryable.</span>
            <span class="c">// Rows = new List&lt;object[]&gt;();</span>
        }
 
        <b>public virtual</b> <a href="@0@mscorlib/A.html#3acf01620172c7f0" class="t t">IEnumerable</a>&lt;<a href="SqlField.cs.html#2de0c9a9df3ed4e5" class="t t">SqlField</a>&gt; <a id="a88b54abc451bf22" href="../R/../../0000000000.html" target="n" data-glyph="72,1" class="i method">FieldsVisible</a>()
        {
            <b>foreach</b> (<a href="SqlField.cs.html#2de0c9a9df3ed4e5" class="k">var</a> <span id="r0 rd" class="r0 r">field</span> <b>in</b> <a href="#e5c7e58c370ac665" class="i property">Fields</a>)
                <b>if</b> (!<span class="r0 r">field</span>.<a href="SqlField.cs.html#24979056bcc76f01" class="i property">Hide</a>)
                    <b>yield return</b> <span class="r0 r">field</span>;
        }
 
        <b>public virtual</b> <a href="@0@mscorlib/A.html#3acf01620172c7f0" class="t t">IEnumerable</a>&lt;<b>object</b>[]&gt; <a id="e11eb20a6249426a" href="../R/../../0000000000.html" target="n" data-glyph="72,1" class="i method">RowsFromTake</a>(<b>int</b> <span id="r1 rd" class="r1 r">indexFrom</span>, <b>int</b> <span id="r2 rd" class="r2 r">rowsTake</span>)
        {
            <span class="c">// var query = Rows.AsQueryable&lt;object[]&gt;();</span>
            <a href="@0@System.Core/A.html#965b3e30b9ed851f" class="k">var</a> <span id="r3 rd" class="r3 r">query</span> = <a href="#f23d3735ed74a980" class="k">this</a>.<a href="#b950083ee978d66c" class="i property">Query</a>;
            <b>if</b> (<span class="r1 r">indexFrom</span> &gt; 0)
                <span class="r3 r">query</span> = <span class="r3 r">query</span>.<a href="@0@System.Core/A.html#feb673b656efcefd" class="i method">Skip</a>(<span class="r1 r">indexFrom</span>);
            <b>if</b> (<span class="r2 r">rowsTake</span> &gt; 0)
                <span class="r3 r">query</span> = <span class="r3 r">query</span>.<a href="@0@System.Core/A.html#65350a83198c1672" class="i method">Take</a>(<span class="r2 r">rowsTake</span>);
 
            <b>foreach</b> (<b>var</b> <span id="r4 rd" class="r4 r">rowItem</span> <b>in</b> <span class="r3 r">query</span>)
                <b>yield return</b> <span class="r4 r">rowItem</span>;
        }
 
        <span class="k preprocess">#</span><span class="k preprocess">endregion</span>
 
        <span class="k preprocess">#</span><span class="k preprocess">region</span> IEnumerator
 
        <b>public virtual</b> <a href="@0@mscorlib/A.html#893e8cdebffde2da" class="t t">IEnumerator</a>&lt;<b>object</b>[]&gt; <a id="8be2a9f571f7ba82" href="../R/8be2a9f571f7ba82.html" target="n" data-glyph="72,1" class="i method">GetEnumerator</a>()
        {
            <b>if</b> (!<a href="#0933ab281cc2d5eb" class="i field">queryParam</a>.<a href="#a3f57f1b71659d53" class="i method">IsPrepared</a>())
                <b>yield break</b>;
 
            <a href="@0@mscorlib/A.html#3acf01620172c7f0" class="k">var</a> <span id="r5 rd" class="r5 r">query</span> = <a href="#f23d3735ed74a980" class="k">this</a>.<a href="#0933ab281cc2d5eb" class="i field">queryParam</a>.<a href="#e1677c6d96c85f48" class="i method">Query</a>();
            <b>foreach</b> (<b>object</b>[] <span id="r6 rd" class="r6 r">rowItem</span> <b>in</b> <span class="r5 r">query</span>)
                <b>yield return</b> <span class="r6 r">rowItem</span>;
        }
 
        <span class="i n">System</span>.<span class="i n">Collections</span>.<a href="@0@mscorlib/A.html#6624f38cb955bfe0" class="t t">IEnumerator</a> <span class="i n">System</span>.<span class="i n">Collections</span>.<a href="@0@mscorlib/A.html#9be451ac13d86a97" class="t t">IEnumerable</a>.<a href="@0@mscorlib/A.html#02a44b09e26b964f" class="i method">GetEnumerator</a>()
        {
            <b>return</b> <a href="#8be2a9f571f7ba82" class="i method">GetEnumerator</a>();
        }
        <span class="k preprocess">#</span><span class="k preprocess">endregion</span>
 
        <b>public</b> <a href="@0@System.Core/A.html#965b3e30b9ed851f" class="t t">IQueryable</a>&lt;<b>object</b>[]&gt; <a id="b950083ee978d66c" href="../R/b950083ee978d66c.html" target="n" data-glyph="102,1" class="i property">Query</a>
        {
            <b>get</b>
            {
                <b>if</b> (!<a href="#0933ab281cc2d5eb" class="i field">queryParam</a>.<a href="#a3f57f1b71659d53" class="i method">IsPrepared</a>())
                    <a href="#0933ab281cc2d5eb" class="i field">queryParam</a>.<a href="#b562948ceeb49866" class="i method">Prepare</a>(<a href="#0933ab281cc2d5eb" class="i field">queryParam</a>.<a href="#72b352a8df76d227" class="i property">proc</a>);
 
                <a href="@0@mscorlib/A.html#3acf01620172c7f0" class="k">var</a> <span id="r7 rd" class="r7 r">enumerable</span> = <a href="#0933ab281cc2d5eb" class="i field">queryParam</a>.<a href="#e1677c6d96c85f48" class="i method">Query</a>();
                <a href="#f23d3735ed74a980" class="k">this</a>.<a href="#3d179875f676b590" class="i field">querySource</a> = <span class="r7 r">enumerable</span>.<a href="@0@System.Core/A.html#080010ec4b6beced" class="i method">AsQueryable</a>&lt;<b>object</b>[]&gt;();
                <b>return</b> <a href="#f23d3735ed74a980" class="k">this</a>.<a href="#3d179875f676b590" class="i field">querySource</a>;
            }
        }
 
        <span class="k preprocess">#</span><span class="k preprocess">region</span> Sql
 
        <b>public bool</b> <a id="862d22230298a2e5" href="../R/../../0000000000.html" target="n" data-glyph="72,1" class="i method">IsClosed</a>()
        {
            <b>return</b> <a href="#e5c7e58c370ac665" class="i property">Fields</a>.<a href="@0@mscorlib/A.html#42e9b7616956cf94" class="i property">Length</a> == 0 || <a href="#0933ab281cc2d5eb" class="i field">queryParam</a>.<a href="#72b352a8df76d227" class="i property">proc</a>.<a href="SqlProc.cs.html#58f89e524ba17082" class="i property">Connection</a> == <b>null</b>;
        }
 
        <b>public bool</b> <a id="ea11ca4c025523da" href="../R/ea11ca4c025523da.html" target="n" data-glyph="72,1" class="i method">Reset</a>()
        {
            <b>if</b> (<a href="#f23d3735ed74a980" class="k">this</a>.<a href="#e5c7e58c370ac665" class="i property">Fields</a>.<a href="@0@mscorlib/A.html#42e9b7616956cf94" class="i property">Length</a> == 0)
                <b>return false</b>;
 
            <a href="#f23d3735ed74a980" class="k">this</a>.<a href="#3d179875f676b590" class="i field">querySource</a> = <a href="#f23d3735ed74a980" class="k">this</a>.<a href="#b950083ee978d66c" class="i property">Query</a>;
            <b>return</b> <a href="#f23d3735ed74a980" class="k">this</a>.<a href="#3d179875f676b590" class="i field">querySource</a> != <b>null</b>;
        }
 
        <b>public bool</b> <a id="38fc208b5a664b37" href="../R/../../0000000000.html" target="n" data-glyph="72,1" class="i method">ExecNamed</a>(<a href="DbContext.cs.html#56afb125adf64a29" class="t t">DbContext</a> <span id="r8 rd" class="r8 r">context</span>, <b>object</b> <span id="r9 rd" class="r9 r">paramNamed</span>, <b>int</b> <span id="r10 rd" class="r10 r">iFrom</span> = 0, <b>int</b> <span id="r11 rd" class="r11 r">iTake</span> = 0)
        {
            <a href="#a6d68fffc7c7ef59" class="k">var</a> <span id="r12 rd" class="r12 r">prop</span> = <b>new</b> <a href="#b79aebf27fd63b1a" class="t constructor">NameProperties</a>(<span class="r9 r">paramNamed</span>);
            <b>string</b> <span id="r13 rd" class="r13 r">execName</span> = <span class="r12 r">prop</span>.<a href="#f5d61379c6371d9d" class="i method">GetValue</a>(<span class="r9 r">paramNamed</span>, <span class="r12 r">prop</span>.<a href="#f2b526f5e1f78c4b" class="i method">FirstName</a>()) <b>as string</b>;
            <a href="SqlProc.cs.html#420674bdead92c9e" class="k">var</a> <span id="r14 rd" class="r14 r">proc</span> = <a href="SqlProc.cs.html#ed5fa4022efb7c05" class="t t">SqlProcExt</a>.<a href="SqlProc.cs.html#b40a9dfdad4b205a" class="i method">CmdText</a>(<span class="r13 r">execName</span>, <span class="r8 r">context</span>);
 
            <a href="@0@mscorlib/A.html#cf7f4095e4de7646" class="k">var</a> <span id="r15 rd" class="r15 r">paramList</span> = <b>new</b> <a href="@0@mscorlib/A.html#9e5352b2b304ceba" class="t constructor">List</a>&lt;<a href="@0@System.Data/A.html#f00e50d65755ab48" class="t t">SqlParameter</a>&gt;();
            <b>foreach</b> (<b>string</b> <span id="r16 rd" class="r16 r">item</span> <b>in</b> <span class="r12 r">prop</span>.<a href="#0460e3fa3cde1431" class="i method">Names</a>(1))
                <span class="r15 r">paramList</span>.<a href="@0@mscorlib/A.html#9cc11588bffd57c1" class="i method">Add</a>(<a href="SqlProc.cs.html#420674bdead92c9e" class="t t">SqlProc</a>.<a href="SqlProc.cs.html#d8579eb1f7faf12a" class="i method">AddWithValue</a>(<span class="s">&quot;@&quot;</span> + <span class="r16 r">item</span>, <span class="r12 r">prop</span>.<a href="#f5d61379c6371d9d" class="i method">GetValue</a>(<span class="r9 r">paramNamed</span>, <span class="r16 r">item</span>)));
            <b>if</b> (<span class="r15 r">paramList</span>.<a href="@0@mscorlib/A.html#78a69d857716bc68" class="i property">Count</a> &gt; 0)
                <span class="r14 r">proc</span>.<a href="SqlProc.cs.html#9af1e406e4c9b494" class="i property">Param</a> = <span class="r15 r">paramList</span>;
 
            <b>return</b> <a href="#c3cd341b7e52d97f" class="i method">ExecProc</a>(<span class="r14 r">proc</span>, <span class="r10 r">iFrom</span>, <span class="r11 r">iTake</span>);
        }
 
        <b>public bool</b> <a id="c1c9407a30aaddb9" href="../R/../../0000000000.html" target="n" data-glyph="72,1" class="i method">Exec</a>(<a href="DbContext.cs.html#56afb125adf64a29" class="t t">DbContext</a> <span id="r17 rd" class="r17 r">context</span>, <b>string</b>[] <span id="r18 rd" class="r18 r">param</span>, <b>int</b> <span id="r19 rd" class="r19 r">iFrom</span> = 0, <b>int</b> <span id="r20 rd" class="r20 r">iTake</span> = 0)
        {
            <b>string</b> <span id="r21 rd" class="r21 r">execName</span> = <span class="r18 r">param</span>[0];
 
            <a href="SqlProc.cs.html#420674bdead92c9e" class="k">var</a> <span id="r22 rd" class="r22 r">proc</span> = <a href="SqlProc.cs.html#ed5fa4022efb7c05" class="t t">SqlProcExt</a>.<a href="SqlProc.cs.html#b40a9dfdad4b205a" class="i method">CmdText</a>(<span class="r21 r">execName</span>, <span class="r17 r">context</span>);
 
            <b>return</b> <a href="#c3cd341b7e52d97f" class="i method">ExecProc</a>(<span class="r22 r">proc</span>, <span class="r19 r">iFrom</span>, <span class="r20 r">iTake</span>);
        }
 
        <b>private bool</b> <a id="c3cd341b7e52d97f" href="../R/c3cd341b7e52d97f.html" target="n" data-glyph="76,1" class="i method">ExecProc</a>(<a href="SqlProc.cs.html#420674bdead92c9e" class="t t">SqlProc</a> <span id="r23 rd" class="r23 r">proc</span>, <b>int</b> <span id="r24 rd" class="r24 r">iFrom</span> = 0, <b>int</b> <span id="r25 rd" class="r25 r">iTake</span> = 0)
        {
            <b>var</b> <span id="r26 rd" class="r26 r">fld</span> = <a href="#f23d3735ed74a980" class="k">this</a>.<a href="#e5c7e58c370ac665" class="i property">Fields</a>;
 
            <span class="c">// &amp;&amp; Rows.Count == 0</span>
            <span class="i n">Ai</span>.<a href="../Assert.cs.html#c98d5547ac260bd3" class="t t">Assert</a>.<a href="../Assert.cs.html#d60825d3f2d93b3f" class="i method">IsTrue</a>(<a href="#a668f745064e885c" class="i property">Rows</a> != <b>null</b>, <span class="s">&quot;SqlTable rows error&quot;</span>);
 
            <a href="@0@mscorlib/A.html#27863de72c2c9b49" class="t t">Action</a>&lt;<a href="#3cccea6d9a6dd3e7" class="t t">SqlTableMapper</a>, <a href="@0@System.Data/A.html#f7c2de36229de361" class="t t">DbDataReader</a>&gt; <span id="r27 rd" class="r27 r">parser</span> = (<span id="r28 rd" class="r28 r">map</span>, <span id="r29 rd" class="r29 r">dbReader</span>) =&gt;
            {
                <b>int</b> <span id="r30 rd" class="r30 r">len</span> = <span class="r29 r">dbReader</span>.<a href="@0@System.Data/A.html#2d0652b14d71dcfa" class="i property">FieldCount</a>;
                <a href="@0@mscorlib/A.html#156e066ecc4ccedf" class="t t">Array</a>.<a href="@0@mscorlib/A.html#71074deaf111c4e3" class="i method">Resize</a>&lt;<a href="SqlField.cs.html#2de0c9a9df3ed4e5" class="t t">SqlField</a>&gt;(<b>ref</b> <span class="r26 r">fld</span>, <span class="r30 r">len</span>);
                <b>for</b> (<b>int</b> <span id="r31 rd" class="r31 r">i</span> = 0; <span class="r31 r">i</span> &lt; <span class="r30 r">len</span>; <span class="r31 r">i</span>++)
                {
                    <span class="r26 r">fld</span>[<span class="r31 r">i</span>] = <b>new</b> <a href="SqlField.cs.html#2de0c9a9df3ed4e5" class="t constructor">SqlField</a>()
                    {
                        <a href="SqlField.cs.html#02367ca387320905" class="i property">Ordinal</a> = <span class="r31 r">i</span>,
                        <a href="SqlField.cs.html#4235a336c91e0442" class="i property">Name</a> = <span class="r29 r">dbReader</span>.<a href="@0@System.Data/A.html#775db66776344d68" class="i method">GetName</a>(<span class="r31 r">i</span>),
                        <a href="SqlField.cs.html#df4a17156b46b723" class="i property">Type</a> = <span class="r29 r">dbReader</span>.<a href="@0@System.Data/A.html#78fdaeb5895bd109" class="i method">GetFieldType</a>(<span class="r31 r">i</span>),
                        <a href="SqlField.cs.html#75b53bda05916bdf" class="i property">Caption</a> = <span class="r29 r">dbReader</span>.<a href="@0@System.Data/A.html#775db66776344d68" class="i method">GetName</a>(<span class="r31 r">i</span>),
                        <a href="SqlField.cs.html#24979056bcc76f01" class="i property">Hide</a> = <b>false</b>
                    };
                }
                <a href="#f23d3735ed74a980" class="k">this</a>.<a href="#e5c7e58c370ac665" class="i property">Fields</a> = <span class="r26 r">fld</span>;
            };
 
            <b>bool</b> <span id="r32 rd" class="r32 r">init</span> = <a href="#f23d3735ed74a980" class="k">this</a>.<a href="#0933ab281cc2d5eb" class="i field">queryParam</a>.<a href="#b562948ceeb49866" class="i method">Prepare</a>(<span class="r23 r">proc</span>, <span class="r27 r">parser</span>);
            <span class="i n">Ai</span>.<a href="../Assert.cs.html#c98d5547ac260bd3" class="t t">Assert</a>.<a href="../Assert.cs.html#e1ea4369b11f88f9" class="i method">IsTrue</a>(<span class="r26 r">fld</span>.<a href="@0@mscorlib/A.html#42e9b7616956cf94" class="i property">Length</a> &gt; 0);
 
            <b>return</b> <span class="r32 r">init</span>;
            <span class="c">// return enumerable.Any&lt;object[]&gt;();</span>
        }
 
        <span class="k preprocess">#</span><span class="k preprocess">endregion</span>
    }
 
    <b>public class</b> <a id="a6d68fffc7c7ef59" href="../R/a6d68fffc7c7ef59.html" target="n" data-glyph="0,0" class="t t">NameProperties</a>
    {
        <b>public</b> <a id="b79aebf27fd63b1a" href="../R/b79aebf27fd63b1a.html" target="n" data-glyph="72,1" class="i constructor">NameProperties</a>(<b>object</b> <span id="r33 rd" class="r33 r">paramNamed</span>)
        {
            <a href="#bff902ebbf056db7" class="i field">list</a> =  <span class="i n">Reflection</span>.<a href="../Reflection/Utils.cs.html#0a1f42724b8665b5" class="t t">Utils</a>.<a href="../Reflection/Utils.cs.html#4dffe5adc8ace85d" class="i method">GetProperties</a>(<span class="r33 r">paramNamed</span>); <span class="c">// .GetPropertyValue  ReflectionUtils.GetProperties(paramNamed);</span>
        }
 
        <a href="@0@System/A.html#2442aaedff6cc765" class="t t">PropertyDescriptorCollection</a> <a id="bff902ebbf056db7" href="../R/bff902ebbf056db7.html" target="n" data-glyph="46,1" class="i field">list</a>;
        <b>public</b> <a href="@0@System/A.html#2442aaedff6cc765" class="t t">PropertyDescriptorCollection</a> <a id="a73a041fe5ee81e4" href="../R/../../0000000000.html" target="n" data-glyph="102,1" class="i property">List</a> { <b>get</b> { <b>return</b> <a href="#bff902ebbf056db7" class="i field">list</a>; } }
 
        <b>public</b> <a href="@0@mscorlib/A.html#3acf01620172c7f0" class="t t">IEnumerable</a>&lt;<b>string</b>&gt; <a id="0460e3fa3cde1431" href="../R/0460e3fa3cde1431.html" target="n" data-glyph="72,1" class="i method">Names</a>(<b>int</b> <span id="r34 rd" class="r34 r">iFrom</span> = 1)
        {
            <b>foreach</b> (<a href="@0@System/A.html#a1f8d8808866e595" class="t t">PropertyDescriptor</a> <span id="r35 rd" class="r35 r">item</span> <b>in</b> <a href="#bff902ebbf056db7" class="i field">list</a>)
            {
                <b>if</b> (<a href="#bff902ebbf056db7" class="i field">list</a>.<a href="@0@System/A.html#3cb18a881279f32a" class="i method">IndexOf</a>(<span class="r35 r">item</span>) &gt;= <span class="r34 r">iFrom</span>)
                    <b>yield return</b> <span class="r35 r">item</span>.<a href="@0@System/A.html#04b17a133b14e8c6" class="i property">Name</a>;
            }
        }
 
        <b>public string</b> <a id="f2b526f5e1f78c4b" href="../R/f2b526f5e1f78c4b.html" target="n" data-glyph="72,1" class="i method">FirstName</a>()
        {
            <b>if</b> (<a href="#bff902ebbf056db7" class="i field">list</a> == <b>null</b> || <a href="#bff902ebbf056db7" class="i field">list</a>.<a href="@0@System/A.html#1512ded3e6d9f730" class="i property">Count</a> == 0) <b>return null</b>;
 
            <b>return</b> <a href="#bff902ebbf056db7" class="i field">list</a>[0].<a href="@0@System/A.html#04b17a133b14e8c6" class="i property">Name</a>;
        }
 
        <b>public object</b> <a id="f5d61379c6371d9d" href="../R/f5d61379c6371d9d.html" target="n" data-glyph="72,1" class="i method">GetValue</a>(<b>object</b> <span id="r36 rd" class="r36 r">paramObj</span>, <b>string</b> <span id="r37 rd" class="r37 r">propertyName</span>)
        {
            <b>return</b> <span class="i n">Reflection</span>.<a href="../Reflection/Utils.cs.html#0a1f42724b8665b5" class="t t">Utils</a>.<a href="../Reflection/Utils.cs.html#3c27d732e6779bbc" class="i method">GetPropertyValue</a>(<span class="r36 r">paramObj</span>, <span class="r37 r">propertyName</span>);
        }
 
    }
 
    <b>public class</b> <a id="3cccea6d9a6dd3e7" href="../R/3cccea6d9a6dd3e7.html" target="n" data-glyph="0,0" class="t t">SqlTableMapper</a> : <a href="DbDataMapHelper.cs.html#072ccd67e28f75bb" class="t t">IDataMapHelper</a>&lt;<b>object</b>[]&gt;
    {
        <b>public</b> <a id="f1becf20bdc122cd" href="../R/f1becf20bdc122cd.html" target="n" data-glyph="72,1" class="i constructor">SqlTableMapper</a>(<a href="@0@mscorlib/A.html#27863de72c2c9b49" class="t t">Action</a>&lt;<a href="#3cccea6d9a6dd3e7" class="t t">SqlTableMapper</a>, <a href="@0@System.Data/A.html#f7c2de36229de361" class="t t">DbDataReader</a>&gt; <span id="r38 rd" class="r38 r">propertiesParser</span>)
        {
            <a href="#3cccea6d9a6dd3e7" class="k">this</a>.<a href="#d9724b5c4267192f" class="i field">propertiesParser</a> = <span class="r38 r">propertiesParser</span>;
        }
        <b>protected</b> <a href="@0@mscorlib/A.html#27863de72c2c9b49" class="t t">Action</a>&lt;<a href="#3cccea6d9a6dd3e7" class="t t">SqlTableMapper</a>, <a href="@0@System.Data/A.html#f7c2de36229de361" class="t t">DbDataReader</a>&gt; <a id="d9724b5c4267192f" href="../R/d9724b5c4267192f.html" target="n" data-glyph="45,1" class="i field">propertiesParser</a>;
 
        <b>public</b> <a href="@0@mscorlib/A.html#3d00eeab9feb80f3" class="t t">Type</a> <a id="dcfdf0bb4280e0cb" href="../R/dcfdf0bb4280e0cb.html" target="n" data-glyph="102,1" class="i property">Type</a> { <b>get</b> { <b>return typeof</b>(<b>object</b>[]); } }
        <b>public int</b> <a id="7398bcc984c514c5" href="../R/../../0000000000.html" target="n" data-glyph="102,1" class="i property">FieldCount</a> { <b>get</b> { <b>return</b> <a href="#1c5b2767eed40bb1" class="i field">iLen</a>; } }
 
        <b>int</b> <a id="1c5b2767eed40bb1" href="../R/1c5b2767eed40bb1.html" target="n" data-glyph="46,1" class="i field">iLen</a>;
        <b>string</b>[] <a id="109ff8b31d9acce2" href="../R/109ff8b31d9acce2.html" target="n" data-glyph="46,1" class="i field">FieldNames</a>;
 
        <a href="DbDataMapHelper.cs.html#072ccd67e28f75bb" class="t t">IDataMapHelper</a>&lt;<b>object</b>[]&gt; <a href="DbDataMapHelper.cs.html#072ccd67e28f75bb" class="t t">IDataMapHelper</a>&lt;<b>object</b>[]&gt;.<a href="DbDataMapHelper.cs.html#88d6b27976920074" class="i method">GetProperties</a>(<a href="@0@System.Data/A.html#f7c2de36229de361" class="t t">DbDataReader</a> <span id="r39 rd" class="r39 r">dataReader</span>)
        {
            <a href="#1c5b2767eed40bb1" class="i field">iLen</a> = <span class="r39 r">dataReader</span>.<a href="@0@System.Data/A.html#2d0652b14d71dcfa" class="i property">FieldCount</a>;
            <a href="#109ff8b31d9acce2" class="i field">FieldNames</a> = <b>new</b> <b>string</b>[<a href="#1c5b2767eed40bb1" class="i field">iLen</a>];
            <b>for</b> (<b>int</b> <span id="r40 rd" class="r40 r">i</span> = 0; <span class="r40 r">i</span> &lt; <a href="#1c5b2767eed40bb1" class="i field">iLen</a>; <span class="r40 r">i</span>++)
                <a href="#109ff8b31d9acce2" class="i field">FieldNames</a>[<span class="r40 r">i</span>] = <span class="r39 r">dataReader</span>.<a href="@0@System.Data/A.html#775db66776344d68" class="i method">GetName</a>(<span class="r40 r">i</span>);
 
            <b>if</b> (<a href="#d9724b5c4267192f" class="i field">propertiesParser</a> != <b>null</b>)
                <a href="#d9724b5c4267192f" class="i field">propertiesParser</a>(<a href="#3cccea6d9a6dd3e7" class="k">this</a>, <span class="r39 r">dataReader</span>);
            <b>return</b> <a href="#3cccea6d9a6dd3e7" class="k">this</a>;
        }
 
        <b>public object</b>[] <a id="e20fe898d1fc4f54" href="../R/e20fe898d1fc4f54.html" target="n" data-glyph="72,1" class="i method">SetValues</a>(<b>object</b>[] <span id="r41 rd" class="r41 r">objVal</span>)
        {
            <b>return</b> <span class="r41 r">objVal</span>;
        }
 
        <b>public object</b>[] <a id="235a326cca6c8a8e" href="../R/235a326cca6c8a8e.html" target="n" data-glyph="72,1" class="i method">DbRecordArray</a>()
        {
            <b>return</b> (<b>object</b>[])<a href="@0@mscorlib/A.html#156e066ecc4ccedf" class="t t">Array</a>.<a href="@0@mscorlib/A.html#0125db0f9ffef78b" class="i method">CreateInstance</a>(<b>typeof</b>(<b>object</b>), <a href="#1c5b2767eed40bb1" class="i field">iLen</a>);
        }
 
        <b>public virtual int</b>? <a id="a4797fd35ecae24a" href="../R/a4797fd35ecae24a.html" target="n" data-glyph="72,1" class="i method">GetOrdinal</a>(<b>string</b> <span id="r42 rd" class="r42 r">columnName</span>)
        {
            <b>for</b> (<b>int</b> <span id="r43 rd" class="r43 r">i</span> = 0; <span class="r43 r">i</span> &lt; <a href="#109ff8b31d9acce2" class="i field">FieldNames</a>.<a href="@0@mscorlib/A.html#42e9b7616956cf94" class="i property">Length</a>; <span class="r43 r">i</span>++)
                <b>if</b> (<a href="#109ff8b31d9acce2" class="i field">FieldNames</a>[<span class="r43 r">i</span>] == <span class="r42 r">columnName</span>)
                    <b>return</b> <span class="r43 r">i</span>;
            <b>return null</b>;
        }
 
        <b>public virtual object</b> <a id="3d76fefb58639609" href="../R/3d76fefb58639609.html" target="n" data-glyph="72,1" class="i method">GetField</a>(<b>string</b> <span id="r44 rd" class="r44 r">columnName</span>, <b>object</b>[] <span id="r45 rd" class="r45 r">arrayItem</span>)
        {
            <b>int</b>? <span id="r46 rd" class="r46 r">find</span> = <a href="#a4797fd35ecae24a" class="i method">GetOrdinal</a>(<span class="r44 r">columnName</span>);
            <b>return</b> <span class="r46 r">find</span>.<a href="@0@mscorlib/A.html#7bbe60e33e857298" class="i property">HasValue</a> ? <span class="r45 r">arrayItem</span>[<span class="r46 r">find</span>.<a href="@0@mscorlib/A.html#7b38d1fa76071c95" class="i property">Value</a>] != <a href="@0@mscorlib/A.html#7faae4cef0a3f251" class="t t">DBNull</a>.<a href="@0@mscorlib/A.html#9603a89be4827410" class="i field">Value</a> ? <span class="r45 r">arrayItem</span>[<span class="r46 r">find</span>.<a href="@0@mscorlib/A.html#7b38d1fa76071c95" class="i property">Value</a>] : <b>null</b>
                                 : <b>null</b>;
        }
    }
 
    <b>public struct</b> <a id="d80aea28850bd3df" href="../R/d80aea28850bd3df.html" target="n" data-glyph="108,0" class="t t"><span id="e25fdf60e313eefb">SqlObjQueryParameters</span></a>
    {
        <b>public</b> <a href="SqlProc.cs.html#420674bdead92c9e" class="t t">SqlProc</a> <a id="72b352a8df76d227" href="../R/72b352a8df76d227.html" target="n" data-glyph="102,1" class="i property">proc</a> { <b>get</b>; <b>private set</b>; }
        <b>private</b> <a href="#a820e35c49f4c6d0" class="t t">SqlObjectReader</a> <a id="79687587f062d847" href="../R/79687587f062d847.html" target="n" data-glyph="46,1" class="i field">mapper</a>;
 
        <b>public static</b> <a href="#d80aea28850bd3df" class="t t">SqlObjQueryParameters</a> <a id="b8386661f5f6094d" href="../R/b8386661f5f6094d.html" target="n" data-glyph="72,1" class="i method">WithParser</a>(<a href="SqlProc.cs.html#420674bdead92c9e" class="t t">SqlProc</a> <span id="r47 rd" class="r47 r">proc</span>, <a href="@0@mscorlib/A.html#27863de72c2c9b49" class="t t">Action</a>&lt;<a href="#3cccea6d9a6dd3e7" class="t t">SqlTableMapper</a>, <a href="@0@System.Data/A.html#f7c2de36229de361" class="t t">DbDataReader</a>&gt; <span id="r48 rd" class="r48 r">propertiesParser</span> = <b>null</b>)
        {
            <b>return</b> <b>new</b> <a href="#d80aea28850bd3df" class="t constructor">SqlObjQueryParameters</a>() { <a href="#72b352a8df76d227" class="i property">proc</a> = <span class="r47 r">proc</span>, <a href="#79687587f062d847" class="i field">mapper</a> = <b>new</b> <a href="#c20b162f609d1c78" class="t constructor">SqlObjectReader</a>(<span class="r48 r">propertiesParser</span>) };
        }
 
        <b>public bool</b> <a id="b6a238a4ab76cb05" href="../R/b6a238a4ab76cb05.html" target="n" data-glyph="72,1" class="i method">IsEmpty</a>() { <b>return string</b>.<a href="@0@mscorlib/A.html#55e241b6143365ef" class="i method">IsNullOrWhiteSpace</a>(<a href="#72b352a8df76d227" class="i property">proc</a>.<a href="SqlProc.cs.html#6bcd485d0b8dace0" class="i property">CmdText</a>) || <a href="#79687587f062d847" class="i field">mapper</a> == <b>null</b>; }
        <b>public bool</b> <a id="a3f57f1b71659d53" href="../R/a3f57f1b71659d53.html" target="n" data-glyph="72,1" class="i method">IsPrepared</a>() { <b>return</b> !<a href="#b6a238a4ab76cb05" class="i method">IsEmpty</a>() &amp;&amp; <a href="#79687587f062d847" class="i field">mapper</a>.<a href="#b62e05c6c13f25e0" class="i property">DataReader</a> != <b>null</b>; }
        <b>public</b> <a href="@0@System.Data/A.html#d576786f0fd1b1dc" class="t t">SqlDataReader</a> <a id="4cf7113134df9cf1" href="../R/4cf7113134df9cf1.html" target="n" data-glyph="102,1" class="i property">DataReader</a> { <b>get</b> { <b>return</b> <a href="#a3f57f1b71659d53" class="i method">IsPrepared</a>() ? <a href="#79687587f062d847" class="i field">mapper</a>.<a href="#b62e05c6c13f25e0" class="i property">DataReader</a> : <b>null</b>; } }
 
        <b>public bool</b> <a id="b562948ceeb49866" href="../R/b562948ceeb49866.html" target="n" data-glyph="72,1" class="i method">Prepare</a>(<a href="SqlProc.cs.html#420674bdead92c9e" class="t t">SqlProc</a> <span id="r49 rd" class="r49 r">proc</span>, <a href="@0@mscorlib/A.html#27863de72c2c9b49" class="t t">Action</a>&lt;<a href="#3cccea6d9a6dd3e7" class="t t">SqlTableMapper</a>, <a href="@0@System.Data/A.html#f7c2de36229de361" class="t t">DbDataReader</a>&gt; <span id="r50 rd" class="r50 r">parser</span> = <b>null</b>)
        {
            <a href="#d80aea28850bd3df" class="k">this</a>.<a href="#72b352a8df76d227" class="i property">proc</a> = <span class="r49 r">proc</span>;
            <b>return</b> <a href="#b6a238a4ab76cb05" class="i method">IsEmpty</a>() || <a href="#79687587f062d847" class="i field">mapper</a>.<a href="#f13346e58451c343" class="i method">Prepare</a>(<span class="r49 r">proc</span>, <span class="r50 r">parser</span>);
        }
 
        <b>public</b> <a href="@0@mscorlib/A.html#3acf01620172c7f0" class="t t">IEnumerable</a>&lt;<b>object</b>[]&gt; <a id="e1677c6d96c85f48" href="../R/e1677c6d96c85f48.html" target="n" data-glyph="72,1" class="i method">Query</a>()
        {
            <b>if</b> (!<a href="#a3f57f1b71659d53" class="i method">IsPrepared</a>())
                <b>yield break</b>;
            <b>else</b>
            {
                <b>foreach</b> (<b>var</b> <span id="r51 rd" class="r51 r">item</span> <b>in</b> <a href="#79687587f062d847" class="i field">mapper</a>.<a href="#65bfe659780d68be" class="i method">Query</a>())
                    <b>yield return</b> <span class="r51 r">item</span>;
 
                <a href="#79687587f062d847" class="i field">mapper</a>.<a href="#33f9cd0a1f620107" class="i method">Dispose</a>();
            }
        }
 
    }
 
    <b>public class</b> <a id="a820e35c49f4c6d0" href="../R/a820e35c49f4c6d0.html" target="n" data-glyph="0,0" class="t t">SqlObjectReader</a> : <a href="#3cccea6d9a6dd3e7" class="t t">SqlTableMapper</a>, <a href="@0@mscorlib/A.html#1f55292c3174123d" class="t t">IDisposable</a>
    {
        <b>private</b> <a href="@0@System.Data/A.html#48932d2b804ed473" class="t t">SqlConnection</a> <a id="6429cb2402bead8f" href="../R/6429cb2402bead8f.html" target="n" data-glyph="46,1" class="i field">conn</a>;
        <b>private</b> <a href="@0@System.Data/A.html#6d1f148f36c73572" class="t t">SqlCommand</a> <a id="c4f6911c906360a8" href="../R/c4f6911c906360a8.html" target="n" data-glyph="46,1" class="i field">cmd</a>;
        <a href="@0@System.Data/A.html#d576786f0fd1b1dc" class="t t">SqlDataReader</a> <a id="02591a3ae21c294c" href="../R/02591a3ae21c294c.html" target="n" data-glyph="46,1" class="i field">dataReader</a>;
        <b>private</b> <a href="#edd14aec711c2625" class="t t">StateExec</a> <a id="574be149739f153c" href="../R/574be149739f153c.html" target="n" data-glyph="46,1" class="i field">state</a>;
 
        <b>public</b> <a href="#edd14aec711c2625" class="t t">StateExec</a> <a id="27ef10e9e339c02a" href="../R/../../0000000000.html" target="n" data-glyph="102,1" class="i property">State</a> { <b>get</b> { <b>return</b> <a href="#574be149739f153c" class="i field">state</a>; } }
        <b>public</b> <a href="@0@System.Data/A.html#48932d2b804ed473" class="t t">SqlConnection</a> <a id="31e34774cdd45f21" href="../R/../../0000000000.html" target="n" data-glyph="102,1" class="i property">Connection</a> { <b>get</b> { <b>return</b> <a href="#6429cb2402bead8f" class="i field">conn</a>; } }
        <b>public</b> <a href="@0@System.Data/A.html#d576786f0fd1b1dc" class="t t">SqlDataReader</a> <a id="b62e05c6c13f25e0" href="../R/b62e05c6c13f25e0.html" target="n" data-glyph="102,1" class="i property">DataReader</a> { <b>get</b> { <b>return</b> <a href="#02591a3ae21c294c" class="i field">dataReader</a>; } }
 
        <b>public</b> <a id="c20b162f609d1c78" href="../R/c20b162f609d1c78.html" target="n" data-glyph="72,1" class="i constructor">SqlObjectReader</a>(<a href="@0@mscorlib/A.html#27863de72c2c9b49" class="t t">Action</a>&lt;<a href="#3cccea6d9a6dd3e7" class="t t">SqlTableMapper</a>, <a href="@0@System.Data/A.html#f7c2de36229de361" class="t t">DbDataReader</a>&gt; <span id="r52 rd" class="r52 r">propertiesParser</span>)
            : <a href="#f1becf20bdc122cd" class="k">base</a>(<span class="r52 r">propertiesParser</span>)
        {
            <a href="#6429cb2402bead8f" class="i field">conn</a> = <b>null</b>;
            <a href="#c4f6911c906360a8" class="i field">cmd</a> = <b>null</b>;
            <a href="#02591a3ae21c294c" class="i field">dataReader</a> = <b>null</b>;
            <a href="#574be149739f153c" class="i field">state</a> = <a href="#edd14aec711c2625" class="t t">StateExec</a>.<a href="#d6a5b4ca748c2f54" class="i field">Init</a>;
        }
 
        <b>public bool</b> <a id="f13346e58451c343" href="../R/f13346e58451c343.html" target="n" data-glyph="72,1" class="i method">Prepare</a>(<a href="SqlProc.cs.html#420674bdead92c9e" class="t t">SqlProc</a> <span id="r53 rd" class="r53 r">proc</span>, <a href="@0@mscorlib/A.html#27863de72c2c9b49" class="t t">Action</a>&lt;<a href="#3cccea6d9a6dd3e7" class="t t">SqlTableMapper</a>, <a href="@0@System.Data/A.html#f7c2de36229de361" class="t t">DbDataReader</a>&gt; <span id="r54 rd" class="r54 r">parser</span> = <b>null</b>)
        {
            <b>if</b> (<a href="#574be149739f153c" class="i field">state</a> != <a href="#edd14aec711c2625" class="t t">StateExec</a>.<a href="#d6a5b4ca748c2f54" class="i field">Init</a>)
                <a href="#a820e35c49f4c6d0" class="k">this</a>.<a href="#33f9cd0a1f620107" class="i method">Dispose</a>();
 
            <a href="Context.cs.html#34011a57bc5ada6f" class="t t">Context</a> <span id="r55 rd" class="r55 r">db</span> = <span class="r53 r">proc</span>.<a href="SqlProc.cs.html#0e2cd862b6088b84" class="i property">Context</a>;
            <a href="#6429cb2402bead8f" class="i field">conn</a> = <b>new</b> <a href="@0@System.Data/A.html#5bfcbd0806b49ca2" class="t constructor">SqlConnection</a>(<span class="r55 r">db</span>.<a href="Context.cs.html#3d1ed6eead7f696d" class="i method">ConnectionString</a>());
            <a href="#6429cb2402bead8f" class="i field">conn</a>.<a href="@0@System.Data/A.html#ac652552a54adc78" class="i method">Open</a>();
            <b>if</b> (<a href="#6429cb2402bead8f" class="i field">conn</a>.<a href="@0@System.Data/A.html#8120b88d92ab1c5f" class="i property">State</a> != <a href="@0@System.Data/A.html#1dae67e12c572852" class="t t">ConnectionState</a>.<a href="@0@System.Data/A.html#2b291ca60b251364" class="i field">Open</a>)
                <b>return false</b>;
 
            <a href="#6429cb2402bead8f" class="i field">conn</a>.<a href="@0@System.Data/A.html#addc2aefc62ea789" class="i method">ChangeDatabase</a>(<span class="r55 r">db</span>.<a href="Context.cs.html#974437ffbdef1cfa" class="i property">DbName</a>);
 
            <a href="#c4f6911c906360a8" class="i field">cmd</a> = <span class="r53 r">proc</span>.<a href="SqlProc.cs.html#9ea32c1c77c8f053" class="i method">CreateCommand</a>();
            <a href="#c4f6911c906360a8" class="i field">cmd</a>.<a href="@0@System.Data/A.html#4ab2a471572d72c9" class="i property">Connection</a> = <a href="#6429cb2402bead8f" class="i field">conn</a>;
 
            <a href="#02591a3ae21c294c" class="i field">dataReader</a> = <a href="#c4f6911c906360a8" class="i field">cmd</a>.<a href="@0@System.Data/A.html#cc08a7aa2c882238" class="i method">ExecuteReader</a>(<a href="@0@System.Data/A.html#776b11da53811109" class="t t">CommandBehavior</a>.<a href="@0@System.Data/A.html#0886a2229603db31" class="i field">SchemaOnly</a> | <a href="@0@System.Data/A.html#776b11da53811109" class="t t">CommandBehavior</a>.<a href="@0@System.Data/A.html#e1154a13a66f0299" class="i field">KeyInfo</a>);
 
            <b>if</b> (<span class="r54 r">parser</span> != <b>null</b>)
                <a href="#3cccea6d9a6dd3e7" class="k">base</a>.<a href="#d9724b5c4267192f" class="i field">propertiesParser</a> = <span class="r54 r">parser</span>;
            (<a href="#a820e35c49f4c6d0" class="k">this</a> <b>as</b> <a href="DbDataMapHelper.cs.html#072ccd67e28f75bb" class="t t">IDataMapHelper</a>&lt;<b>object</b>[]&gt;).<a href="DbDataMapHelper.cs.html#88d6b27976920074" class="i method">GetProperties</a>(<a href="#02591a3ae21c294c" class="i field">dataReader</a>);
 
 
            <span class="c">// CommandBehavior.</span>
            <span class="c">//  SingleResult = 1,   The query returns a single result set.</span>
            <span class="c">//    SchemaOnly = 2,</span>
            <span class="c">//     The query returns column information only. When using System.Data.CommandBehavior.SchemaOnly,</span>
            <span class="c">//     the .NET Framework Data Provider for SQL Server precedes the statement being</span>
            <span class="c">//     executed with SET FMTONLY ON.</span>
            <span class="c">//  KeyInfo = 4,</span>
            <span class="c">//     The query returns column and primary key information.</span>
            <span class="c">//  SingleRow = 8,</span>
            <span class="c">//     The query is expected to return a single row of the first result set. Execution</span>
            <span class="c">//     of the query may affect the database state. Some .NET Framework data providers</span>
            <span class="c">//     may, but are not required to, use this information to optimize the performance</span>
            <span class="c">//     of the command. When you specify System.Data.CommandBehavior.SingleRow with</span>
            <span class="c">//     the System.Data.OleDb.OleDbCommand.ExecuteReader() method of the System.Data.OleDb.OleDbCommand</span>
            <span class="c">//     object, the .NET Framework Data Provider for OLE DB performs binding using</span>
            <span class="c">//     the OLE DB IRow interface if it is available. Otherwise, it uses the IRowset</span>
            <span class="c">//     interface. If your SQL statement is expected to return only a single row,</span>
            <span class="c">//     specifying System.Data.CommandBehavior.SingleRow can also improve application</span>
            <span class="c">//     performance. It is possible to specify SingleRow when executing queries that</span>
            <span class="c">//     are expected to return multiple result sets. In that case, where both a multi-result</span>
            <span class="c">//     set SQL query and single row are specified, the result returned will contain</span>
            <span class="c">//     only the first row of the first result set. The other result sets of the</span>
            <span class="c">//     query will not be returned.</span>
 
            <a href="#02591a3ae21c294c" class="i field">dataReader</a> = <a href="#c4f6911c906360a8" class="i field">cmd</a>.<a href="@0@System.Data/A.html#cc08a7aa2c882238" class="i method">ExecuteReader</a>(<a href="@0@System.Data/A.html#776b11da53811109" class="t t">CommandBehavior</a>.<a href="@0@System.Data/A.html#4d51fc3343ba6279" class="i field">CloseConnection</a> | <a href="@0@System.Data/A.html#776b11da53811109" class="t t">CommandBehavior</a>.<a href="@0@System.Data/A.html#56c4c57b7770c503" class="i field">SingleResult</a>);
 
            <a href="#574be149739f153c" class="i field">state</a> = <a href="#edd14aec711c2625" class="t t">StateExec</a>.<a href="#e541993248f2011c" class="i field">Prepared</a>;
            <b>return true</b>;
        }
 
        <b>public void</b> <a id="c31d4c4e76cf4bfa" href="../R/c31d4c4e76cf4bfa.html" target="n" data-glyph="72,1" class="i method">StateExecuting</a>()
        {
            <a href="#574be149739f153c" class="i field">state</a> = <a href="#edd14aec711c2625" class="t t">StateExec</a>.<a href="#b353c5eeb62aad5b" class="i field">Executing</a>;
        }
 
        <b>public int</b>? <a id="d03ed1cfa4669bd5" href="../R/../../0000000000.html" target="n" data-glyph="102,1" class="i property">Records</a> { <b>get</b> { <b>return</b> <a href="#a820e35c49f4c6d0" class="k">this</a>.<a href="#02591a3ae21c294c" class="i field">dataReader</a> == <b>null</b> ? <b>null</b> : (<b>int</b>?)<a href="#02591a3ae21c294c" class="i field">dataReader</a>.<a href="@0@System.Data/A.html#0a9b406ea2cf28c8" class="i property">RecordsAffected</a>; } }
 
        <b>public</b> <a href="@0@mscorlib/A.html#3acf01620172c7f0" class="t t">IEnumerable</a>&lt;<b>object</b>[]&gt; <a id="65bfe659780d68be" href="../R/65bfe659780d68be.html" target="n" data-glyph="72,1" class="i method">Query</a>()
        {
            <a href="#c31d4c4e76cf4bfa" class="i method">StateExecuting</a>();
            <span class="c">// using (SqlDataReader dataReader = cmd.ExecuteReader())</span>
            <b>if</b> (<a href="#02591a3ae21c294c" class="i field">dataReader</a> == <b>null</b> || !<a href="#02591a3ae21c294c" class="i field">dataReader</a>.<a href="@0@System.Data/A.html#5f1c5939d60eccbb" class="i method">Read</a>())
            {
                <a href="#33f9cd0a1f620107" class="i method">Dispose</a>();
                <a href="#574be149739f153c" class="i field">state</a> = <a href="#edd14aec711c2625" class="t t">StateExec</a>.<a href="#d6a5b4ca748c2f54" class="i field">Init</a>;
 
                <b>yield break</b>;
            }
            <b>else</b>
            {
                <a href="#a820e35c49f4c6d0" class="k">var</a> <span id="r56 rd" class="r56 r">helper</span> = <a href="#a820e35c49f4c6d0" class="k">this</a>;
                <b>do</b>
                {
                    <b>object</b>[] <span id="r57 rd" class="r57 r">objVal</span> = <span class="r56 r">helper</span>.<a href="#235a326cca6c8a8e" class="i method">DbRecordArray</a>();
                    <a href="#02591a3ae21c294c" class="i field">dataReader</a>.<a href="@0@System.Data/A.html#7c5486f7b548f0e2" class="i method">GetValues</a>(<span class="r57 r">objVal</span>);
 
                    <b>yield return</b> <span class="r56 r">helper</span>.<a href="#e20fe898d1fc4f54" class="i method">SetValues</a>(<span class="r57 r">objVal</span>);
                }
                <b>while</b> (<a href="#02591a3ae21c294c" class="i field">dataReader</a>.<a href="@0@System.Data/A.html#5f1c5939d60eccbb" class="i method">Read</a>());
 
                <a href="#33f9cd0a1f620107" class="i method">Dispose</a>();
                <a href="#574be149739f153c" class="i field">state</a> = <a href="#edd14aec711c2625" class="t t">StateExec</a>.<a href="#d6a5b4ca748c2f54" class="i field">Init</a>;
            }
        }
 
        <b>public enum</b> <a id="edd14aec711c2625" href="../R/edd14aec711c2625.html" target="n" data-glyph="18,1" class="t t"><span id="71edde83da5c7a0e">StateExec</span></a>
        {
            <a id="d6a5b4ca748c2f54" href="../R/d6a5b4ca748c2f54.html" target="n" data-glyph="24,2" class="i field">Init</a> = 0,
            <a id="e541993248f2011c" href="../R/e541993248f2011c.html" target="n" data-glyph="24,2" class="i field">Prepared</a> = 1,
            <a id="b353c5eeb62aad5b" href="../R/b353c5eeb62aad5b.html" target="n" data-glyph="24,2" class="i field">Executing</a> = 2
            <span class="c">// Finished = 3</span>
        }
 
        <b>public void</b> <a id="33f9cd0a1f620107" href="../R/33f9cd0a1f620107.html" target="n" data-glyph="72,1" class="i method">Dispose</a>()
        {
            <b>if</b> (<a href="#02591a3ae21c294c" class="i field">dataReader</a> != <b>null</b>)
                <a href="#02591a3ae21c294c" class="i field">dataReader</a>.<a href="@0@System.Data/A.html#299df8cf12ea9097" class="i method">Dispose</a>();
            <a href="#02591a3ae21c294c" class="i field">dataReader</a> = <b>null</b>;
 
            <b>if</b> (<a href="#c4f6911c906360a8" class="i field">cmd</a> != <b>null</b>)
                <a href="#c4f6911c906360a8" class="i field">cmd</a>.<a href="@0@System/A.html#ec402748f4bd1220" class="i method">Dispose</a>();
            <a href="#c4f6911c906360a8" class="i field">cmd</a> = <b>null</b>;
 
            <b>if</b> (<a href="#6429cb2402bead8f" class="i field">conn</a> != <b>null</b> &amp;&amp; <a href="#6429cb2402bead8f" class="i field">conn</a>.<a href="@0@System.Data/A.html#8120b88d92ab1c5f" class="i property">State</a> != <a href="@0@System.Data/A.html#1dae67e12c572852" class="t t">ConnectionState</a>.<a href="@0@System.Data/A.html#d482408df082bfdc" class="i field">Closed</a>)
                <a href="#6429cb2402bead8f" class="i field">conn</a>.<a href="@0@System.Data/A.html#9414944f8fe487ef" class="i method">Close</a>();
            <b>if</b> (<a href="#6429cb2402bead8f" class="i field">conn</a> != <b>null</b>)
                <a href="#6429cb2402bead8f" class="i field">conn</a>.<a href="@0@System/A.html#ec402748f4bd1220" class="i method">Dispose</a>();
            <a href="#6429cb2402bead8f" class="i field">conn</a> = <b>null</b>;
            <a href="#574be149739f153c" class="i field">state</a> = <a href="#edd14aec711c2625" class="t t">StateExec</a>.<a href="#d6a5b4ca748c2f54" class="i field">Init</a>;
        }
    }
 
}
</pre></td></tr></table></div></body></html>
