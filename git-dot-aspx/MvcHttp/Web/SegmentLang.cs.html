<!DOCTYPE html>
<html><head><title>SegmentLang.cs</title><link rel="stylesheet" href="../../styles.css"><script src="../../scripts.js"></script></head>
<body class="cB" onload="i(465);"><div class="dH">
<table style="width: 100%">
<tr><td>File: <a id="filePath" class="blueLink" href="/#MvcHttp/Web/SegmentLang.cs" target="_top">Web\SegmentLang.cs</a><br/></td><td></td></tr>
<tr><td>Project: <a id="projectPath" class="blueLink" href="/#MvcHttp" target="_top">MvcHttp\MvcHttp.csproj</a> (MvcHttp)</td><td></td></tr>
</table>
</div>
<div class="cz"><table class="tb" cellpadding="0" cellspacing="0"><tr><td valign="top" align="right"><pre id="ln"></pre></td><td valign="top" align="left"><pre id="code">

<b>using</b> <span class="i n">AiLib</span>.<span class="i n">Mvc</span>;
<b>using</b> <span class="i n">AiLib</span>.<span class="i n">Render</span>;
<b>using</b> <span class="i n">System</span>;
<b>using</b> <span class="i n">System</span>.<span class="i n">Collections</span>.<span class="i n">Generic</span>;
<b>using</b> <span class="i n">System</span>.<span class="i n">Configuration</span>;
<b>using</b> <span class="i n">System</span>.<span class="i n">Linq</span>;
<b>using</b> <span class="i n">System</span>.<span class="i n">Text</span>;
<b>using</b> <span class="i n">System</span>.<span class="i n">Threading</span>.<span class="i n">Tasks</span>;
<b>using</b> <span class="i n">System</span>.<span class="i n">Web</span>;
<b>using</b> <span class="i n">System</span>.<span class="i n">Web</span>.<span class="i n">Hosting</span>;
<b>using</b> <span class="i n">System</span>.<span class="i n">Web</span>.<span class="i n">Routing</span>;
<b>using</b> <span class="i n">System</span>.<span class="i n">IO</span>;
<b>using</b> <span class="i n">System</span>.<span class="i n">Web</span>.<span class="i n">Mvc</span>;
<b>using</b> <span class="i n">AiLib</span>.<span class="i n">MvcHttp</span>;
<b>using</b> <span class="i n">System</span>.<span class="i n">Xml</span>.<span class="i n">Linq</span>;

<b>namespace</b> <span class="i n">AiLib</span>.<span class="i n">Web</span>
{
    <b>public class</b> <a id="1560d52eea3e70e5" href="../R/1560d52eea3e70e5.html" target="n" data-glyph="0,0" class="t t"><span id="c8967193898ae327">SegmentLang</span></a> : <a href="Segment.cs.html#701d093cab6c6ef4" class="t t">Segment</a>, <a href="Segment.cs.html#dfbcdaf9936acc03" class="t t">ISegment</a>
    {
        <b>public</b> <b>new</b> <b>static</b> <a href="#1560d52eea3e70e5" class="t t">SegmentLang</a> <a id="217ca99a5e7e96ae" href="../R/217ca99a5e7e96ae.html" target="n" data-glyph="42,1" class="i field">Instance</a>;
        <b>static</b> <a id="963eb82f44f12012" href="../R/../../0000000000.html" target="n" data-glyph="76,1" class="i method">SegmentLang</a>()
        {
            <a href="@0@mscorlib/A.html#8281103e6f23cb5c" class="k">var</a> <span id="r0 rd" class="r0 r">firmID</span> = <a href="@0@System.Configuration/A.html#82b0d78ddc6f04b3" class="t t">ConfigurationManager</a>.<a href="@0@System.Configuration/A.html#cfa8b7126ec13177" class="i property">AppSettings</a>.<a href="@0@System/A.html#f72b925e4fb9387a" class="i method">Get</a>(<span class="s">&quot;dir.firmid&quot;</span>) ?? <span class="s">&quot;SA&quot;</span>;
            <a href="@0@mscorlib/A.html#8281103e6f23cb5c" class="k">var</a> <span id="r1 rd" class="r1 r">lang</span> = <a href="@0@System.Configuration/A.html#82b0d78ddc6f04b3" class="t t">ConfigurationManager</a>.<a href="@0@System.Configuration/A.html#cfa8b7126ec13177" class="i property">AppSettings</a>.<a href="@0@System/A.html#f72b925e4fb9387a" class="i method">Get</a>(<span class="s">&quot;dir.lang&quot;</span>) ?? <span class="s">&quot;LT&quot;</span>;
            <a href="#217ca99a5e7e96ae" class="i field">Instance</a> = <b>new</b> <a href="#1560d52eea3e70e5" class="t constructor">SegmentLang</a>() { <a href="#9f767652c2859dc7" class="i property">FirmID</a> = <span class="r0 r">firmID</span>, <a href="#2d6e49f5e44f98ac" class="i property">Lang</a> = <span class="r1 r">lang</span> };
            <a href="Segment.cs.html#701d093cab6c6ef4" class="t t">Segment</a>.<a href="Segment.cs.html#293d0a86ce2b0d20" class="i field">Instance</a> = <a href="#217ca99a5e7e96ae" class="i field">Instance</a>;
            <a href="#217ca99a5e7e96ae" class="i field">Instance</a>.<a href="#ab6cf7e091d79c5a" class="i field">afterFirst</a> = <b>false</b>;
            <a href="#217ca99a5e7e96ae" class="i field">Instance</a>.<a href="#1924effe39414a87" class="i property">PhysicalPath</a> = <a href="@0@System.Web/A.html#f12b2fb72be7982c" class="t t">HostingEnvironment</a>.<a href="@0@System.Web/A.html#5c349191566e3f2c" class="i property">ApplicationPhysicalPath</a>;
        }

        <b>public</b> <a href="@0@mscorlib/A.html#f092fb2b893a0162" class="t t">Exception</a> <a id="6cd8ce7f872d404a" href="../R/6cd8ce7f872d404a.html" target="n" data-glyph="102,1" class="i property">LastException</a> { <b>get</b>; <b>set</b>; }

        <span class="k preprocess">#</span><span class="k preprocess">region</span> Properties
        <b>public</b> <b>new</b> <b>string</b> <a id="9f767652c2859dc7" href="../R/9f767652c2859dc7.html" target="n" data-glyph="102,1" class="i property">FirmID</a>
        {
            <b>get</b> { <b>return</b> <a href="Segment.cs.html#701d093cab6c6ef4" class="k">base</a>.<a href="Segment.cs.html#d1ebecb7d3bcae32" class="i property">FirmID</a>; }
            <b>set</b>
            {
                <b>if</b> (<a href="Segment.cs.html#701d093cab6c6ef4" class="k">base</a>.<a href="Segment.cs.html#d1ebecb7d3bcae32" class="i property">FirmID</a> != <b>value</b>)
                    <a href="Segment.cs.html#701d093cab6c6ef4" class="k">base</a>.<a href="Segment.cs.html#d1ebecb7d3bcae32" class="i property">FirmID</a> = <b>value</b>;
            }
        }

        <span class="c">// interface language : LT or EN</span>
        <b>public</b> <b>new</b> <b>string</b> <a id="2d6e49f5e44f98ac" href="../R/2d6e49f5e44f98ac.html" target="n" data-glyph="102,1" class="i property">Lang</a>
        {
            <b>get</b> { <b>return</b> <a href="../Trans.cs.html#264811a697a64aa9" class="t t">Trans</a>.<a href="../Trans.cs.html#ba8d1287514e7d36" class="i property">Lang</a>.<a href="@0@mscorlib/A.html#d536cbe70a300b01" class="i method">ToUpper</a>(); }
            <b>set</b>
            {
                <b>if</b> (<b>value</b> == <b>null</b>)
                    <b>return</b>;
                <b>if</b> (<a href="../Trans.cs.html#264811a697a64aa9" class="t t">Trans</a>.<a href="../Trans.cs.html#ba8d1287514e7d36" class="i property">Lang</a> != <b>value</b>.<a href="@0@mscorlib/A.html#0b5a1ee33618e0b3" class="i method">ToLower</a>())
                    <a href="../Trans.cs.html#264811a697a64aa9" class="t t">Trans</a>.<a href="../Trans.cs.html#ba8d1287514e7d36" class="i property">Lang</a> = <b>value</b>.<a href="@0@mscorlib/A.html#0b5a1ee33618e0b3" class="i method">ToLower</a>();
                <a href="Segment.cs.html#701d093cab6c6ef4" class="k">base</a>.<a href="Segment.cs.html#afa9e3c28bae6009" class="i property">Lang</a> = <b>value</b>;
            }
        }

        <span class="k preprocess">#</span><span class="k preprocess">endregion</span>

        <span class="k preprocess">#</span><span class="k preprocess">region</span> Session, Request

        <b>public string</b> <a id="a7d3f59761a515d6" href="../R/a7d3f59761a515d6.html" target="n" data-glyph="102,1" class="i property">SiteAlias</a> { <b>get</b>; <b>set</b>; }
        <b>public string</b> <a id="65bf82bf7e22752e" href="../R/65bf82bf7e22752e.html" target="n" data-glyph="102,1" class="i property">VirtualPath</a> { <b>get</b>; <b>set</b>; }
        <b>public string</b> <a id="1924effe39414a87" href="../R/1924effe39414a87.html" target="n" data-glyph="102,1" class="i property">PhysicalPath</a> { <b>get</b>; <b>set</b>; }
        <b>public string</b> <a id="2f047b7faf898f7c" href="../R/../../0000000000.html" target="n" data-glyph="102,1" class="i property">IP</a> { <b>get</b> { <b>return</b> <a href="HttpStatic.cs.html#dc32c2cfc2749249" class="t t">HttpStatic</a>.<a href="HttpStatic.cs.html#589b916ff3c67352" class="i property">Current</a> == <b>null</b> ? <b>string</b>.<a href="@0@mscorlib/A.html#c9f70a27facb27cf" class="i field">Empty</a> : <a href="HttpStatic.cs.html#dc32c2cfc2749249" class="t t">HttpStatic</a>.<a href="HttpStatic.cs.html#7efded907d82802e" class="i property">Request</a>.<a href="@0@System.Web/A.html#ef16ce1dfbb74ecb" class="i property">UserHostAddress</a>.<a href="Reflection/WebStringConvert.cs.html#475e74ba16548eb0" class="i method">SubStringSafe</a>(0, 20); } }

        [<a href="../RazorGenerator.Mvc/ViewClass.cs.html#4793a1e5c0f43929" class="t constructor">Caller</a>(<b>typeof</b>(<a href="HttpHandler.cs.html#196280eab96bfdac" class="t t">HttpHandler</a>), <span class="s">&quot;Init&quot;</span>)]
        <b>public virtual void</b> <a id="e9bee8616049ed4c" href="../R/e9bee8616049ed4c.html" target="n" data-glyph="72,1" class="i method">InitHandler</a>(<a href="@0@System.Web/A.html#46c4f0aa7cd268fe" class="t t">HttpApplication</a> <span id="r2 rd" class="r2 r">context</span>, <a href="@0@System.Web/A.html#2352844b030631b2" class="t t">IHttpModule</a> <span id="r3 rd" class="r3 r">module</span> = <b>null</b>)
        {
            <a href="../Guard.cs.html#d9bf5b5bec13d107" class="t t">Guard</a>.<a href="../Guard.cs.html#1798ec9653f2e59f" class="i method">CheckArgumentNull</a>(<span class="r2 r">context</span>);
            <a href="#65bf82bf7e22752e" class="i property">VirtualPath</a> = <a href="@0@System.Web/A.html#f12b2fb72be7982c" class="t t">HostingEnvironment</a>.<a href="@0@System.Web/A.html#403ee1a4de2b9a62" class="i property">ApplicationVirtualPath</a>;
            <b>if</b> (<a href="#65bf82bf7e22752e" class="i property">VirtualPath</a> == <b>null</b>)
                <b>return</b>;     <span class="c">// Test unit</span>
            <a href="#a7d3f59761a515d6" class="i property">SiteAlias</a> = <a href="@0@System.Web/A.html#f12b2fb72be7982c" class="t t">HostingEnvironment</a>.<a href="@0@System.Web/A.html#1cb1426b6b4db0e4" class="i property">SiteName</a>.<a href="@0@mscorlib/A.html#69fc1d0aa6df8a90" class="i method">Replace</a>(<span class="s">&quot; &quot;</span>, <span class="s">&quot;&quot;</span>);
            <a href="#1924effe39414a87" class="i property">PhysicalPath</a> = <a href="@0@System.Web/A.html#f12b2fb72be7982c" class="t t">HostingEnvironment</a>.<a href="@0@System.Web/A.html#5c349191566e3f2c" class="i property">ApplicationPhysicalPath</a>;

            <span class="c">// The first System.Exception for the current HTTP request/response process;</span>
            <a href="@0@mscorlib/A.html#f092fb2b893a0162" class="t t">Exception</a> <span id="r4 rd" class="r4 r">appError</span> = <a href="@0@System.Web/A.html#6fba8e72335f5cc8" class="t t">HttpContext</a>.<a href="@0@System.Web/A.html#917b79cec44466cd" class="i property">Current</a> == <b>null</b> ? <b>null</b> : <a href="@0@System.Web/A.html#6fba8e72335f5cc8" class="t t">HttpContext</a>.<a href="@0@System.Web/A.html#917b79cec44466cd" class="i property">Current</a>.<a href="@0@System.Web/A.html#0bb696980ee2be6e" class="i property">Error</a>;
            <b>if</b> (<span class="r4 r">appError</span> != <b>null</b> &amp;&amp; <a href="#bb32c4e6bfe555de" class="i property">CustomError</a> != <b>null</b>)
            {
                <a href="#bb32c4e6bfe555de" class="i property">CustomError</a>(<span class="r4 r">appError</span>);
            }

            <b>if</b> (<span class="r3 r">module</span> != <b>null</b>) <span class="c">// &amp;&amp; !isModuleInit)</span>
            {
                <span class="r2 r">context</span>.<a href="@0@System.Web/A.html#c0eeabbe84a38a08" class="i">PostAuthenticateRequest</a> += <b>new</b> <span class="t">EventHandler</span>(<a href="#4be7c69447a281ab" class="i method">OnPostAuthenticate</a>);
                <span class="c">// pipeline error NullReferenceException PipelineModuleStepContainer.GetStepArray</span>
            }
        }

        <b>public static void</b> <a id="4be7c69447a281ab" href="../R/4be7c69447a281ab.html" target="n" data-glyph="72,1" class="i method">OnPostAuthenticate</a>(<b>object</b> <span id="r5 rd" class="r5 r">sender</span>, <a href="@0@mscorlib/A.html#9a1496aa60befd10" class="t t">EventArgs</a> <span id="r6 rd" class="r6 r">args</span>)
        {
            <a href="@0@System.Web/A.html#6fba8e72335f5cc8" class="k">var</a> <span id="r7 rd" class="r7 r">ctx</span> = <a href="@0@System.Web/A.html#6fba8e72335f5cc8" class="t t">HttpContext</a>.<a href="@0@System.Web/A.html#917b79cec44466cd" class="i property">Current</a>;
            <b>if</b> (<span class="r7 r">ctx</span> == <b>null</b> || <span class="r7 r">ctx</span>.<a href="@0@System.Web/A.html#601e6eafc050b903" class="i property">Session</a> == <b>null</b>
                || <span class="r7 r">ctx</span>.<a href="@0@System.Web/A.html#90c6355c9857d1e2" class="i property">User</a> == <b>null</b> || !<span class="r7 r">ctx</span>.<a href="@0@System.Web/A.html#90c6355c9857d1e2" class="i property">User</a>.<a href="@0@mscorlib/A.html#d8458dcca9bf9e3c" class="i property">Identity</a>.<a href="@0@mscorlib/A.html#74422dd23bbca7de" class="i property">IsAuthenticated</a>)
                <b>return</b>;

            <a href="#217ca99a5e7e96ae" class="i field">Instance</a>.<a href="#aab97ef1e5a59791" class="i method">CreateSession</a>();
            <span class="c">//var userClaim = Claim.GetPrincipal(ctx);</span>
        }

        <b>public virtual bool</b> <a id="84199989524859de" href="../R/84199989524859de.html" target="n" data-glyph="72,1" class="i method">OnFirstRequest</a>(<b>object</b> <span id="r8 rd" class="r8 r">sender</span>, <a href="@0@mscorlib/A.html#9a1496aa60befd10" class="t t">EventArgs</a> <span id="r9 rd" class="r9 r">args</span>)
        {
            <b>if</b> (<a href="#217ca99a5e7e96ae" class="i field">Instance</a>.<a href="#6cd8ce7f872d404a" class="i property">LastException</a> != <b>null</b>)
            {
                <span class="c">// Startup error</span>
                <a href="HttpHandler.cs.html#196280eab96bfdac" class="t t">HttpHandler</a>.<a href="HttpHandler.cs.html#087e5bc4b903bf1a" class="i method">AppError</a>(<a href="#217ca99a5e7e96ae" class="i field">Instance</a>.<a href="#6cd8ce7f872d404a" class="i property">LastException</a>);
                <b>return false</b>;
            }

            <b>string</b> <span id="r10 rd" class="r10 r">status</span> = <span class="s">&quot;&quot;</span>;
            <b>try</b>
            {
                <a href="@0@System.Web/A.html#313dbe954e552d25" class="k">var</a> <span id="r11 rd" class="r11 r">req</span> = <a href="HttpStatic.cs.html#dc32c2cfc2749249" class="t t">HttpStatic</a>.<a href="HttpStatic.cs.html#7efded907d82802e" class="i property">Request</a>;
                <b>if</b> (<span class="r11 r">req</span> != <b>null</b>)
                {
                    <span class="r10 r">status</span> = <span class="s">&quot; ip = &quot;</span> + <span class="r11 r">req</span>.<a href="@0@System.Web/A.html#ef16ce1dfbb74ecb" class="i property">UserHostAddress</a>;
                    <a href="@0@mscorlib/A.html#8281103e6f23cb5c" class="k">var</a> <span id="r12 rd" class="r12 r">browser</span> = <span class="r11 r">req</span>.<a href="@0@System.Web/A.html#af3ddafa67877f3c" class="i property">Browser</a>.<a href="@0@System.Web/A.html#4b5e2a9f04bcc3c8" class="i property">Browser</a> + <span class="r11 r">req</span>.<a href="@0@System.Web/A.html#af3ddafa67877f3c" class="i property">Browser</a>.<a href="@0@System.Web/A.html#b9548321d9830928" class="i property">Version</a> + <span class="s">&quot;/&quot;</span> + <span class="r11 r">req</span>.<a href="@0@System.Web/A.html#af3ddafa67877f3c" class="i property">Browser</a>.<a href="@0@System.Web/A.html#c367a5bc23dc7825" class="i property">Platform</a>;
                    <span class="r10 r">status</span> += <span class="s">&quot; &quot;</span> + <span class="r12 r">browser</span> + <span class="s">&quot; &quot;</span>;
                    <span class="c">// + &quot; clr=&quot; + req.Browser.ClrVersion.ToString()</span>

                    <b>var</b> <span id="r13 rd" class="r13 r">langList</span> = <span class="r11 r">req</span>.<a href="@0@System.Web/A.html#7695de2a0b9d4eee" class="i property">UserLanguages</a>;
                    <b>if</b> (<span class="r13 r">langList</span>.<a href="@0@System.Core/A.html#8788153112b7ffd0" class="i method">Any</a>())
                    {
                        <a href="@0@mscorlib/A.html#6624f38cb955bfe0" class="k">var</a> <span id="r14 rd" class="r14 r">numer</span> = <span class="r13 r">langList</span>.<a href="@0@mscorlib/A.html#34fb54e46eb30d27" class="i method">GetEnumerator</a>();
                        <span class="r10 r">status</span> += <span class="s">&quot; lang=&quot;</span>;
                        <b>for</b> (<b>int</b> <span id="r15 rd" class="r15 r">i</span> = 0; <span class="r15 r">i</span> &lt; 2 &amp;&amp; <span class="r14 r">numer</span>.<a href="@0@mscorlib/A.html#116c28c0f6355e3f" class="i method">MoveNext</a>(); <span class="r15 r">i</span>++)
                            <span class="r10 r">status</span> += <span class="r14 r">numer</span>.<a href="@0@mscorlib/A.html#3f12a86aa5b0da2b" class="i property">Current</a> + <span class="s">&quot;;&quot;</span>;
                    }
                    <span class="r10 r">status</span> += <span class="s">&quot; url=&quot;</span> + (<span class="r11 r">req</span>.<a href="@0@System.Web/A.html#98945de8f620647a" class="i property">Url</a>.<a href="@0@System/A.html#bf3caa11ab73e433" class="i method">ToString</a>() ?? <b>string</b>.<a href="@0@mscorlib/A.html#c9f70a27facb27cf" class="i field">Empty</a>);
                }
            }
            <b>catch</b> (<a href="@0@mscorlib/A.html#f092fb2b893a0162" class="t t">Exception</a>) { ; }
            <b>if</b> (<span class="r10 r">status</span>.<a href="@0@mscorlib/A.html#e13f5829ef28aa07" class="i property">Length</a> &gt; 90)
                <span class="r10 r">status</span> = <span class="r10 r">status</span>.<a href="@0@mscorlib/A.html#8124961f027d9ac9" class="i method">Substring</a>(0, 90);

            <a href="../Log.cs.html#a3e8993478f4ef54" class="t t">Log</a>.<a href="../Log.cs.html#6f2248a9a1e33162" class="i method">Write</a>(<span class="s">&quot;AppStart Init &quot;</span> + <span class="r10 r">status</span>);
            <span class="c">// AiLib.Web.Reflection.WebStringConvert.PadRight  + AiLib.Web.HttpStatic  req.Url.ToString()</span>

            <b>return true</b>;
        }

        <b>public</b> <a href="@0@mscorlib/A.html#486d58da4553e12d" class="t t">Action</a>&lt;<a href="@0@mscorlib/A.html#f092fb2b893a0162" class="t t">Exception</a>&gt; <a id="bb32c4e6bfe555de" href="../R/bb32c4e6bfe555de.html" target="n" data-glyph="102,1" class="i property">CustomError</a> { <b>get</b>; <b>set</b>; }

        <b>public override bool</b> <a id="5422245f932a8ee6" href="../R/5422245f932a8ee6.html" target="n" data-glyph="72,1" class="i method">IgnoreError</a>(<a href="@0@mscorlib/A.html#f092fb2b893a0162" class="t t">Exception</a> <span id="r16 rd" class="r16 r">ex</span>, <a href="@0@System.Web/A.html#313dbe954e552d25" class="t t">HttpRequest</a> <span id="r17 rd" class="r17 r">req</span>)
        {
            <b>if</b> (<a href="#bb32c4e6bfe555de" class="i property">CustomError</a> == <b>null</b>)
                <b>return false</b>;

            <a href="#bb32c4e6bfe555de" class="i property">CustomError</a>(<span class="r16 r">ex</span>);
            <b>return true</b>;
        }

        <b>public virtual void</b> <a id="aab97ef1e5a59791" href="../R/aab97ef1e5a59791.html" target="n" data-glyph="72,1" class="i method">CreateSession</a>()
        {
            <a href="@0@System.Web/A.html#6fba8e72335f5cc8" class="k">var</a> <span id="r18 rd" class="r18 r">ctx</span> = <a href="@0@System.Web/A.html#6fba8e72335f5cc8" class="t t">HttpContext</a>.<a href="@0@System.Web/A.html#917b79cec44466cd" class="i property">Current</a>;
            <b>if</b> (<span class="r18 r">ctx</span> == <b>null</b> || <span class="r18 r">ctx</span>.<a href="@0@System.Web/A.html#601e6eafc050b903" class="i property">Session</a> == <b>null</b>)
                <b>return</b>;

            <a href="#1e1b270040525312" class="i method">SaveSession</a>();
        }

        <b>public virtual void</b> <a id="1d1f38bccf36d62b" href="../R/1d1f38bccf36d62b.html" target="n" data-glyph="72,1" class="i method">ReadRequest</a>()
        {
            <a href="@0@System.Web/A.html#6fba8e72335f5cc8" class="k">var</a> <span id="r19 rd" class="r19 r">ctx</span> = <a href="@0@System.Web/A.html#6fba8e72335f5cc8" class="t t">HttpContext</a>.<a href="@0@System.Web/A.html#917b79cec44466cd" class="i property">Current</a>;
            <b>if</b> (<span class="r19 r">ctx</span> == <b>null</b> || <span class="r19 r">ctx</span>.<a href="@0@System.Web/A.html#1ef28ccd612d621c" class="i property">Request</a> == <b>null</b> || <span class="r19 r">ctx</span>.<a href="@0@System.Web/A.html#1ef28ccd612d621c" class="i property">Request</a>.<a href="@0@System.Web/A.html#20122c18b4ca8f34" class="i property">Params</a>.<a href="@0@System/A.html#fbd562ca3c55ec32" class="i property">Count</a> == 0)
                <b>return</b>;

            <a href="@0@mscorlib/A.html#40fe672fdd6dae6b" class="k">var</a> <span id="r20 rd" class="r20 r">user</span> = <span class="r19 r">ctx</span>.<a href="@0@System.Web/A.html#90c6355c9857d1e2" class="i property">User</a>;
            <b>string</b> <span id="r21 rd" class="r21 r">newLang</span> = <span class="r19 r">ctx</span>.<a href="@0@System.Web/A.html#1ef28ccd612d621c" class="i property">Request</a>.<a href="@0@System.Web/A.html#20122c18b4ca8f34" class="i property">Params</a><a href="@0@System/A.html#b33fdfa0b2d0a3ad">[</a><span class="s">&quot;lang&quot;</span>];
            <b>if</b> (<span class="r21 r">newLang</span> == <span class="s">&quot;lt&quot;</span> || <span class="r21 r">newLang</span> == <span class="s">&quot;en&quot;</span>)
                <span class="r21 r">newLang</span> = <span class="r21 r">newLang</span>.<a href="@0@mscorlib/A.html#8124961f027d9ac9" class="i method">Substring</a>(0, 2).<a href="@0@mscorlib/A.html#d536cbe70a300b01" class="i method">ToUpper</a>();

            <b>if</b> (!<b>string</b>.<a href="@0@mscorlib/A.html#55e241b6143365ef" class="i method">IsNullOrWhiteSpace</a>(<span class="r21 r">newLang</span>))
            {
                <a href="#217ca99a5e7e96ae" class="i field">Instance</a>.<a href="#2d6e49f5e44f98ac" class="i property">Lang</a> = <span class="r21 r">newLang</span>;
                <b>if</b> (<span class="r19 r">ctx</span>.<a href="@0@System.Web/A.html#601e6eafc050b903" class="i property">Session</a> != <b>null</b>)
                    <a href="#217ca99a5e7e96ae" class="i field">Instance</a>.<a href="#1e1b270040525312" class="i method">SaveSession</a>();
            }
        }

        <b>public virtual void</b> <a id="d281813f7a85e4de" href="../R/d281813f7a85e4de.html" target="n" data-glyph="72,1" class="i method">ReadSession</a>()
        {
            <a href="#217ca99a5e7e96ae" class="i field">Instance</a>.<a href="#9f767652c2859dc7" class="i property">FirmID</a> = <a href="#217ca99a5e7e96ae" class="i field">Instance</a>.<a href="#9f767652c2859dc7" class="i property">FirmID</a> ?? <a href="@0@System.Configuration/A.html#82b0d78ddc6f04b3" class="t t">ConfigurationManager</a>.<a href="@0@System.Configuration/A.html#cfa8b7126ec13177" class="i property">AppSettings</a>.<a href="@0@System/A.html#f72b925e4fb9387a" class="i method">Get</a>(<span class="s">&quot;dir.firmid&quot;</span>);
            <a href="@0@mscorlib/A.html#8281103e6f23cb5c" class="k">var</a> <span id="r22 rd" class="r22 r">lang</span> = <a href="#217ca99a5e7e96ae" class="i field">Instance</a>.<a href="#2d6e49f5e44f98ac" class="i property">Lang</a> ?? <a href="@0@System.Configuration/A.html#82b0d78ddc6f04b3" class="t t">ConfigurationManager</a>.<a href="@0@System.Configuration/A.html#cfa8b7126ec13177" class="i property">AppSettings</a>.<a href="@0@System/A.html#f72b925e4fb9387a" class="i method">Get</a>(<span class="s">&quot;dir.lang&quot;</span>);

            <a href="@0@System.Web/A.html#6fba8e72335f5cc8" class="k">var</a> <span id="r23 rd" class="r23 r">ctx</span> = <a href="@0@System.Web/A.html#6fba8e72335f5cc8" class="t t">HttpContext</a>.<a href="@0@System.Web/A.html#917b79cec44466cd" class="i property">Current</a>;
            <b>if</b> (<span class="r23 r">ctx</span> != <b>null</b> &amp;&amp; <span class="r23 r">ctx</span>.<a href="@0@System.Web/A.html#601e6eafc050b903" class="i property">Session</a> != <b>null</b>)
            {
                <span class="r22 r">lang</span> = <span class="r23 r">ctx</span>.<a href="@0@System.Web/A.html#601e6eafc050b903" class="i property">Session</a><a href="@0@System.Web/A.html#5cd02a44fa66934a">[</a><span class="s">&quot;lang&quot;</span>] <b>as string</b> ?? <span class="r22 r">lang</span>;   <span class="c">// Language</span>
                <span class="c">//var principal = Claim.GetPrincipal(ctx);</span>
                <span class="c">//ctx.User = principal ?? ctx.User;</span>
            }
            <b>if</b> (<a href="#217ca99a5e7e96ae" class="i field">Instance</a>.<a href="#2d6e49f5e44f98ac" class="i property">Lang</a> != <span class="r22 r">lang</span>)
                <a href="#217ca99a5e7e96ae" class="i field">Instance</a>.<a href="#2d6e49f5e44f98ac" class="i property">Lang</a> = <span class="r22 r">lang</span>;


        }

        <b>public virtual void</b> <a id="1e1b270040525312" href="../R/1e1b270040525312.html" target="n" data-glyph="72,1" class="i method">SaveSession</a>()
        {
            <a href="@0@System.Web/A.html#6fba8e72335f5cc8" class="k">var</a> <span id="r24 rd" class="r24 r">ctx</span> = <a href="@0@System.Web/A.html#6fba8e72335f5cc8" class="t t">HttpContext</a>.<a href="@0@System.Web/A.html#917b79cec44466cd" class="i property">Current</a>;
            <span class="r24 r">ctx</span>.<a href="@0@System.Web/A.html#601e6eafc050b903" class="i property">Session</a><a href="@0@System.Web/A.html#5cd02a44fa66934a">[</a><span class="s">&quot;lang&quot;</span>] = <a href="#217ca99a5e7e96ae" class="i field">Instance</a>.<a href="#2d6e49f5e44f98ac" class="i property">Lang</a>;
        }

        <span class="k preprocess">#</span><span class="k preprocess">endregion</span>

        <b>public string</b> <a id="1fcfcd3aff6da610" href="../R/../../0000000000.html" target="n" data-glyph="102,1" class="i property">DataLang</a> { <b>get</b>; <b>set</b>; }    <span class="c">// data language: LT, LV, EE</span>

        <span class="k preprocess">#</span><span class="k preprocess">region</span> Request methods

        <b>private bool</b> <a id="ab6cf7e091d79c5a" href="../R/ab6cf7e091d79c5a.html" target="n" data-glyph="46,1" class="i field">afterFirst</a>;

        [<a href="../RazorGenerator.Mvc/ViewClass.cs.html#4793a1e5c0f43929" class="t constructor">Caller</a>(<b>typeof</b>(<a href="HttpHandler.cs.html#196280eab96bfdac" class="t t">HttpHandler</a>))]
        <b>public override void</b> <a id="ee6bb75d8464ffa2" href="../R/ee6bb75d8464ffa2.html" target="n" data-glyph="72,1" class="i method">RequestPrepare</a>(<a href="@0@System.Web/A.html#313dbe954e552d25" class="t t">HttpRequest</a> <span id="r25 rd" class="r25 r">request</span>)
        {
            <b>if</b> (!<a href="#ab6cf7e091d79c5a" class="i field">afterFirst</a>)
            {
                <a href="#ab6cf7e091d79c5a" class="i field">afterFirst</a> = <b>true</b>;

                <b>if</b> (<span class="i n">System</span>.<span class="i n">Web</span>.<span class="i n">Hosting</span>.<a href="@0@System.Web/A.html#f12b2fb72be7982c" class="t t">HostingEnvironment</a>.<a href="@0@System.Web/A.html#b87d25204b1b5d23" class="i property">InitializationException</a> != <b>null</b>
                    &amp;&amp; <a href="#217ca99a5e7e96ae" class="i field">Instance</a>.<a href="#6cd8ce7f872d404a" class="i property">LastException</a> == <b>null</b>)
                    <a href="#217ca99a5e7e96ae" class="i field">Instance</a>.<a href="#6cd8ce7f872d404a" class="i property">LastException</a> = <span class="i n">System</span>.<span class="i n">Web</span>.<span class="i n">Hosting</span>.<a href="@0@System.Web/A.html#f12b2fb72be7982c" class="t t">HostingEnvironment</a>.<a href="@0@System.Web/A.html#b87d25204b1b5d23" class="i property">InitializationException</a>;

                <b>if</b> (!<a href="#84199989524859de" class="i method">OnFirstRequest</a>(<span class="r25 r">request</span>, <a href="@0@mscorlib/A.html#9a1496aa60befd10" class="t t">EventArgs</a>.<a href="@0@mscorlib/A.html#433622385e05af0d" class="i field">Empty</a>))
                    <b>return</b>;
            }

            <a href="#d281813f7a85e4de" class="i method">ReadSession</a>();
            <a href="#1d1f38bccf36d62b" class="i method">ReadRequest</a>();
            <a href="Segment.cs.html#701d093cab6c6ef4" class="k">base</a>.<a href="Segment.cs.html#03890d7f6677ece4" class="i method">RequestPrepare</a>(<span class="r25 r">request</span>);

            <b>if</b> (<a href="#803b2d394b5e229f" class="i property">IsRedirectAspx</a>)
                <a href="#23cf611d469de595" class="i method">RedirectAspx</a>();
        }

        [<a href="../RazorGenerator.Mvc/ViewClass.cs.html#4793a1e5c0f43929" class="t constructor">Caller</a>(<b>typeof</b>(<a href="../MvcHttp/RoutingModule.cs.html#10d2b204ba67c38f" class="t t">RoutingModule</a>))]
        <b>public virtual void</b> <a id="d245af664e12e732" href="../R/d245af664e12e732.html" target="n" data-glyph="72,1" class="i method">ResolveRequest</a>(<a href="@0@System.Web/A.html#91a04cddc33c5bea" class="t t">HttpContextBase</a> <span id="r26 rd" class="r26 r">context</span>, <a href="@0@System.Web/A.html#39b7a1fd375ff358" class="t t">RouteData</a> <span id="r27 rd" class="r27 r">routeData</span> = <b>null</b>)
        {
            <a href="#1560d52eea3e70e5" class="k">this</a>.<a href="#150d514fd3c6810e" class="i property">UrlContext</a> = <span class="r26 r">context</span>;
            <a href="#1560d52eea3e70e5" class="k">this</a>.<a href="#5e61ac18bd97966f" class="i property">UrlRouteData</a> = <span class="r27 r">routeData</span>;

            <b>if</b> (<span class="r27 r">routeData</span> != <b>null</b> &amp;&amp; <span class="r26 r">context</span>.<a href="@0@System.Web/A.html#bf9eed8ebb48f81f" class="i property">Request</a>.<a href="@0@System.Web/A.html#ed4a6cb00a5dfa33" class="i property">Path</a>.<a href="@0@mscorlib/A.html#cb74053b3f2d03f4" class="i method">EndsWith</a>(<span class="s">&quot;netversion&quot;</span>))
            {
                <span class="c">// special IRouteHandler that tells the routing module to stop processing</span>
                <span class="r27 r">routeData</span>.<a href="@0@System.Web/A.html#e9adfb6214505246" class="i property">RouteHandler</a> = <b>new</b> <a href="@0@System.Web/A.html#af19b9aa96122a3b" class="t constructor">StopRoutingHandler</a>();
                <a href="../MvcHttp/NetVersionController.cs.html#dc276c8231e1fbc5" class="t t">NetVersionController</a>.<a href="../MvcHttp/NetVersionController.cs.html#b5dccc0bbe29d8f0" class="i method">Output</a>(<span class="r26 r">context</span>.<a href="@0@System.Web/A.html#b5a3728929e8cb42" class="i property">Response</a>);
            }
        }

        <span class="k preprocess">#</span><span class="k preprocess">endregion</span>

        <b>public</b> <a href="@0@System.Web/A.html#91a04cddc33c5bea" class="t t">HttpContextBase</a> <a id="150d514fd3c6810e" href="../R/150d514fd3c6810e.html" target="n" data-glyph="102,1" class="i property">UrlContext</a> { <b>get</b>; <b>set</b>; }
        <b>public</b> <a href="@0@System.Web/A.html#39b7a1fd375ff358" class="t t">RouteData</a> <a id="5e61ac18bd97966f" href="../R/5e61ac18bd97966f.html" target="n" data-glyph="102,1" class="i property">UrlRouteData</a> { <b>get</b>; <b>set</b>; }

        <b>public virtual bool</b> <a id="803b2d394b5e229f" href="../R/803b2d394b5e229f.html" target="n" data-glyph="102,1" class="i property">IsRedirectAspx</a>
        {
            <b>get</b>
            {
                <a href="@0@mscorlib/A.html#8281103e6f23cb5c" class="k">var</a> <span id="r28 rd" class="r28 r">cfg</span> = <a href="@0@System.Configuration/A.html#82b0d78ddc6f04b3" class="t t">ConfigurationManager</a>.<a href="@0@System.Configuration/A.html#cfa8b7126ec13177" class="i property">AppSettings</a><a href="@0@System/A.html#b33fdfa0b2d0a3ad">[</a><span class="s">&quot;redirect.aspx&quot;</span>];
                <b>return string</b>.<a href="@0@mscorlib/A.html#55e241b6143365ef" class="i method">IsNullOrWhiteSpace</a>(<span class="r28 r">cfg</span>) || !<span class="r28 r">cfg</span>.<a href="@0@mscorlib/A.html#31b307b02a3bd6b9" class="i method">Equals</a>(<span class="s">&quot;0&quot;</span>);
            }
        }

        <b>public virtual void</b> <a id="23cf611d469de595" href="../R/23cf611d469de595.html" target="n" data-glyph="72,1" class="i method">RedirectAspx</a>()
        {
            <span class="c">// Redirect</span>
            <a href="@0@System.Web/A.html#6fba8e72335f5cc8" class="k">var</a> <span id="r29 rd" class="r29 r">ctx</span> = <a href="@0@System.Web/A.html#6fba8e72335f5cc8" class="t t">HttpContext</a>.<a href="@0@System.Web/A.html#917b79cec44466cd" class="i property">Current</a>;
            <b>if</b> (<span class="r29 r">ctx</span> == <b>null</b> || <span class="r29 r">ctx</span>.<a href="@0@System.Web/A.html#1ef28ccd612d621c" class="i property">Request</a>.<a href="@0@System.Web/A.html#98945de8f620647a" class="i property">Url</a> == <b>null</b>)
                <b>return</b>;

            <a href="@0@System.Web/A.html#313dbe954e552d25" class="k">var</a> <span id="r30 rd" class="r30 r">request</span> = <span class="r29 r">ctx</span>.<a href="@0@System.Web/A.html#1ef28ccd612d621c" class="i property">Request</a>;
            <b>if</b> (<b>string</b>.<a href="@0@mscorlib/A.html#55e241b6143365ef" class="i method">IsNullOrWhiteSpace</a>(<span class="r30 r">request</span>.<a href="@0@System.Web/A.html#5fdd09fb7be129b0" class="i property">Path</a>)
                || <span class="r30 r">request</span>.<a href="@0@System.Web/A.html#98945de8f620647a" class="i property">Url</a>.<a href="@0@System/A.html#6da7cb1d49922d85" class="i property">LocalPath</a>.<a href="@0@mscorlib/A.html#e13f5829ef28aa07" class="i property">Length</a> == 0
                || !<span class="r30 r">request</span>.<a href="@0@System.Web/A.html#5fdd09fb7be129b0" class="i property">Path</a>.<a href="@0@mscorlib/A.html#428c5c9954dea844" class="i method">Contains</a>(<span class="s">&quot;.aspx&quot;</span>))
                <b>return</b>;

            <b>string</b> <span id="r31 rd" class="r31 r">path</span> = <a href="@0@System.Core/A.html#577032c8811e20d3" class="t t">Enumerable</a>.<a href="@0@System.Core/A.html#981cccb3b4b716eb" class="i method">LastOrDefault</a>&lt;<b>string</b>&gt;(<span class="r30 r">request</span>.<a href="@0@System.Web/A.html#98945de8f620647a" class="i property">Url</a>.<a href="@0@System/A.html#9f1791fdcbd164c6" class="i property">Segments</a>);
            <b>string</b> <span id="r32 rd" class="r32 r">fileAspx</span> = <a href="#1560d52eea3e70e5" class="k">this</a>.<a href="#1924effe39414a87" class="i property">PhysicalPath</a> + <span class="r30 r">request</span>.<a href="@0@System.Web/A.html#98945de8f620647a" class="i property">Url</a>.<a href="@0@System/A.html#6da7cb1d49922d85" class="i property">LocalPath</a>;
            <span class="c">// ctx.Request.Url.AbsolutePath.Replace(&quot;/&quot;, &quot;\\&quot;)</span>
            <span class="r32 r">fileAspx</span> = <span class="r32 r">fileAspx</span>
                     .<a href="@0@mscorlib/A.html#69fc1d0aa6df8a90" class="i method">Replace</a>(<span class="s">&quot;/&quot;</span>, <span class="s">&quot;\\&quot;</span>)
                     .<a href="@0@mscorlib/A.html#69fc1d0aa6df8a90" class="i method">Replace</a>(<span class="s">&quot;~\\&quot;</span>, <span class="s">&quot;\\&quot;</span>)
                     .<a href="@0@mscorlib/A.html#69fc1d0aa6df8a90" class="i method">Replace</a>(<span class="s">&quot;\\\\&quot;</span>, <span class="s">&quot;\\&quot;</span>);

            <b>if</b> (<span class="i n">System</span>.<span class="i n">IO</span>.<a href="@0@mscorlib/A.html#1c7421e464f67b7e" class="t t">File</a>.<a href="@0@mscorlib/A.html#3360368484a9f131" class="i method">Exists</a>(<span class="r32 r">fileAspx</span>))
            {
                <span class="i n">AiLib</span>.<a href="../Guard.cs.html#d9bf5b5bec13d107" class="t t">Guard</a>.<a href="../Guard.cs.html#f321cb5ab91df294" class="i property">Log</a>.<a href="../Guard.cs.html#ce8e4da8c65b0013" class="i method">Write</a>(<span class="s">&quot;ASPX: &quot;</span> + <span class="r32 r">fileAspx</span>);

                <span class="c">// &lt;system.web&gt;&lt;httpHandlers&gt;</span>
                <span class="c">//  &lt;add path=&quot;*.aspx&quot; type=&quot;System.Web.UI.PageHandlerFactory&quot; validate=&quot;true&quot; verb=&quot;*&quot;/&gt;</span>
                <b>return</b>;
            }

            <a href="@0@mscorlib/A.html#8281103e6f23cb5c" class="k">var</a> <span id="r33 rd" class="r33 r">url</span> = <span class="r30 r">request</span>.<a href="@0@System.Web/A.html#98945de8f620647a" class="i property">Url</a>.<a href="@0@System/A.html#bf3caa11ab73e433" class="i method">ToString</a>();
            <span class="c">//if (url.Contains(&quot;.aspx&quot;))</span>
            <span class="c">//{</span>
            <span class="c">//    // var virtualPath = System.Web.Hosting.HostingEnvironment.ApplicationVirtualPath; // == &quot;/&quot;</span>
            <span class="c">//    string map = System.Web.Hosting.HostingEnvironment.ApplicationPhysicalPath + ctx.Request.Url.AbsolutePath.Replace(&quot;/&quot;, &quot;\\&quot;);</span>
            <span class="c">//    map = map.Replace(&quot;~\\&quot;, &quot;\\&quot;)</span>
            <span class="c">//             .Replace(&quot;\\\\&quot;, &quot;\\&quot;);</span>
            <span class="c">//    if (File.Exists(map))</span>
            <span class="c">//        return;</span>
            <span class="c">//}</span>

            <b>if</b> (<span class="r33 r">url</span>.<a href="@0@mscorlib/A.html#428c5c9954dea844" class="i method">Contains</a>(<span class="s">&quot;default.aspx&quot;</span>))
                <span class="r33 r">url</span> = <span class="r33 r">url</span>.<a href="@0@mscorlib/A.html#69fc1d0aa6df8a90" class="i method">Replace</a>(<span class="s">&quot;default.aspx&quot;</span>, <span class="s">&quot;&quot;</span>);
            <b>else</b>
                <span class="r33 r">url</span> = <span class="r33 r">url</span>.<a href="@0@mscorlib/A.html#69fc1d0aa6df8a90" class="i method">Replace</a>(<span class="s">&quot;.aspx&quot;</span>, <span class="s">&quot;&quot;</span>);

            <span class="r29 r">ctx</span>.<a href="@0@System.Web/A.html#f5621f312ad2934e" class="i property">Response</a>.<a href="@0@System.Web/A.html#b4a2d13569ff3440" class="i method">Redirect</a>(<span class="r33 r">url</span>);
        }

        <span class="k preprocess">#</span><span class="k preprocess">region</span> RequestContext

        <b>public virtual string</b> <a id="44ccbb2c858cbca5" href="../R/44ccbb2c858cbca5.html" target="n" data-glyph="72,1" class="i method">PathSegment</a>(<b>int</b> <span id="r34 rd" class="r34 r">depth</span> = 0)
        {
            <a href="@0@mscorlib/A.html#8281103e6f23cb5c" class="k">var</a> <span id="r35 rd" class="r35 r">segment</span> = <span class="i n">AiLib</span>.<span class="i n">Web</span>.<a href="HttpStatic.cs.html#dc32c2cfc2749249" class="t t">HttpStatic</a>.<a href="HttpStatic.cs.html#ade24e932cc9d55a" class="i method">PathSegment</a>(<span class="r34 r">depth</span>, <a href="#70f9e8bf2515f782" class="i field">_context</a>);
            <b>return</b> <span class="r35 r">segment</span>;
        }

        <b>public virtual string</b> <a id="9ed6791f332c4a95" href="../R/../../0000000000.html" target="n" data-glyph="72,1" class="i method">PathAndQuery</a>()
        {
            <b>return</b> <span class="i n">AiLib</span>.<span class="i n">Web</span>.<a href="HttpStatic.cs.html#dc32c2cfc2749249" class="t t">HttpStatic</a>.<a href="HttpStatic.cs.html#d7d3945531ff6483" class="i property">PathAndQuery</a>;
        }

        <b>protected</b> <a href="@0@System.Web/A.html#eedd1fb7c5b6334c" class="t t">RequestContext</a> <a id="70f9e8bf2515f782" href="../R/70f9e8bf2515f782.html" target="n" data-glyph="45,1" class="i field">_context</a>;
        <b>public</b> <a href="@0@System.Web/A.html#eedd1fb7c5b6334c" class="t t">RequestContext</a> <a id="803d0c4eb96579ff" href="../R/../../0000000000.html" target="n" data-glyph="102,1" class="i property">RequestContext</a>
        {
            <b>get</b> { <b>return</b> <a href="#70f9e8bf2515f782" class="i field">_context</a> ?? <a href="HttpStatic.cs.html#dc32c2cfc2749249" class="t t">HttpStatic</a>.<a href="HttpStatic.cs.html#2e3c5ac2b3685417" class="i property">RequestContext</a>; }
            <b>set</b> { <a href="#70f9e8bf2515f782" class="i field">_context</a> = <b>value</b>; }
        }

        <b>public static dynamic</b> <a id="a8f5b7223306dc54" href="../R/../../0000000000.html" target="n" data-glyph="102,1" class="i property">WebContext</a>
        {
            <b>get</b>
            {
                <b>return</b> <a href="HttpStatic.cs.html#dc32c2cfc2749249" class="t t">HttpStatic</a>.<a href="HttpStatic.cs.html#8cce2d02a9568dd7" class="i property">WebContext</a>;

            }
        }

        <b>public static dynamic</b> <a id="4bf5a6720ca1acc8" href="../R/../../0000000000.html" target="n" data-glyph="102,1" class="i property">Hosting</a>
        {
            <b>get</b>
            {
                <b>return</b> <b>new</b>
                {
                    <a href="#9262f3d54ffd7b3b" class="i property">Environment</a> = <b>new</b>
                    {
                        <span class="c">// object that contains information about the application host.</span>
                        <a href="#430a18370005ef31" class="i property">ApplicationHost</a> = <a href="@0@System.Web/A.html#f12b2fb72be7982c" class="t t">HostingEnvironment</a>.<a href="@0@System.Web/A.html#76dfb775af318446" class="i property">ApplicationHost</a>,
                        <span class="c">// The unique identifier of the application.</span>
                        <a href="#21486f27dc8cf170" class="i property">ApplicationID</a> = <a href="@0@System.Web/A.html#f12b2fb72be7982c" class="t t">HostingEnvironment</a>.<a href="@0@System.Web/A.html#3876e99749cec9a7" class="i property">ApplicationID</a> <b>as string</b>,
                        <span class="c">// physical path on disk to the application&#39;s directory.</span>
                        <a href="#70c882dc4705dc9d" class="i property">ApplicationPhysicalPath</a> = <a href="@0@System.Web/A.html#f12b2fb72be7982c" class="t t">HostingEnvironment</a>.<a href="@0@System.Web/A.html#5c349191566e3f2c" class="i property">ApplicationPhysicalPath</a> <b>as string</b>,
                        <a href="#6b0a6ad21834a54a" class="i property">ApplicationVirtualPath</a> = <a href="@0@System.Web/A.html#f12b2fb72be7982c" class="t t">HostingEnvironment</a>.<a href="@0@System.Web/A.html#403ee1a4de2b9a62" class="i property">ApplicationVirtualPath</a> <b>as string</b>,
                        <span class="c">// thrown during initialization of the System.Web.Hosting.HostingEnvironment</span>
                        <a href="#91587340fb1f745c" class="i property">InitializationException</a> = <a href="@0@System.Web/A.html#f12b2fb72be7982c" class="t t">HostingEnvironment</a>.<a href="@0@System.Web/A.html#b87d25204b1b5d23" class="i property">InitializationException</a>,
                        <a href="#ed3cedebdc522a3e" class="i property">IsDevelopmentEnvironment</a> = <a href="@0@System.Web/A.html#f12b2fb72be7982c" class="t t">HostingEnvironment</a>.<a href="@0@System.Web/A.html#0aa1d9c3d29b9f60" class="i property">IsDevelopmentEnvironment</a> <b>as bool</b>?,
                        <span class="c">// application domain is hosted by an System.Web.Hosting.ApplicationManager</span>
                        <a href="#f6ba6bff04785aec" class="i property">IsHosted</a> = <a href="@0@System.Web/A.html#f12b2fb72be7982c" class="t t">HostingEnvironment</a>.<a href="@0@System.Web/A.html#fef408b5916b2be9" class="i property">IsHosted</a> <b>as bool</b>?,
                        <span class="c">// name of the site.</span>
                        <a href="#cf27602895f5b574" class="i property">SiteName</a> = <a href="@0@System.Web/A.html#f12b2fb72be7982c" class="t t">HostingEnvironment</a>.<a href="@0@System.Web/A.html#1cb1426b6b4db0e4" class="i property">SiteName</a> <b>as string</b>
                    },
                    <a href="#44aabfdb1b42a0c1" class="i property">AppDomain</a> = <span class="i n">System</span>.<a href="@0@mscorlib/A.html#2e9e7922eace2be8" class="t t">AppDomain</a>.<a href="@0@mscorlib/A.html#0f1cf66beffbb219" class="i property">CurrentDomain</a>
                };
            }
        }

        <span class="k preprocess">#</span><span class="k preprocess">endregion</span>

        <span class="k preprocess">#</span><span class="k preprocess">region</span> PageTop menu render

        <b>public virtual void</b> <a id="5cce184dde4df0c8" href="../R/../../0000000000.html" target="n" data-glyph="72,1" class="i method">PageTopCss</a>(<a href="/System.Web.Mvc/A.html#770e19693bb6aca9" class="t t">UrlHelper</a> <span id="r36 rd" class="r36 r">url</span>, <a href="@0@mscorlib/A.html#6e84a88dc2be46e3" class="t t">TextWriter</a> <span id="r37 rd" class="r37 r">output</span>)
        {
            <a href="@0@mscorlib/A.html#8281103e6f23cb5c" class="k">var</a> <span id="r38 rd" class="r38 r">rootCss</span> = <span class="s">&quot;~/css/&quot;</span>;
            <a href="../MvcHttp/MvcBundle.cs.html#4f67cf62a8df9c83" class="t t">MvcBundle</a>.<a href="../MvcHttp/MvcBundle.cs.html#69c0b60f2dab50b6" class="i method">WriteCssHref</a>(<span class="r37 r">output</span>, <span class="r36 r">url</span>, <span class="s">&quot;pagetopx.css&quot;</span>, <span class="r38 r">rootCss</span>);
            <span class="r37 r">output</span>.<a href="@0@mscorlib/A.html#d3fb8ea93246e9a9" class="i method">Write</a>(<a href="@0@mscorlib/A.html#7d2f1469d916fc63" class="t t">Environment</a>.<a href="@0@mscorlib/A.html#63a04833d43dd9d3" class="i property">NewLine</a>);

            <a href="../MvcHttp/MvcBundle.cs.html#4f67cf62a8df9c83" class="t t">MvcBundle</a>.<a href="../MvcHttp/MvcBundle.cs.html#69c0b60f2dab50b6" class="i method">WriteCssHref</a>(<span class="r37 r">output</span>, <span class="r36 r">url</span>, <span class="s">&quot;detailx.css&quot;</span>, <span class="r38 r">rootCss</span>);
            <span class="r37 r">output</span>.<a href="@0@mscorlib/A.html#d3fb8ea93246e9a9" class="i method">Write</a>(<a href="@0@mscorlib/A.html#7d2f1469d916fc63" class="t t">Environment</a>.<a href="@0@mscorlib/A.html#63a04833d43dd9d3" class="i property">NewLine</a>);
        }

        <b>public virtual</b> <a href="@0@System.Xml.Linq/A.html#3367036406d1344a" class="t t">XElement</a> <a id="c06438a7b65ec3e0" href="../R/c06438a7b65ec3e0.html" target="n" data-glyph="102,1" class="i property">PageTopXml</a>
        {
            <b>get</b>
            {
                <a href="@0@System.Xml.Linq/A.html#3367036406d1344a" class="k">var</a> <span id="r39 rd" class="r39 r">root</span> = <b>new</b> <a href="@0@System.Xml.Linq/A.html#003021639e94d77e" class="t constructor">XElement</a>(<span class="s">&quot;Root&quot;</span>,
                    <b>new</b> <a href="@0@System.Xml.Linq/A.html#6480bd244db2d79e" class="t constructor">XAttribute</a>(<span class="s">&quot;LINK&quot;</span>, <a href="#44ccbb2c858cbca5" class="i method">PathSegment</a>(0)),
                    <b>new</b> <a href="@0@System.Xml.Linq/A.html#6480bd244db2d79e" class="t constructor">XAttribute</a>(<span class="s">&quot;FIRMID&quot;</span>, <a href="#9f767652c2859dc7" class="i property">FirmID</a>),
                    <b>new</b> <a href="@0@System.Xml.Linq/A.html#6480bd244db2d79e" class="t constructor">XAttribute</a>(<span class="s">&quot;LANG&quot;</span>, <a href="#2d6e49f5e44f98ac" class="i property">Lang</a>),
                    <b>new</b> <a href="@0@System.Xml.Linq/A.html#6480bd244db2d79e" class="t constructor">XAttribute</a>(<span class="s">&quot;USERID&quot;</span>, <a href="Segment.cs.html#fc40c810d1153640" class="i property">UserID</a>),
                    <b>new</b> <a href="@0@System.Xml.Linq/A.html#6480bd244db2d79e" class="t constructor">XAttribute</a>(<span class="s">&quot;PathRoot&quot;</span>, <a href="HttpStatic.cs.html#dc32c2cfc2749249" class="t t">HttpStatic</a>.<a href="HttpStatic.cs.html#00d789b1c20e7a1c" class="i property">PathRoot</a>),
                    <b>new</b> <a href="@0@System.Xml.Linq/A.html#6480bd244db2d79e" class="t constructor">XAttribute</a>(<span class="s">&quot;PathAndQuery&quot;</span>, <a href="HttpStatic.cs.html#dc32c2cfc2749249" class="t t">HttpStatic</a>.<a href="HttpStatic.cs.html#d7d3945531ff6483" class="i property">PathAndQuery</a>)
                );
                <b>return</b> <span class="r39 r">root</span>;
            }
        }

        <b>public virtual string</b> <a id="79c45bb8ee23651e" href="../R/../../0000000000.html" target="n" data-glyph="72,1" class="i method">PageTopRender</a>(<a href="@0@mscorlib/A.html#6e84a88dc2be46e3" class="t t">TextWriter</a> <span id="r40 rd" class="r40 r">output</span>, <a href="@0@System.Xml.Linq/A.html#3367036406d1344a" class="t t">XElement</a> <span id="r41 rd" class="r41 r">xml</span> = <b>null</b>, <b>string</b> <span id="r42 rd" class="r42 r">xlst</span> = <span class="s">@&quot;../pagemenux.xslt&quot;</span>,  <b>string</b> <span id="r43 rd" class="r43 r">link</span> = <b>null</b>)
        {
            <span class="r41 r">xml</span> = <span class="r41 r">xml</span> ?? <a href="#c06438a7b65ec3e0" class="i property">PageTopXml</a>;
            <b>if</b> (<span class="r43 r">link</span> != <b>null</b>)
                <span class="r41 r">xml</span>.<a href="@0@System.Xml.Linq/A.html#4967ff154010968e" class="i method">Attribute</a>(<span class="s">&quot;LINK&quot;</span>).<a href="@0@System.Xml.Linq/A.html#8a0c06b9dac3e320" class="i method">SetValue</a>(<span class="r43 r">link</span>);

            <a href="@0@mscorlib/A.html#8281103e6f23cb5c" class="k">var</a> <span id="r44 rd" class="r44 r">menuXslt</span> = <a href="#1560d52eea3e70e5" class="t t">SegmentLang</a>.<a href="#217ca99a5e7e96ae" class="i field">Instance</a>.<a href="#1924effe39414a87" class="i property">PhysicalPath</a> + <span class="r42 r">xlst</span>;
            <b>if</b> (!<a href="@0@mscorlib/A.html#1c7421e464f67b7e" class="t t">File</a>.<a href="@0@mscorlib/A.html#3360368484a9f131" class="i method">Exists</a>(<span class="r44 r">menuXslt</span>))
                <span class="r44 r">menuXslt</span> = <a href="#1560d52eea3e70e5" class="t t">SegmentLang</a>.<a href="#217ca99a5e7e96ae" class="i field">Instance</a>.<a href="#1924effe39414a87" class="i property">PhysicalPath</a> + <span class="s">@&quot;../pagemenux.xslt&quot;</span>;

            <a href="#483ad729f335245a" class="k">var</a> <span id="r45 rd" class="r45 r">render</span> = <b>new</b> <a href="#483ad729f335245a" class="t constructor">PageTopRender</a> { <a href="#390aed43436349f5" class="i property">Xml</a> = <span class="r41 r">xml</span>, <a href="#152b0596ee84873e" class="i property">Xslt</a> = <span class="r44 r">menuXslt</span>, <a href="#8dfe99022da3ea36" class="i property">Link</a> = <span class="r43 r">link</span> };
            <span class="r45 r">render</span>.<a href="#8002ca02f5d571eb" class="i method">Render</a>(<span class="r40 r">output</span>);

            <b>return</b> <a href="@0@mscorlib/A.html#8281103e6f23cb5c" class="t t">String</a>.<a href="@0@mscorlib/A.html#c9f70a27facb27cf" class="i field">Empty</a>;
        }

        <b>public virtual void</b> <a id="1ddc9190855f8134" href="../R/../../0000000000.html" target="n" data-glyph="72,1" class="i method">LayoutContent</a>(<a href="@0@mscorlib/A.html#6e84a88dc2be46e3" class="t t">TextWriter</a> <span id="r46 rd" class="r46 r">output</span>, <b>object</b> <span id="r47 rd" class="r47 r">title</span> = <b>null</b>,
            <b>string</b> <span id="r48 rd" class="r48 r">id</span> = <span class="s">&quot;content&quot;</span>, <a href="@0@mscorlib/A.html#9147ae6f76643aae" class="t t">Action</a> <span id="r49 rd" class="r49 r">inside</span> = <b>null</b>)
        {
            <span class="r46 r">output</span>.<a href="@0@mscorlib/A.html#d3fb8ea93246e9a9" class="i method">Write</a>(<span class="s">@&quot;&lt;div id=&quot;&quot;content&quot;&quot;&gt;

            &quot;</span>);

            <b>if</b> (<span class="r47 r">title</span> <b>is</b> <a href="@0@System.Xml.Linq/A.html#3367036406d1344a" class="t t">XElement</a>)
                <span class="r46 r">output</span>.<a href="@0@mscorlib/A.html#20e18fa41ebefe91" class="i method">Write</a>(<span class="r47 r">title</span> <b>as</b> <a href="@0@System.Xml.Linq/A.html#3367036406d1344a" class="t t">XElement</a>);
            <b>else if</b> (!<b>string</b>.<a href="@0@mscorlib/A.html#55e241b6143365ef" class="i method">IsNullOrWhiteSpace</a>(<span class="r47 r">title</span> <b>as string</b>))
                <span class="r46 r">output</span>.<a href="@0@mscorlib/A.html#20e18fa41ebefe91" class="i method">Write</a>(<b>new</b> <a href="@0@System.Xml.Linq/A.html#7f699221c89b323a" class="t constructor">XElement</a>(<span class="s">&quot;h4&quot;</span>, <span class="r47 r">title</span>));

            <b>if</b> (<span class="r49 r">inside</span> != <b>null</b>)
                <span class="r49 r">inside</span>();

            <span class="r46 r">output</span>.<a href="@0@mscorlib/A.html#d3fb8ea93246e9a9" class="i method">Write</a>(<span class="s">@&quot;
            &lt;div&gt;
            &quot;</span>);
        }
        <span class="k preprocess">#</span><span class="k preprocess">endregion</span>
    }

    <b>public class</b> <a id="483ad729f335245a" href="../R/483ad729f335245a.html" target="n" data-glyph="0,0" class="t t"><span id="64f4c2665d7f4d07">PageTopRender</span></a> : <a href="../Render/Base/IRenderBase.cs.html#bfb676d99db009f3" class="t t">IRenderBase</a>
    {
        <b>public string</b> <a id="152b0596ee84873e" href="../R/152b0596ee84873e.html" target="n" data-glyph="102,1" class="i property">Xslt</a> { <b>get</b>; <b>set</b>; }
        <b>public</b> <a href="@0@System.Xml.Linq/A.html#3367036406d1344a" class="t t">XElement</a> <a id="390aed43436349f5" href="../R/390aed43436349f5.html" target="n" data-glyph="102,1" class="i property">Xml</a> { <b>get</b>; <b>set</b>; }
        <b>public string</b> <a id="8dfe99022da3ea36" href="../R/8dfe99022da3ea36.html" target="n" data-glyph="102,1" class="i property">Link</a> { <b>get</b>; <b>set</b>; }

        <b>public virtual string</b> <a id="8002ca02f5d571eb" href="../R/8002ca02f5d571eb.html" target="n" data-glyph="72,1" class="i method">Render</a>(<a href="@0@mscorlib/A.html#6e84a88dc2be46e3" class="t t">TextWriter</a> <span id="r50 rd" class="r50 r">writer</span>)
        {
            <b>try</b>
            {
                <a href="@0@System.Xml.Linq/A.html#3367036406d1344a" class="k">var</a> <span id="r51 rd" class="r51 r">xslt</span> = <a href="@0@System.Xml.Linq/A.html#3367036406d1344a" class="t t">XElement</a>.<a href="@0@System.Xml.Linq/A.html#0456ac1a66a124dc" class="i method">Load</a>(<a href="#152b0596ee84873e" class="i property">Xslt</a>);
                <a href="../Render/RequestInfo.cs.html#67586cf23b82e26e" class="k">var</a> <span id="r52 rd" class="r52 r">info</span> = <b>new</b> <a href="../Render/RequestInfo.cs.html#4a3df20fe2dd8531" class="t constructor">RequestInfo</a>(<b>null</b>, <a href="HttpStatic.cs.html#dc32c2cfc2749249" class="t t">HttpStatic</a>.<a href="HttpStatic.cs.html#7efded907d82802e" class="i property">Request</a>);
                <a href="XPathWeb.cs.html#01ccddb5a5666841" class="t t">XPathWeb</a>.<a href="XPathWeb.cs.html#0e6035916f4d7299" class="i method">XTransformToWriter</a>(<a href="#390aed43436349f5" class="i property">Xml</a>, <span class="r50 r">writer</span>, <span class="r51 r">xslt</span>, <span class="r52 r">info</span>);
            }
            <b>catch</b> (<a href="@0@mscorlib/A.html#f092fb2b893a0162" class="t t">Exception</a> <span id="r53 rd" class="r53 r">ex</span>)
            {
                <a href="#1560d52eea3e70e5" class="t t">SegmentLang</a>.<a href="#217ca99a5e7e96ae" class="i field">Instance</a>.<a href="#6cd8ce7f872d404a" class="i property">LastException</a> = <span class="r53 r">ex</span>;
                <a href="#1560d52eea3e70e5" class="t t">SegmentLang</a>.<a href="#217ca99a5e7e96ae" class="i field">Instance</a>.<a href="#5422245f932a8ee6" class="i method">IgnoreError</a>(<span class="r53 r">ex</span>, <a href="HttpStatic.cs.html#dc32c2cfc2749249" class="t t">HttpStatic</a>.<a href="HttpStatic.cs.html#7efded907d82802e" class="i property">Request</a>);
            }
            <b>return string</b>.<a href="@0@mscorlib/A.html#c9f70a27facb27cf" class="i field">Empty</a>;
        }
    }

}
</pre></td></tr></table></div></body></html>
