<!DOCTYPE html>
<html><head><title>BaseTest.cs</title><link rel="stylesheet" href="../styles.css"><script src="../scripts.js"></script></head>
<body class="cB" onload="i(83);"><div class="dH">
<table style="width: 100%">
<tr><td>File: <a id="filePath" class="blueLink" href="/#GitAspx.Tests/BaseTest.cs" target="_top">BaseTest.cs</a><br/></td><td></td></tr>
<tr><td>Project: <a id="projectPath" class="blueLink" href="/#GitAspx.Tests" target="_top">GitAspx.Tests\GitAspx.Tests.csproj</a> (GitAspx.Tests)</td><td></td></tr>
</table>
</div>
<div class="cz"><table class="tb" cellpadding="0" cellspacing="0"><tr><td valign="top" align="right"><pre id="ln"></pre></td><td valign="top" align="left"><pre id="code">
<span class="k preprocess">#</span><span class="k preprocess">region</span> License
 
<span class="c">// Copyright 2010 Jeremy Skinner (http://www.jeremyskinner.co.uk)</span>
<span class="c">//  </span>
<span class="c">// Licensed under the Apache License, Version 2.0 (the &quot;License&quot;); </span>
<span class="c">// you may not use this file except in compliance with the License. </span>
<span class="c">// You may obtain a copy of the License at </span>
<span class="c">// </span>
<span class="c">// http://www.apache.org/licenses/LICENSE-2.0 </span>
<span class="c">// </span>
<span class="c">// Unless required by applicable law or agreed to in writing, software </span>
<span class="c">// distributed under the License is distributed on an &quot;AS IS&quot; BASIS, </span>
<span class="c">// WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied. </span>
<span class="c">// See the License for the specific language governing permissions and </span>
<span class="c">// limitations under the License.</span>
<span class="c">// </span>
<span class="c">// The latest version of this file can be found at http://github.com/JeremySkinner/git-dot-aspx</span>
 
<span class="k preprocess">#</span><span class="k preprocess">endregion</span>
 
<b>namespace</b> <span class="i n">GitAspx</span>.<span class="i n">Tests</span> {
	<b>using</b> <span class="i n">System</span>.<span class="i n">IO</span>;
	<b>using</b> <span class="i n">System</span>.<span class="i n">Linq</span>;
	<b>using</b> <span class="i n">System</span>.<span class="i n">Net</span>;
	<b>using</b> <span class="i n">System</span>.<span class="i n">Xml</span>.<span class="i n">Linq</span>;
	<b>using</b> <span class="i n">CassiniDev</span>;
	<b>using</b> <span class="i n">NUnit</span>.<span class="i n">Framework</span>;
 
	[<span class="t constructor">TestFixture</span>]
	<b>public class</b> <a id="ae565cf7b1722059" href="R/ae565cf7b1722059.html" target="n" data-glyph="0,0" class="t t"><span id="129f4be0e82577e2">BaseTest</span></a> : <span class="t t">CassiniDevServer</span> {
		<span class="c">//Server server;</span>
 
		[<span class="t constructor">TestFixtureSetUp</span>]
		<b>public void</b> <a id="e8ce3a4ba69f40cc" href="R/../../0000000000.html" target="n" data-glyph="72,1" class="i method">TestFixtureSetup</a>() {
			<a href="#4cf571baf02e8f45" class="i method">ChangeRepo</a>(<b>new</b> <a href="@0@mscorlib/A.html#683f5ff112df8d3a" class="t constructor">DirectoryInfo</a>(<span class="s">&quot;..\\..\\Repositories&quot;</span>).<a href="@0@mscorlib/A.html#0f9b506168f8cec0" class="i property">FullName</a>);
			<span class="i method">StartServer</span>(<span class="s">&quot;..\\..\\..\\GitAspx&quot;</span>);
		}
 
		[<span class="t constructor">TestFixtureTearDown</span>]
		<b>public void</b> <a id="f6f6249c85ae44e0" href="R/../../0000000000.html" target="n" data-glyph="72,1" class="i method">TestFixtureTeardown</a>() {
			<span class="i method">StopServer</span>();
			<a href="#4cf571baf02e8f45" class="i method">ChangeRepo</a>(<span class="s">&quot;C:\\Repositories&quot;</span>);
		}
 
		<b>void</b> <a id="4cf571baf02e8f45" href="R/4cf571baf02e8f45.html" target="n" data-glyph="76,1" class="i method">ChangeRepo</a>(<b>string</b> <span id="r0 rd" class="r0 r">repoDir</span>) {
			<b>string</b> <span id="r1 rd" class="r1 r">path</span> = <span class="s">&quot;..\\..\\..\\GitAspx\\Web.config&quot;</span>;
 
			<a href="@0@System.Xml.Linq/A.html#3354dac0913e417b" class="k">var</a> <span id="r2 rd" class="r2 r">doc</span> = <a href="@0@System.Xml.Linq/A.html#3354dac0913e417b" class="t t">XDocument</a>.<a href="@0@System.Xml.Linq/A.html#8a0ff89671e31a9d" class="i method">Load</a>(<span class="r1 r">path</span>);
			<span class="r2 r">doc</span>.<a href="@0@System.Xml.Linq/A.html#9c55392aa48852a0" class="i method">Element</a>(<span class="s">&quot;configuration&quot;</span>).<a href="@0@System.Xml.Linq/A.html#9c55392aa48852a0" class="i method">Element</a>(<span class="s">&quot;appSettings&quot;</span>).<a href="@0@System.Xml.Linq/A.html#7117b3fee01458b8" class="i method">Elements</a>(<span class="s">&quot;add&quot;</span>).<a href="@0@System.Core/A.html#226beadd4e521229" class="i method">Single</a>(
				<span id="r3 rd" class="r3 r">x</span> =&gt; <span class="r3 r">x</span>.<a href="@0@System.Xml.Linq/A.html#4967ff154010968e" class="i method">Attribute</a>(<span class="s">&quot;key&quot;</span>).<a href="@0@System.Xml.Linq/A.html#41b93251dfa049f0" class="i property">Value</a> == <span class="s">&quot;RepositoriesDirectory&quot;</span>)
				.<a href="@0@System.Xml.Linq/A.html#4967ff154010968e" class="i method">Attribute</a>(<span class="s">&quot;value&quot;</span>).<a href="@0@System.Xml.Linq/A.html#41b93251dfa049f0" class="i property">Value</a> = <span class="r0 r">repoDir</span>;
 
			<span class="r2 r">doc</span>.<a href="@0@System.Xml.Linq/A.html#047f1cc926c6bf3a" class="i method">Save</a>(<span class="r1 r">path</span>);
		}
 
		<b>protected</b> <a href="@0@System/A.html#b51bad13c30be1c4" class="t t">HttpWebResponse</a> <a id="d4fd2d57b7227ee0" href="R/d4fd2d57b7227ee0.html" target="n" data-glyph="75,1" class="i method">Get</a>(<b>string</b> <span id="r4 rd" class="r4 r">url</span>) {
			<b>try</b> {
				<span class="r4 r">url</span> = <span class="i method">NormalizeUrl</span>(<span class="r4 r">url</span>);
				<a href="@0@System/A.html#f2ab2d685cb26f13" class="k">var</a> <span id="r5 rd" class="r5 r">request</span> = (<a href="@0@System/A.html#f2ab2d685cb26f13" class="t t">HttpWebRequest</a>) <a href="@0@System/A.html#4a9454016805ca53" class="t t">WebRequest</a>.<a href="@0@System/A.html#6216de40b052b741" class="i method">Create</a>(<span class="r4 r">url</span>);
				<b>return</b> (<a href="@0@System/A.html#b51bad13c30be1c4" class="t t">HttpWebResponse</a>) <span class="r5 r">request</span>.<a href="@0@System/A.html#9080c16d0396fb3d" class="i method">GetResponse</a>();
			}
			<b>catch</b> (<a href="@0@System/A.html#47e37066345d8b7c" class="t t">WebException</a> <span id="r6 rd" class="r6 r">e</span>) {
				<span class="c">//wtf, why does WebRequest throw for non-200 status codes?!</span>
				<b>return</b> (<a href="@0@System/A.html#b51bad13c30be1c4" class="t t">HttpWebResponse</a>) <span class="r6 r">e</span>.<a href="@0@System/A.html#3184d7b61c9cbfc3" class="i property">Response</a>;
			}
		}
 
		<b>public</b> <a href="@0@System/A.html#b51bad13c30be1c4" class="t t">HttpWebResponse</a> <a id="bc1008913032d867" href="R/bc1008913032d867.html" target="n" data-glyph="72,1" class="i method">Post</a>(<b>string</b> <span id="r7 rd" class="r7 r">url</span>, <b>string</b> <span id="r8 rd" class="r8 r">contentType</span> = <b>null</b>) {
			<b>try</b> {
				<span class="r7 r">url</span> = <span class="i method">NormalizeUrl</span>(<span class="r7 r">url</span>);
				<a href="@0@System/A.html#f2ab2d685cb26f13" class="k">var</a> <span id="r9 rd" class="r9 r">request</span> = (<a href="@0@System/A.html#f2ab2d685cb26f13" class="t t">HttpWebRequest</a>) <a href="@0@System/A.html#4a9454016805ca53" class="t t">WebRequest</a>.<a href="@0@System/A.html#6216de40b052b741" class="i method">Create</a>(<span class="r7 r">url</span>);
				<b>if</b> (<span class="r8 r">contentType</span> != <b>null</b>) {
					<span class="r9 r">request</span>.<a href="@0@System/A.html#3f436e84703160b6" class="i property">ContentType</a> = <span class="r8 r">contentType</span>;
				}
				<span class="r9 r">request</span>.<a href="@0@System/A.html#dfbb511da4373b9e" class="i property">Method</a> = <span class="s">&quot;POST&quot;</span>;
				<b>return</b> (<a href="@0@System/A.html#b51bad13c30be1c4" class="t t">HttpWebResponse</a>) <span class="r9 r">request</span>.<a href="@0@System/A.html#9080c16d0396fb3d" class="i method">GetResponse</a>();
			}
			<b>catch</b> (<a href="@0@System/A.html#47e37066345d8b7c" class="t t">WebException</a> <span id="r10 rd" class="r10 r">e</span>) {
				<b>return</b> (<a href="@0@System/A.html#b51bad13c30be1c4" class="t t">HttpWebResponse</a>) <span class="r10 r">e</span>.<a href="@0@System/A.html#3184d7b61c9cbfc3" class="i property">Response</a>;
			}
		}
	}
}</pre></td></tr></table></div></body></html>
